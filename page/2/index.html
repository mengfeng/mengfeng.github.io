<!DOCTYPE html>


<html lang="en">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> è‰ºæœ¯ç ç•œ</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-G16F14RTRN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-G16F14RTRN');
</script>

 
<script>
var _hmt = _hmt || [];
(function() {
	var hm = document.createElement("script");
	hm.src = "https://hm.baidu.com/hm.js?f5e6c5b5d28b6bff1c9eb1fcf7f6862b";
	var s = document.getElementsByTagName("script")[0]; 
	s.parentNode.insertBefore(hm, s);
})();
</script>


      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="è‰ºæœ¯ç ç•œ" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/mengfeng/mengfeng.github.io.git"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">è‰ºæœ¯ç ç•œ</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['é¢æœå¤§æµ·ï¼Œæ˜¥æš–èŠ±å¼€', 'æ„¿ä½ ä¸€ç”ŸåŠªåŠ›ï¼Œä¸€ç”Ÿè¢«çˆ±', 'æƒ³è¦çš„éƒ½æ‹¥æœ‰ï¼Œå¾—ä¸åˆ°çš„éƒ½é‡Šæ€€'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  
<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content">è‰ºæœ¯ç ç•œçš„ç”Ÿæ´»ç¬é—´</div>
</div>


<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-threejs-d-2-0"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/29/threejs-d-2-0/"
    >threejs-d-2.0</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/29/threejs-d-2-0/" class="article-date">
  <time datetime="2022-11-29T08:43:31.000Z" itemprop="datePublished">2022-11-29</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web3D/">Web3D</a> / <a class="article-category-link" href="/categories/Web3D/Three-js/">Three.js</a> / <a class="article-category-link" href="/categories/Web3D/Three-js/threejs-d-2-0/">threejs-d-2.0</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="threejs-d-2-0"><a href="#threejs-d-2-0" class="headerlink" title="threejs-d-2.0"></a>threejs-d-2.0</h1><h3 id="ä¸€ã€åˆ›å»ºç¬¬ä¸€ä¸ªthreejsåº”ç”¨"><a href="#ä¸€ã€åˆ›å»ºç¬¬ä¸€ä¸ªthreejsåº”ç”¨" class="headerlink" title="ä¸€ã€åˆ›å»ºç¬¬ä¸€ä¸ªthreejsåº”ç”¨"></a>ä¸€ã€åˆ›å»ºç¬¬ä¸€ä¸ªthreejsåº”ç”¨</h3><p>ä»£ç æ±‡æ€»ï¼š</p>
<pre><code class="javascript">//main.js
import * as THREE from &#39;three&#39;

const scene = new THREE.Scene();//åˆ›å»ºåœºæ™¯
const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );//åˆ›å»ºé€è§†ç›¸æœºï¼ˆç›¸æœºä¸­çš„ä¸€ç§ï¼‰
const renderer = new THREE.WebGLRenderer();//åˆ›å»ºæ¸²æŸ“å™¨
renderer.setSize( window.innerWidth, window.innerHeight );//å°†è¾“å‡ºcanvasçš„å¤§å°è°ƒæ•´ä¸º(width, height)å¹¶è€ƒè™‘è®¾å¤‡åƒç´ æ¯”ï¼Œä¸”å°†è§†å£ä»(0, 0)å¼€å§‹è°ƒæ•´åˆ°é€‚åˆå¤§å°
document.body.appendChild( renderer.domElement );//å°†rendererï¼ˆæ¸²æŸ“å™¨ï¼‰çš„domå…ƒç´ ï¼ˆrenderer.domElementï¼‰æ·»åŠ åˆ°æˆ‘ä»¬çš„HTMLæ–‡æ¡£ä¸­

const geometry = new THREE.BoxGeometry( 1, 1, 1 );//åˆ›å»ºå‡ ä½•ä½“
const material = new THREE.MeshBasicMaterial( &#123; color: 0x00ff00 &#125; );//åˆ›å»ºåŸºç¡€ç½‘æ ¼æè´¨
const cube = new THREE.Mesh( geometry, material );//ä½¿ç”¨æ„é€ å™¨
scene.add( cube );//å°†å‡ ä½•ä½“æ·»åŠ åˆ°åœºæ™¯
camera.position.z = 5;//è°ƒæ•´ç›¸æœºä½ç½®ï¼ˆé»˜è®¤0ï¼Œ0ï¼Œ0ï¼‰

//å‡ ä½•ä½“å¾ªç¯æ—‹è½¬åŠ¨ç”»
function animate() &#123;
    requestAnimationFrame( animate );
  //æ—‹è½¬åæ ‡å˜æ¢
    cube.rotation.x += 0.01;
    cube.rotation.y += 0.01;
  //é‡æ–°æ¸²æŸ“å‡ ä½•ä½“
    renderer.render( scene, camera );
&#125;
animate();
</code></pre>
<h4 id="1-åˆ›å»ºåœºæ™¯ã€ç›¸æœºã€æ¸²æŸ“å™¨"><a href="#1-åˆ›å»ºåœºæ™¯ã€ç›¸æœºã€æ¸²æŸ“å™¨" class="headerlink" title="1.åˆ›å»ºåœºæ™¯ã€ç›¸æœºã€æ¸²æŸ“å™¨"></a>1.åˆ›å»ºåœºæ™¯ã€ç›¸æœºã€æ¸²æŸ“å™¨</h4><blockquote>
<p>å¦‚æœæˆ‘ä»¬æœ‰ç©è¿‡ä¸‰ç»´è½¯ä»¶çš„åŒå­¦åº”è¯¥ä¸ä¼šé™Œç”Ÿè¿™å‡ ä¸ªæ¦‚å¿µ</p>
<p>æˆ‘ä»¬ä¸‹é¢ä»¥ä¸‰ç»´è½¯ä»¶C4Dæ¥ç®€å•è®¤è¯†ä¸€ä¸‹å§</p>
</blockquote>
<p><img src="/2022/11/29/threejs-d-2-0/image-20221129085326176.png"></p>
<p>æˆ‘ä»¬èŠ±ä¸€ç‚¹ç‚¹æ—¶é—´æ¥è§£é‡Šä¸€ä¸‹è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚æˆ‘ä»¬ç°åœ¨å»ºç«‹äº†åœºæ™¯ã€ç›¸æœºå’Œæ¸²æŸ“å™¨ã€‚</p>
<pre><code class="javascript">const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
const renderer = new THREE.WebGLRenderer();
renderer.setSize( window.innerWidth, window.innerHeight );
document.body.appendChild( renderer.domElement );
</code></pre>
<p>three.jsé‡Œæœ‰å‡ ç§ä¸åŒçš„ç›¸æœºï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯<strong>PerspectiveCamera</strong>ï¼ˆé€è§†æ‘„åƒæœºï¼‰ã€‚</p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<strong>è§†é‡è§’åº¦ï¼ˆFOVï¼‰</strong>ã€‚è§†é‡è§’åº¦å°±æ˜¯æ— è®ºåœ¨ä»€ä¹ˆæ—¶å€™ï¼Œä½ æ‰€èƒ½åœ¨æ˜¾ç¤ºå™¨ä¸Šçœ‹åˆ°çš„åœºæ™¯çš„èŒƒå›´ï¼Œå®ƒçš„å•ä½æ˜¯è§’åº¦(ä¸å¼§åº¦åŒºåˆ†å¼€)ã€‚</p>
<p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯<strong>é•¿å®½æ¯”ï¼ˆaspect ratioï¼‰</strong>ã€‚ ä¹Ÿå°±æ˜¯ä½ ç”¨ä¸€ä¸ªç‰©ä½“çš„å®½é™¤ä»¥å®ƒçš„é«˜çš„å€¼ã€‚æ¯”å¦‚è¯´ï¼Œå½“ä½ åœ¨ä¸€ä¸ªå®½å±ç”µè§†ä¸Šæ’­æ”¾è€ç”µå½±æ—¶ï¼Œå¯ä»¥çœ‹åˆ°å›¾åƒä»¿ä½›æ˜¯è¢«å‹æ‰çš„ã€‚</p>
<p>æ¥ä¸‹æ¥çš„ä¸¤ä¸ªå‚æ•°æ˜¯<strong>è¿‘æˆªé¢</strong>ï¼ˆnearï¼‰å’Œ<strong>è¿œæˆªé¢</strong>ï¼ˆfarï¼‰ã€‚ å½“ç‰©ä½“æŸäº›éƒ¨åˆ†æ¯”æ‘„åƒæœºçš„<strong>è¿œæˆªé¢</strong>è¿œæˆ–è€…æ¯”<strong>è¿‘æˆªé¢</strong>è¿‘çš„æ—¶å€™ï¼Œè¯¥è¿™äº›éƒ¨åˆ†å°†ä¸ä¼šè¢«æ¸²æŸ“åˆ°åœºæ™¯ä¸­ã€‚æˆ–è®¸ç°åœ¨ä½ ä¸ç”¨æ‹…å¿ƒè¿™ä¸ªå€¼çš„å½±å“ï¼Œä½†æœªæ¥ä¸ºäº†è·å¾—æ›´å¥½çš„æ¸²æŸ“æ€§èƒ½ï¼Œä½ å°†å¯ä»¥åœ¨ä½ çš„åº”ç”¨ç¨‹åºé‡Œå»è®¾ç½®å®ƒã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯æ¸²æŸ“å™¨ã€‚è¿™é‡Œæ˜¯æ–½å±•é­”æ³•çš„åœ°æ–¹ã€‚é™¤äº†æˆ‘ä»¬åœ¨è¿™é‡Œç”¨åˆ°çš„WebGLRendereræ¸²æŸ“å™¨ä¹‹å¤–ï¼ŒThree.jsåŒæ—¶æä¾›äº†å…¶ä»–å‡ ç§æ¸²æŸ“å™¨ï¼Œå½“ç”¨æˆ·æ‰€ä½¿ç”¨çš„æµè§ˆå™¨è¿‡äºè€æ—§ï¼Œæˆ–è€…ç”±äºå…¶ä»–åŸå› ä¸æ”¯æŒWebGLæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™å‡ ç§æ¸²æŸ“å™¨è¿›è¡Œé™çº§ã€‚</p>
<p>é™¤äº†åˆ›å»ºä¸€ä¸ªæ¸²æŸ“å™¨çš„å®ä¾‹ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºé‡Œè®¾ç½®ä¸€ä¸ªæ¸²æŸ“å™¨çš„å°ºå¯¸ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ‰€éœ€è¦çš„æ¸²æŸ“åŒºåŸŸçš„å®½é«˜ï¼Œæ¥è®©æ¸²æŸ“å™¨æ¸²æŸ“å‡ºçš„åœºæ™¯å¡«å……æ»¡æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¸²æŸ“å™¨å®½é«˜è®¾ç½®ä¸ºæµè§ˆå™¨çª—å£å®½é«˜ã€‚å¯¹äºæ€§èƒ½æ¯”è¾ƒæ•æ„Ÿçš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œä½ å¯ä»¥ä½¿ç”¨<strong>setSize</strong>ä¼ å…¥ä¸€ä¸ªè¾ƒå°çš„å€¼ï¼Œä¾‹å¦‚<strong>window.innerWidth&#x2F;2</strong>å’Œ<strong>window.innerHeight&#x2F;2</strong>ï¼Œè¿™å°†ä½¿å¾—åº”ç”¨ç¨‹åºåœ¨æ¸²æŸ“æ—¶ï¼Œä»¥ä¸€åŠçš„é•¿å®½å°ºå¯¸æ¸²æŸ“åœºæ™¯ã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›ä¿æŒä½ çš„åº”ç”¨ç¨‹åºçš„å°ºå¯¸ï¼Œä½†æ˜¯ä»¥è¾ƒä½çš„åˆ†è¾¨ç‡æ¥æ¸²æŸ“ï¼Œä½ å¯ä»¥åœ¨è°ƒç”¨<strong>setSize</strong>æ—¶ï¼Œå°†<strong>updateStyle</strong>ï¼ˆç¬¬ä¸‰ä¸ªå‚æ•°ï¼‰è®¾ä¸ºfalseã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ çš„<canvas> æ ‡ç­¾ç°åœ¨å·²ç»å…·æœ‰äº†100%çš„å®½å’Œé«˜ï¼Œè°ƒç”¨**setSize(window.innerWidth&#x2F;2, window.innerHeight&#x2F;2, false)**å°†ä½¿å¾—ä½ çš„åº”ç”¨ç¨‹åºä»¥ä¸€åŠçš„åˆ†è¾¨ç‡æ¥è¿›è¡Œæ¸²æŸ“ã€‚</p>
<pre><code class="javascript">document.body.appendChild( renderer.domElement );
</code></pre>
<p>æœ€åä¸€æ­¥å¾ˆé‡è¦ï¼Œæˆ‘ä»¬å°†<strong>renderer</strong>ï¼ˆæ¸²æŸ“å™¨ï¼‰çš„domå…ƒç´ ï¼ˆrenderer.domElementï¼‰æ·»åŠ åˆ°æˆ‘ä»¬çš„HTMLæ–‡æ¡£ä¸­ã€‚è¿™å°±æ˜¯æ¸²æŸ“å™¨ç”¨æ¥æ˜¾ç¤ºåœºæ™¯ç»™æˆ‘ä»¬çœ‹çš„<canvas>å…ƒç´ ã€‚</p>
<h4 id="2-åˆ›å»ºå‡ ä½•ä½“ã€æè´¨"><a href="#2-åˆ›å»ºå‡ ä½•ä½“ã€æè´¨" class="headerlink" title="2.åˆ›å»ºå‡ ä½•ä½“ã€æè´¨"></a>2.åˆ›å»ºå‡ ä½•ä½“ã€æè´¨</h4><blockquote>
<p>å¯¹äºæè´¨è¿™å—ï¼Œå°±æ˜¯ç»™ä¸€ä¸ªæ²¡æœ‰ä»»ä½•å±æ€§çš„ç‰©ä½“æ·»åŠ å±æ€§ï¼Œç»ç’ƒã€é‡‘å±ã€ç‰ã€æœ‰é¢œè‰²çš„ç«‹æ–¹ä½“ã€‚</p>
</blockquote>
<p><img src="/2022/11/29/threejs-d-2-0/image-20221129090339038.png"></p>
<p>è¦åˆ›å»ºä¸€ä¸ªç«‹æ–¹ä½“ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª<strong>BoxGeometry</strong>ï¼ˆç«‹æ–¹ä½“ï¼‰å¯¹è±¡. è¿™ä¸ªå¯¹è±¡åŒ…å«äº†ä¸€ä¸ªç«‹æ–¹ä½“ä¸­æ‰€æœ‰çš„é¡¶ç‚¹ï¼ˆ<strong>vertices</strong>ï¼‰å’Œé¢ï¼ˆ<strong>faces</strong>ï¼‰ã€‚æœªæ¥æˆ‘ä»¬å°†åœ¨è¿™æ–¹é¢è¿›è¡Œæ›´å¤šçš„æ¢ç´¢ã€‚</p>
<pre><code class="javascript">const geometry = new THREE.BoxGeometry( 1, 1, 1 );
const material = new THREE.MeshBasicMaterial( &#123; color: 0x00ff00 &#125; );
const cube = new THREE.Mesh( geometry, material );
scene.add( cube );
camera.position.z = 5;
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œå¯¹äºè¿™ä¸ªç«‹æ–¹ä½“ï¼Œæˆ‘ä»¬éœ€è¦ç»™å®ƒä¸€ä¸ªæè´¨ï¼Œæ¥è®©å®ƒæœ‰é¢œè‰²ã€‚Three.jsè‡ªå¸¦äº†å‡ ç§æè´¨ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯<strong>MeshBasicMaterial</strong>ã€‚æ‰€æœ‰çš„æè´¨éƒ½å­˜æœ‰åº”ç”¨äºä»–ä»¬çš„å±æ€§çš„å¯¹è±¡ã€‚åœ¨è¿™é‡Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åªè®¾ç½®ä¸€ä¸ªcolorå±æ€§ï¼Œå€¼ä¸º<strong>0x00ff00</strong>ï¼Œä¹Ÿå°±æ˜¯ç»¿è‰²ã€‚è¿™é‡Œæ‰€åšçš„äº‹æƒ…ï¼Œå’Œåœ¨CSSæˆ–è€…Photoshopä¸­ä½¿ç”¨åå…­è¿›åˆ¶(<strong>hex colors</strong>)é¢œè‰²æ ¼å¼æ¥è®¾ç½®é¢œè‰²çš„æ–¹å¼ä¸€è‡´ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª<strong>Mesh</strong>ï¼ˆç½‘æ ¼ï¼‰ã€‚ ç½‘æ ¼åŒ…å«ä¸€ä¸ªå‡ ä½•ä½“ä»¥åŠä½œç”¨åœ¨æ­¤å‡ ä½•ä½“ä¸Šçš„æè´¨ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†ç½‘æ ¼å¯¹è±¡æ”¾å…¥åˆ°æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œå¹¶è®©å®ƒåœ¨åœºæ™¯ä¸­è‡ªç”±ç§»åŠ¨ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬è°ƒç”¨**scene.add()<strong>çš„æ—¶å€™ï¼Œç‰©ä½“å°†ä¼šè¢«æ·»åŠ åˆ°</strong>(0,0,0)**åæ ‡ã€‚ä½†å°†ä½¿å¾—æ‘„åƒæœºå’Œç«‹æ–¹ä½“å½¼æ­¤åœ¨ä¸€èµ·ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ‘„åƒæœºç¨å¾®å‘å¤–ç§»åŠ¨ä¸€äº›å³å¯ã€‚</p>
<h4 id="3-åˆ›å»ºæ¸²æŸ“"><a href="#3-åˆ›å»ºæ¸²æŸ“" class="headerlink" title="3.åˆ›å»ºæ¸²æŸ“"></a>3.åˆ›å»ºæ¸²æŸ“</h4><blockquote>
<p>è¿™ä¸ªå°±æ¯”è¾ƒå¥½ç†è§£äº†ï¼Œæ·»åŠ xï¼Œyï¼Œzæ–¹å‘çš„ä½ç½®å˜åŒ–</p>
</blockquote>
<p>ç°åœ¨ï¼Œå¦‚æœå°†ä¹‹å‰å†™å¥½çš„ä»£ç å¤åˆ¶åˆ°HTMLæ–‡ä»¶ä¸­ï¼Œä½ ä¸ä¼šåœ¨é¡µé¢ä¸­çœ‹åˆ°ä»»ä½•ä¸œè¥¿ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å¯¹å®ƒè¿›è¡ŒçœŸæ­£çš„æ¸²æŸ“ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªè¢«å«åšâ€œ<strong>æ¸²æŸ“å¾ªç¯</strong>â€ï¼ˆrender loopï¼‰æˆ–è€…â€œ<strong>åŠ¨ç”»å¾ªç¯</strong>â€ï¼ˆanimate loopï¼‰çš„ä¸œè¥¿ã€‚</p>
<pre><code class="javascript">function animate() &#123; 
requestAnimationFrame( animate ); 
renderer.render( scene, camera ); 
&#125; 
animate();
</code></pre>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä½¿æ¸²æŸ“å™¨èƒ½å¤Ÿåœ¨æ¯æ¬¡å±å¹•åˆ·æ–°æ—¶å¯¹åœºæ™¯è¿›è¡Œç»˜åˆ¶çš„å¾ªç¯ï¼ˆåœ¨å¤§å¤šæ•°å±å¹•ä¸Šï¼Œåˆ·æ–°ç‡ä¸€èˆ¬æ˜¯60æ¬¡&#x2F;ç§’ï¼‰ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªæµè§ˆå™¨æ¸¸æˆå¼€å‘çš„æ–°æ‰‹ï¼Œä½ æˆ–è®¸ä¼šè¯´<em>â€œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸ç›´æ¥ç”¨setIntervalæ¥å®ç°åˆ·æ–°çš„åŠŸèƒ½å‘¢ï¼Ÿâ€</em>å½“ç„¶å•¦ï¼Œæˆ‘ä»¬çš„ç¡®å¯ä»¥ç”¨setIntervalï¼Œä½†æ˜¯ï¼Œ<strong>requestAnimationFrame</strong>æœ‰å¾ˆå¤šçš„ä¼˜ç‚¹ã€‚æœ€é‡è¦çš„ä¸€ç‚¹æˆ–è®¸å°±æ˜¯å½“ç”¨æˆ·åˆ‡æ¢åˆ°å…¶å®ƒçš„æ ‡ç­¾é¡µæ—¶ï¼Œå®ƒä¼šæš‚åœï¼Œå› æ­¤ä¸ä¼šæµªè´¹ç”¨æˆ·å®è´µçš„å¤„ç†å™¨èµ„æºï¼Œä¹Ÿä¸ä¼šæŸè€—ç”µæ± çš„ä½¿ç”¨å¯¿å‘½ã€‚</p>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œå¦‚æœä½ å·²ç»å°†ä¸Šé¢çš„ä»£ç å†™å…¥åˆ°äº†ä½ æ‰€åˆ›å»ºçš„æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç»¿è‰²çš„æ–¹å—ã€‚è®©æˆ‘ä»¬æ¥åšä¸€äº›æ›´åŠ æœ‰è¶£çš„äº‹ â€”â€” è®©å®ƒæ—‹è½¬èµ·æ¥ã€‚</p>
<p>å°†ä¸‹åˆ—ä»£ç æ·»åŠ åˆ°animate()å‡½æ•°ä¸­<strong>renderer.render</strong>è°ƒç”¨çš„ä¸Šæ–¹ï¼š</p>
<pre><code class="javascript">cube.rotation.x += 0.01; 
cube.rotation.y += 0.01;
</code></pre>
<p>è¿™æ®µä»£ç æ¯å¸§éƒ½ä¼šæ‰§è¡Œï¼ˆæ­£å¸¸æƒ…å†µä¸‹æ˜¯60æ¬¡&#x2F;ç§’ï¼‰ï¼Œè¿™å°±è®©ç«‹æ–¹ä½“æœ‰äº†ä¸€ä¸ªçœ‹èµ·æ¥å¾ˆä¸é”™çš„æ—‹è½¬åŠ¨ç”»ã€‚åŸºæœ¬ä¸Šæ¥è¯´ï¼Œå½“åº”ç”¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå¦‚æœä½ æƒ³è¦ç§»åŠ¨æˆ–è€…æ”¹å˜ä»»ä½•åœºæ™¯ä¸­çš„ä¸œè¥¿ï¼Œéƒ½å¿…é¡»è¦ç»è¿‡è¿™ä¸ªåŠ¨ç”»å¾ªç¯ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªåŠ¨ç”»å¾ªç¯é‡Œè°ƒç”¨åˆ«çš„å‡½æ•°ï¼Œè¿™æ ·ä½ å°±ä¸ä¼šå†™å‡ºæœ‰ä¸Šç™¾è¡Œä»£ç çš„<strong>animate</strong>å‡½æ•°ã€‚</p>
<h4 id="æ•ˆæœæ¼”ç¤ºï¼š"><a href="#æ•ˆæœæ¼”ç¤ºï¼š" class="headerlink" title="æ•ˆæœæ¼”ç¤ºï¼š"></a>æ•ˆæœæ¼”ç¤ºï¼š</h4><p><img src="/2022/11/29/threejs-d-2-0/image-20221129090831716.png"></p>
<h3 id="äºŒã€æ§åˆ¶å™¨ï¼ˆè½¨é“æ§åˆ¶å™¨ï¼‰"><a href="#äºŒã€æ§åˆ¶å™¨ï¼ˆè½¨é“æ§åˆ¶å™¨ï¼‰" class="headerlink" title="äºŒã€æ§åˆ¶å™¨ï¼ˆè½¨é“æ§åˆ¶å™¨ï¼‰"></a>äºŒã€æ§åˆ¶å™¨ï¼ˆè½¨é“æ§åˆ¶å™¨ï¼‰</h3><blockquote>
<p>æ§åˆ¶å™¨æœ‰è®¸å¤šï¼Œæˆ‘ä»¬è¿™å…ˆè¯´è¿™ä¸€ç§</p>
<p>è½¨é“æ§åˆ¶å™¨æ˜¯ä»¥ç‰©ä½“ä¸ºä¸­å¿ƒï¼Œå¯¹ç‰©ä½“åšç¯ç»•è¿åŠ¨</p>
</blockquote>
<p>ä»£ç æ±‡æ€»ï¼š</p>
<pre><code class="javascript">//main.js
import * as THREE from &#39;three&#39;
import &#123; OrbitControls &#125; from &#39;three/examples/jsm/controls/OrbitControls&#39; //å¯¼å…¥è½¨é“æ§åˆ¶å™¨

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 10000 );
const renderer = new THREE.WebGLRenderer();
renderer.setSize( window.innerWidth, window.innerHeight );
document.body.appendChild( renderer.domElement );

const geometry = new THREE.BoxGeometry( 5, 5, 5 );
const material = new THREE.MeshBasicMaterial( &#123; color: 0x00ff00 &#125; );
const cube = new THREE.Mesh( geometry, material );
scene.add( cube );
const controls = new OrbitControls( camera,renderer.domElement  );
camera.position.set(0,20,100);
controls.update();//æ›´æ–°æ§åˆ¶å™¨ã€‚å¿…é¡»åœ¨æ‘„åƒæœºçš„å˜æ¢å‘ç”Ÿä»»ä½•æ‰‹åŠ¨æ”¹å˜åè°ƒç”¨
function animate() &#123;
    requestAnimationFrame( animate );
    controls.update();//å¾ªç¯æ›´æ–°è½¨é“æ§åˆ¶å™¨
    renderer.render( scene, camera );
&#125;
animate();
</code></pre>
<p>OrbitControls( object : Camera, domElement : HTMLDOMElement )</p>
<p>object: ï¼ˆå¿…é¡»ï¼‰å°†è¦è¢«æ§åˆ¶çš„ç›¸æœºã€‚è¯¥ç›¸æœºä¸å…è®¸æ˜¯å…¶ä»–ä»»ä½•å¯¹è±¡çš„å­çº§ï¼Œé™¤éè¯¥å¯¹è±¡æ˜¯åœºæ™¯è‡ªèº«ã€‚</p>
<p>domElement: ç”¨äºäº‹ä»¶ç›‘å¬çš„HTMLå…ƒç´ ã€‚</p>
<p>é‚£æˆ‘ä»¬ç°åœ¨å°±å¯ä»¥ç§»åŠ¨æˆ‘ä»¬çš„ç›¸æœºæ¥è§‚å¯Ÿæˆ‘ä»¬çš„ç‰©ä½“äº†ã€‚</p>
<h3 id="ä¸‰ã€æ·»åŠ è¾…åŠ©å™¨"><a href="#ä¸‰ã€æ·»åŠ è¾…åŠ©å™¨" class="headerlink" title="ä¸‰ã€æ·»åŠ è¾…åŠ©å™¨"></a>ä¸‰ã€æ·»åŠ è¾…åŠ©å™¨</h3><blockquote>
<p>è¿™ä¸ªæ¥è‡ªä¸æˆ‘ä»¬helpé‡Œé¢çš„ä¸œè¥¿ï¼Œæ–‡æ¡£é‡ŒæŸ¥å°±å¯ä»¥äº†</p>
<p>æ·»åŠ è¾…åŠ©å™¨çš„ç”¨å¤„æ˜¯ä¸ºäº†æ›´å¥½çš„å»å¼€å‘</p>
</blockquote>
<h4 id="1-åæ ‡è¾…åŠ©å™¨"><a href="#1-åæ ‡è¾…åŠ©å™¨" class="headerlink" title="1.åæ ‡è¾…åŠ©å™¨"></a>1.åæ ‡è¾…åŠ©å™¨</h4><blockquote>
<p>ç”¨äºç®€å•æ¨¡æ‹Ÿ3ä¸ªåæ ‡è½´çš„å¯¹è±¡.<br>çº¢è‰²ä»£è¡¨ X è½´. ç»¿è‰²ä»£è¡¨ Y è½´. è“è‰²ä»£è¡¨ Z è½´.</p>
</blockquote>
<pre><code class="javascript">const axesHelper = new THREE.AxesHelper( 5 );//è½´çš„çº¿æ®µé•¿åº¦. é»˜è®¤ä¸º 1.
scene.add( axesHelper );//æ·»åŠ åˆ°åœºæ™¯
</code></pre>
<p><img src="/2022/11/29/threejs-d-2-0/image-20221129155031932.png"></p>
<h4 id="2-ç›¸æœºè¾…åŠ©å™¨"><a href="#2-ç›¸æœºè¾…åŠ©å™¨" class="headerlink" title="2.ç›¸æœºè¾…åŠ©å™¨"></a>2.ç›¸æœºè¾…åŠ©å™¨</h4><blockquote>
<p>ç”¨äºæ¨¡æ‹Ÿç›¸æœºè§†é”¥ä½“çš„è¾…åŠ©å¯¹è±¡.<br>å®ƒä½¿ç”¨ LineSegments æ¥æ¨¡æ‹Ÿç›¸æœºè§†é”¥ä½“.</p>
</blockquote>
<pre><code class="javascript">const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
const helper = new THREE.CameraHelper( camera );
scene.add( helper );
</code></pre>
<p><img src="/2022/11/29/threejs-d-2-0/image-20221129155852737.png"></p>
<p>CameraHelper( camera : Camera )</p>
<p>camera â€“ è¢«æ¨¡æ‹Ÿçš„ç›¸æœº.</p>
<p>ä¸ºæŒ‡å®šç›¸æœºåˆ›å»ºä¸€ä¸ªæ–°çš„ç›¸æœºè¾…åŠ©å¯¹è±¡ CameraHelper .</p>
<h4 id="3-å¹³é¢è¾…åŠ©å™¨"><a href="#3-å¹³é¢è¾…åŠ©å™¨" class="headerlink" title="3.å¹³é¢è¾…åŠ©å™¨"></a>3.å¹³é¢è¾…åŠ©å™¨</h4><blockquote>
<p>ç”¨äºæ¨¡æ‹Ÿå¹³é¢ Plane çš„è¾…åŠ©å¯¹è±¡.</p>
</blockquote>
<pre><code class="javascript">const plane = new THREE.Plane( new THREE.Vector3( 1, 1, 0.2 ), 3 );
const helper = new THREE.PlaneHelper( plane, 100, 0xffff00 );
scene.add( helper );
</code></pre>
<p><img src="/2022/11/29/threejs-d-2-0/image-20221129160213446.png"></p>
<p>PlaneHelper( plane : Plane, size : Float, hex : Color )</p>
<p>plane â€“ è¢«æ¨¡æ‹Ÿçš„å¹³é¢.<br>size â€“ (å¯é€‰çš„) è¾…åŠ©å¯¹è±¡çš„å•è¾¹é•¿åº¦. é»˜è®¤ä¸º 1.<br>color â€“ (å¯é€‰çš„) è¾…åŠ©å¯¹è±¡çš„é¢œè‰². é»˜è®¤ä¸º 0xffff00.</p>
<p>åˆ›å»ºä¸€ä¸ªçº¿æ¡†è¾…åŠ©å¯¹è±¡æ¥è¡¨ç¤ºæŒ‡å®šå¹³é¢.</p>
<h4 id="ç»ˆç»“ï¼š"><a href="#ç»ˆç»“ï¼š" class="headerlink" title="ç»ˆç»“ï¼š"></a>ç»ˆç»“ï¼š</h4><p>å…¶ä»–çš„è¾…åŠ©å™¨ï¼Œæˆ‘ä»¬å°±è‡ªå·±æŒ‰ç…§éœ€æ±‚å»åŠ å§ï¼Œè¿™ä¸ªå°±æ˜¯åšä¸€ä¸ªå‚ç…§</p>
<h3 id="å››ã€ç‰©ä½“çš„å±æ€§"><a href="#å››ã€ç‰©ä½“çš„å±æ€§" class="headerlink" title="å››ã€ç‰©ä½“çš„å±æ€§"></a>å››ã€ç‰©ä½“çš„å±æ€§</h3><blockquote>
<p>ç‰©ä½“çš„å±æ€§ï¼Œé‚£æˆ‘ä»¬è¦çœ‹ä¸€ä¸‹cubeæ˜¯ä»€ä¹ˆäº†</p>
<p>æ ¹æ®æ§åˆ¶å°æ‰“å°ï¼Œå®ƒæ˜¯ä¸ªMeshç±»ï¼Œä¸‹é¢æœ‰è®¸å¤šå±æ€§</p>
</blockquote>
<pre><code class="javascript">const geometry = new THREE.BoxGeometry( 5, 5, 5 );
const material = new THREE.MeshBasicMaterial( &#123; color: 0x00ff00 &#125; );
const cube = new THREE.Mesh( geometry, material );
scene.add( cube );
</code></pre>
<p><img src="/2022/11/29/threejs-d-2-0/image-20221129160944920.png"></p>
<h4 id="1-ç‰©ä½“çš„ä½ç§»"><a href="#1-ç‰©ä½“çš„ä½ç§»" class="headerlink" title="1.ç‰©ä½“çš„ä½ç§»"></a>1.ç‰©ä½“çš„ä½ç§»</h4><blockquote>
<p>æ§åˆ¶ç‰©ä½“çš„ä½ç½®</p>
</blockquote>
<pre><code class="javascript">cube.position.set(10,0,0)//é»˜è®¤ä¸ºxï¼Œyï¼Œzæ–¹å‘
</code></pre>
<p><img src="/2022/11/29/threejs-d-2-0/image-20221129161420179.png"></p>
<h4 id="2-ç‰©ä½“çš„æ—‹è½¬"><a href="#2-ç‰©ä½“çš„æ—‹è½¬" class="headerlink" title="2.ç‰©ä½“çš„æ—‹è½¬"></a>2.ç‰©ä½“çš„æ—‹è½¬</h4><blockquote>
<p>æ§åˆ¶é—®é¢˜çš„æ—‹è½¬è§’åº¦</p>
<p>è¿™ä¸ªä¸æ˜¯å•çº¯çš„ä¸‰ç»´å‘é‡äº†</p>
<p>æ˜¯ä¸€ä¸ªEulerç±»</p>
</blockquote>
<pre><code class="javascript">cube.rotation.set(Math.PI/4,0,0,&#39;XYZ&#39;)//é»˜è®¤ä¸ºâ€˜xyzâ€™
</code></pre>
<p><img src="/2022/11/29/threejs-d-2-0/image-20221129162730828.png"></p>
<p>Euler( x : Float, y : Float, z : Float, order : String )</p>
<p>x - (optional) ç”¨å¼§åº¦è¡¨ç¤ºxè½´æ—‹è½¬é‡ã€‚ é»˜è®¤å€¼æ˜¯ <strong>0</strong>ã€‚<br>y - (optional) ç”¨å¼§åº¦è¡¨ç¤ºyè½´æ—‹è½¬é‡ã€‚ é»˜è®¤å€¼æ˜¯ <strong>0</strong>ã€‚<br>z - (optional) ç”¨å¼§åº¦è¡¨ç¤ºzè½´æ—‹è½¬é‡ã€‚ é»˜è®¤å€¼æ˜¯ <strong>0</strong>ã€‚<br>order - (optional) è¡¨ç¤ºæ—‹è½¬é¡ºåºçš„å­—ç¬¦ä¸²ï¼Œé»˜è®¤ä¸ºâ€™XYZâ€™ï¼ˆå¿…é¡»æ˜¯å¤§å†™ï¼‰ã€‚</p>
<h4 id="3-ç‰©ä½“çš„ç¼©æ”¾"><a href="#3-ç‰©ä½“çš„ç¼©æ”¾" class="headerlink" title="3.ç‰©ä½“çš„ç¼©æ”¾"></a>3.ç‰©ä½“çš„ç¼©æ”¾</h4><blockquote>
<p>æ§åˆ¶ç‰©ä½“ç¼©æ”¾</p>
</blockquote>
<pre><code class="javascript">cube.scale.set(3,2,1)
</code></pre>
<p><img src="/2022/11/29/threejs-d-2-0/image-20221129161943968.png"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/threejs/" rel="tag">threejs</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-electron-vue3-vite"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/28/electron-vue3-vite/"
    >electron-vue3-vite</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/28/electron-vue3-vite/" class="article-date">
  <time datetime="2022-11-28T04:04:11.000Z" itemprop="datePublished">2022-11-28</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Electron/">Electron</a> / <a class="article-category-link" href="/categories/Electron/electron-vue3-vite/">electron-vue3-vite</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Electron-Vue3-Vite"><a href="#Electron-Vue3-Vite" class="headerlink" title="Electron-Vue3-Vite"></a>Electron-Vue3-Vite</h1><blockquote>
<p>ä»Šå¤©è¿™ä¸€ç¯‡æ–‡ç« ç®—æ˜¯electronçš„ä¸€ä¸ªçŸ­æš‚çš„ç»“å°¾ï¼Œä»¥åæˆ‘ä»¬å†æ›´æ–°electron çš„çŸ¥è¯†ã€‚</p>
<p>ä»Šå¤©çš„å†…å®¹æ˜¯é¡¹ç›®çš„vue3+electroné¡¹ç›®æ­å»ºå’Œæ‰“åŒ…éƒ¨ç½²</p>
</blockquote>
<h3 id="ä¸€ã€Electron-Vue3-Viteæ­å»º"><a href="#ä¸€ã€Electron-Vue3-Viteæ­å»º" class="headerlink" title="ä¸€ã€Electron-Vue3-Viteæ­å»º"></a>ä¸€ã€Electron-Vue3-Viteæ­å»º</h3><h4 id="1-åˆ›å»ºæ¨¡æ¿"><a href="#1-åˆ›å»ºæ¨¡æ¿" class="headerlink" title="1.åˆ›å»ºæ¨¡æ¿"></a>1.åˆ›å»ºæ¨¡æ¿</h4><blockquote>
<p>ï¼ï¼ï¼å…¼å®¹æ€§æ³¨æ„</p>
<p>Vite éœ€è¦ Node.jsç‰ˆæœ¬ 14.18+ï¼Œ16+ã€‚ç„¶è€Œï¼Œæœ‰äº›æ¨¡æ¿éœ€è¦ä¾èµ–æ›´é«˜çš„ Node ç‰ˆæœ¬æ‰èƒ½æ­£å¸¸è¿è¡Œï¼Œå½“ä½ çš„åŒ…ç®¡ç†å™¨å‘å‡ºè­¦å‘Šæ—¶ï¼Œè¯·æ³¨æ„å‡çº§ä½ çš„ Node ç‰ˆæœ¬ã€‚</p>
</blockquote>
<pre><code class="ini">//ä½¿ç”¨npm
npm create vite@latest
//ä½¿ç”¨yarn
yarn create vite
//ä½¿ç”¨pnpm
pnpm create vite
</code></pre>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ï¼š</p>
<pre><code class="ini">npm i //å®‰è£…ä¾èµ–
npm run dev //å¯åŠ¨é¡¹ç›®
</code></pre>
<p><img src="/2022/11/28/electron-vue3-vite/image-20221127082439543.png"></p>
<p><img src="/2022/11/28/electron-vue3-vite/image-20221127082625854.png"></p>
<h4 id="2-å®‰è£…electron"><a href="#2-å®‰è£…electron" class="headerlink" title="2.å®‰è£…electron"></a>2.å®‰è£…electron</h4><pre><code class="ini">npm i electron -D 
</code></pre>
<p>ç›®å‰åšä¸»é‡åˆ°äº†ä¸€ä¸ªå°é—®é¢˜ï¼Œå°±æ˜¯ä¸‹è½½electronä¼šä¸€ç›´å¡ä½ï¼Œè¿™é‡Œä½¿ç”¨å¦‚ä¸‹æ–¹æ³•å°±å¯ä»¥è§£å†³äº†ã€‚</p>
<pre><code class="ini">npm install cnpm -g --registry=https://registry.npm.taobao.org //åˆ‡æ¢å›½å†…é•œåƒæº
cnpm isntall electron --save-dev
</code></pre>
<p><img src="/2022/11/28/electron-vue3-vite/image-20221128081646599.png"></p>
<h4 id="3-åˆ›å»ºå…¥å£æ–‡ä»¶"><a href="#3-åˆ›å»ºå…¥å£æ–‡ä»¶" class="headerlink" title="3.åˆ›å»ºå…¥å£æ–‡ä»¶"></a>3.åˆ›å»ºå…¥å£æ–‡ä»¶</h4><p>æ ¹ç›®å½•ä¸‹åˆ›å»º</p>
<p>Main.jså…¥å£æ–‡ä»¶</p>
<pre><code class="javascript">//main.js
const &#123; app,BrowserWindow &#125; = require(&#39;electron&#39;)
const path = require(&#39;path&#39;)
const WinState = require(&#39;electron-win-state&#39;).default //ä¿å­˜çª—å£çŠ¶æ€çš„åŒ…ï¼ˆçª—å£å¯ä»¥ä¿å­˜ç¼©æ”¾ã€ä½ç½®çŠ¶æ€ï¼‰

const createWindow = () =&gt; &#123;
  const winState = new WinState(&#123; 
    defaultWidth: 1000,
    defaultHeight: 800,
    // other winState options, see below
  &#125;)
    const win = new BrowserWindow(&#123;
      ...winState.winOptions,
      // width: 800,
      // height: 600,
      webPreferences: &#123;
        preload: path.join(__dirname, &#39;preload.js&#39;)
      &#125;
    &#125;)
    win.loadURL(&#39;http://127.0.0.1:5173/&#39;) //åŠ è½½æœ¬åœ°ç«¯å£ï¼Œéƒ¨ç½²çš„æ—¶å€™å¯ä»¥æ¢æˆæˆ‘ä»¬çš„åŸŸå
    win.webContents.openDevTools() //æ‰“å¼€æ§åˆ¶å°è°ƒè¯•
    winState.manage(win)
  &#125;

  app.whenReady().then(() =&gt; &#123;
    createWindow()
    app.on(&#39;activate&#39;, () =&gt; &#123;
      if (BrowserWindow.getAllWindows().length === 0) createWindow()
    &#125;)
  &#125;) 

  app.on(&#39;window-all-closed&#39;, () =&gt; &#123;
    if (process.platform !== &#39;darwin&#39;) app.quit()
  &#125;)
</code></pre>
<p>Preload.jsé¢„åŠ è½½æ–‡ä»¶</p>
<pre><code class="javascript">//ç›®å‰å…ˆä¸å†™å†…å®¹ï¼Œå…ˆæ­ä¸ªæ¶å­
</code></pre>
<p>é…ç½®package.json</p>
<pre><code class="javascript">//package.json
&#123;
  &quot;name&quot;: &quot;vite-project&quot;,
  &quot;private&quot;: true,
  &quot;version&quot;: &quot;0.0.0&quot;,
  &quot;main&quot;: &quot;main.js&quot;,
  &quot;scripts&quot;: &#123;
    &quot;dev&quot;: &quot;vite&quot;,
    &quot;build&quot;: &quot;vite build&quot;,
    &quot;preview&quot;: &quot;vite preview&quot;,
    &quot;start&quot;: &quot;nodemon --exec electron . --watch ./ --ext .js,.html,.vue,.css&quot;,
  &#125;,
  &quot;dependencies&quot;: &#123;
    &quot;electron-win-state&quot;: &quot;^1.1.22&quot;,
    &quot;vue&quot;: &quot;^3.2.41&quot;
  &#125;,
  &quot;devDependencies&quot;: &#123;
    &quot;@vitejs/plugin-vue&quot;: &quot;^3.2.0&quot;,
    &quot;electron&quot;: &quot;^21.3.1&quot;,
    &quot;electron-builder&quot;: &quot;^23.6.0&quot;,
    &quot;nodemon&quot;: &quot;^2.0.20&quot;,
    &quot;vite&quot;: &quot;^3.2.3&quot;
  &#125;
&#125;

</code></pre>
<h4 id="4-å®‰è£…å…¶ä»–ä¾èµ–"><a href="#4-å®‰è£…å…¶ä»–ä¾èµ–" class="headerlink" title="4.å®‰è£…å…¶ä»–ä¾èµ–"></a>4.å®‰è£…å…¶ä»–ä¾èµ–</h4><pre><code class="ini">cnpm install nodemon --save-dev //å®‰è£…nodemon
cnpm install electron-win-state --save-dev //å®‰è£…electron-win-state
</code></pre>
<h4 id="5-è¿è¡Œé¡¹ç›®"><a href="#5-è¿è¡Œé¡¹ç›®" class="headerlink" title="5.è¿è¡Œé¡¹ç›®"></a>5.è¿è¡Œé¡¹ç›®</h4><pre><code class="ini">npm run dev //å¯åŠ¨vueé¡¹ç›®
npm start //å¯åŠ¨electron
</code></pre>
<p><img src="/2022/11/28/electron-vue3-vite/image-20221128085457686.png"></p>
<p>æˆ‘ä»¬ç°åœ¨å°±å¯ä»¥å»å¼€å‘æˆ‘ä»¬çš„é¡¹ç›®äº†</p>
<p><img src="/2022/11/28/electron-vue3-vite/image-20221128085520887.png"></p>
<h3 id="äºŒã€æ‰“åŒ…ä¸éƒ¨ç½²"><a href="#äºŒã€æ‰“åŒ…ä¸éƒ¨ç½²" class="headerlink" title="äºŒã€æ‰“åŒ…ä¸éƒ¨ç½²"></a>äºŒã€æ‰“åŒ…ä¸éƒ¨ç½²</h3><p>å®˜ç½‘æ¨èæˆ‘ä»¬çš„æ˜¯<a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/latest/tutorial/forge-overview">Electron Forge</a>æ¥åˆ†å‘æˆ‘ä»¬çš„åº”ç”¨ç¨‹åº</p>
<blockquote>
<p>electron-forge å¯ä»¥è‡ªåŠ¨æ£€æµ‹ä½ çš„ç³»ç»Ÿï¼Œç„¶åæ‰“åŒ…æˆå¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚<br>å®ƒå¯ä»¥å®ç° package æˆæœ€ç»ˆå¯ç”¨çš„ç‹¬ç«‹é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œ<br>è¿˜å¯ä»¥ make æˆèƒ½å¤Ÿå®‰è£…çš„ zip åŒ…</p>
</blockquote>
<p>ç›®å‰è¿™ä¸ªæ–¹æ³•æœ‰ä¸€äº›é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆç”¨å¦ä¸€ç§æ–¹æ³•æ¥è¿›è¡Œæ‰“åŒ…<a target="_blank" rel="noopener" href="https://www.electron.build/">electron-build</a></p>
<p>æ ¹æ®æ–‡æ¡£æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå¿«çš„æŒæ¡è¿™ç§æ‰“åŒ…æ–¹å¼</p>
<h4 id="1-å®‰è£…ä¾èµ–"><a href="#1-å®‰è£…ä¾èµ–" class="headerlink" title="1.å®‰è£…ä¾èµ–"></a>1.å®‰è£…ä¾èµ–</h4><pre><code class="ini">cnpm i electron-builder -D //å®‰è£…ä¾èµ–
</code></pre>
<p>é…ç½®ä¸€ä¸‹package.json</p>
<pre><code class="javascript">//package.json+
&quot;scripts&quot;: &#123;
  ...
  &quot;app:dir&quot;: &quot;electron-builder --dir&quot;,
  &quot;app:dist&quot;: &quot;electron-builder&quot;
  ...
&#125;
</code></pre>
<h4 id="2-æ‰“åŒ…"><a href="#2-æ‰“åŒ…" class="headerlink" title="2.æ‰“åŒ…"></a>2.æ‰“åŒ…</h4><pre><code class="ini">cnpm run app:dist  //æ‰§è¡Œæ‰“åŒ…
</code></pre>
<p>ç›®å‰æˆ‘é‡åˆ°æ‰“åŒ…é”™è¯¯çš„é—®é¢˜</p>
<p><img src="/2022/11/28/electron-vue3-vite/image-20221128115215328.png"></p>
<p>å¦‚æœæˆ‘ä»¬é‡åˆ°è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬åˆ‡æ¢ä¸€ä¸‹npmé•œåƒæºå°±å¯ä»¥äº†ï¼›</p>
<p><img src="/2022/11/28/electron-vue3-vite/image-20221128115258224.png"></p>
<p>ç°åœ¨æˆ‘ä»¬æ‰“åŒ…å°±æˆåŠŸäº†</p>
<h4 id="3-è¿è¡Œå®‰è£…åŒ…"><a href="#3-è¿è¡Œå®‰è£…åŒ…" class="headerlink" title="3.è¿è¡Œå®‰è£…åŒ…"></a>3.è¿è¡Œå®‰è£…åŒ…</h4><p>æ‰¾åˆ°æˆ‘ä»¬é¡¹ç›®ç›®å½•ä¸‹çš„distæ–‡ä»¶çš„.dmgå®‰è£…åŒ…ï¼ˆæˆ‘çš„æ˜¯macï¼‰</p>
<p>åœ¨è¿è¡Œä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆå°†é¡¹ç›® è¿è¡Œ èµ·æ¥ï¼ˆå› ä¸ºæˆ‘ä»¬æ˜¯æœ¬åœ°é¡¹ç›®ï¼Œç­‰éƒ¨ç½²åˆ°æœåŠ¡å™¨å°±ä¸ç”¨äº†ï¼‰</p>
<p><img src="/2022/11/28/electron-vue3-vite/image-20221128115702655.png"></p>
<p>ç‚¹å‡»æ‰§è¡Œå®‰è£…åŒ…</p>
<p><img src="/2022/11/28/electron-vue3-vite/image-20221128115730129.png"></p>
<p><img src="/2022/11/28/electron-vue3-vite/image-20221128115827756.png"></p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„electronçš„æ­å»º-&gt;å¼€å‘-&gt;æ‰“åŒ…å°±ä¸€æ°”å‘µæˆäº†ï¼Œå½“ç„¶ï¼Œå¼€å‘é¡¹ç›®ä¸­è¿˜æœ‰è®¸å¤šå¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜å’ŒçŸ¥è¯†ç‚¹ï¼Œå°±é å„ä½èªæ˜çš„è„‘ç“œäº†ã€‚ã€‚</p>
<p><img src="/2022/11/28/electron-vue3-vite/tl.webp"></p>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[Electronå®˜ç½‘]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/docs/latest/tutorial/forge-overview">https://www.electronjs.org/docs/latest/tutorial/forge-overview</a> â€œ<br>[Vite.jså®˜ç½‘]: 	â€œ<a target="_blank" rel="noopener" href="https://cn.vitejs.dev/">https://cn.vitejs.dev/</a> â€œ<br>[electron-builder]: 	â€œ<a target="_blank" rel="noopener" href="https://github.com/electron-userland/electron-builder">https://github.com/electron-userland/electron-builder</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/electron/" rel="tag">electron</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-threejs-d-1-0"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/27/threejs-d-1-0/"
    >threejs-d-1.0</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/27/threejs-d-1-0/" class="article-date">
  <time datetime="2022-11-27T09:51:37.000Z" itemprop="datePublished">2022-11-27</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Web3D/">Web3D</a> / <a class="article-category-link" href="/categories/Web3D/Three-js/">Three.js</a> / <a class="article-category-link" href="/categories/Web3D/Three-js/threejs-d-1-0/">threejs-d-1.0</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="threejs-d-1-0"><a href="#threejs-d-1-0" class="headerlink" title="threejs-d-1.0"></a>threejs-d-1.0</h1><blockquote>
<p>d-1.0ä¸»è¦æ˜¯å‡†å¤‡æˆ‘ä»¬å¼€å‘ç¯å¢ƒå’Œå…¶ä»–çš„ä¸€äº›å‡†å¤‡ï¼Œä¸ºäº†æˆ‘ä»¬æ›´å¥½çš„å»è¿›å…¥threeçš„ä¸–ç•Œ</p>
</blockquote>
<h3 id="ä¸€ã€æ­å»ºthree-jsæœ¬åœ°ç½‘ç«™"><a href="#ä¸€ã€æ­å»ºthree-jsæœ¬åœ°ç½‘ç«™" class="headerlink" title="ä¸€ã€æ­å»ºthree.jsæœ¬åœ°ç½‘ç«™"></a>ä¸€ã€æ­å»ºthree.jsæœ¬åœ°ç½‘ç«™</h3><blockquote>
<p>æ­å»ºæœ¬åœ°ç½‘ç«™çš„åŸå› ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬è®¿é—®å®˜ç½‘çš„æ—¶å€™ï¼Œç”±äºç½‘é€Ÿé™åˆ¶ï¼Œå¯¼è‡´æˆ‘ä»¬çš„ä½“éªŒæ„Ÿä¸‹é™ï¼Œæ­å»ºæœ¬åœ°æœåŠ¡å™¨ï¼Œå¿«å¾ˆå¤šäº†ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æ‰“å¼€å®˜ç½‘<a target="_blank" rel="noopener" href="https://threejs.org/">Three.js</a>ç‚¹å‡»githubå°±è¿›å…¥äº†threejsä»“åº“äº†</p>
<p><img src="/2022/11/27/threejs-d-1-0/image-20221127171040581.png"></p>
<p>æˆ‘ä»¬ä¸‹è½½ä»“åº“çš„devå¼€å‘åŒ…</p>
<p>git clone å’Œ ä¸‹è½½å‹ç¼©åŒ…éƒ½å¯ä»¥ï¼</p>
<p><img src="/2022/11/27/threejs-d-1-0/image-20221127171152583.png"></p>
<p>æ‰§è¡Œå‘½ä»¤è¿è¡Œï¼š</p>
<pre><code class="ini">npm i //å®‰è£…ä¾èµ–
npm start //è¿è¡Œé¡¹ç›®
</code></pre>
<p><img src="/2022/11/27/threejs-d-1-0/image-20221127171346283.png"></p>
<p><img src="/2022/11/27/threejs-d-1-0/image-20221127171325067.png"></p>
<p>æˆ‘ä»¬ç°åœ¨è®¿é—®æœ¬åœ°é¡¹ç›®å°±å¿«å¤šäº†ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“ä»»ä½•ä¸€ä¸ªä¾‹å­ä¹Ÿå¯ä»¥æŸ¥çœ‹å…¶å…·ä½“çš„æ–‡ä»¶äº†ã€‚</p>
<h3 id="äºŒã€ä½¿ç”¨parcelæ­å»ºthreejså¼€å‘ç¯å¢ƒ"><a href="#äºŒã€ä½¿ç”¨parcelæ­å»ºthreejså¼€å‘ç¯å¢ƒ" class="headerlink" title="äºŒã€ä½¿ç”¨parcelæ­å»ºthreejså¼€å‘ç¯å¢ƒ"></a>äºŒã€ä½¿ç”¨<a target="_blank" rel="noopener" href="https://parceljs.org/">parcel</a>æ­å»ºthreejså¼€å‘ç¯å¢ƒ</h3><pre><code class="ini">npm init -y //åˆå§‹åŒ–é¡¹ç›®
npm install  parcel-bundler -D //å®‰è£…parcel
</code></pre>
<p>è®¾ç½®å…¥å£æ–‡ä»¶main.jså’Œindex.html</p>
<p><img src="/2022/11/27/threejs-d-1-0/image-20221127173957450.png"></p>
<p>é…ç½®package.json</p>
<pre><code class="javascript">//package.json
&#123;
  &quot;name&quot;: &quot;threejs&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.js&quot;,
  &quot;scripts&quot;: &#123;
    &quot;dev&quot;: &quot;parcel ./src/index.html&quot;,
    &quot;build&quot;: &quot;parcel build ./src/index.html&quot;
  &#125;,
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;devDependencies&quot;: &#123;
    &quot;parcel-bundler&quot;: &quot;^1.12.5&quot;
  &#125;
&#125;
</code></pre>
<p>ä¸‹è½½threejsä¾èµ–</p>
<pre><code class="ini">npm install three --save //å®‰è£…ä¾èµ–
</code></pre>
<pre><code class="javascript">//main.js
import * as THREE from &#39;three&#39;
console.log(THREE)
</code></pre>
<p>è¿è¡Œé¡¹ç›®ï¼Œæ‰“åŒ…é¡¹ç›®</p>
<pre><code class="ini">npm run dev //è¿è¡Œé¡¹ç›®
npm run build //æ‰“åŒ…é¡¹ç›®
</code></pre>
<p><img src="/2022/11/27/threejs-d-1-0/image-20221127174654769.png"></p>
<p><img src="/2022/11/27/threejs-d-1-0/image-20221127174742984.png"></p>
<p>è¿è¡ŒæˆåŠŸï¼ï¼ï¼</p>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[Three.jså®˜ç½‘]: 	â€œ<a target="_blank" rel="noopener" href="https://threejs.org/">https://threejs.org/</a> â€œ<br>[Three.js-github]: 	â€œ<a target="_blank" rel="noopener" href="https://github.com/mrdoob/three.js/">https://github.com/mrdoob/three.js/</a> â€œ<br>[parcelå®˜ç½‘]: 	â€œ<a target="_blank" rel="noopener" href="https://parceljs.org/&quot;">https://parceljs.org/&quot;</a><br>[parcelä¸­æ–‡å®˜ç½‘]: 	â€œ<a target="_blank" rel="noopener" href="https://www.parceljs.cn/">https://www.parceljs.cn/</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/three-js/" rel="tag">three.js</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Electron-d-3-0"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/26/Electron-d-3-0/"
    >Electron-d-3.0</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/26/Electron-d-3-0/" class="article-date">
  <time datetime="2022-11-26T02:26:43.000Z" itemprop="datePublished">2022-11-26</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Electron/">Electron</a> / <a class="article-category-link" href="/categories/Electron/Electron-d-3-0/">Electron-d-3.0</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Electron-d-3-0"><a href="#Electron-d-3-0" class="headerlink" title="Electron-d-3.0"></a>Electron-d-3.0</h1><h3 id="æ¸²æŸ“è¿›ç¨‹"><a href="#æ¸²æŸ“è¿›ç¨‹" class="headerlink" title="æ¸²æŸ“è¿›ç¨‹"></a>æ¸²æŸ“è¿›ç¨‹</h3><p>ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²è§£äº†ä¸»è¿›ç¨‹çš„ä¸€äº›å¸¸ç”¨APIï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬æ¥ç€æ¥è®²è§£æ¸²æŸ“è¿›ç¨‹çš„API</p>
<h3 id="1-å‰ªåˆ‡æ¿ï¼ˆclipboardï¼‰"><a href="#1-å‰ªåˆ‡æ¿ï¼ˆclipboardï¼‰" class="headerlink" title="1.å‰ªåˆ‡æ¿ï¼ˆclipboardï¼‰"></a>1.å‰ªåˆ‡æ¿ï¼ˆclipboardï¼‰</h3><blockquote>
<p>åœ¨ç³»ç»Ÿå‰ªè´´æ¿ä¸Šæ‰§è¡Œå¤åˆ¶å’Œç²˜è´´æ“ä½œã€‚</p>
<p>ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹éƒ½å¯ä»¥ç”¨ã€‚</p>
</blockquote>
<p>ï¼ˆ1ï¼‰<code>clipboard.readText([type])</code></p>
<ul>
<li><code>type</code> string (optional) -å¯ä»¥æ˜¯ <code>selection</code> æˆ– <code>clipboard</code>; é»˜è®¤ä¸º â€˜clipboardâ€™. <code>selection</code> ä»…åœ¨ Linux ä¸­å¯ç”¨ã€‚</li>
</ul>
<p>è¿”å› <code>string</code> - å‰ªè´´æ¿ä¸­çš„å†…å®¹ä¸ºçº¯æ–‡æœ¬ã€‚</p>
<pre><code class="javascript">const &#123; clipboard &#125; = require(&#39;electron&#39;)

clipboard.writeText(&#39;hello i am a bit of text!&#39;)

const text = clipboard.readText()
console.log(text)
// hello i am a bit of text!&#39;
</code></pre>
<p>ï¼ˆ2ï¼‰<code>clipboard.writeText(text[, type])</code></p>
<ul>
<li><code>text</code> string</li>
<li><code>type</code> string (optional) -å¯ä»¥æ˜¯ <code>selection</code> æˆ– <code>clipboard</code>; é»˜è®¤ä¸º â€˜clipboardâ€™. <code>selection</code> ä»…åœ¨ Linux ä¸­å¯ç”¨ã€‚</li>
</ul>
<p>å°† <code>text</code> ä½œä¸ºçº¯æ–‡æœ¬å†™å…¥å‰ªè´´æ¿ã€‚</p>
<pre><code class="javascript">const &#123; clipboard &#125; = require(&#39;electron&#39;)

const text = &#39;hello i am a bit of text!&#39;
clipboard.writeText(text)
</code></pre>
<p>æˆ‘ä»¬å‰ªåˆ‡æ¿çš„APIå°±è¯´è¿™ä¸¤ä¸ªè¯»ä¸å†™ã€‚ä½†æ˜¯æˆ‘åœ¨æ¸²æŸ“è¿›ç¨‹é‡Œè¯»ä¸åˆ°clipboardã€‚</p>
<p>[clipboardæ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/clipboard">https://www.electronjs.org/zh/docs/latest/api/clipboard</a> â€œ</p>
<h3 id="2-contextBridge"><a href="#2-contextBridge" class="headerlink" title="2.contextBridge"></a>2.contextBridge</h3><p>åœ¨éš”ç¦»çš„ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„ã€åŒå‘çš„ã€åŒæ­¥çš„æ¡¥æ¢ã€‚</p>
<p>å¦‚ä¸‹ï¼Œæ˜¯ä¸€ä¸ªä»éš”ç¦»çš„é¢„åŠ è½½è„šæœ¬å°† API æš´éœ²ç»™æ¸²æŸ“å™¨çš„ç¤ºä¾‹ï¼šï¼ˆé€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²APIï¼Œæ¸²æŸ“è¿›ç¨‹å¯ä»¥è¯»å–ï¼‰</p>
<pre><code class="javascript">// Preload (Isolated World)
const &#123; contextBridge, ipcRenderer &#125; = require(&#39;electron&#39;)

contextBridge.exposeInMainWorld(
  &#39;electron&#39;,
  &#123;
    doThing: () =&gt; ipcRenderer.send(&#39;do-a-thing&#39;)
  &#125;
)
</code></pre>
<pre><code class="javascript">// Renderer (Main World)

window.electron.doThing()
</code></pre>
<p>[contextBridgeæ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/context-bridge">https://www.electronjs.org/zh/docs/latest/api/context-bridge</a> â€œ</p>
<h3 id="3-desktopCapturer"><a href="#3-desktopCapturer" class="headerlink" title="3.desktopCapturer"></a>3.desktopCapturer</h3><p>å®˜æ–¹æ–‡æ¡£ç»™çš„æ¡ˆä¾‹ä¸æ˜¯ç‰¹åˆ«å®¹æ˜“ç†è§£ï¼Œä»£ç æœ‰ç‚¹é•¿ã€‚</p>
<blockquote>
<p>è™½ç„¶å®˜æ–¹æ–‡æ¡£çš„ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹éƒ½æœ‰desktopCapturerï¼Œä½†æ˜¯æ¸²æŸ“è¿›ç¨‹æ˜¯è®¿é—®ä¸åˆ°çš„</p>
</blockquote>
<p>æˆ‘ä»¬ä¸¾ä¸€ä¸ªæŠ“å–é¡µé¢å†…å®¹çš„è”æå§ï¼</p>
<p><img src="/2022/11/26/Electron-d-3-0/image-20221126093410069.png"></p>
<pre><code class="javascript">//main.js+
 ipcMain.handle(&#39;capture-event&#39;,async (event,args)=&gt;&#123;
      return  desktopCapturer.getSources(&#123; types: [&#39;window&#39;, &#39;screen&#39;] &#125;).then( sources =&gt; &#123;
        return sources
      &#125;)
 &#125;)
//è§£é‡Šä¸€ä¸‹ï¼ŒdesktopCapturer.getSourcesè¿”å›çš„æ˜¯ä¸€ä¸ªPromiseçš„å¯¹è±¡
</code></pre>
<pre><code class="javascript">//preload.js+

  const capture = async ()=&gt;&#123;
    let res = await ipcRenderer.invoke(&#39;capture-event&#39;)
    console.log(res)
  &#125;
  
  contextBridge.exposeInMainWorld(&#39;electronAPI&#39;, &#123;
    capture
&#125;)
</code></pre>
<pre><code class="javascript">//app.js+
const btn = document.getElementById(&#39;btn&#39;)
btn.addEventListener(&#39;click&#39;,()=&gt;&#123;
    window.electronAPI.capture()
&#125;)
</code></pre>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP --&gt;
    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;&gt;
    &lt;title&gt;capture&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;button id=&quot;btn&quot;&gt;capture&lt;/button&gt;
    &lt;script src=&#39;./renderer/app.js&#39;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>å½“æˆ‘ä»¬ç‚¹å‡»é¡µé¢ä¸Šçš„æŒ‰é’®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šæ‰“å°å‡ºçª—å£ä¿¡æ¯ï¼Œç”±ä¸‹å›¾å¯ä»¥çœ‹å‡ºsourcesæ˜¯ä¸€ä¸ªæ•°ç»„</p>
<p><img src="/2022/11/26/Electron-d-3-0/image-20221126093927866.png"></p>
<p>æˆ‘ä»¬ç°åœ¨å°±å¯ä»¥æ ¹æ®æˆ‘ä»¬è·å–åˆ°çš„ä¿¡æ¯å»å¹²ä¸€äº›äº‹æƒ…äº†ã€‚</p>
<pre><code class="javascript">//preload.js+
  const capture = async ()=&gt;&#123;
    let sources = await ipcRenderer.invoke(&#39;capture-event&#39;)
    for (const source of sources) &#123;
      if (source.name === &#39;electron&#39;) &#123;
        let str = source.thumbnail.crop(&#123;x:0,y:0,width:300,height:300&#125;)
        let imgUrl = str.toDataURL()
        return imgUrl //è¿”å›çš„æ˜¯ä¸€ä¸ªPromise
      &#125;
    &#125;
  &#125;

  contextBridge.exposeInMainWorld(&#39;electronAPI&#39;, &#123;
    handleCounter: (callback) =&gt; ipcRenderer.on(&#39;update-counter&#39;, callback),
    capture,
&#125;)
</code></pre>
<pre><code class="javascript">//app.js+
const btn = document.getElementById(&#39;btn&#39;)
btn.addEventListener(&#39;click&#39;,async ()=&gt;&#123;
   let imgUrl = await window.electronAPI.capture()
   console.log(imgUrl)
&#125;)
</code></pre>
<p><img src="/2022/11/26/Electron-d-3-0/image-20221126100006800.png"></p>
<p>æˆ‘ä»¬åœ¨æ¸²æŸ“è¿›ç¨‹è¿™å°±å·²ç»æ‹¿åˆ°äº†æˆ‘ä»¬çš„æ•°æ®</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å°†æˆ‘ä»¬çš„æ•°æ®å¡«å……åˆ°æˆ‘ä»¬çš„é¡µé¢ä¹‹ä¸­</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP --&gt;
    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;;img-src * data:&quot;&gt;
    &lt;title&gt;Menu Counter&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- Current value: &lt;strong id=&quot;counter&quot;&gt;0&lt;/strong&gt; --&gt;
    &lt;button id=&quot;btn&quot;&gt;capture&lt;/button&gt;
    &lt;img src=&quot;&quot; alt=&quot;æ•è·æ•°æ®&quot; id=&quot;img&quot;&gt;
    &lt;script src=&#39;./renderer/app.js&#39;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<pre><code class="javascript">//app.js+
const btn = document.getElementById(&#39;btn&#39;)

btn.addEventListener(&#39;click&#39;,async ()=&gt;&#123;
   let imgUrl = await window.electronAPI.capture()
   document.getElementById(&#39;img&#39;).src = imgUrl
&#125;)
</code></pre>
<p><img src="/2022/11/26/Electron-d-3-0/image-20221126101223120.png"></p>
<p>æ­å–œä½ ï¼ï¼ï¼æˆåŠŸäº†ğŸ¥³ğŸ¥³ğŸ¥³</p>
<p>[desktopCaptureræ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/desktop-capturer&quot;">https://www.electronjs.org/zh/docs/latest/api/desktop-capturer&quot;</a></p>
<h3 id="4-nativeImage"><a href="#4-nativeImage" class="headerlink" title="4.nativeImage"></a>4.nativeImage</h3><blockquote>
<p>ä½¿ç”¨ PNG æˆ– JPG æ–‡ä»¶åˆ›å»ºæ‰˜ç›˜ã€dockå’Œåº”ç”¨ç¨‹åºå›¾æ ‡ã€‚</p>
<p>ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹éƒ½å¯ä»¥ç”¨ã€‚</p>
</blockquote>
<p>åœ¨ Electron å†…, é‚£äº›éœ€è¦å›¾ç‰‡çš„ API å¯ä»¥ä¼ é€’ä¸¤ç§å‚æ•°, ä¸€ç§æ˜¯æ–‡ä»¶è·¯å¾„, ä¸€ç§æ˜¯ <code>NativeImage</code> å®ä¾‹å¯¹è±¡ã€‚ ç©ºçš„å›¾ç‰‡å¯¹è±¡å°†è¢« <code>null</code> å‚æ•°æ›¿ä»£</p>
<p>ä¾‹å¦‚, åˆ›å»ºæ‰˜ç›˜æˆ–è®¾ç½®çª—å£å›¾æ ‡æ—¶, ä½ å¯ä»¥ä¼ é€’ <code>string</code> æ ¼å¼çš„å›¾ç‰‡è·¯å¾„</p>
<pre><code class="javascript">const &#123; BrowserWindow, Tray &#125; = require(&#39;electron&#39;)

const appIcon = new Tray(&#39;/Users/somebody/images/icon.png&#39;)
const win = new BrowserWindow(&#123; icon: &#39;/Users/somebody/images/window.png&#39; &#125;)
console.log(appIcon, win)
</code></pre>
<p>æˆ–è€…ä»ç²˜è´´æ¿è¯»å–å›¾ç‰‡ï¼Œå°†è¿”å› <code>NativeImage</code> å¯¹è±¡ï¼š</p>
<pre><code class="javascript">const &#123; clipboard, Tray &#125; = require(&#39;electron&#39;)
const image = clipboard.readImage()
const appIcon = new Tray(image)
console.log(appIcon)
</code></pre>
<p>æˆ‘ä»¬æ–‡æ¡£é‡Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›å…³äºNativeImageå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å“ªé‡Œéœ€è¦å“ªé‡Œæ¬ã€‚</p>
<p>[nativeImageæ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/native-image">https://www.electronjs.org/zh/docs/latest/api/native-image</a> â€œ</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯¹äºelectronçš„å­¦ä¹ å…ˆåˆ°è¿™ï¼Œå¦‚æœæˆ‘çš„è¿™å‡ ç¯‡æ–‡ç« éƒ½è®¤è®¤çœŸçœŸçš„çœ‹å®Œäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯¹electronæœ‰äº†è¿›ä¸€æ­¥è®¤è¯†ã€‚</p>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[Electronå®˜ç½‘]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/">https://www.electronjs.org/</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/electron/" rel="tag">electron</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Electron-d-2-0"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/25/Electron-d-2-0/"
    >Electron-d-2.0</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/25/Electron-d-2-0/" class="article-date">
  <time datetime="2022-11-25T09:31:05.000Z" itemprop="datePublished">2022-11-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Electron/">Electron</a> / <a class="article-category-link" href="/categories/Electron/Electron-d-2-0/">Electron-d-2.0</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Electron"><a href="#Electron" class="headerlink" title="Electron"></a>Electron</h1><p>æœ¬ç¯‡æ–‡ç« æ¥ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œè¯¦ç»†è®²è§£ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¸€äº›å¸¸ç”¨çš„API</p>
<h3 id="ä¸»è¿›ç¨‹API"><a href="#ä¸»è¿›ç¨‹API" class="headerlink" title="ä¸»è¿›ç¨‹API"></a>ä¸»è¿›ç¨‹API</h3><h4 id="1-App-BrowserWindow"><a href="#1-App-BrowserWindow" class="headerlink" title="1.App+BrowserWindow"></a>1.App+BrowserWindow</h4><h5 id="Appäº‹ä»¶ï¼š"><a href="#Appäº‹ä»¶ï¼š" class="headerlink" title="Appäº‹ä»¶ï¼š"></a>Appäº‹ä»¶ï¼š</h5><h6 id="ï¼ˆ1ï¼‰Before-quit"><a href="#ï¼ˆ1ï¼‰Before-quit" class="headerlink" title="ï¼ˆ1ï¼‰Before-quit"></a>ï¼ˆ1ï¼‰Before-quit</h6><ul>
<li><code>event</code> Event #è¿”å›</li>
</ul>
<p> åœ¨ç¨‹åºå…³é—­çª—å£å‰è§¦å‘ï¼ˆmacOSä¸æ˜¯å…³é—­çª—å£è§¦å‘ï¼Œè€Œæ˜¯å…³é—­ç¨‹åºï¼‰</p>
<p>**æ³¨:**åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå› ç³»ç»Ÿå…³æœº&#x2F;é‡å¯æˆ–ç”¨æˆ·æ³¨é”€è€Œå…³é—­ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹ä»¶ä¸ä¼šè¢«è§¦å‘ã€‚</p>
<p>ä»£ç ä»¥åŠç¨‹åºæ¼”ç¤ºï¼š</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125085755781.png"></p>
<h6 id="ï¼ˆ2ï¼‰browser-window-blur"><a href="#ï¼ˆ2ï¼‰browser-window-blur" class="headerlink" title="ï¼ˆ2ï¼‰browser-window-blur"></a>ï¼ˆ2ï¼‰browser-window-blur</h6><ul>
<li><code>event</code> Event #è¿”å›</li>
<li><code>window</code> BrowserWindow #è¿”å›</li>
</ul>
<p>å½“ä¸€ä¸ª browserWindow ï¼ˆçª—å£ï¼‰å¤±å»ç„¦ç‚¹æ—¶è§¦å‘ã€‚å½“æˆ‘ä»¬é¼ æ ‡ç‚¹å‡»çª—å£ä»¥å¤–çš„åœ°æ–¹å°±ä¼šå¤±ç„¦ã€‚</p>
<p>ä»£ç ä»¥åŠç¨‹åºæ¼”ç¤ºï¼š</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125090204480.png"></p>
<h6 id="ï¼ˆ3ï¼‰browser-window-focus"><a href="#ï¼ˆ3ï¼‰browser-window-focus" class="headerlink" title="ï¼ˆ3ï¼‰browser-window-focus"></a>ï¼ˆ3ï¼‰browser-window-focus</h6><ul>
<li><code>event</code> Event #è¿”å›</li>
<li><code>window</code> BrowserWindow #è¿”å›</li>
</ul>
<p>å½“ä¸€ä¸ª browserWindow è·å¾—ç„¦ç‚¹æ—¶è§¦å‘ã€‚</p>
<p>ä»£ç ä»¥åŠç¨‹åºæ¼”ç¤ºï¼š</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125090450485.png"></p>
<h6 id="ï¼ˆ4ï¼‰quit"><a href="#ï¼ˆ4ï¼‰quit" class="headerlink" title="ï¼ˆ4ï¼‰quit"></a>ï¼ˆ4ï¼‰quit</h6><ul>
<li><code>event</code> Event #è¿”å›</li>
<li><code>exitCode</code> Integer #è¿”å›</li>
</ul>
<p>åœ¨åº”ç”¨ç¨‹åºé€€å‡ºæ—¶å‘å‡ºã€‚</p>
<p>**æ³¨:**åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå› ç³»ç»Ÿå…³æœº&#x2F;é‡å¯æˆ–ç”¨æˆ·æ³¨é”€è€Œå…³é—­ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹ä»¶ä¸ä¼šè¢«è§¦å‘ã€‚</p>
<p>ä»£ç ä»¥åŠç¨‹åºæ¼”ç¤ºï¼š</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125090654139.png"></p>
<h6 id="ï¼ˆ5ï¼‰window-all-closed"><a href="#ï¼ˆ5ï¼‰window-all-closed" class="headerlink" title="ï¼ˆ5ï¼‰window-all-closed"></a>ï¼ˆ5ï¼‰window-all-closed</h6><p>å½“æ‰€æœ‰çš„çª—å£éƒ½è¢«å…³é—­æ—¶è§¦å‘ã€‚</p>
<p>å¦‚æœä½ æ²¡æœ‰ç›‘å¬æ­¤äº‹ä»¶å¹¶ä¸”æ‰€æœ‰çª—å£éƒ½å…³é—­äº†ï¼Œé»˜è®¤çš„è¡Œä¸ºæ˜¯æ§åˆ¶é€€å‡ºç¨‹åºï¼›ä½†å¦‚æœä½ ç›‘å¬äº†æ­¤äº‹ä»¶ï¼Œä½ å¯ä»¥æ§åˆ¶æ˜¯å¦é€€å‡ºç¨‹åºã€‚ å¦‚æœç”¨æˆ·æŒ‰ä¸‹äº† <code>Cmd + Q</code>ï¼Œæˆ–è€…å¼€å‘è€…è°ƒç”¨äº† <code>app.quit()</code>ï¼ŒElectron ä¼šé¦–å…ˆå…³é—­æ‰€æœ‰çš„çª—å£ç„¶åè§¦å‘ <code>will-quit</code> äº‹ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ <code>window-all-closed</code>äº‹ä»¶ä¸ä¼šè¢«è§¦å‘ã€‚</p>
<p>ä»£ç ä»¥åŠç¨‹åºæ¼”ç¤ºï¼š</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125090909458.png"></p>
<h5 id="æ–¹æ³•ï¼š"><a href="#æ–¹æ³•ï¼š" class="headerlink" title="æ–¹æ³•ï¼š"></a>æ–¹æ³•ï¼š</h5><p>ç”±äºå„ç§app.æ–¹æ³•ä½¿ç”¨é¢‘ç‡éƒ½å·®ä¸å¤šï¼Œé‚£ä¹ˆæˆ‘ä»¬æ ¹æ®éœ€è¦çœ‹å®˜æ–¹æ–‡æ¡£å§ï¼ˆä¹Ÿæ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚ï¼‰</p>
<p>[App.æ–¹æ³• æ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/app#%E6%96%B9%E6%B3%95">https://www.electronjs.org/zh/docs/latest/api/app#æ–¹æ³•</a> â€œ</p>
<h5 id="BrowserWindowï¼š"><a href="#BrowserWindowï¼š" class="headerlink" title="BrowserWindowï¼š"></a>BrowserWindowï¼š</h5><p><code>BrowserWindow</code> ç±»æš´éœ²äº†å„ç§æ–¹æ³•æ¥ä¿®æ”¹åº”ç”¨çª—å£çš„å¤–è§‚å’Œè¡Œä¸º</p>
<h6 id="ï¼ˆ1ï¼‰ä¼˜é›…çš„æ‰“å¼€çª—å£"><a href="#ï¼ˆ1ï¼‰ä¼˜é›…çš„æ‰“å¼€çª—å£" class="headerlink" title="ï¼ˆ1ï¼‰ä¼˜é›…çš„æ‰“å¼€çª—å£"></a>ï¼ˆ1ï¼‰ä¼˜é›…çš„æ‰“å¼€çª—å£</h6><p><code>ready-to-show</code> äº‹ä»¶</p>
<p>åœ¨åŠ è½½é¡µé¢æ—¶ï¼Œæ¸²æŸ“è¿›ç¨‹ç¬¬ä¸€æ¬¡å®Œæˆç»˜åˆ¶æ—¶ï¼Œå¦‚æœçª—å£è¿˜æ²¡æœ‰è¢«æ˜¾ç¤ºï¼Œæ¸²æŸ“è¿›ç¨‹ä¼šå‘å‡º <code>ready-to-show</code> äº‹ä»¶ ã€‚ åœ¨æ­¤äº‹ä»¶åæ˜¾ç¤ºçª—å£å°†æ²¡æœ‰è§†è§‰é—ªçƒï¼šï¼ˆä¸ä¼šæœ‰ç™½å±å‡ºç°ï¼Œä½†å¦‚æœç»˜åˆ¶æ²¡æœ‰å®Œæˆï¼Œçª—å£å‡ºç°çš„æ—¶é—´ä¹Ÿä¼šå»¶é•¿ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚æ¥é€‰æ‹©æ˜¯å¦è¦é€‰æ‹©è¿™ç§ä¼˜é›…çš„æ‰“å¼€çª—å£æ–¹å¼ï¼‰</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125093133167.png"></p>
<p>è¿™ä¸ªäº‹ä»¶é€šå¸¸åœ¨ <code>did-finish-load</code> äº‹ä»¶ä¹‹åå‘å‡ºï¼Œä½†æ˜¯é¡µé¢æœ‰è®¸å¤šè¿œç¨‹èµ„æºæ—¶ï¼Œå®ƒå¯èƒ½ä¼šåœ¨ <code>did-finish-load</code>ä¹‹å‰å‘å‡ºäº‹ä»¶ã€‚</p>
<p><code>backgroundColor</code>å±æ€§</p>
<p>å¯¹äºä¸€ä¸ªå¤æ‚çš„åº”ç”¨ï¼Œ<code>ready-to-show</code> å¯èƒ½å‘å‡ºçš„å¤ªæ™šï¼Œä¼šè®©åº”ç”¨æ„Ÿè§‰ç¼“æ…¢ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå»ºè®®ç«‹åˆ»æ˜¾ç¤ºçª—å£ï¼Œå¹¶ä½¿ç”¨æ¥è¿‘åº”ç”¨ç¨‹åºèƒŒæ™¯çš„ <code>backgroundColor</code></p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125093813389.png"></p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125093827541.png"></p>
<p>å»ºè®® è®¾ç½® <code>backgroundColor</code>å’Œ <code>ready-to-show</code> äº‹ä»¶ä¸€èµ·ç”¨ï¼Œä»¥ä½¿åº”ç”¨æ„Ÿè§‰æ›´æ¥è¿‘åŸç”Ÿã€‚</p>
<pre><code class="javascript">//backgroundColoræœ‰æ•ˆå€¼
const win = new BrowserWindow()
win.setBackgroundColor(&#39;hsl(230, 100%, 50%)&#39;)
win.setBackgroundColor(&#39;rgb(255, 145, 145)&#39;)
win.setBackgroundColor(&#39;#ff00a3&#39;)
win.setBackgroundColor(&#39;blueviolet&#39;)
</code></pre>
<h6 id="ï¼ˆ2ï¼‰çˆ¶å­çª—å£-amp-amp-æ¨¡æ€çª—å£"><a href="#ï¼ˆ2ï¼‰çˆ¶å­çª—å£-amp-amp-æ¨¡æ€çª—å£" class="headerlink" title="ï¼ˆ2ï¼‰çˆ¶å­çª—å£&amp;&amp;æ¨¡æ€çª—å£"></a>ï¼ˆ2ï¼‰çˆ¶å­çª—å£&amp;&amp;æ¨¡æ€çª—å£</h6><p>çˆ¶å­çª—å£ï¼š</p>
<p>é€šè¿‡ä½¿ç”¨ <code>parent</code> é€‰é¡¹ï¼Œä½ å¯ä»¥åˆ›å»ºå­çª—å£ï¼š</p>
<pre><code class="javascript">const &#123; BrowserWindow &#125; = require(&#39;electron&#39;)

const top = new BrowserWindow()
const child = new BrowserWindow(&#123; parent: top &#125;)
child.show()
top.show()
</code></pre>
<p><code>child</code> çª—å£å°†æ€»æ˜¯æ˜¾ç¤ºåœ¨ <code>top</code> çª—å£çš„é¡¶éƒ¨.</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125094829288.png"></p>
<p>æ¨¡æ€çª—å£</p>
<p>æ¨¡æ€çª—å£æ˜¯ç¦ç”¨çˆ¶çª—å£çš„å­çª—å£ï¼Œåˆ›å»ºæ¨¡æ€çª—å£å¿…é¡»è®¾ç½® <code>parent</code> å’Œ <code>modal</code> é€‰é¡¹ï¼š</p>
<pre><code class="javascript">const &#123; BrowserWindow &#125; = require(&#39;electron&#39;)

const child = new BrowserWindow(&#123; parent: top, modal: true, show: false &#125;)
child.loadURL(&#39;https://github.com&#39;)
child.once(&#39;ready-to-show&#39;, () =&gt; &#123;
  child.show()
&#125;)
</code></pre>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125095057232.png"></p>
<h6 id="ï¼ˆ3ï¼‰BrowserWindowå±æ€§"><a href="#ï¼ˆ3ï¼‰BrowserWindowå±æ€§" class="headerlink" title="ï¼ˆ3ï¼‰BrowserWindowå±æ€§"></a>ï¼ˆ3ï¼‰BrowserWindowå±æ€§</h6><p>è¿™ä¸ªBrowserWindowå±æ€§ æ¯”è¾ƒå¤šï¼Œè€Œä¸”éƒ½æ˜¯è®¾ç½®çª—å£çš„ä¸€äº›å±æ€§ï¼Œä¹Ÿæ˜¯ä¸éš¾ç†è§£ï¼Œæˆ‘ä»¬å°±å¯¹ç…§æˆ‘ä»¬çš„å®˜æ–¹æ–‡æ¡£æ¥å­¦ä¹ å§ï¼</p>
<p>[BrowserWindowå±æ€§]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/browser-window#new-browserwindowoptions">https://www.electronjs.org/zh/docs/latest/api/browser-window#new-browserwindowoptions</a> â€œ</p>
<h6 id="ï¼ˆ4ï¼‰webContents"><a href="#ï¼ˆ4ï¼‰webContents" class="headerlink" title="ï¼ˆ4ï¼‰webContents"></a>ï¼ˆ4ï¼‰webContents</h6><p><code>did-finish-load</code> äº‹ä»¶</p>
<p>å¯¼èˆªå®Œæˆæ—¶è§¦å‘ï¼Œå³é€‰é¡¹å¡çš„æ—‹è½¬å™¨å°†åœæ­¢æ—‹è½¬ï¼Œå¹¶æŒ‡æ´¾<code>onload</code>äº‹ä»¶åã€‚</p>
<p>[webContentsç±»å®ä¾‹äº‹ä»¶]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/web-contents#%E7%B1%BB-webcontents">https://www.electronjs.org/zh/docs/latest/api/web-contents#ç±»-webcontents</a> â€œ</p>
<h6 id="ï¼ˆ5ï¼‰ä¿å­˜çª—å£çŠ¶æ€"><a href="#ï¼ˆ5ï¼‰ä¿å­˜çª—å£çŠ¶æ€" class="headerlink" title="ï¼ˆ5ï¼‰ä¿å­˜çª—å£çŠ¶æ€"></a>ï¼ˆ5ï¼‰ä¿å­˜çª—å£çŠ¶æ€</h6><p>å½“æˆ‘ä»¬ä½¿ç”¨æ¡Œé¢ç¨‹åºçš„æ—¶å€™ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰æ—¶å€™å¸Œæœ›æˆ‘ä»¬å…³é—­ç¨‹åºå†æ¬¡æ‰“å¼€ç¨‹åºçš„æ—¶å€™ï¼Œç¨‹åºçš„ç•Œé¢å’ŒçŠ¶æ€èƒ½å¤Ÿæ˜¯æˆ‘ä»¬å…³é—­å‰çš„æ ·å­ï¼Œä¸å¸Œæœ›å†å»é‡æ–°è®¾ç½®ã€‚é‚£æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªåŒ…<code>electron-win-state</code> </p>
<p>å®‰è£…è¿™ä¸ªåŒ…</p>
<pre><code class="ini">npm i electron-win-state -S
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥åœ¨npmjså®˜ç½‘ä¸Šæ‰¾åˆ°è¿™ä¸ªåŒ…ï¼Œå»çœ‹å®ƒçš„è¯´æ˜æ–‡æ¡£</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125101014250.png"></p>
<p>æ ¹æ®ä½¿ç”¨è¯´æ˜ï¼Œæˆ‘ä»¬ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125101245297.png"></p>
<p>æˆ‘ä»¬å‘ç°æŠ¥é”™äº†ï¼ŒWinState is not a constructor</p>
<p>å½“æˆ‘ä»¬æ‰“å°ä¸€ä¸‹WinStateçœ‹çœ‹ä»€ä¹ˆæƒ…å†µ</p>
<pre><code class="javascript">const WinState = require(&#39;electron-win-state&#39;)
console.log(WinState)
</code></pre>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125101446532.png"></p>
<p>å‘ç°æ²¡æœ‰ç›´æ¥å¼•å…¥WinStateï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹</p>
<pre><code class="javascript">const WinState = require(&#39;electron-win-state&#39;).default 
</code></pre>
<p>ç°åœ¨å°±æ²¡æŠ¥é”™äº†ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œè™½ç„¶å®‰è£…äº†è¿™ä¸ªåŒ…ï¼Œä½†æ˜¯æˆ‘ä»¬ç¨‹åºçš„çŠ¶æ€è¿˜æ˜¯æ²¡æœ‰æ”¹å˜ï¼Œè¿™å°±å¾ˆå¥‡æ€ªäº†ï¼Œå…¶å®ï¼Œæ˜¯æˆ‘ä»¬è‡ªå·±å·²ç»ç»™çª—å£è®¾ç½®äº†è‡ªå®šä¹‰å®½é«˜ï¼Œè¦†ç›–äº†ã€‚æˆ‘ä»¬ä¹Ÿç¼ºäº†ä¸€å¥ä»£ç ï¼›</p>
<pre><code class="javascript"> winState.manage(win)
</code></pre>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125102737449.png"></p>
<p>ç°åœ¨æˆ‘ä»¬çš„çŠ¶æ€ä¿å­˜å°±æ²¡é—®é¢˜äº†ã€‚å½“æˆ‘ä»¬å…³é—­çª—å£å†æ¬¡æ‰“å¼€çš„æ—¶å€™å°±æ˜¯å…³é—­ä¹‹å‰çš„æ ·å­äº†ã€‚</p>
<h4 id="2-dialog"><a href="#2-dialog" class="headerlink" title="2.dialog"></a>2.dialog</h4><p>è¿™äº›å…·ä½“å‚æ•°è¯·çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œä¸‹é¢å‡ ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡</p>
<h6 id="ï¼ˆ1ï¼‰dialog-showOpenDialog-browserWindow-options"><a href="#ï¼ˆ1ï¼‰dialog-showOpenDialog-browserWindow-options" class="headerlink" title="ï¼ˆ1ï¼‰dialog.showOpenDialog([browserWindow, ]options)"></a>ï¼ˆ1ï¼‰<code>dialog.showOpenDialog([browserWindow, ]options)</code></h6><h6 id="ï¼ˆ2ï¼‰dialog-showSaveDialog-browserWindow-options"><a href="#ï¼ˆ2ï¼‰dialog-showSaveDialog-browserWindow-options" class="headerlink" title="ï¼ˆ2ï¼‰dialog.showSaveDialog([browserWindow, ]options)"></a>ï¼ˆ2ï¼‰<code>dialog.showSaveDialog([browserWindow, ]options)</code></h6><h6 id="ï¼ˆ3ï¼‰dialog-showMessageBox-browserWindow-options"><a href="#ï¼ˆ3ï¼‰dialog-showMessageBox-browserWindow-options" class="headerlink" title="ï¼ˆ3ï¼‰dialog.showMessageBox([browserWindow, ]options)"></a>ï¼ˆ3ï¼‰<code>dialog.showMessageBox([browserWindow, ]options)</code></h6><p>[dialogæ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/dialog#dialogshowopendialogsyncbrowserwindow-options">https://www.electronjs.org/zh/docs/latest/api/dialog#dialogshowopendialogsyncbrowserwindow-options</a> â€œ</p>
<h4 id="3-å¿«æ·é”®ï¼ˆglobalShortcutï¼‰"><a href="#3-å¿«æ·é”®ï¼ˆglobalShortcutï¼‰" class="headerlink" title="3.å¿«æ·é”®ï¼ˆglobalShortcutï¼‰"></a>3.å¿«æ·é”®ï¼ˆglobalShortcutï¼‰</h4><blockquote>
<p>åœ¨åº”ç”¨ç¨‹åºæ²¡æœ‰é”®ç›˜ç„¦ç‚¹æ—¶ï¼Œç›‘å¬é”®ç›˜äº‹ä»¶ã€‚</p>
</blockquote>
<p><code>globalShortcut</code> æ¨¡å—å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿä¸­æ³¨å†Œ&#x2F;æ³¨é”€å…¨å±€å¿«æ·é”®, ä»¥ä¾¿å¯ä»¥ä¸ºæ“ä½œå®šåˆ¶å„ç§å¿«æ·é”®ã€‚</p>
<p><strong>æ³¨æ„:</strong> å¿«æ·æ–¹å¼æ˜¯å…¨å±€çš„; å³ä½¿åº”ç”¨ç¨‹åºæ²¡æœ‰é”®ç›˜ç„¦ç‚¹, å®ƒä¹Ÿä»ç„¶åœ¨æŒç»­ç›‘å¬é”®ç›˜äº‹ä»¶ã€‚ åœ¨ app æ¨¡å—çš„ <code>ready</code> äº‹ä»¶å°±ç»ªä¹‹å‰ï¼Œè¿™ä¸ªæ¨¡å—ä¸èƒ½ä½¿ç”¨ã€‚</p>
<pre><code class="javascript">const &#123; app, globalShortcut &#125; = require(&#39;electron&#39;)

app.whenReady().then(() =&gt; &#123;
  // æ³¨å†Œä¸€ä¸ª&#39;CommandOrControl+X&#39; å¿«æ·é”®ç›‘å¬å™¨
  const ret = globalShortcut.register(&#39;CommandOrControl+X&#39;, () =&gt; &#123;
    console.log(&#39;CommandOrControl+X is pressed&#39;)
  &#125;)

  if (!ret) &#123;
    console.log(&#39;registration failed&#39;)
  &#125;

  // æ£€æŸ¥å¿«æ·é”®æ˜¯å¦æ³¨å†ŒæˆåŠŸ
  console.log(globalShortcut.isRegistered(&#39;CommandOrControl+X&#39;))
&#125;)

app.on(&#39;will-quit&#39;, () =&gt; &#123;
  // æ³¨é”€å¿«æ·é”®
  globalShortcut.unregister(&#39;CommandOrControl+X&#39;)

  // æ³¨é”€æ‰€æœ‰å¿«æ·é”®
  globalShortcut.unregisterAll()
&#125;)
</code></pre>
<p>æ–¹æ³•</p>
<p><code>globalShortcut</code> æ¨¡å—å…·æœ‰ä»¥ä¸‹æ–¹æ³•:</p>
<h6 id="ï¼ˆ1ï¼‰globalShortcut-register-accelerator-callback"><a href="#ï¼ˆ1ï¼‰globalShortcut-register-accelerator-callback" class="headerlink" title="ï¼ˆ1ï¼‰globalShortcut.register(accelerator, callback)"></a>ï¼ˆ1ï¼‰<code>globalShortcut.register(accelerator, callback)</code></h6><ul>
<li><code>accelerator</code> Accelerator</li>
<li><code>callback</code> Function</li>
</ul>
<p>è¿”å›<code>boolean</code> - å¿«æ·é”®æ³¨å†Œæ˜¯å¦æˆåŠŸ</p>
<p>æ³¨å†Œ <code>accelerator</code> çš„å…¨å±€å¿«æ·é”®ã€‚ å½“ç”¨æˆ·æŒ‰ä¸‹æ³¨å†Œå¿«æ·é”®æ—¶ï¼Œ <code>callback</code> ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>å¦‚æœæŒ‡å®šçš„å¿«æ·é”®å·²ç»è¢«å…¶ä»–åº”ç”¨ç¨‹åºæ³¨å†Œæ‰, è°ƒç”¨ä¼šé»˜é»˜å¤±è´¥ã€‚ è¯¥ç‰¹æ€§ç”±æ“ä½œç³»ç»Ÿå®šä¹‰ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¸å¸Œæœ›å¤šä¸ªç¨‹åºçš„å…¨å±€å¿«æ·é”®äº’ç›¸å†²çªã€‚</p>
<p>åœ¨ macOS 10.14 Mojave ä¸‹é¢ï¼Œå¦‚æœ app æ²¡æœ‰è¢«æˆæƒä¸ºå¯ä¿¡ä»»ä½¿ç”¨çš„å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆä¸‹åˆ—å¿«æ·é”®ä¼šæ³¨å†Œå¤±è´¥ï¼š</p>
<ul>
<li>â€œMedia Play&#x2F;Pauseâ€</li>
<li>â€œMedia Next Trackâ€</li>
<li>â€œMedia Previous Trackâ€</li>
<li>â€œMedia Stopâ€</li>
</ul>
<h6 id="ï¼ˆ2ï¼‰globalShortcut-registerAll-accelerators-callback"><a href="#ï¼ˆ2ï¼‰globalShortcut-registerAll-accelerators-callback" class="headerlink" title="ï¼ˆ2ï¼‰globalShortcut.registerAll(accelerators, callback)"></a>ï¼ˆ2ï¼‰<code>globalShortcut.registerAll(accelerators, callback)</code></h6><ul>
<li><code>accelerators</code> string[] - an array of Accelerators.</li>
<li><code>callback</code> Function</li>
</ul>
<p>æ³¨å†Œå¤šä¸ªå…¨å±€å¿«æ·é”®ã€‚ å½“ç”¨æˆ·æŒ‰ä¸‹æ³¨å†Œå¿«æ·é”®æ—¶ï¼Œ <code>callback</code> ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>å¦‚æœå®šä¹‰çš„å¿«æ·é”®å·²ç»è¢«å…¶ä»–åº”ç”¨å ç”¨ï¼Œè¿™ä¸ªè°ƒç”¨ä¼šå¤±æ•ˆã€‚ è¯¥ç‰¹æ€§ç”±æ“ä½œç³»ç»Ÿå®šä¹‰ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¸å¸Œæœ›å¤šä¸ªç¨‹åºçš„å…¨å±€å¿«æ·é”®äº’ç›¸å†²çªã€‚</p>
<p>åœ¨ macOS 10.14 Mojave ä¸‹é¢ï¼Œå¦‚æœ app æ²¡æœ‰è¢«æˆæƒä¸ºå¯ä¿¡ä»»ä½¿ç”¨çš„å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆä¸‹åˆ—å¿«æ·é”®ä¼šæ³¨å†Œå¤±è´¥ï¼š</p>
<ul>
<li>â€œMedia Play&#x2F;Pauseâ€</li>
<li>â€œMedia Next Trackâ€</li>
<li>â€œMedia Previous Trackâ€</li>
<li>â€œMedia Stopâ€</li>
</ul>
<h6 id="ï¼ˆ3ï¼‰globalShortcut-isRegistered-accelerator"><a href="#ï¼ˆ3ï¼‰globalShortcut-isRegistered-accelerator" class="headerlink" title="ï¼ˆ3ï¼‰globalShortcut.isRegistered(accelerator)"></a>ï¼ˆ3ï¼‰<code>globalShortcut.isRegistered(accelerator)</code></h6><ul>
<li><code>accelerator</code> Accelerator</li>
</ul>
<p>Returns <code>boolean</code> - è¡¨ç¤º <code>accelerator</code> å…¨å±€å¿«æ·é”®æ˜¯å¦æ³¨å†ŒæˆåŠŸ</p>
<p>å½“å¿«æ·é”®å·²ç»è¢«å…¶ä»–åº”ç”¨ç¨‹åºæ³¨å†Œæ—¶, æ­¤è°ƒç”¨ä¾ç„¶å°†è¿”å› <code>false</code>ã€‚ è¯¥ç‰¹æ€§ç”±æ“ä½œç³»ç»Ÿå®šä¹‰ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¸å¸Œæœ›å¤šä¸ªç¨‹åºçš„å…¨å±€å¿«æ·é”®äº’ç›¸å†²çªã€‚</p>
<h6 id="ï¼ˆ4ï¼‰globalShortcut-unregister-accelerator"><a href="#ï¼ˆ4ï¼‰globalShortcut-unregister-accelerator" class="headerlink" title="ï¼ˆ4ï¼‰globalShortcut.unregister(accelerator)"></a>ï¼ˆ4ï¼‰<code>globalShortcut.unregister(accelerator)</code></h6><ul>
<li><code>accelerator</code> Accelerator</li>
</ul>
<p>æ³¨é”€ <code>accelerator</code> çš„å…¨å±€å¿«æ·é”®ã€‚</p>
<h6 id="ï¼ˆ5ï¼‰globalShortcut-unregisterAll"><a href="#ï¼ˆ5ï¼‰globalShortcut-unregisterAll" class="headerlink" title="ï¼ˆ5ï¼‰globalShortcut.unregisterAll()"></a>ï¼ˆ5ï¼‰<code>globalShortcut.unregisterAll()</code></h6><p>æ³¨é”€æ‰€æœ‰çš„å…¨å±€å¿«æ·é”®ï¼ˆæ¸…ç©ºè¯¥åº”ç”¨ç¨‹åºçš„æ‰€æœ‰å…¨å±€å¿«æ·é”®ï¼‰ã€‚</p>
<h4 id="4-èœå•ï¼ˆMenuï¼‰"><a href="#4-èœå•ï¼ˆMenuï¼‰" class="headerlink" title="4.èœå•ï¼ˆMenuï¼‰"></a>4.èœå•ï¼ˆMenuï¼‰</h4><p>æˆ‘ä»¬è¿™ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="javascript">//ä¸€ä¸ªç®€å•çš„èœå•æ¨¡æ¿
const &#123; app, Menu &#125; = require(&#39;electron&#39;)

const isMac = process.platform === &#39;darwin&#39;//åˆ¤æ–­æ˜¯ä¸æ˜¯macOS
//roleï¼šèœå•é€‰é¡¹
const template = [
  // &#123; role: &#39;appMenu&#39; &#125;
  ...(isMac ? [&#123;
    label: app.name,//æˆ‘ä»¬ç¨‹åºåç§°
    submenu: [
      &#123; role: &#39;about&#39; &#125;,
      &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
      &#123; role: &#39;services&#39; &#125;,
      &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
      &#123; role: &#39;hide&#39; &#125;,
      &#123; role: &#39;hideOthers&#39; &#125;,
      &#123; role: &#39;unhide&#39; &#125;,
      &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
      &#123; role: &#39;quit&#39; &#125;
    ]
  &#125;] : []),
  // &#123; role: &#39;fileMenu&#39; &#125;
  &#123;
    label: &#39;File&#39;,
    submenu: [
      isMac ? &#123; role: &#39;close&#39; &#125; : &#123; role: &#39;quit&#39; &#125;
    ]
  &#125;,
  // &#123; role: &#39;editMenu&#39; &#125;
  &#123;
    label: &#39;Edit&#39;,
    submenu: [
      &#123; role: &#39;undo&#39; &#125;,
      &#123; role: &#39;redo&#39; &#125;,
      &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
      &#123; role: &#39;cut&#39; &#125;,
      &#123; role: &#39;copy&#39; &#125;,
      &#123; role: &#39;paste&#39; &#125;,
      ...(isMac ? [
        &#123; role: &#39;pasteAndMatchStyle&#39; &#125;,
        &#123; role: &#39;delete&#39; &#125;,
        &#123; role: &#39;selectAll&#39; &#125;,
        &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
        &#123;
          label: &#39;Speech&#39;,
          submenu: [
            &#123; role: &#39;startSpeaking&#39; &#125;,
            &#123; role: &#39;stopSpeaking&#39; &#125;
          ]
        &#125;
      ] : [
        &#123; role: &#39;delete&#39; &#125;,
        &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
        &#123; role: &#39;selectAll&#39; &#125;
      ])
    ]
  &#125;,
  // &#123; role: &#39;viewMenu&#39; &#125;
  &#123;
    label: &#39;View&#39;,
    submenu: [
      &#123; role: &#39;reload&#39; &#125;,
      &#123; role: &#39;forceReload&#39; &#125;,
      &#123; role: &#39;toggleDevTools&#39; &#125;,
      &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
      &#123; role: &#39;resetZoom&#39; &#125;,
      &#123; role: &#39;zoomIn&#39; &#125;,
      &#123; role: &#39;zoomOut&#39; &#125;,
      &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
      &#123; role: &#39;togglefullscreen&#39; &#125;
    ]
  &#125;,
  // &#123; role: &#39;windowMenu&#39; &#125;
  &#123;
    label: &#39;Window&#39;,
    submenu: [
      &#123; role: &#39;minimize&#39; &#125;,
      &#123; role: &#39;zoom&#39; &#125;,
      ...(isMac ? [
        &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
        &#123; role: &#39;front&#39; &#125;,
        &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
        &#123; role: &#39;window&#39; &#125;
      ] : [
        &#123; role: &#39;close&#39; &#125;
      ])
    ]
  &#125;,
  &#123;
    role: &#39;help&#39;,
    submenu: [
      &#123;
        label: &#39;Learn More&#39;,
        click: async () =&gt; &#123;
          //å®šä¹‰è‡ªå·±çš„èœå•æ–¹æ³•
          const &#123; shell &#125; = require(&#39;electron&#39;)
          await shell.openExternal(&#39;https://electronjs.org&#39;)
        &#125;
      &#125;,
      &#123;
        label:&#39;alanmf&#39;,
          click:()=&gt;&#123;console.log(&#39;shift+G&#39;)&#125;,
          accelerator:&#39;shift+G&#39;//å®šä¹‰å¿«æ·é”®
      &#125;
    ]
  &#125;
]

const menu = Menu.buildFromTemplate(template)//ä¸€èˆ¬æ¥è¯´ï¼Œ templateæ˜¯ä¸€ä¸ªoptionsç±»å‹çš„æ•°ç»„ï¼Œç”¨äºæ„å»ºMenuItemã€‚ ä½¿ç”¨æ–¹æ³•å¯å‚è€ƒå‰æ–‡ã€‚è¿˜å¯ä»¥å°†å…¶ä»–å­—æ®µé™„åŠ åˆ°templateï¼Œå®ƒä»¬å°†æˆä¸ºèœå•é¡¹çš„å±æ€§ã€‚
Menu.setApplicationMenu(menu)//åœ¨macOSä¸Šå°† menuè®¾ç½®æˆåº”ç”¨å†…èœå• åœ¨windowså’ŒLinuxä¸Šï¼Œmenu å°†ä¼šè¢«è®¾ç½®æˆçª—å£é¡¶éƒ¨èœå•åœ¨Windowså’ŒLinuxä¸­
</code></pre>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125155603331.png"></p>
<p>[Menuèœå•æ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/menu">https://www.electronjs.org/zh/docs/latest/api/menu</a> â€œ<br>[roleçš„å±æ€§å€¼]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/menu-item#%E8%A7%92%E8%89%B2">https://www.electronjs.org/zh/docs/latest/api/menu-item#è§’è‰²</a> â€œ</p>
<h4 id="5-ç³»ç»Ÿæ‰˜ç›˜ï¼ˆTrayï¼‰"><a href="#5-ç³»ç»Ÿæ‰˜ç›˜ï¼ˆTrayï¼‰" class="headerlink" title="5.ç³»ç»Ÿæ‰˜ç›˜ï¼ˆTrayï¼‰"></a>5.ç³»ç»Ÿæ‰˜ç›˜ï¼ˆTrayï¼‰</h4><blockquote>
<p>æ·»åŠ å›¾æ ‡å’Œä¸Šä¸‹æ–‡èœå•åˆ°ç³»ç»Ÿé€šçŸ¥åŒº</p>
</blockquote>
<pre><code class="javascript">const &#123; app, Menu, Tray &#125; = require(&#39;electron&#39;)

let tray = null
app.whenReady().then(() =&gt; &#123;
  tray = new Tray(&#39;/path/to/my/icon&#39;) //å®šä¹‰iconçš„è·¯å¾„
  const contextMenu = Menu.buildFromTemplate([
    &#123; label: &#39;Item1&#39;, type: &#39;radio&#39; &#125;,
    &#123; label: &#39;Item2&#39;, type: &#39;radio&#39; &#125;,
    &#123; label: &#39;Item3&#39;, type: &#39;radio&#39;, checked: true &#125;,
    &#123; label: &#39;Item4&#39;, type: &#39;radio&#39; &#125;
  ])
  tray.setToolTip(&#39;This is my application.&#39;)//è®¾ç½®é¼ æ ‡æŒ‡é’ˆåœ¨æ‰˜ç›˜å›¾æ ‡ä¸Šæ‚¬åœæ—¶æ˜¾ç¤ºçš„æ–‡æœ¬
  tray.setContextMenu(contextMenu)//è®¾ç½®ä¸Šä¸‹æ–‡èœå•åˆ°æ‰˜ç›˜
&#125;)
</code></pre>
<p>å…¶å®è¿™ä¸ªTrayè·ŸMenuæ˜¯å¸ƒå±€å·®ä¸å¤ªå¤šçš„ï¼Œæ‰€ä»¥å­¦ä¹ èµ·æ¥ä¹Ÿä¸æ˜¯å¾ˆéš¾ç†è§£äº†ã€‚å…·ä½“äº‹ä»¶å’Œæ–¹æ³•ä¹Ÿä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæˆ‘ä»¬å°±ç›´æ¥çœ‹å®˜æ–¹APIæ–‡æ¡£å§ï¼</p>
<p>[Trayæ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/tray">https://www.electronjs.org/zh/docs/latest/api/tray</a> â€œ</p>
<h4 id="6-è§¦æ§æ¿ï¼ˆTouchBarï¼‰"><a href="#6-è§¦æ§æ¿ï¼ˆTouchBarï¼‰" class="headerlink" title="6.è§¦æ§æ¿ï¼ˆTouchBarï¼‰"></a>6.è§¦æ§æ¿ï¼ˆTouchBarï¼‰</h4><p><strong>æ³¨æ„:</strong> TouchBar APIç›®å‰ä¸ºå®éªŒæ€§è´¨ï¼Œå¯èƒ½ä¼šæ›´æ”¹æˆ–åˆ é™¤ã€‚</p>
<p>å¦‚æœå®˜ç½‘æ¨èçš„TouchBaræ¨¡æ‹Ÿå™¨ä¸‹è½½å¤±è´¥ï¼Œè‡ªå·±æœç´¢ä¸€ä¸‹å³å¯ã€‚ï¼ˆå¦‚æœä¸‹è½½çš„æ‰“ä¸å¼€ï¼Œé‚£å°±åœ¨åº”ç”¨ç¨‹åº-&gt;å³é”®æ˜¾ç¤ºåŒ…å†…å®¹-&gt;å¦‚ä¸‹ï¼‰æ‰§è¡Œå°±å¯ä»¥äº†</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125172856290.png"></p>
<pre><code class="javascript">//touchbar.js
const &#123; app, BrowserWindow, TouchBar &#125; = require(&#39;electron&#39;)

const &#123; TouchBarLabel, TouchBarButton, TouchBarSpacer &#125; = TouchBar

let spinning = false

// ç±»ä¼¼è€è™æœºçš„æ»šè½´æ ‡ç­¾
const reel1 = new TouchBarLabel()
const reel2 = new TouchBarLabel()
const reel3 = new TouchBarLabel()

// æ—‹è½¬ç»“æœæ ‡ç­¾
const result = new TouchBarLabel()

// æ—‹è½¬æŒ‰é’®
const spin = new TouchBarButton(&#123;
  label: &#39;ğŸ° Spin&#39;,
  backgroundColor: &#39;#7851A9&#39;,
  click: () =&gt; &#123;
    // Ignore clicks if already spinning
    if (spinning) &#123;
      return
    &#125;

    spinning = true
    result.label = &#39;&#39;

    let timeout = 10
    const spinLength = 4 * 1000 // 4 seconds
    const startTime = Date.now()

    const spinReels = () =&gt; &#123;
      updateReels()

      if ((Date.now() - startTime) &gt;= spinLength) &#123;
        finishSpin()
      &#125; else &#123;
        // Slow down a bit on each spin
        timeout *= 1.1
        setTimeout(spinReels, timeout)
      &#125;
    &#125;

    spinReels()
  &#125;
&#125;)

const getRandomValue = () =&gt; &#123;
  const values = [&#39;ğŸ’&#39;, &#39;ğŸ’&#39;, &#39;7ï¸âƒ£&#39;, &#39;ğŸŠ&#39;, &#39;ğŸ””&#39;, &#39;â­&#39;, &#39;ğŸ‡&#39;, &#39;ğŸ€&#39;]
  return values[Math.floor(Math.random() * values.length)]
&#125;

const updateReels = () =&gt; &#123;
  reel1.label = getRandomValue()
  reel2.label = getRandomValue()
  reel3.label = getRandomValue()
&#125;

const finishSpin = () =&gt; &#123;
  const uniqueValues = new Set([reel1.label, reel2.label, reel3.label]).size
  if (uniqueValues === 1) &#123;
    // All 3 values are the same
    result.label = &#39;ğŸ’° Jackpot!&#39;
    result.textColor = &#39;#FDFF00&#39;
  &#125; else if (uniqueValues === 2) &#123;
    // 2ä¸ªå€¼ç›¸åŒ
    result.label = &#39;ğŸ˜ Winner!&#39;
    result.textColor = &#39;#FDFF00&#39;
  &#125; else &#123;
    // æ²¡æœ‰å€¼ç›¸åŒ
    result.label = &#39;ğŸ™ Spin Again&#39;
    result.textColor = null
  &#125;
  spinning = false
&#125;

const touchBar = new TouchBar(&#123;
  items: [
    spin,
    new TouchBarSpacer(&#123; size: &#39;large&#39; &#125;),
    reel1,
    new TouchBarSpacer(&#123; size: &#39;small&#39; &#125;),
    reel2,
    new TouchBarSpacer(&#123; size: &#39;small&#39; &#125;),
    reel3,
    new TouchBarSpacer(&#123; size: &#39;large&#39; &#125;),
    result
  ]
&#125;)

let window

app.whenReady().then(() =&gt; &#123;
  window = new BrowserWindow(&#123;
    frame: false,
    titleBarStyle: &#39;hiddenInset&#39;,
    width: 200,
    height: 200,
    backgroundColor: &#39;#000&#39;
  &#125;)
  window.loadURL(&#39;about:blank&#39;)
  window.setTouchBar(touchBar)
&#125;)
</code></pre>
<p>è¿è¡Œå‘½ä»¤ï¼š</p>
<pre><code class="ini">./node_modules/.bin/electron touchbar.js
</code></pre>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125172447369.png"></p>
<p>[TouchBaræ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/touch-bar&quot;">https://www.electronjs.org/zh/docs/latest/api/touch-bar&quot;</a></p>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[Electronå®˜æ–¹æ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/app">https://www.electronjs.org/zh/docs/latest/api/app</a> â€œ<br>[npmjs]: 	â€œ<a target="_blank" rel="noopener" href="https://www.npmjs.com/">https://www.npmjs.com/</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/electron/" rel="tag">electron</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Electron-d-1-0"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/24/Electron-d-1-0/"
    >Electron-d-1.0</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/24/Electron-d-1-0/" class="article-date">
  <time datetime="2022-11-24T08:27:34.000Z" itemprop="datePublished">2022-11-24</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Electron/">Electron</a> / <a class="article-category-link" href="/categories/Electron/Electron-d-1-0/">Electron-d-1.0</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Electron"><a href="#Electron" class="headerlink" title="Electron"></a>Electron</h1><h3 id="ä¸€ã€æ„å»ºç¬¬ä¸€ä¸ªelectronåº”ç”¨"><a href="#ä¸€ã€æ„å»ºç¬¬ä¸€ä¸ªelectronåº”ç”¨" class="headerlink" title="ä¸€ã€æ„å»ºç¬¬ä¸€ä¸ªelectronåº”ç”¨"></a>ä¸€ã€æ„å»ºç¬¬ä¸€ä¸ªelectronåº”ç”¨</h3><h4 id="1-åˆå§‹åŒ–"><a href="#1-åˆå§‹åŒ–" class="headerlink" title="1.åˆå§‹åŒ–"></a>1.åˆå§‹åŒ–</h4><pre><code class="ini">npm init -y //åˆå§‹åŒ–é¡¹ç›®
npm install --save-dev electron //ä¸‹è½½electronåˆ°å¼€å‘ä¾èµ–
</code></pre>
<h4 id="2-åˆ›å»ºå…¥å£index-html"><a href="#2-åˆ›å»ºå…¥å£index-html" class="headerlink" title="2.åˆ›å»ºå…¥å£index.html"></a>2.åˆ›å»ºå…¥å£index.html</h4><pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP --&gt;
    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;&gt;
    &lt;title&gt;Hello World!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello World!&lt;/h1&gt;
    We are using Node.js &lt;span id=&quot;node-version&quot;&gt;&lt;/span&gt;,
    Chromium &lt;span id=&quot;chrome-version&quot;&gt;&lt;/span&gt;,
    and Electron &lt;span id=&quot;electron-version&quot;&gt;&lt;/span&gt;.
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h4 id="3-åˆ›å»ºå…¥å£æ–‡ä»¶"><a href="#3-åˆ›å»ºå…¥å£æ–‡ä»¶" class="headerlink" title="3.åˆ›å»ºå…¥å£æ–‡ä»¶"></a>3.åˆ›å»ºå…¥å£æ–‡ä»¶</h4><pre><code class="javascript">//main.js
const &#123; app,BrowserWindow &#125; = require(&#39;electron&#39;)

const createWindow = () =&gt; &#123;
    const win = new BrowserWindow(&#123;
      width: 800,
      height: 600
    &#125;)
  
    win.loadFile(&#39;index.html&#39;)
  &#125;

app.whenReady().then(() =&gt; &#123;
    createWindow()
  &#125;)
</code></pre>
<h4 id="4-åˆ›å»ºçª—å£åº”ç”¨"><a href="#4-åˆ›å»ºçª—å£åº”ç”¨" class="headerlink" title="4.åˆ›å»ºçª—å£åº”ç”¨"></a>4.åˆ›å»ºçª—å£åº”ç”¨</h4><p>Package.jsoné…ç½®</p>
<pre><code class="javascript">//Package.json
&#123;
  &quot;name&quot;: &quot;electron-app&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;ä¸€ä¸ªå¤„äºå®éªŒé˜¶æ®µçš„app&quot;,
  &quot;main&quot;: &quot;main.js&quot;,
  &quot;scripts&quot;: &#123;
    &quot;start&quot;: &quot;electron .&quot;
  &#125;,
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;alanmf&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;devDependencies&quot;: &#123;
    &quot;electron&quot;: &quot;^21.3.0&quot;
  &#125;
&#125;
</code></pre>
<pre><code class="ini">npm start //æ‰§è¡Œ electron .
</code></pre>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221123155226283.png"></p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221123155133707.png"></p>
<p>ä¸ºäº†æ›´æ–¹ä¾¿é¡µé¢æ›´æ–°æˆ‘ä»¬ä½¿ç”¨nodemon</p>
<p>nodemonæ˜¯ä¸€ä¸ªè‡ªåŠ¨é‡å¯nodeåº”ç”¨çš„å·¥å…·ï¼Œå½“ç›‘å¬çš„æ–‡ä»¶æˆ–ç›‘å¬ç›®å½•ä¸‹çš„æ–‡ä»¶å‘ç”Ÿä¿®æ”¹æ—¶ï¼Œè‡ªåŠ¨é‡å¯åº”ç”¨</p>
<pre><code class="ini">npm i nodemon -D
</code></pre>
<p>æ›´æ”¹package.json</p>
<pre><code class="javascript">//Package.json
&#123;
  &quot;name&quot;: &quot;electron-app&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;ä¸€ä¸ªå¤„äºå®éªŒé˜¶æ®µçš„app&quot;,
  &quot;main&quot;: &quot;main.js&quot;,
  &quot;scripts&quot;: &#123;
    &quot;start&quot;: &quot;nodemon --exec electron .&quot;
  &#125;,
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;alanmf&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;devDependencies&quot;: &#123;
    &quot;electron&quot;: &quot;^21.3.0&quot;
  &#125;
&#125;
</code></pre>
<h3 id="äºŒã€electronæ ¸å¿ƒ"><a href="#äºŒã€electronæ ¸å¿ƒ" class="headerlink" title="äºŒã€electronæ ¸å¿ƒ"></a>äºŒã€electronæ ¸å¿ƒ</h3><h4 id="1-electronæ ¸å¿ƒæ¦‚å¿µ"><a href="#1-electronæ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="1.electronæ ¸å¿ƒæ¦‚å¿µ"></a>1.electronæ ¸å¿ƒæ¦‚å¿µ</h4><p><strong>ä¸»è¿›ç¨‹</strong>ï¼›å¯åŠ¨é¡¹ç›®æ—¶è¿è¡Œçš„main.jsè„šæœ¬å°±æ˜¯æˆ‘ä»¬è¯´çš„ä¸»è¿›ç¨‹ï¼Œåœ¨ä¸»è¿›ç¨‹è¿è¡Œçš„è„šæ­¥å¯ä»¥åˆ›å»ºwebé¡µé¢çš„å½¢å¼å±•ç¤ºGUIï¼Œä¸»è¿›ç¨‹åªæœ‰ä¸€ä¸ªã€‚</p>
<p><strong>æ¸²æŸ“è¿›ç¨‹</strong>ï¼šæ¯ä¸ªElectronçš„é¡µé¢éƒ½åœ¨è¿è¡Œç€è‡ªå·±çš„è¿›ç¨‹ï¼Œè¿™æ ·çš„è¿›ç¨‹ç§°ä¹‹ä¸ºæ¸²æŸ“è¿›ç¨‹ï¼ˆåŸºäºChromiumçš„å¤šè¿›ç¨‹ç»“æ„ï¼‰ã€‚</p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221123160858462.png"></p>
<p>ä¸»è¿›ç¨‹ä½¿ç”¨BrowserWindowåˆ›å»ºå®ä¾‹ï¼Œä¸»è¿›ç¨‹é”€æ¯åï¼Œå¯¹åº”çš„æ¸²æŸ“è¿›ç¨‹ä¼šè¢«ç»ˆæ­¢ã€‚ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹é€šè¿‡ IPC çš„æ–¹å¼ï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰è¿›è¡Œé€šä¿¡ã€‚</p>
<h4 id="2-electronçª—å£æ§åˆ¶å°"><a href="#2-electronçª—å£æ§åˆ¶å°" class="headerlink" title="2.electronçª—å£æ§åˆ¶å°"></a>2.electronçª—å£æ§åˆ¶å°</h4><pre><code class="javascript">//æ‰“å¼€å¼€å‘è€…å·¥å…·
win.webContents.openDevTools();
//æš‚æ—¶å…³é—­å®‰å…¨è­¦å‘Šï¼ˆä¸æ¨èï¼‰
process.env[&#39;ELECTRON_DISABLE_SECURITY_WARNINGS&#39;] = &#39;true&#39;
</code></pre>
<pre><code class="javascript">//é…ç½®CSPï¼ˆé˜»æŒ¡ä¸€éƒ¨åˆ†å®‰å…¨è­¦å‘Šï¼‰
&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;&gt;
</code></pre>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221123162757926.png"></p>
<h4 id="3-ä¸»è¿›ç¨‹äº‹ä»¶ç”Ÿå‘½å‘¨æœŸ"><a href="#3-ä¸»è¿›ç¨‹äº‹ä»¶ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="3.ä¸»è¿›ç¨‹äº‹ä»¶ç”Ÿå‘½å‘¨æœŸ"></a>3.ä¸»è¿›ç¨‹äº‹ä»¶ç”Ÿå‘½å‘¨æœŸ</h4><p>å…³é—­æ‰€æœ‰çª—å£æ—¶é€€å‡ºåº”ç”¨ <strong>Windows &amp; Linux</strong></p>
<p>åœ¨Windowså’ŒLinuxä¸Šï¼Œå…³é—­æ‰€æœ‰çª—å£é€šå¸¸ä¼šå®Œå…¨é€€å‡ºä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦ç›‘å¬ <code>app</code> æ¨¡å—çš„ <code>&#39;window-all-closed&#39;äº‹ä»¶ã€‚å¦‚æœç”¨æˆ·ä¸æ˜¯åœ¨ macOS(</code>darwin<code>) ä¸Šè¿è¡Œç¨‹åºï¼Œåˆ™è°ƒç”¨ </code>app.quit()&#96;ã€‚</p>
<pre><code class="javascript">app.on(&#39;window-all-closed&#39;, () =&gt; &#123;
  //macOSç”¨æˆ·åœ¨å…³é—­çª—å£æ—¶ä¸ä¼šå…³é—­åº”ç”¨
  if (process.platform !== &#39;darwin&#39;) app.quit()
&#125;)
</code></pre>
<p>å½“ Linux å’Œ Windows åº”ç”¨åœ¨æ²¡æœ‰çª—å£æ‰“å¼€æ—¶é€€å‡ºäº†ï¼ŒmacOS åº”ç”¨é€šå¸¸å³ä½¿åœ¨æ²¡æœ‰æ‰“å¼€ä»»ä½•çª—å£çš„æƒ…å†µä¸‹ä¹Ÿç»§ç»­è¿è¡Œï¼Œå¹¶ä¸”åœ¨æ²¡æœ‰çª—å£å¯ç”¨çš„æƒ…å†µä¸‹æ¿€æ´»åº”ç”¨æ—¶ä¼šæ‰“å¼€æ–°çš„çª—å£ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸€ç‰¹æ€§ï¼Œç›‘å¬ <code>app</code> æ¨¡å—çš„ <code>activate</code> äº‹ä»¶ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•æµè§ˆå™¨çª—å£æ˜¯æ‰“å¼€çš„ï¼Œåˆ™è°ƒç”¨ <code>createWindow()</code> æ–¹æ³•ã€‚</p>
<p>å› ä¸ºçª—å£æ— æ³•åœ¨ <code>ready</code> äº‹ä»¶å‰åˆ›å»ºï¼Œä½ åº”å½“åœ¨ä½ çš„åº”ç”¨åˆå§‹åŒ–åä»…ç›‘å¬ <code>activate</code> äº‹ä»¶ã€‚ é€šè¿‡åœ¨æ‚¨ç°æœ‰çš„ <code>whenReady()</code> å›è°ƒä¸­é™„ä¸Šæ‚¨çš„äº‹ä»¶ç›‘å¬å™¨æ¥å®Œæˆè¿™ä¸ªæ“ä½œã€‚</p>
<pre><code class="javascript">app.whenReady().then(() =&gt; &#123;
  createWindow()
  app.on(&#39;activate&#39;, () =&gt; &#123;
    if (BrowserWindow.getAllWindows().length === 0) createWindow()
  &#125;)
&#125;)
</code></pre>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„çª—å£çš„æ§ä»¶å°±å®Œæ•´äº†ï¼ˆå®ç°macOSç”¨æˆ·-æ²¡æœ‰çª—å£æ‰“å¼€æ—¶åˆ›å»ºæ–°çª—å£-å…³é—­çª—å£ä¸å…³é—­åº”ç”¨ï¼Œç‚¹å‡»ç¨‹åºååº”ç”¨æ‰“å¼€æ–°çª—å£ï¼‰</p>
<h4 id="4-é€šè¿‡é¢„åŠ è½½è„šæœ¬ä»æ¸²æŸ“å™¨è®¿é—®Node-js"><a href="#4-é€šè¿‡é¢„åŠ è½½è„šæœ¬ä»æ¸²æŸ“å™¨è®¿é—®Node-js" class="headerlink" title="4.é€šè¿‡é¢„åŠ è½½è„šæœ¬ä»æ¸²æŸ“å™¨è®¿é—®Node.js"></a>4.é€šè¿‡é¢„åŠ è½½è„šæœ¬ä»æ¸²æŸ“å™¨è®¿é—®Node.js</h4><p>ç°åœ¨ï¼Œæœ€åè¦åšçš„æ˜¯è¾“å‡ºElectronçš„ç‰ˆæœ¬å·å’Œå®ƒçš„ä¾èµ–é¡¹åˆ°ä½ çš„webé¡µé¢ä¸Šã€‚</p>
<p>åœ¨ä¸»è¿›ç¨‹é€šè¿‡Nodeçš„å…¨å±€ <code>process</code> å¯¹è±¡è®¿é—®è¿™ä¸ªä¿¡æ¯æ˜¯å¾®ä¸è¶³é“çš„ã€‚ ç„¶è€Œï¼Œä½ ä¸èƒ½ç›´æ¥åœ¨ä¸»è¿›ç¨‹ä¸­ç¼–è¾‘DOMï¼Œå› ä¸ºå®ƒæ— æ³•è®¿é—®æ¸²æŸ“å™¨ <code>æ–‡æ¡£</code> ä¸Šä¸‹æ–‡ã€‚ å®ƒä»¬å­˜åœ¨äºå®Œå…¨ä¸åŒçš„è¿›ç¨‹ï¼</p>
<p>è¿™æ˜¯å°† <strong>é¢„åŠ è½½</strong> è„šæœ¬è¿æ¥åˆ°æ¸²æŸ“å™¨æ—¶æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚ é¢„åŠ è½½è„šæœ¬åœ¨æ¸²æŸ“å™¨è¿›ç¨‹åŠ è½½ä¹‹å‰åŠ è½½ï¼Œå¹¶æœ‰æƒè®¿é—®ä¸¤ä¸ª æ¸²æŸ“å™¨å…¨å±€ (ä¾‹å¦‚ <code>window</code> å’Œ <code>document</code>) å’Œ Node.js ç¯å¢ƒã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªåä¸º <code>preload.js</code> çš„æ–°è„šæœ¬:</p>
<pre><code class="javascript">//preload.js
window.addEventListener(&#39;DOMContentLoaded&#39;, () =&gt; &#123;
  const replaceText = (selector, text) =&gt; &#123;
    const element = document.getElementById(selector)
    if (element) element.innerText = text
  &#125;

  for (const dependency of [&#39;chrome&#39;, &#39;node&#39;, &#39;electron&#39;]) &#123;
    replaceText(`$&#123;dependency&#125;-version`, process.versions[dependency])
  &#125;
&#125;)
</code></pre>
<p>ä¸Šé¢çš„ä»£ç è®¿é—® Node.js <code>process.versions</code> å¯¹è±¡ï¼Œå¹¶è¿è¡Œä¸€ä¸ªåŸºæœ¬çš„ <code>replaceText</code> è¾…åŠ©å‡½æ•°å°†ç‰ˆæœ¬å·æ’å…¥åˆ° HTML æ–‡æ¡£ä¸­ã€‚</p>
<p>è¦å°†æ­¤è„šæœ¬é™„åŠ åˆ°æ¸²æŸ“å™¨æµç¨‹ï¼Œè¯·åœ¨ä½ ç°æœ‰çš„ <code>BrowserWindow</code> æ„é€ å™¨ä¸­å°†è·¯å¾„ä¸­çš„é¢„åŠ è½½è„šæœ¬ä¼ å…¥ <code>webPreferences.preload</code> é€‰é¡¹ã€‚</p>
<pre><code class="javascript">// include the Node.js &#39;path&#39; module at the top of your file
const path = require(&#39;path&#39;)

// modify your existing createWindow() function
const createWindow = () =&gt; &#123;
  const win = new BrowserWindow(&#123;
    width: 800,
    height: 600,
    webPreferences: &#123;
      preload: path.join(__dirname, &#39;preload.js&#39;)
    &#125;
  &#125;)

  win.loadFile(&#39;index.html&#39;)
&#125;
// ...
</code></pre>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124081539904.png"></p>
<p>è¿™é‡Œä½¿ç”¨äº†ä¸¤ä¸ªNode.jsæ¦‚å¿µï¼š</p>
<ul>
<li><code>__dirname</code>å­—ç¬¦ä¸²æŒ‡å‘å½“å‰æ­£åœ¨æ‰§è¡Œè„šæœ¬çš„è·¯å¾„ (åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒæŒ‡å‘ä½ çš„é¡¹ç›®çš„æ ¹æ–‡ä»¶å¤¹)ã€‚</li>
<li><code>path.join</code> API å°†å¤šä¸ªè·¯å¾„è”ç»“åœ¨ä¸€èµ·ï¼Œåˆ›å»ºä¸€ä¸ªè·¨å¹³å°çš„è·¯å¾„å­—ç¬¦ä¸²ã€‚</li>
</ul>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç›¸å¯¹å½“å‰æ­£åœ¨æ‰§è¡ŒJavaScriptæ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™æ ·ç›¸å¯¹è·¯å¾„å°†åœ¨å¼€å‘æ¨¡å¼å’Œæ‰“åŒ…æ¨¡å¼ä¸­éƒ½å°†æœ‰æ•ˆã€‚</p>
<h4 id="5-contextBridge"><a href="#5-contextBridge" class="headerlink" title="5.contextBridge"></a>5.contextBridge</h4><p><code>contextBridge</code>æ¨¡å—æœ‰ä»¥ä¸‹æ–¹æ³•:</p>
<p><code>contextBridge.exposeInMainWorld(apiKey, api)</code></p>
<ul>
<li><code>apiKey</code> string - å°† API æ³¨å…¥åˆ° <code>çª—å£</code> çš„é”®ã€‚ API å°†å¯é€šè¿‡ <code>window[apiKey]</code> è®¿é—®ã€‚</li>
<li><code>api</code> any - ä½ çš„ APIå¯ä»¥æ˜¯ä»€ä¹ˆæ ·çš„ä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ç›¸å…³ä¿¡æ¯å¦‚ä¸‹ã€‚</li>
</ul>
<p>åº”ç”¨å¼€å‘æ¥å£ï¼ˆAPIï¼‰</p>
<p>æä¾›ç»™ <code>exposeInMainWorld</code> çš„ <code>api</code> å¿…é¡»æ˜¯ä¸€ä¸ª <code>Function</code>ï¼Œ <code>string</code>ï¼Œ <code>number</code>ï¼Œ <code>Array</code>ï¼Œ <code>boolean</code>ï¼›æˆ–ä¸€ä¸ªé”®ä¸ºå­—ç¬¦ä¸²ï¼Œå€¼ä¸ºä¸€ä¸ª <code>Function</code>ï¼Œ <code>string</code>ï¼Œ <code>number</code>ï¼Œ <code>Array</code>ï¼Œ <code>boolean</code>çš„å¯¹è±¡ï¼›æˆ–å…¶ä»–ç¬¦åˆç›¸åŒæ¡ä»¶çš„åµŒå¥—å¯¹è±¡ã€‚</p>
<p><code>Function</code> ç±»å‹çš„å€¼è¢«ä»£ç†åˆ°å…¶ä»–ä¸Šä¸‹æ–‡ä¸­ï¼Œæ‰€æœ‰å…¶ä»–ç±»å‹çš„å€¼éƒ½ä¼šè¢« <strong>å¤åˆ¶</strong> å¹¶ <strong>å†»ç»“</strong>ã€‚ åœ¨ API ä¸­å‘é€çš„ä»»ä½•æ•°æ® &#x2F;åŸå§‹æ•°æ®å°†ä¸å¯æ”¹å˜ï¼Œåœ¨æ¡¥æ¥å™¨å…¶ä¸­ä¸€ä¾§çš„æ›´æ–°ä¸ä¼šå¯¼è‡´å¦ä¸€ä¾§çš„æ›´æ–°ã€‚</p>
<p>ä»£ç åº”ç”¨ï¼š</p>
<pre><code class="javascript">//preload.js+
const &#123; contextBridge &#125; = require(&#39;electron&#39;)

contextBridge.exposeInMainWorld(&#39;myApi&#39;,&#123;
    platform:process.platform
  &#125;)
</code></pre>
<p>é‚£æˆ‘ä»¬å°±å¯ä»¥åœ¨é¡µé¢ä¸Šå»è®¿é—®windowä¸Šçš„æ–¹æ³•äº†</p>
<pre><code class="javascript">//app.js
console.log(window.myApi.platform) //darwin
</code></pre>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124093018081.png"></p>
<h3 id="ä¸‰ã€ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹é€šä¿¡"><a href="#ä¸‰ã€ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹é€šä¿¡" class="headerlink" title="ä¸‰ã€ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹é€šä¿¡"></a>ä¸‰ã€ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹é€šä¿¡</h3><p>è¿›ç¨‹é—´é€šä¿¡ (IPC) æ˜¯åœ¨ Electron ä¸­æ„å»ºåŠŸèƒ½ä¸°å¯Œçš„æ¡Œé¢åº”ç”¨ç¨‹åºçš„å…³é”®éƒ¨åˆ†ä¹‹ä¸€ã€‚ ç”±äºä¸»è¿›ç¨‹å’Œæ¸²æŸ“å™¨è¿›ç¨‹åœ¨ Electron çš„è¿›ç¨‹æ¨¡å‹å…·æœ‰ä¸åŒçš„èŒè´£ï¼Œå› æ­¤ IPC æ˜¯æ‰§è¡Œè®¸å¤šå¸¸è§ä»»åŠ¡çš„å”¯ä¸€æ–¹æ³•ï¼Œä¾‹å¦‚ä» UI è°ƒç”¨åŸç”Ÿ API æˆ–ä»åŸç”Ÿèœå•è§¦å‘ Web å†…å®¹çš„æ›´æ”¹ã€‚</p>
<p>åœ¨ Electron ä¸­ï¼Œè¿›ç¨‹ä½¿ç”¨ <code>ipcMain</code> å’Œ <code>ipcRenderer</code>æ¨¡å—ï¼Œé€šè¿‡å¼€å‘äººå‘˜å®šä¹‰çš„â€œé€šé“â€ä¼ é€’æ¶ˆæ¯æ¥è¿›è¡Œé€šä¿¡ã€‚ è¿™äº›é€šé“æ˜¯ <strong>ä»»æ„</strong> ï¼ˆæ‚¨å¯ä»¥éšæ„å‘½åå®ƒä»¬ï¼‰å’Œ <strong>åŒå‘</strong> ï¼ˆæ‚¨å¯ä»¥åœ¨ä¸¤ä¸ªæ¨¡å—ä¸­ä½¿ç”¨ç›¸åŒçš„é€šé“åç§°ï¼‰çš„ã€‚</p>
<h4 id="1-æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆå•å‘"><a href="#1-æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆå•å‘" class="headerlink" title="1.æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆå•å‘ )"></a>1.æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆå•å‘ )</h4><p>è¦å°†å•å‘ IPC æ¶ˆæ¯ä»æ¸²æŸ“å™¨è¿›ç¨‹å‘é€åˆ°ä¸»è¿›ç¨‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>ipcRenderer.send</code>API å‘é€æ¶ˆæ¯ï¼Œç„¶åä½¿ç”¨ <code>ipcMain.on</code>API æ¥æ”¶ã€‚</p>
<p>æˆ‘ä»¬ä¸‹è¾¹å°±æŒ‰ç…§å®˜ç½‘çš„ä¾‹å­æ¥è¯´å§ï¼</p>
<h5 id="1-ä½¿ç”¨-ipcMain-on-ç›‘å¬äº‹ä»¶"><a href="#1-ä½¿ç”¨-ipcMain-on-ç›‘å¬äº‹ä»¶" class="headerlink" title="(1) ä½¿ç”¨ ipcMain.on ç›‘å¬äº‹ä»¶"></a>(1) ä½¿ç”¨ <code>ipcMain.on</code> ç›‘å¬äº‹ä»¶</h5><p>åœ¨ä¸»è¿›ç¨‹ï¼ˆmain.jsï¼‰ä¸­ï¼Œä½¿ç”¨ <code>ipcMain.on</code> API åœ¨ <code>set-title</code> é€šé“ä¸Šè®¾ç½®ä¸€ä¸ª IPC ç›‘å¬å™¨:</p>
<pre><code class="javascript">//main.js+
const &#123; ipcMain &#125; = require(&#39;electron&#39;)
 ipcMain.on(&#39;set-title&#39;, (event, title) =&gt; &#123;
      const webContents = event.sender
      const win = BrowserWindow.fromWebContents(webContents)
      win.setTitle(title)
    &#125;)
</code></pre>
<h5 id="2-é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²-ipcRenderer-send"><a href="#2-é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²-ipcRenderer-send" class="headerlink" title="(2) é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ² ipcRenderer.send"></a>(2) é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ² <code>ipcRenderer.send</code></h5><p>è¦å°†æ¶ˆæ¯å‘é€åˆ°ä¸Šé¢åˆ›å»ºçš„ IPC ç›‘å¬å™¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>ipcRenderer.send</code> APIã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¸²æŸ“å™¨è¿›ç¨‹æ²¡æœ‰æƒé™è®¿é—® Node.js å’Œ Electron æ¨¡å—ã€‚ ä½œä¸ºåº”ç”¨å¼€å‘è€…ï¼Œéœ€è¦ä½¿ç”¨ <code>contextBridge</code> API æ¥é€‰æ‹©è¦ä»é¢„åŠ è½½è„šæœ¬ä¸­æš´éœ²å“ªäº› APIã€‚</p>
<p>åœ¨æ‚¨çš„é¢„åŠ è½½è„šæœ¬ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œå‘æ¸²æŸ“å™¨è¿›ç¨‹æš´éœ²ä¸€ä¸ªå…¨å±€çš„ <code>window.electronAPI</code> å˜é‡ã€‚</p>
<pre><code class="javascript">//preload.js+
const &#123; contextBridge,ipcRenderer &#125; = require(&#39;electron&#39;)
contextBridge.exposeInMainWorld(&#39;electronAPI&#39;, &#123;
    setTitle: (title) =&gt; ipcRenderer.send(&#39;set-title&#39;, title)
&#125;)
</code></pre>
<p>æ­¤æ—¶ï¼Œå°†èƒ½å¤Ÿåœ¨æ¸²æŸ“å™¨è¿›ç¨‹ä¸­ä½¿ç”¨ <code>window.electronAPI.setTitle()</code> å‡½æ•°ã€‚</p>
<h5 id="3-æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹-UI"><a href="#3-æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹-UI" class="headerlink" title="(3) æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹ UI"></a>(3) æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹ UI</h5><p>åœ¨ BrowserWindow åŠ è½½çš„æˆ‘ä»¬çš„ HTML æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªç”±æ–‡æœ¬è¾“å…¥æ¡†å’ŒæŒ‰é’®ç»„æˆçš„åŸºæœ¬ç”¨æˆ·ç•Œé¢ï¼š</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP --&gt;
    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;&gt;
    &lt;title&gt;Hello World!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    Title: &lt;input id=&quot;title&quot;/&gt;
    &lt;button id=&quot;btn&quot; type=&quot;button&quot;&gt;Set&lt;/button&gt;
    &lt;script src=&quot;./renderer/app.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>å°†åœ¨å¯¼å…¥çš„ <code>renderer.js</code> æ–‡ä»¶ä¸­æ·»åŠ å‡ è¡Œä»£ç ï¼Œä»¥åˆ©ç”¨ä»é¢„åŠ è½½è„šæœ¬ä¸­æš´éœ²çš„ <code>window.electronAPI</code> åŠŸèƒ½ï¼š</p>
<pre><code class="javascript">//app.js
const setButton = document.getElementById(&#39;btn&#39;)
const titleInput = document.getElementById(&#39;title&#39;)
setButton.addEventListener(&#39;click&#39;, () =&gt; &#123;
    const title = titleInput.value
    window.electronAPI.setTitle(title)
&#125;);
</code></pre>
<p>åˆ°ç›®å‰çš„ä»£ç ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹çš„è¿›ç¨‹é€šä¿¡å°±å·²ç»å®ç°äº†ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ä¸€è¯•æˆ‘ä»¬çš„UIç•Œé¢åŠŸèƒ½</p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124100800847.png"></p>
<h5 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h5><p>ï¼ï¼ï¼æˆ‘ä»¬ä¸Šé¢æœ‰ä¸€äº›åœ°æ–¹ä¸ç†è§£çš„æ–¹æ³•å’ŒAPIï¼Œæˆ‘ä»¬ç°åœ¨è®²ä¸€ä¸‹</p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124101054114.png"></p>
<p>ä¸Šé¢çš„ å›è°ƒå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ª IpcMainEvent ç»“æ„å’Œä¸€ä¸ª <code>title</code> å­—ç¬¦ä¸²ã€‚ æ¯å½“æ¶ˆæ¯é€šè¿‡ <code>set-title</code> é€šé“ä¼ å…¥æ—¶ï¼Œæ­¤å‡½æ•°æ‰¾åˆ°é™„åŠ åˆ°æ¶ˆæ¯å‘é€æ–¹çš„ BrowserWindow å®ä¾‹ï¼Œå¹¶åœ¨è¯¥å®ä¾‹ä¸Šä½¿ç”¨ <code>win.setTitle</code> APIã€‚</p>
<p>æˆ‘ä»¬åªæ˜¯ä¸ºäº†æ›´ç®€å•çš„ç†è§£è¿›ç¨‹é€šä¿¡ï¼Œå…·ä½“ API è§å®˜æ–¹æ–‡æ¡£å§ï¼</p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124101339509.png"></p>
<h4 id="2-æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆåŒå‘ï¼‰"><a href="#2-æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆåŒå‘ï¼‰" class="headerlink" title="2.æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆåŒå‘ï¼‰"></a>2.æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆåŒå‘ï¼‰</h4><p>åŒå‘ IPC çš„ä¸€ä¸ªå¸¸è§åº”ç”¨æ˜¯ä»æ¸²æŸ“å™¨è¿›ç¨‹ä»£ç è°ƒç”¨ä¸»è¿›ç¨‹æ¨¡å—å¹¶ç­‰å¾…ç»“æœã€‚ è¿™å¯ä»¥é€šè¿‡å°† <code>ipcRenderer.invoke</code> ä¸ <code>ipcMain.handle</code> æ­é…ä½¿ç”¨æ¥å®Œæˆã€‚</p>
<h5 id="1-ä½¿ç”¨-ipcMain-handle-ç›‘å¬äº‹ä»¶"><a href="#1-ä½¿ç”¨-ipcMain-handle-ç›‘å¬äº‹ä»¶" class="headerlink" title="(1)ä½¿ç”¨ ipcMain.handle ç›‘å¬äº‹ä»¶"></a>(1)ä½¿ç”¨ <code>ipcMain.handle</code> ç›‘å¬äº‹ä»¶</h5><p>åœ¨ä¸»è¿›ç¨‹(main.js)ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª <code>handleFileOpen()</code> å‡½æ•°ï¼Œå®ƒè°ƒç”¨ <code>dialog.showOpenDialog</code> å¹¶è¿”å›ç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶è·¯å¾„å€¼ã€‚ æ¯å½“æ¸²æŸ“å™¨è¿›ç¨‹é€šè¿‡ <code>dialog:openFile</code> é€šé“å‘é€ <code>ipcRender.invoke</code> æ¶ˆæ¯æ—¶ï¼Œæ­¤å‡½æ•°è¢«ç”¨ä½œä¸€ä¸ªå›è°ƒã€‚ ç„¶åï¼Œè¿”å›å€¼å°†ä½œä¸ºä¸€ä¸ª Promise è¿”å›åˆ°æœ€åˆçš„ <code>invoke</code> è°ƒç”¨ã€‚</p>
<pre><code class="javascript">//main.js
const &#123; app,BrowserWindow,ipcMain,dialog &#125; = require(&#39;electron&#39;)
const path = require(&#39;path&#39;)

//å›è°ƒå‡½æ•°
async function handleFileOpen() &#123;
  const &#123; canceled, filePaths &#125; = await dialog.showOpenDialog()
  if (canceled) &#123;
    return
  &#125; else &#123;
    return filePaths[0]
  &#125;
&#125;

const createWindow = () =&gt; &#123;
    const win = new BrowserWindow(&#123;
      width: 800,
      height: 600,
      webPreferences: &#123;
        preload: path.join(__dirname, &#39;preload.js&#39;)
      &#125;
    &#125;)
    win.loadFile(&#39;index.html&#39;) 
    win.webContents.openDevTools()
    
  &#125;

  app.whenReady().then(() =&gt; &#123;
    //ç›‘å¬ï¼Œæ‰§è¡Œå›è°ƒ
    ipcMain.handle(&#39;dialog:openFile&#39;, handleFileOpen)
    createWindow()
    app.on(&#39;activate&#39;, () =&gt; &#123;
      if (BrowserWindow.getAllWindows().length === 0) createWindow()
    &#125;)
  &#125;)
  app.on(&#39;window-all-closed&#39;, () =&gt; &#123;
    if (process.platform !== &#39;darwin&#39;) app.quit()
  &#125;)
</code></pre>
<h5 id="2-é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²-ipcRenderer-invoke"><a href="#2-é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²-ipcRenderer-invoke" class="headerlink" title="(2)é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ² ipcRenderer.invoke"></a>(2)é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ² <code>ipcRenderer.invoke</code></h5><p>åœ¨é¢„åŠ è½½è„šæœ¬ä¸­ï¼Œæˆ‘ä»¬æš´éœ²äº†ä¸€ä¸ªå•è¡Œçš„ <code>openFile</code> å‡½æ•°ï¼Œå®ƒè°ƒç”¨å¹¶è¿”å› <code>ipcRenderer.invoke(&#39;dialog:openFile&#39;)</code> çš„å€¼ã€‚ æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ­¥ä¸­ä½¿ç”¨æ­¤ API ä»æ¸²æŸ“å™¨çš„ç”¨æˆ·ç•Œé¢è°ƒç”¨åŸç”Ÿå¯¹è¯æ¡†ã€‚</p>
<pre><code class="javascript">//preload.js
const &#123; contextBridge,ipcRenderer &#125; = require(&#39;electron&#39;)
 contextBridge.exposeInMainWorld(&#39;electronAPI&#39;, &#123;
    openFile: () =&gt; ipcRenderer.invoke(&#39;dialog:openFile&#39;)
&#125;)
</code></pre>
<h5 id="3-æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹-UI-1"><a href="#3-æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹-UI-1" class="headerlink" title="(3)æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹ UI"></a>(3)æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹ UI</h5><p>æœ€åï¼Œè®©æˆ‘ä»¬æ„å»ºåŠ è½½åˆ° BrowserWindow ä¸­çš„ HTML æ–‡ä»¶ã€‚</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP --&gt;
    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;&gt;
    &lt;title&gt;Dialog&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;button type=&quot;button&quot; id=&quot;btn&quot;&gt;Open a File&lt;/button&gt;
    File path: &lt;strong id=&quot;filePath&quot;&gt;&lt;/strong&gt;
    &lt;script src=&#39;./renderer/app.js&#39;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>ç”¨æˆ·ç•Œé¢åŒ…å«ä¸€ä¸ª <code>#btn</code> æŒ‰é’®å…ƒç´ ï¼Œå°†ç”¨äºè§¦å‘æˆ‘ä»¬çš„é¢„åŠ è½½ APIï¼Œä»¥åŠä¸€ä¸ª <code>#filePath</code> å…ƒç´ ï¼Œå°†ç”¨äºæ˜¾ç¤ºæ‰€é€‰æ–‡ä»¶çš„è·¯å¾„ã€‚éœ€è¦åœ¨æ¸²æŸ“å™¨è¿›ç¨‹è„šæœ¬ä¸­ç¼–å†™å‡ è¡Œä»£ç </p>
<pre><code class="javascript">//app.js
const btn = document.getElementById(&#39;btn&#39;)
const filePathElement = document.getElementById(&#39;filePath&#39;)

btn.addEventListener(&#39;click&#39;, async () =&gt; &#123;
  const filePath = await window.electronAPI.openFile()
  filePathElement.innerText = filePath
&#125;)
</code></pre>
<p>åˆ°ç›®å‰çš„ä»£ç ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹çš„åŒå‘è¿›ç¨‹é€šä¿¡å°±å·²ç»å®ç°äº†ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ä¸€è¯•æˆ‘ä»¬çš„UIç•Œé¢åŠŸèƒ½</p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124103530122.png"></p>
<h5 id="æ€»ç»“ï¼š-1"><a href="#æ€»ç»“ï¼š-1" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h5><p><code>ipcRenderer.invoke</code> API ï¼ˆè€æ–¹æ³•äº†ï¼Œä½†ä¾ç„¶å¥½ç”¨ï¼‰æ˜¯åœ¨ Electron 7 ä¸­æ·»åŠ çš„ï¼Œä½œä¸ºå¤„ç†æ¸²æŸ“å™¨è¿›ç¨‹ä¸­åŒå‘ IPC çš„ä¸€ç§å¼€å‘äººå‘˜å‹å¥½çš„æ–¹å¼ã€‚ ä½†è¿™ç§ IPC æ¨¡å¼å­˜åœ¨å‡ ç§æ›¿ä»£æ–¹æ³•ã€‚</p>
<p>ä½¿ç”¨ <code>ipcRenderer.send</code>æˆ‘ä»¬ç”¨äºå•å‘é€šä¿¡çš„ <code>ipcRenderer.send</code> API ä¹Ÿå¯ç”¨äºåŒå‘é€šä¿¡ã€‚ è¿™æ˜¯åœ¨ Electron 7 ä¹‹å‰é€šè¿‡ IPC è¿›è¡Œå¼‚æ­¥åŒå‘é€šä¿¡çš„æ¨èæ–¹å¼ã€‚</p>
<pre><code class="javascript">//preload.js
// æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ `contextBridge` API
// å°†è¿™æ®µä»£ç æš´éœ²ç»™æ¸²æŸ“å™¨è¿›ç¨‹
const &#123; ipcRenderer &#125; = require(&#39;electron&#39;)

ipcRenderer.on(&#39;asynchronous-reply&#39;, (_event, arg) =&gt; &#123;
  console.log(arg) // åœ¨ DevTools æ§åˆ¶å°ä¸­æ‰“å°â€œpongâ€
&#125;)
ipcRenderer.send(&#39;asynchronous-message&#39;, &#39;ping&#39;)
</code></pre>
<pre><code class="javascript">//main.js
ipcMain.on(&#39;asynchronous-message&#39;, (event, arg) =&gt; &#123;
  console.log(arg) // åœ¨ Node æ§åˆ¶å°ä¸­æ‰“å°â€œpingâ€
  // ä½œç”¨å¦‚åŒ `send`ï¼Œä½†è¿”å›ä¸€ä¸ªæ¶ˆæ¯
  // åˆ°å‘é€åŸå§‹æ¶ˆæ¯çš„æ¸²æŸ“å™¨
  event.reply(&#39;asynchronous-reply&#39;, &#39;pong&#39;)
&#125;)
</code></pre>
<p>è¿™ç§æ–¹æ³•æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š</p>
<ul>
<li>æ‚¨éœ€è¦è®¾ç½®ç¬¬äºŒä¸ª <code>ipcRenderer.on</code> ç›‘å¬å™¨æ¥å¤„ç†æ¸²æŸ“å™¨è¿›ç¨‹ä¸­çš„å“åº”ã€‚ ä½¿ç”¨ <code>invoke</code>ï¼Œæ‚¨å°†è·å¾—ä½œä¸º Promise è¿”å›åˆ°åŸå§‹ API è°ƒç”¨çš„å“åº”å€¼ã€‚</li>
<li>æ²¡æœ‰æ˜¾è€Œæ˜“è§çš„æ–¹æ³•å¯ä»¥å°† <code>asynchronous-reply</code> æ¶ˆæ¯ä¸åŸå§‹çš„ <code>asynchronous-message</code>æ¶ˆæ¯é…å¯¹ã€‚ å¦‚æœæ‚¨é€šè¿‡è¿™äº›é€šé“éå¸¸é¢‘ç¹åœ°æ¥å›ä¼ é€’æ¶ˆæ¯ï¼Œåˆ™éœ€è¦æ·»åŠ å…¶ä»–åº”ç”¨ä»£ç æ¥å•ç‹¬è·Ÿè¸ªæ¯ä¸ªè°ƒç”¨å’Œå“åº”ã€‚</li>
</ul>
<p>ä½¿ç”¨ <code>ipcRenderer.sendSync</code>APIä¹Ÿæ˜¯å¯ä»¥æ›¿ä»£çš„ï¼Œä½†ä¸æ¨è</p>
<p><code>ipcRenderer.sendSync</code> API å‘ä¸»è¿›ç¨‹å‘é€æ¶ˆæ¯ï¼Œå¹¶ <em>åŒæ­¥</em> ç­‰å¾…å“åº”ã€‚</p>
<pre><code class="javascript">//main.js
const &#123; ipcMain &#125; = require(&#39;electron&#39;)
ipcMain.on(&#39;synchronous-message&#39;, (event, arg) =&gt; &#123;
  console.log(arg) // åœ¨ Node æ§åˆ¶å°ä¸­æ‰“å°â€œpingâ€
  event.returnValue = &#39;pong&#39;
&#125;)
</code></pre>
<pre><code class="javascript">//perload.js
// æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ `contextBridge` API
// å°†è¿™æ®µä»£ç æš´éœ²ç»™æ¸²æŸ“å™¨è¿›ç¨‹
const &#123; ipcRenderer &#125; = require(&#39;electron&#39;)

const result = ipcRenderer.sendSync(&#39;synchronous-message&#39;, &#39;ping&#39;)
console.log(result) // åœ¨ DevTools æ§åˆ¶å°ä¸­æ‰“å°â€œpongâ€
</code></pre>
<p>è¿™ä»½ä»£ç çš„ç»“æ„ä¸ <code>invoke</code> æ¨¡å‹éå¸¸ç›¸ä¼¼ï¼Œä½†å‡ºäºæ€§èƒ½åŸå› ï¼Œæˆ‘ä»¬å»ºè®®<strong>é¿å…ä½¿ç”¨æ­¤ API</strong>ã€‚ å®ƒçš„åŒæ­¥ç‰¹æ€§æ„å‘³ç€å®ƒå°†é˜»å¡æ¸²æŸ“å™¨è¿›ç¨‹ï¼Œç›´åˆ°æ”¶åˆ°å›å¤ä¸ºæ­¢ã€‚(å®¹æ˜“é˜»å¡æ¸²æŸ“å™¨è¿›ç¨‹)</p>
<h4 id="3-ä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹"><a href="#3-ä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹" class="headerlink" title="3.ä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹"></a>3.ä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹</h4><p>å°†æ¶ˆæ¯ä»ä¸»è¿›ç¨‹å‘é€åˆ°æ¸²æŸ“å™¨è¿›ç¨‹æ—¶ï¼Œéœ€è¦æŒ‡å®šæ˜¯å“ªä¸€ä¸ªæ¸²æŸ“å™¨æ¥æ”¶æ¶ˆæ¯ã€‚ æ¶ˆæ¯éœ€è¦é€šè¿‡å…¶ <code>WebContents</code>å®ä¾‹å‘é€åˆ°æ¸²æŸ“å™¨è¿›ç¨‹ã€‚ æ­¤ WebContents å®ä¾‹åŒ…å«ä¸€ä¸ª <code>send</code> æ–¹æ³•ï¼Œå…¶ä½¿ç”¨æ–¹å¼ä¸ <code>ipcRenderer.send</code> ç›¸åŒã€‚</p>
<h5 id="1-ä½¿ç”¨-webContents-æ¨¡å—å‘é€æ¶ˆæ¯"><a href="#1-ä½¿ç”¨-webContents-æ¨¡å—å‘é€æ¶ˆæ¯" class="headerlink" title="(1)ä½¿ç”¨ webContents æ¨¡å—å‘é€æ¶ˆæ¯"></a>(1)ä½¿ç”¨ <code>webContents</code> æ¨¡å—å‘é€æ¶ˆæ¯</h5><p>æˆ‘ä»¬éœ€è¦é¦–å…ˆä½¿ç”¨ Electron çš„ <code>Menu</code> æ¨¡å—åœ¨ä¸»è¿›ç¨‹ä¸­æ„å»ºä¸€ä¸ªè‡ªå®šä¹‰èœå•ï¼Œè¯¥æ¨¡å—ä½¿ç”¨ <code>webContents.send</code> API å°† IPC æ¶ˆæ¯ä»ä¸»è¿›ç¨‹å‘é€åˆ°ç›®æ ‡æ¸²æŸ“å™¨ã€‚</p>
<pre><code class="javascript">//main.js
const &#123; app,BrowserWindow,ipcMain,Menu &#125; = require(&#39;electron&#39;)
const path = require(&#39;path&#39;)

const createWindow = () =&gt; &#123;
    const win = new BrowserWindow(&#123;
      width: 800,
      height: 600,
      webPreferences: &#123;
        preload: path.join(__dirname, &#39;preload.js&#39;)
      &#125;
    &#125;)

    const menu = Menu.buildFromTemplate([
      &#123;
        label: app.name,
        submenu: [
        &#123;
          click: () =&gt; win.webContents.send(&#39;update-counter&#39;, 1),
          label: &#39;Increment&#39;,
        &#125;,
        &#123;
          click: () =&gt; win.webContents.send(&#39;update-counter&#39;, -1),
          label: &#39;Decrement&#39;,
        &#125;
        ]
      &#125;
  
    ])

    Menu.setApplicationMenu(menu)
    win.loadFile(&#39;index.html&#39;) 
    win.webContents.openDevTools()
    
  &#125;

  app.whenReady().then(() =&gt; &#123;
    ipcMain.on(&#39;counter-value&#39;, (_event, value) =&gt; &#123;
      console.log(value) // will print value to Node console
    &#125;)
    createWindow()
    app.on(&#39;activate&#39;, () =&gt; &#123;
      if (BrowserWindow.getAllWindows().length === 0) createWindow()
    &#125;)
  &#125;)

  app.on(&#39;window-all-closed&#39;, () =&gt; &#123;
    if (process.platform !== &#39;darwin&#39;) app.quit()
  &#125;)
</code></pre>
<h5 id="2-é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²-ipcRenderer-on"><a href="#2-é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²-ipcRenderer-on" class="headerlink" title="(2)é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ² ipcRenderer.on"></a>(2)é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ² <code>ipcRenderer.on</code></h5><p>ä¸å‰é¢çš„æ¸²æŸ“å™¨åˆ°ä¸»è¿›ç¨‹çš„ç¤ºä¾‹ä¸€æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨é¢„åŠ è½½è„šæœ¬ä¸­çš„ <code>contextBridge</code> å’Œ <code>ipcRenderer</code> æ¨¡å—å‘æ¸²æŸ“å™¨è¿›ç¨‹æš´éœ² IPC åŠŸèƒ½ï¼š</p>
<pre><code class="javascript">//preload.js
const &#123; contextBridge,ipcRenderer &#125; = require(&#39;electron&#39;)
contextBridge.exposeInMainWorld(&#39;electronAPI&#39;, &#123;
    handleCounter: (callback) =&gt; ipcRenderer.on(&#39;update-counter&#39;, callback)
&#125;)
</code></pre>
<p>åŠ è½½é¢„åŠ è½½è„šæœ¬åï¼Œæ¸²æŸ“å™¨è¿›ç¨‹åº”æœ‰æƒè®¿é—® <code>window.electronAPI.handleCounter()</code> ç›‘å¬å™¨å‡½æ•°ã€‚</p>
<h5 id="3-æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹-UI-2"><a href="#3-æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹-UI-2" class="headerlink" title="(3)æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹ UI"></a>(3)æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹ UI</h5><p>æˆ‘ä»¬å°†åœ¨åŠ è½½çš„ HTML æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª <code>#counter</code>å…ƒç´ ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥å…ƒç´ æ¥æ˜¾ç¤ºå€¼ï¼š</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP --&gt;
    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;&gt;
    &lt;title&gt;Menu Counter&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    Current value: &lt;strong id=&quot;counter&quot;&gt;0&lt;/strong&gt;
    &lt;script src=&#39;./renderer/app.js&#39;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>ä¸ºäº†æ›´æ–° HTML æ–‡æ¡£ä¸­çš„å€¼ï¼Œæˆ‘ä»¬å°†æ·»åŠ å‡ è¡Œ DOM æ“ä½œçš„ä»£ç ï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡è§¦å‘ <code>update-counter</code> äº‹ä»¶æ—¶æ›´æ–° <code>#counter</code> å…ƒç´ çš„å€¼ã€‚</p>
<pre><code class="javascript">//app.js
const counter = document.getElementById(&#39;counter&#39;)
window.electronAPI.handleCounter((event, value) =&gt; &#123;
    const oldValue = Number(counter.innerText)
    const newValue = oldValue + value
    counter.innerText = newValue
    event.sender.send(&#39;counter-value&#39;, newValue)
&#125;)
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†å›è°ƒä¼ é€’ç»™ä»é¢„åŠ è½½è„šæœ¬ä¸­æš´éœ²çš„ <code>window.electronAPI.onUpdateCounter</code> å‡½æ•°ã€‚ ç¬¬äºŒä¸ª <code>value</code> å‚æ•°å¯¹åº”äºæˆ‘ä»¬ä¼ å…¥ <code>webContents.send</code> å‡½æ•°çš„ <code>1</code> æˆ– <code>-1</code>ï¼Œè¯¥å‡½æ•°æ˜¯ä»åŸç”Ÿèœå•è°ƒç”¨çš„ã€‚</p>
<p>åˆ°ç›®å‰çš„ä»£ç ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹çš„è¿›ç¨‹é€šä¿¡å°±å·²ç»å®ç°äº†ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ä¸€è¯•æˆ‘ä»¬çš„UIç•Œé¢åŠŸèƒ½</p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124161644112.png"></p>
<h5 id="æ€»ç»“ï¼š-2"><a href="#æ€»ç»“ï¼š-2" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h5><p>å¯¹äºä»ä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹çš„ IPCï¼Œæ²¡æœ‰ä¸ <code>ipcRenderer.invoke</code> ç­‰æ•ˆçš„ APIã€‚ ä¸è¿‡ï¼Œå¯ä»¥ä» <code>ipcRenderer.on</code> å›è°ƒä¸­å°†å›å¤å‘é€å›ä¸»è¿›ç¨‹ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å¯¹å‰é¢ä¾‹å­çš„ä»£ç è¿›è¡Œç•¥å¾®ä¿®æ”¹æ¥æ¼”ç¤ºè¿™ä¸€ç‚¹ã€‚ åœ¨æ¸²æŸ“å™¨è¿›ç¨‹ä¸­ï¼Œä½¿ç”¨ <code>event</code> å‚æ•°ï¼Œé€šè¿‡ <code>counter-value</code> é€šé“å°†å›å¤å‘é€å›ä¸»è¿›ç¨‹ã€‚</p>
<pre><code class="javascript">//app.js
const counter = document.getElementById(&#39;counter&#39;)
window.electronAPI.handleCounter((event, value) =&gt; &#123;
    const oldValue = Number(counter.innerText)
    const newValue = oldValue + value
    counter.innerText = newValue
    event.sender.send(&#39;counter-value&#39;, newValue)
&#125;)
</code></pre>
<p>åœ¨ä¸»è¿›ç¨‹ä¸­ï¼Œç›‘å¬ <code>counter-value</code> äº‹ä»¶å¹¶é€‚å½“åœ°å¤„ç†å®ƒä»¬ã€‚</p>
<pre><code class="javascript">//main.js
ipcMain.on(&#39;counter-value&#39;, (_event, value) =&gt; &#123;
      console.log(value) // will print value to Node console
  &#125;)
</code></pre>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124162116311.png"></p>
<h4 id="4-æ¸²æŸ“å™¨è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹"><a href="#4-æ¸²æŸ“å™¨è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹" class="headerlink" title="4.æ¸²æŸ“å™¨è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹"></a>4.æ¸²æŸ“å™¨è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹</h4><p>æ²¡æœ‰ç›´æ¥çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨ <code>ipcMain</code> å’Œ <code>ipcRenderer</code> æ¨¡å—åœ¨ Electron ä¸­çš„æ¸²æŸ“å™¨è¿›ç¨‹ä¹‹é—´å‘é€æ¶ˆæ¯ã€‚ ä¸ºæ­¤ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<ul>
<li>å°†ä¸»è¿›ç¨‹ä½œä¸ºæ¸²æŸ“å™¨ä¹‹é—´çš„æ¶ˆæ¯ä»£ç†ã€‚ è¿™éœ€è¦å°†æ¶ˆæ¯ä»ä¸€ä¸ªæ¸²æŸ“å™¨å‘é€åˆ°ä¸»è¿›ç¨‹ï¼Œç„¶åä¸»è¿›ç¨‹å°†æ¶ˆæ¯è½¬å‘åˆ°å¦ä¸€ä¸ªæ¸²æŸ“å™¨ã€‚</li>
<li>ä»ä¸»è¿›ç¨‹å°†ä¸€ä¸ª MessagePort ä¼ é€’åˆ°ä¸¤ä¸ªæ¸²æŸ“å™¨ã€‚ è¿™å°†å…è®¸åœ¨åˆå§‹è®¾ç½®åæ¸²æŸ“å™¨ä¹‹é—´ç›´æ¥è¿›è¡Œé€šä¿¡ã€‚</li>
</ul>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[Electronå®˜ç½‘]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/tutorial/quick-start">https://www.electronjs.org/zh/docs/latest/tutorial/quick-start</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/electron/" rel="tag">electron</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-pinia"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/23/pinia/"
    >pinia</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/23/pinia/" class="article-date">
  <time datetime="2022-11-23T02:21:26.000Z" itemprop="datePublished">2022-11-23</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Electron/">Electron</a> / <a class="article-category-link" href="/categories/Electron/Pinia/">Pinia</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="pinia"><a href="#pinia" class="headerlink" title="pinia"></a>pinia</h1><h3 id="ä¸€ã€Vuex-ä¸-Pinia-æ ¸å¿ƒæ€æƒ³ä¸ç”¨æ³•"><a href="#ä¸€ã€Vuex-ä¸-Pinia-æ ¸å¿ƒæ€æƒ³ä¸ç”¨æ³•" class="headerlink" title="ä¸€ã€Vuex ä¸ Pinia æ ¸å¿ƒæ€æƒ³ä¸ç”¨æ³•"></a>ä¸€ã€Vuex ä¸ Pinia æ ¸å¿ƒæ€æƒ³ä¸ç”¨æ³•</h3><h4 id="Flux-æ¶æ„"><a href="#Flux-æ¶æ„" class="headerlink" title="Flux æ¶æ„"></a>Flux æ¶æ„</h4><p>Flux æ˜¯ Facebook åœ¨æ„å»ºå¤§å‹ Web åº”ç”¨ç¨‹åºæ—¶ä¸ºäº†è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜è€Œè®¾è®¡å‡ºçš„ä¸€ç§æ¶æ„ï¼Œå®ƒæ˜¯ä¸€ç§æè¿°çŠ¶æ€ç®¡ç†çš„è®¾è®¡æ¨¡å¼ã€‚ç»å¤§å¤šæ•°å‰ç«¯é¢†åŸŸçš„çŠ¶æ€ç®¡ç†å·¥å…·éƒ½éµå¾ªè¿™ç§æ¶æ„ï¼Œæˆ–è€…ä»¥å®ƒä¸ºå‚è€ƒåŸå‹ã€‚</p>
<p>Flux æ¶æ„ä¸»è¦æœ‰å››ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p>
<ul>
<li>ğŸ“¦ <strong>store</strong>ï¼šçŠ¶æ€æ•°æ®çš„å­˜å‚¨ç®¡ç†ä¸­å¿ƒï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œå¯ä»¥æ¥å— action åšå‡ºå“åº”ã€‚</li>
<li>ğŸ–¼ <strong>view</strong>ï¼šè§†å›¾ï¼Œæ ¹æ® store ä¸­çš„æ•°æ®æ¸²æŸ“ç”Ÿæˆé¡µé¢ï¼Œä¸ store ä¹‹é—´å­˜åœ¨å‘å¸ƒè®¢é˜…å…³ç³»ã€‚</li>
<li>ğŸ›  <strong>action</strong>ï¼šä¸€ç§æè¿°åŠ¨ä½œè¡Œä¸ºçš„æ•°æ®å¯¹è±¡ï¼Œé€šå¸¸ä¼šåŒ…å«åŠ¨ä½œç±»å‹ type å’Œéœ€è¦ä¼ é€’çš„å‚æ•° payload ç­‰å±æ€§ã€‚</li>
<li>ğŸ“® <strong>dispatcher</strong>ï¼šè°ƒåº¦å™¨ï¼Œæ¥æ”¶ action å¹¶åˆ†å‘è‡³ storeã€‚</li>
</ul>
<p><img src="/2022/11/23/pinia/b55512a3f1be47b2.png"></p>
<p>æ•´ä¸ªæ•°æ®æµåŠ¨å…³ç³»ä¸ºï¼š</p>
<p>1ã€view è§†å›¾ä¸­çš„äº¤äº’è¡Œä¸ºä¼šåˆ›å»º actionï¼Œäº¤ç”± dispatcher è°ƒåº¦å™¨ã€‚</p>
<p>2ã€dispatcher æ¥æ”¶åˆ° action åä¼šåˆ†å‘è‡³å¯¹åº”çš„ storeã€‚</p>
<p>3ã€store æ¥æ”¶åˆ° action ååšå‡ºå“åº”åŠ¨ä½œï¼Œå¹¶è§¦å‘ change äº‹ä»¶ï¼Œé€šçŸ¥ä¸å…¶å…³è”çš„ view é‡æ–°æ¸²æŸ“å†…å®¹ã€‚</p>
<p>è¿™å°±æ˜¯ Flux æ¶æ„æœ€æ ¸å¿ƒçš„ç‰¹ç‚¹ï¼šå•å‘æ•°æ®æµã€‚</p>
<p>ä¸ä¼ ç»Ÿçš„ MVC æ¶æ„ç›¸æ¯”ï¼Œå•å‘æ•°æ®æµä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªå¥½å¤„ï¼šå¯é¢„æµ‹æ€§ã€‚</p>
<p>æ‰€æœ‰å¯¹äºçŠ¶æ€çš„ä¿®æ”¹éƒ½éœ€è¦ç»è¿‡ dispatcher æ´¾å‘çš„ action æ¥è§¦å‘çš„ï¼Œæ¯ä¸€ä¸ª action éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ•°æ®å¯¹è±¡å®ä½“ï¼Œå¯åºåˆ—åŒ–ï¼Œæ“ä½œè®°å½•å¯è¿½è¸ªï¼Œæ›´æ˜“äºè°ƒè¯•ã€‚</p>
<p>Vuex ä¸ Pinia å¤§ä½“ä¸Šæ²¿ç”¨ Flux çš„æ€æƒ³ï¼Œå¹¶é’ˆå¯¹ Vue æ¡†æ¶å•ç‹¬è¿›è¡Œäº†ä¸€äº›è®¾è®¡ä¸Šçš„ä¼˜åŒ–ã€‚</p>
<h4 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h4><p><img src="/2022/11/23/pinia/f9ae36a64955b220.png"></p>
<ul>
<li>ğŸ“¦ <strong>state</strong>ï¼šæ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ç®¡ç†å•ä¾‹ï¼Œç­‰æ•ˆäº Vue ç»„ä»¶ä¸­çš„ dataï¼Œå¯¹åº”äº† Flux æ¶æ„ä¸­çš„ storeã€‚</li>
<li>ğŸ§® <strong>getter</strong>ï¼šå¯ä»¥ç”± state ä¸­çš„æ•°æ®æ´¾ç”Ÿè€Œæˆï¼Œç­‰æ•ˆäº Vue ç»„ä»¶ä¸­çš„è®¡ç®—å±æ€§ã€‚å®ƒä¼šè‡ªåŠ¨æ”¶é›†ä¾èµ–ï¼Œä»¥å®ç°è®¡ç®—å±æ€§çš„ç¼“å­˜ã€‚</li>
<li>ğŸ›  <strong>mutation</strong>ï¼šç±»ä¼¼äºäº‹ä»¶ï¼ŒåŒ…å«ä¸€ä¸ªç±»å‹åå’Œå¯¹åº”çš„å›è°ƒå‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­å¯ä»¥å¯¹ state ä¸­çš„æ•°æ®è¿›è¡ŒåŒæ­¥ä¿®æ”¹ã€‚<ul>
<li>Vuex ä¸å…è®¸ç›´æ¥è°ƒç”¨è¯¥å‡½æ•°ï¼Œè€Œæ˜¯éœ€è¦é€šè¿‡ <code>store.commit</code> æ–¹æ³•æäº¤ä¸€ä¸ªæ“ä½œï¼Œå¹¶å°†å‚æ•°ä¼ å…¥å›è°ƒå‡½æ•°ã€‚</li>
<li>commit çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œæ­£å¦‚ Flux æ¶æ„ä¸­çš„ action å¯¹è±¡ä¸€æ ·ï¼Œå®ƒåŒ…å«äº†ç±»å‹å <code>type</code> å’Œè´Ÿè½½ <code>payload</code>ã€‚</li>
<li>è¿™é‡Œè¦æ±‚ mutation ä¸­å›è°ƒå‡½æ•°çš„æ“ä½œä¸€å®šæ˜¯åŒæ­¥çš„ï¼Œè¿™æ˜¯å› ä¸ºåŒæ­¥çš„ã€å¯åºåˆ—åŒ–çš„æ“ä½œæ­¥éª¤èƒ½ä¿è¯ç”Ÿæˆå”¯ä¸€çš„æ—¥å¿—è®°å½•ï¼Œæ‰èƒ½ä½¿å¾— devtools èƒ½å¤Ÿå®ç°å¯¹çŠ¶æ€çš„è¿½è¸ªï¼Œå®ç° time-travelã€‚</li>
</ul>
</li>
<li>ğŸ”¨ <strong>action</strong>ï¼šaction å†…éƒ¨çš„æ“ä½œä¸å—é™åˆ¶ï¼Œå¯ä»¥è¿›è¡Œä»»æ„çš„å¼‚æ­¥æ“ä½œã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡ <code>dispatch</code> æ–¹æ³•æ¥è§¦å‘ action æ“ä½œï¼ŒåŒæ ·çš„ï¼Œå‚æ•°åŒ…å«äº†ç±»å‹å <code>type</code> å’Œè´Ÿè½½ <code>payload</code>ã€‚<ul>
<li>action çš„æ“ä½œæœ¬è´¨ä¸Šå·²ç»è„±ç¦»äº† Vuex æœ¬èº«ï¼Œå‡å¦‚å°†å®ƒå‰¥ç¦»å‡ºæ¥ï¼Œä»…ä»…åœ¨ç”¨æˆ·ï¼ˆå¼€å‘è€…ï¼‰ä»£ç ä¸­è°ƒç”¨ <code>commit</code> æ¥æäº¤ mutation ä¹Ÿèƒ½è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœã€‚</li>
</ul>
</li>
<li>ğŸ“ <strong>module</strong>ï¼šstore çš„åˆ†å‰²ï¼Œæ¯ä¸ª module éƒ½å…·æœ‰ç‹¬ç«‹çš„ stateã€getterã€mutation å’Œ actionã€‚<ul>
<li>å¯ä»¥ä½¿ç”¨ <code>module.registerModule</code> åŠ¨æ€æ³¨å†Œæ¨¡å—ã€‚</li>
<li>æ”¯æŒæ¨¡å—ç›¸äº’åµŒå¥—ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®å‘½åç©ºé—´æ¥è¿›è¡Œæ•°æ®å’Œæ“ä½œéš”ç¦»ã€‚</li>
</ul>
</li>
</ul>
<h4 id="Pinia"><a href="#Pinia" class="headerlink" title="Pinia"></a>Pinia</h4><p><img src="/2022/11/23/pinia/image-20221123084525884.png"></p>
<p>ä¿ç•™ï¼š</p>
<ul>
<li>ğŸ“¦ <strong>state</strong>ï¼šstore çš„æ ¸å¿ƒï¼Œä¸ Vue ä¸­çš„ data ä¸€è‡´ï¼Œå¯ä»¥ç›´æ¥å¯¹å…¶ä¸­çš„æ•°æ®è¿›è¡Œè¯»å†™ã€‚</li>
<li>ğŸ§® <strong>getters</strong>ï¼šä¸ Vue ä¸­çš„è®¡ç®—å±æ€§ç›¸åŒï¼Œæ”¯æŒç¼“å­˜ã€‚</li>
<li>ğŸ”¨ <strong>actions</strong>ï¼šæ“ä½œä¸å—é™åˆ¶ï¼Œå¯ä»¥åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ï¼Œå¯ä»¥ç›´æ¥è¢«è°ƒç”¨ï¼Œä¸å†éœ€è¦ commitã€dispatch ç­‰æ–¹æ³•ã€‚</li>
</ul>
<p>èˆå¼ƒï¼š</p>
<ul>
<li>ğŸ›  <strong>mutation</strong>ï¼šPinia å¹¶éå®Œå…¨æŠ›å¼ƒäº† mutationï¼Œè€Œæ˜¯å°†å¯¹ state ä¸­å•ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹çš„æ“ä½œå°è£…ä¸ºä¸€ä¸ª mutationï¼Œä½†ä¸å¯¹å¤–å¼€æ”¾æ¥å£ã€‚å¯ä»¥åœ¨ devtools ä¸­è§‚å¯Ÿåˆ° mutationã€‚</li>
<li>ğŸ“ <strong>module</strong>ï¼šPinia é€šè¿‡åœ¨åˆ›å»º store æ—¶æŒ‡å®š name æ¥åŒºåˆ†ä¸åŒçš„ storeï¼Œä¸å†éœ€è¦ moduleã€‚</li>
</ul>
<h3 id="äºŒã€ä½¿ç”¨Pinia"><a href="#äºŒã€ä½¿ç”¨Pinia" class="headerlink" title="äºŒã€ä½¿ç”¨Pinia"></a>äºŒã€ä½¿ç”¨Pinia</h3><h4 id="1-å®‰è£…pinia"><a href="#1-å®‰è£…pinia" class="headerlink" title="1.å®‰è£…pinia"></a>1.å®‰è£…pinia</h4><pre><code class="ini">npm i pinia -S //å®‰è£…piniaä¾èµ–
</code></pre>
<h4 id="2-main-jsç»„å†Œ"><a href="#2-main-jsç»„å†Œ" class="headerlink" title="2.main.jsç»„å†Œ"></a>2.main.jsç»„å†Œ</h4><pre><code class="javascript">//main.js
import &#123; createApp &#125; from &#39;vue&#39;
import &#39;./style.css&#39;
import App from &#39;./App.vue&#39;
import &#123; createPinia &#125; from &#39;pinia&#39;

createApp(App)
.use(createPinia())
.mount(&#39;#app&#39;)
</code></pre>
<h4 id="3-åˆ›å»ºstore"><a href="#3-åˆ›å»ºstore" class="headerlink" title="3.åˆ›å»ºstore"></a>3.åˆ›å»ºstore</h4><p><img src="/2022/11/23/pinia/image-20221123090656211.png"></p>
<pre><code class="javascript">//countStore.js
import &#123; defineStore &#125; from &#39;pinia&#39;
const useCountStore = defineStore(&#39;countStore&#39;,&#123;
    state()&#123;
        return &#123;
            count:0
        &#125;
    &#125;
&#125; )
export default useCountStore; //å¯¼å‡º
</code></pre>
<h4 id="4-æ–°å»ºç»„ä»¶ä½¿ç”¨state"><a href="#4-æ–°å»ºç»„ä»¶ä½¿ç”¨state" class="headerlink" title="4.æ–°å»ºç»„ä»¶ä½¿ç”¨state"></a>4.æ–°å»ºç»„ä»¶ä½¿ç”¨state</h4><pre><code class="vue">//components/Count.vue
&lt;script setup&gt;
import useCountStore from &#39;../store/countStore&#39;
const countStore = useCountStore();
console.log(countStore)
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
    &#123;&#123;countStore.count&#125;&#125;
  &lt;/div&gt;
&lt;/template&gt;
&lt;style lang=&quot;css&quot;&gt;
div&#123;
    width: 100px;
    height: 30px;
    border:1px solid black;
    border-radius: 5px;
&#125;
&lt;/style&gt;
</code></pre>
<pre><code class="vue">//App.vue
&lt;script setup&gt;
// This starter template is using Vue 3 &lt;script setup&gt; SFCs
// Check out https://vuejs.org/api/sfc-script-setup.html#script-setup
import Count from &#39;./components/Count.vue&#39;
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;Count/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.logo &#123;
  height: 6em;
  padding: 1.5em;
  will-change: filter;
&#125;
.logo:hover &#123;
  filter: drop-shadow(0 0 2em #646cffaa);
&#125;
.logo.vue:hover &#123;
  filter: drop-shadow(0 0 2em #42b883aa);
&#125;
&lt;/style&gt;
</code></pre>
<p><img src="/2022/11/23/pinia/image-20221123091224524.png" alt="countStore"></p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å°±å¯ä»¥äº†ï¼Œæ ¹æ®ä¸Šé¢æ§åˆ¶å°è¾“å‡ºå¯ä»¥çœ‹æ¸…æ¥šcountStore</p>
<p>åˆ°ç°åœ¨å·²ç»å®ç°äº†åˆ›å»ºstoreåŠä½¿ç”¨</p>
<h4 id="5-æ›´æ–°store"><a href="#5-æ›´æ–°store" class="headerlink" title="5.æ›´æ–°store"></a>5.æ›´æ–°store</h4><p>1.æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªactionæ–¹æ³•</p>
<pre><code class="javascript">//countStore.js
import &#123; defineStore &#125; from &#39;pinia&#39;

const useCountStore = defineStore(&#39;countStore&#39;,&#123;
    //å®šä¹‰state
    state()&#123;
        return &#123;
            count:0
        &#125;
    &#125;,
    //å®šä¹‰actionæ–¹æ³•
    actions:&#123;
        add()&#123;
            this.count++
        &#125;
    &#125;
&#125; )

export default useCountStore;
</code></pre>
<p>2.è§£æ„æ–¹æ³•å’Œstate</p>
<pre><code class="vue">//Count.vue
&lt;script setup&gt;
import &#123; storeToRefs &#125; from &#39;pinia&#39;
import useCountStore from &#39;../store/countStore&#39;
const &#123;count,add&#125; = storeToRefs(useCountStore());
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
    &#123;&#123;count&#125;&#125;
  &lt;/div&gt;
  &lt;button @click=&quot;add()&quot;&gt;Add&lt;/button&gt;
&lt;/template&gt;
&lt;style lang=&quot;css&quot;&gt;
div&#123;
    width: 100px;
    height: 30px;
    border:1px solid black;
    border-radius: 5px;
    text-align: center;
&#125;
button&#123;
    position: relative;
    bottom: -30px;
&#125;
&lt;/style&gt; 
</code></pre>
<p>å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ storeToRefs æ¥è½¬å‘ï¼Œé‚£ä¹ˆé¡µé¢å°†ä¸ä¼šæœ‰ä»»ä½•å“åº”</p>
<p>ä½†æ˜¯æˆ‘ä»¬åŒ…è£¹äº†useCountStore()å¹¶ä¸”è§£æ„äº†ï¼Œå‘ç°æ§åˆ¶å°è¾“å‡ºé”™è¯¯error</p>
<p><img src="/2022/11/23/pinia/image-20221123094109387.png"></p>
<p>ç»è¿‡ä¿®æ”¹å‘ç°ï¼Œactionsæ–¹æ³•ä¸å¯ä»¥é€šè¿‡è§£æ„æ¥ä½¿ç”¨ï¼Œåªèƒ½é€šè¿‡å¦ä¸€ç§æ–¹æ³•</p>
<p><img src="/2022/11/23/pinia/image-20221123094416363.png"> </p>
<h3 id="å‚è€ƒæ–‡æ¡£ï¼š"><a href="#å‚è€ƒæ–‡æ¡£ï¼š" class="headerlink" title="å‚è€ƒæ–‡æ¡£ï¼š"></a>å‚è€ƒæ–‡æ¡£ï¼š</h3><p>[Piniaä¸­æ–‡æ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://pinia.web3doc.top/">https://pinia.web3doc.top/</a> â€œ<br>[Viteä¸­æ–‡æ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://vitejs.cn/">https://vitejs.cn/</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pinia/" rel="tag">Pinia</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-viteé…ç½®"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/22/vite%E9%85%8D%E7%BD%AE/"
    >viteé…ç½®</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/22/vite%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2022-11-22T01:50:43.000Z" itemprop="datePublished">2022-11-22</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/">å·¥ç¨‹æŠ€æœ¯</a> / <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/vite%E9%85%8D%E7%BD%AE/">viteé…ç½®</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="viteé…ç½®"><a href="#viteé…ç½®" class="headerlink" title="viteé…ç½®"></a>viteé…ç½®</h1><p>æœ€ç›´è§‚çš„ä½“éªŒæ˜¯â€œå¿«é€Ÿâ€ã€â€œæ¸…çˆ½â€ï¼Œå¼€å‘æ•ˆç‡ä¹Ÿå¾—åˆ°æ˜æ˜¾æå‡ï¼ˆè§£å†³æ‰äº†webpackå¼€å‘æœåŠ¡å™¨å­˜åœ¨çš„ç—›ç‚¹ï¼‰ã€‚</p>
<p>åˆå§‹åŒ–å®Œæˆåï¼Œå·¥ç¨‹ç›®å½•å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/11/22/vite%E9%85%8D%E7%BD%AE/image-20221122094453903.png"></p>
<p>VS Codeæ’ä»¶ï¼šVite</p>
<p>é…ç½®è¯¦æƒ…ï¼š</p>
<p>vite.config.ts</p>
<pre><code class="javascript">import &#123; defineConfig, loadEnv &#125; from &#39;vite&#39;;
import vue from &#39;@vitejs/plugin-vue&#39;;
import vueJSX from &#39;@vitejs/plugin-vue-jsx&#39;;
import Components from &#39;unplugin-vue-components/vite&#39;;
import &#123; AntDesignVueResolver &#125; from &#39;unplugin-vue-components/resolvers&#39;;
import &#123; resolve &#125; from &#39;path&#39;;
import &#123; initDevProxy &#125; from &#39;./http-proxy&#39;;

// https://vitejs.dev/config/
export default defineConfig((&#123; mode &#125;) =&gt; &#123;
  const env = loadEnv(mode, process.cwd(), &#39;&#39;);
  return &#123;
    // è‡ªå®šä¹‰å…¬å…±åŸºç¡€è·¯å¾„ï¼ˆå–è‡ª .env(.*) æ–‡ä»¶ï¼‰
    base: env.VITE_BASE_PATH,
    // å®šä¹‰å…¨å±€å¸¸é‡æ›¿æ¢æ–¹å¼
    define: &#123;
      // å–æ¶ˆå¯ç”¨Vue.2xä¸­é€‰é¡¹å¼apiï¼ˆè¿™éƒ¨åˆ†ä¸ä¼šè¢«æ‰“åŒ…ï¼‰
      &#39;__VUE_OPTIONS_API__&#39;: false,
    &#125;,
    // é…ç½®viteæ’ä»¶
    plugins: [
      vue(),
      vueJSX(),
      // è‡ªåŠ¨åŒ–çš„ç»„ä»¶æŒ‰éœ€å¼•å…¥é…ç½®
      Components(&#123;
        extensions: [&#39;vue&#39;, &#39;tsx&#39;],
        resolvers: [
          AntDesignVueResolver(&#123; resolveIcons: true &#125;),
        ],
        include: [/\.vue$/, /\.vue\?vue/, /\.tsx$/],
      &#125;),
    ],
    // é…ç½®è§£æé¡¹
    resolve: &#123;
      // è·¯å¾„åˆ«å
      alias: &#123;
        &#39;@/&#39;: resolve(__dirname, &#39;src&#39;) + &#39;/&#39;,
      &#125;,
    &#125;,
    // æ ·å¼å¤„ç†é…ç½®é¡¹
    css: &#123;
      // CSS module
      modules: &#123;
        generateScopedName: `_[name]_[local]_[hash:base64:6]_`,
      &#125;,
      // ä¼ é€’ç»™ç‰¹å®šcssæ ·å¼é¢„å¤„ç†å™¨çš„é…ç½®
      preprocessorOptions: &#123;
        less: &#123;
          javascriptEnabled: true,
        &#125;,
      &#125;,
    &#125;,
    // é…ç½®å¼€å‘æœåŠ¡å™¨
    server: &#123;
      open: true,
      proxy: initDevProxy(),
    &#125;,
    // è‡ªå®šä¹‰æ‰“åŒ…é¡¹é…ç½®
    build: &#123;
      // å¤§æ–‡ä»¶å‘Šè­¦é˜ˆå€¼(kb)
      chunkSizeWarningLimit: 400,
    &#125;,
  &#125;;
&#125;);
</code></pre>
<p>http-proxy.ts</p>
<pre><code class="javascript">import type &#123; ProxyOptions &#125; from &#39;vite&#39;;

/**
 * åˆå§‹åŒ–å¼€å‘æœåŠ¡å™¨ä»£ç†
 */
export const initDevProxy = (): Record&lt;string, string | ProxyOptions&gt; =&gt; &#123;
  return &#123;
    // ä¸´æ—¶ç¤ºä¾‹
    &#39;/api&#39;: &#123;
      target: &#39;&#39;,
      changeOrigin: true,
    &#125;,
  &#125;;
&#125;;
</code></pre>
<p>ä»¥ä¸Šçš„é…ç½®æ˜¯é¡¹ç›®é…ç½®çš„ä¸€éƒ¨åˆ†ï¼Œå…¶ä»–æ‰€éœ€è¦çš„é…ç½®æŒ‰ç…§è‡ªå·±çš„éœ€è¦å»å®˜ç½‘æŸ¥è¯¢å°±å¯ä»¥ï¼Œå®˜ç½‘åŸºäºæ²¡ä¸ªé…ç½®éƒ½æœ‰è¯¦ç»†è®²è§£ã€‚</p>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[Viteä¸­æ–‡å®˜ç½‘]: 	â€œ<a target="_blank" rel="noopener" href="https://cn.vitejs.dev/guide/">https://cn.vitejs.dev/guide/</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vite/" rel="tag">vite</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Vite-Vue3-Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/21/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%932/"
    >Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/21/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%932/" class="article-date">
  <time datetime="2022-11-21T06:40:38.000Z" itemprop="datePublished">2022-11-21</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/">å·¥ç¨‹æŠ€æœ¯</a> / <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%932/">Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Vite-Vue3-Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2"><a href="#Vite-Vue3-Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2" class="headerlink" title="Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2"></a>Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2</h1><p>æœ¬æ–‡ç« åªä¾›å‚è€ƒï¼Œå…·ä½“å®ç°å¯èƒ½ä¼šæœ‰å‡ºå…¥ï¼ˆä¼šå°½å¿«å®Œå–„ï¼‰</p>
<h3 id="ä¸€ã€viteæ‰“åŒ…"><a href="#ä¸€ã€viteæ‰“åŒ…" class="headerlink" title="ä¸€ã€viteæ‰“åŒ…"></a>ä¸€ã€viteæ‰“åŒ…</h3><p>ä¸Šä¸€ç¯‡æœ«å°¾çš„æ‰“åŒ…è¿˜æ˜¯æœ‰ç¼ºé™·çš„ï¼Œæ‰“åŒ…çš„ç»„ä»¶åº“åªèƒ½ç»™jsé¡¹ç›®ä½¿ç”¨,åœ¨tsé¡¹ç›®ä¸‹è¿è¡Œä¼šå‡ºç°ä¸€äº›é”™è¯¯ï¼Œè€Œä¸”ä½¿ç”¨çš„æ—¶å€™è¿˜ä¼šå¤±å»ä»£ç æç¤ºåŠŸèƒ½ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±å¤±å»äº†ç”¨tså¼€å‘ç»„ä»¶åº“çš„æ„ä¹‰äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ‰“åŒ…çš„åº“é‡ŒåŠ å…¥å£°æ˜æ–‡ä»¶(.d.ts)ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•å‘æ‰“åŒ…åçš„åº“é‡ŒåŠ å…¥å£°æ˜æ–‡ä»¶å‘¢ï¼Ÿ å…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦å¼•å…¥ vite-plugin-dts</p>
<pre><code class="css">pnpm i vite-plugin-dts -D -w
</code></pre>
<p>å¦‚æœpnpmå‘½ä»¤ä¸€ç›´errorï¼Œç”¨å…¶ä»–å‘½ä»¤ä¸‹è½½å®‰è£…ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼ˆä¸‹è½½åˆ°æ ¹ç›®å½•ï¼‰</p>
<p>ç„¶åä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„vite.config.tså¼•å…¥è¿™ä¸ªæ’ä»¶</p>
<pre><code class="javascript">//components/vite.config.ts
import &#123; defineConfig &#125; from &quot;vite&quot;;
import vue from &quot;@vitejs/plugin-vue&quot;
import dts from &#39;vite-plugin-dts&#39;

export default defineConfig(
    &#123;
        build: &#123;...&#125;,
        plugins: [
            vue(),
            dts(&#123;
                //æŒ‡å®šä½¿ç”¨çš„tsconfig.jsonä¸ºæˆ‘ä»¬æ•´ä¸ªé¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰,å¦‚æœä¸é…ç½®,ä½ ä¹Ÿå¯ä»¥åœ¨componentsä¸‹æ–°å»ºtsconfig.json
                tsConfigFilePath: &#39;../../tsconfig.json&#39;
            &#125;),
            //å› ä¸ºè¿™ä¸ªæ’ä»¶é»˜è®¤æ‰“åŒ…åˆ°esä¸‹ï¼Œæˆ‘ä»¬æƒ³è®©libç›®å½•ä¸‹ä¹Ÿç”Ÿæˆå£°æ˜æ–‡ä»¶éœ€è¦å†é…ç½®ä¸€ä¸ª
            dts(&#123;
                outputDir:&#39;lib&#39;,
                tsConfigFilePath: &#39;../../tsconfig.json&#39;
            &#125;)

        ]
    &#125;
)
</code></pre>
<p>æ‰§è¡Œpnpm run buildä½ å°±ä¼šå‘ç°ä½ çš„eså’Œlibä¸‹å°±æœ‰äº†å£°æ˜æ–‡ä»¶</p>
<h3 id="äºŒã€ç»„ä»¶æ ·å¼"><a href="#äºŒã€ç»„ä»¶æ ·å¼" class="headerlink" title="äºŒã€ç»„ä»¶æ ·å¼"></a>äºŒã€ç»„ä»¶æ ·å¼</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åšçš„æ˜¯å°†lessæ‰“åŒ…æˆcssç„¶åæ”¾åˆ°æ‰“åŒ…åå¯¹åº”çš„æ–‡ä»¶ç›®å½•ä¸‹,æˆ‘ä»¬åœ¨componentsä¸‹æ–°å»ºbuildæ–‡ä»¶å¤¹æ¥å­˜æ”¾æˆ‘ä»¬çš„ä¸€äº›æ‰“åŒ…å·¥å…·,ç„¶åæ–°å»ºbuildLess.ts,é¦–å…ˆæˆ‘ä»¬éœ€è¦å…ˆå®‰è£…ä¸€äº›å·¥å…·cpyå’Œfast-glob</p>
<pre><code class="css">pnpm i cpy fast-glob -D -w
</code></pre>
<p>å®ƒå¯ä»¥ç›´æ¥å¤åˆ¶æˆ‘ä»¬è§„å®šçš„æ–‡ä»¶å¹¶å°†æˆ‘ä»¬çš„æ–‡ä»¶copyåˆ°æŒ‡å®šç›®å½•,æ¯”å¦‚buildLess.ts:</p>
<pre><code class="javascript">//build/buildLess.ts
import cpy from &#39;cpy&#39;
import &#123; resolve &#125; from &#39;path&#39;

const sourceDir = resolve(__dirname, &#39;../src&#39;)
//libæ–‡ä»¶
const targetLib = resolve(__dirname, &#39;../lib&#39;)
//esæ–‡ä»¶
const targetEs = resolve(__dirname, &#39;../es&#39;)
console.log(sourceDir);
const buildLess = async () =&gt; &#123;
    await cpy(`$&#123;sourceDir&#125;/**/*.less`, targetLib)
    await cpy(`$&#123;sourceDir&#125;/**/*.less`, targetEs)
&#125;
buildLess()
</code></pre>
<p>ç„¶ååœ¨package.jsonä¸­æ–°å¢å‘½ä»¤</p>
<pre><code class="erlang">...
&quot;scripts&quot;: &#123;
    &quot;build&quot;: &quot;vite build&quot;,
    &quot;build:less&quot;: &quot;esno build/buildLess&quot;
  &#125;,
...
</code></pre>
<p>ç»ˆç«¯æ‰§è¡Œ pnpm run build:less ä½ å°±ä¼šå‘ç°libå’Œesæ–‡ä»¶å¯¹åº”ç›®å½•ä¸‹å°±å‡ºç°äº†lessæ–‡ä»¶.(å¦‚æœerrorï¼Œåˆ‡æ¢nodeç‰ˆæœ¬)</p>
<p>ä½†æ˜¯æˆ‘ä»¬æœ€ç»ˆè¦çš„å¹¶ä¸æ˜¯lessæ–‡ä»¶è€Œæ˜¯cssæ–‡ä»¶,æ‰€ä»¥æˆ‘ä»¬è¦å°†lessæ‰“åŒ…æˆcss,æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨çš„lessæ¨¡å—.åœ¨tsä¸­å¼•å…¥lesså› ä¸ºå®ƒæœ¬èº«æ²¡æœ‰å£°æ˜æ–‡ä»¶æ‰€ä»¥ä¼šå‡ºç°ç±»å‹é”™è¯¯,æ‰€ä»¥æˆ‘ä»¬è¦å…ˆå®‰è£…å®ƒçš„ @types&#x2F;less</p>
<pre><code class="css">pnpm i --save-dev @types/less -D -w
</code></pre>
<p>buildLess.tså¦‚ä¸‹(è¯¦ç»†æ³¨é‡Šéƒ½åœ¨ä»£ç ä¸­)</p>
<pre><code class="javascript">import cpy from &#39;cpy&#39;
import &#123; resolve &#125; from &#39;path&#39;
import &#123; promises as fs &#125; from &quot;fs&quot;
import less from &quot;less&quot;
import glob from &quot;fast-glob&quot;
const sourceDir = resolve(__dirname, &#39;../src&#39;)
//libæ–‡ä»¶ç›®å½•
const targetLib = resolve(__dirname, &#39;../lib&#39;)
//esæ–‡ä»¶ç›®å½•
const targetEs = resolve(__dirname, &#39;../es&#39;)



const buildLess = async () =&gt; &#123;
    //ç›´æ¥å°†lessæ–‡ä»¶å¤åˆ¶åˆ°æ‰“åŒ…åç›®å½•
    await cpy(`$&#123;sourceDir&#125;/**/*.less`, targetLib)
    await cpy(`$&#123;sourceDir&#125;/**/*.less`, targetEs)

    //è·å–æ‰“åŒ…å.lessæ–‡ä»¶ç›®å½•(libå’Œesä¸€æ ·)
    const lessFils = await glob(&quot;**/*.less&quot;, &#123; cwd: targetLib, onlyFiles: true &#125;)

    //éå†å«æœ‰lessçš„ç›®å½•
    for (let path in lessFils) &#123;
        const lessPathLib = `$&#123;targetLib&#125;/$&#123;lessFils[path]&#125;`
        const lessPathEs = `$&#123;targetEs&#125;/$&#123;lessFils[path]&#125;`

        //è·å–lessæ–‡ä»¶å­—ç¬¦ä¸²
        const lessCode = await fs.readFile(lessPathLib, &#39;utf-8&#39;)
        //å°†lessè§£ææˆcss
        const code = await less.render(lessCode)

        //æ‹¿åˆ°.cssåç¼€path
        const cssPathLib = lessPathLib.replace(&#39;.less&#39;, &#39;.css&#39;)
        const cssPathEs = lessPathEs.replace(&#39;.less&#39;, &#39;.css&#39;)

        //å°†csså†™å…¥å¯¹åº”ç›®å½•
        await fs.writeFile(cssPathLib, code.css)
        await fs.writeFile(cssPathEs, code.css)
    &#125;



&#125;
buildLess()
</code></pre>
<p>æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ä¹‹åä½ ä¼šå‘ç°å¯¹åº”æ–‡ä»¶å¤¹ä¸‹å¤šäº†.cssæ–‡ä»¶</p>
<p><img src="/2022/11/21/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%932/image-20221121092003205.png"></p>
<p>ç°åœ¨æˆ‘å·²ç»å°†cssæ–‡ä»¶æ”¾å…¥å¯¹åº”çš„ç›®å½•ä¸‹äº†,ä½†æ˜¯æˆ‘ä»¬çš„ç›¸å…³ç»„ä»¶å¹¶æ²¡æœ‰å¼•å…¥è¿™ä¸ªcssæ–‡ä»¶;æ‰€ä»¥æˆ‘ä»¬éœ€è¦çš„æ˜¯æ¯ä¸ªæ‰“åŒ…åç»„ä»¶çš„index.jsä¸­å‡ºç°å¦‚:</p>
<pre><code class="cpp">import &quot;xxx/xxx.css&quot;
</code></pre>
<p>ä¹‹ç±»çš„ä»£ç æˆ‘ä»¬çš„cssæ‰ä¼šç”Ÿæ•ˆ;æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹vite.config.tsè¿›è¡Œç›¸å…³é…ç½®</p>
<p>é¦–å…ˆæˆ‘ä»¬å…ˆå°†.lessæ–‡ä»¶å¿½ç•¥external: [â€˜vueâ€™, &#x2F;.less&#x2F;],è¿™æ—¶å€™æ‰“åŒ…åçš„æ–‡ä»¶ä¸­å¦‚button&#x2F;index.jså°±ä¼šå‡ºç°</p>
<pre><code class="cpp">import &quot;./style/index.less&quot;;
</code></pre>
<p>ç„¶åæˆ‘ä»¬å†å°†æ‰“åŒ…åä»£ç çš„.lessæ¢æˆ.csså°±å¤§åŠŸå‘Šæˆäº†</p>
<pre><code class="typescript">...
plugins: [
            ...

            &#123;
                name: &#39;style&#39;,
                generateBundle(config, bundle) &#123;
                    //è¿™é‡Œå¯ä»¥è·å–æ‰“åŒ…åçš„æ–‡ä»¶ç›®å½•ä»¥åŠä»£ç code
                    const keys = Object.keys(bundle)

                    for (const key of keys) &#123;
                        const bundler: any = bundle[key as any]
                        //rollupå†…ç½®æ–¹æ³•,å°†æ‰€æœ‰è¾“å‡ºæ–‡ä»¶codeä¸­çš„.lessæ¢æˆ.css,å› ä¸ºæˆ‘ä»¬å½“æ—¶æ²¡æœ‰æ‰“åŒ…lessæ–‡ä»¶

                        this.emitFile(&#123;
                            type: &#39;asset&#39;,
                            fileName: key,//æ–‡ä»¶ååä¸å˜
                            source: bundler.code.replace(/\.less/g, &#39;.css&#39;)
                        &#125;)
                    &#125;
                &#125;
            &#125;
        ...
        ]
...
</code></pre>
<p>æˆ‘ä»¬æœ€ç»ˆçš„vite.config.tså¦‚ä¸‹</p>
<pre><code class="typescript">import &#123; defineConfig &#125; from &quot;vite&quot;;
import vue from &quot;@vitejs/plugin-vue&quot;
import dts from &#39;vite-plugin-dts&#39;

export default defineConfig(
    &#123;
        build: &#123;
            target: &#39;modules&#39;,
            //æ‰“åŒ…æ–‡ä»¶ç›®å½•
            outDir: &quot;es&quot;,
            //å‹ç¼©
            minify: false,
            //cssåˆ†ç¦»
            //cssCodeSplit: true,
            rollupOptions: &#123;
                //å¿½ç•¥æ‰“åŒ…vueå’Œ.lessæ–‡ä»¶
                external: [&#39;vue&#39;, /\.less/],
                input: [&#39;src/index.ts&#39;],
                output: [
                    &#123;
                        format: &#39;es&#39;,
                        //ä¸ç”¨æ‰“åŒ…æˆ.es.js,è¿™é‡Œæˆ‘ä»¬æƒ³æŠŠå®ƒæ‰“åŒ…æˆ.js
                        entryFileNames: &#39;[name].js&#39;,
                        //è®©æ‰“åŒ…ç›®å½•å’Œæˆ‘ä»¬ç›®å½•å¯¹åº”
                        preserveModules: true,
                        //é…ç½®æ‰“åŒ…æ ¹ç›®å½•
                        dir: &#39;es&#39;,
                        preserveModulesRoot: &#39;src&#39;
                    &#125;,
                    &#123;
                        format: &#39;cjs&#39;,
                        //ä¸ç”¨æ‰“åŒ…æˆ.mjs
                        entryFileNames: &#39;[name].js&#39;,
                        //è®©æ‰“åŒ…ç›®å½•å’Œæˆ‘ä»¬ç›®å½•å¯¹åº”
                        preserveModules: true,
                        //é…ç½®æ‰“åŒ…æ ¹ç›®å½•
                        dir: &#39;lib&#39;,
                        preserveModulesRoot: &#39;src&#39;
                    &#125;
                ]
            &#125;,
            lib: &#123;
                entry: &#39;./index.ts&#39;,
                formats: [&#39;es&#39;, &#39;cjs&#39;]
            &#125;
        &#125;,




        plugins: [
            vue(),
            dts(&#123;
                //æŒ‡å®šä½¿ç”¨çš„tsconfig.jsonä¸ºæˆ‘ä»¬æ•´ä¸ªé¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰,å¦‚æœä¸é…ç½®,ä½ ä¹Ÿå¯ä»¥åœ¨componentsä¸‹æ–°å»ºtsconfig.json
                tsConfigFilePath: &#39;../../tsconfig.json&#39;
            &#125;),
            //å› ä¸ºè¿™ä¸ªæ’ä»¶é»˜è®¤æ‰“åŒ…åˆ°esä¸‹ï¼Œæˆ‘ä»¬æƒ³è®©libç›®å½•ä¸‹ä¹Ÿç”Ÿæˆå£°æ˜æ–‡ä»¶éœ€è¦å†é…ç½®ä¸€ä¸ª
            dts(&#123;
                outputDir: &#39;lib&#39;,
                tsConfigFilePath: &#39;../../tsconfig.json&#39;
            &#125;),

            &#123;
                name: &#39;style&#39;,
                generateBundle(config, bundle) &#123;
                    //è¿™é‡Œå¯ä»¥è·å–æ‰“åŒ…åçš„æ–‡ä»¶ç›®å½•ä»¥åŠä»£ç code
                    const keys = Object.keys(bundle)

                    for (const key of keys) &#123;
                        const bundler: any = bundle[key as any]
                        //rollupå†…ç½®æ–¹æ³•,å°†æ‰€æœ‰è¾“å‡ºæ–‡ä»¶codeä¸­çš„.lessæ¢æˆ.css,å› ä¸ºæˆ‘ä»¬å½“æ—¶æ²¡æœ‰æ‰“åŒ…lessæ–‡ä»¶

                        this.emitFile(&#123;
                            type: &#39;asset&#39;,
                            fileName: key,//æ–‡ä»¶ååä¸å˜
                            source: bundler.code.replace(/\.less/g, &#39;.css&#39;)
                        &#125;)
                    &#125;
                &#125;
            &#125;

        ]
    &#125;
)
</code></pre>
<p>æœ€åæˆ‘ä»¬å°†æ‰“åŒ…lessä¸æ‰“åŒ…ç»„ä»¶åˆæˆä¸€ä¸ªå‘½ä»¤(package.json):</p>
<pre><code class="erlang">...
&quot;scripts&quot;: &#123;
     &quot;build&quot;:&quot;vite build&quot;,
    &quot;build:less&quot;: &quot;esno build/buildLess&quot;
  &#125;,
...
</code></pre>
<p>åç»­ç›´æ¥æ‰§è¡Œpnpm run build å³å¯å®Œæˆæ‰€æœ‰æ‰“åŒ…å•¦</p>
<h3 id="ä¸‰ã€å¼•ç”¨uiåŒ…"><a href="#ä¸‰ã€å¼•ç”¨uiåŒ…" class="headerlink" title="ä¸‰ã€å¼•ç”¨uiåŒ…"></a>ä¸‰ã€å¼•ç”¨uiåŒ…</h3><p>åšäº†é‚£ä¹ˆå¤šç»ˆäºåˆ°å‘å¸ƒçš„é˜¶æ®µäº†ï¼›å…¶å®npmå‘åŒ…æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œå°±æ‹¿æˆ‘ä»¬çš„ç»„ä»¶alanmfä¸¾ä¾‹å§</p>
<p>å‘å¸ƒä¹‹å‰è®°å¾—åˆ°<a target="_blank" rel="noopener" href="https://www.npmjs.com/">npm</a>å®˜ç½‘æ³¨å†Œä¸ªè´¦æˆ·,å¦‚æœä½ è¦å‘å¸ƒ@xx&#x2F;xxè¿™ç§åŒ…çš„è¯éœ€è¦åœ¨npmæ–°å»ºä¸ªç»„ç»‡ç»„ç»‡ç»„ç»‡åå°±æ˜¯@åé¢çš„ï¼Œæ¯”å¦‚æˆ‘å»ºçš„ç»„ç»‡å°±æ˜¯kitty-ui,æ³¨å†Œå®Œä¹‹åä½ å°±å¯ä»¥å‘å¸ƒäº†</p>
<p>é¦–å…ˆè¦å°†æˆ‘ä»¬ä»£ç æäº¤åˆ°gitä»“åº“ï¼Œä¸ç„¶pnpmå‘å¸ƒæ— æ³•é€šè¿‡ï¼Œåé¢æ¯æ¬¡å‘ç‰ˆè®°å¾—åœ¨å¯¹åº”åŒ…ä¸‹æ‰§è¡Œ <strong>pnpm version patch</strong>ä½ å°±ä¼šå‘ç°è¿™ä¸ªåŒ…çš„ç‰ˆæœ¬å·patch(ç‰ˆæœ¬å·ç¬¬ä¸‰ä¸ªæ•°) +1 äº†</p>
<p>å¦‚æœä½ å‘å¸ƒçš„æ˜¯å…¬å…±åŒ…çš„è¯ï¼Œåœ¨å¯¹åº”åŒ…ä¸‹æ‰§è¡Œ</p>
<pre><code class="cpp">pnpm publish --access public
</code></pre>
<p>è¾“å…¥ä½ çš„è´¦æˆ·å’Œå¯†ç ï¼ˆè®°å¾—è¾“å…¥å¯†ç çš„æ—¶å€™æ˜¯ä¸æ˜¾ç¤ºçš„ï¼Œä¸è¦ä»¥ä¸ºå¡äº†ï¼‰æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¯å‘å¸ƒæˆåŠŸäº†</p>
<p><strong>æ³¨æ„</strong></p>
<p>å‘å¸ƒçš„æ—¶å€™è¦å°†npmçš„æºåˆ‡æ¢åˆ°npmçš„å®˜æ–¹åœ°å€(<a target="_blank" rel="noopener" href="https://registry.npmjs.org/">https://registry.npmjs.org/</a>); å¦‚æœä½ ä½¿ç”¨äº†å…¶å®ƒé•œåƒæºçš„è¯</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/" rel="tag">ç§æœ‰ç»„ä»¶åº“</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Vite-Vue3-Tsæ­å»ºç§æœ‰ç»„ä»¶åº“"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/"
    >Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/" class="article-date">
  <time datetime="2022-11-20T09:04:55.000Z" itemprop="datePublished">2022-11-20</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/">å·¥ç¨‹æŠ€æœ¯</a> / <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/">Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Vite-Vue3-Tsæ­å»ºç§æœ‰ç»„ä»¶åº“"><a href="#Vite-Vue3-Tsæ­å»ºç§æœ‰ç»„ä»¶åº“" class="headerlink" title="Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“"></a>Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“</h1><p>ç›®å‰å‰ç«¯æŠ€æœ¯çš„æŒç»­å‘å±•ï¼Œç¤¾åŒºç”Ÿæ€å‡ºç°äº†ä¸€æ‰¹æ¯”è¾ƒé€‚ç”¨çš„ç»„ä»¶åº“ï¼Œä¾‹å¦‚ï¼šElementUI,Vantï¼ŒAntDesignç­‰ï¼Œä½†è¿™äº›ç»„ä»¶åº“çš„ç»„ä»¶ä¸ä¸€å®šèƒ½æ»¡è¶³æˆ‘ä»¬ä¸€äº›é¡¹ç›®çš„ç‰¹å®šä¸šåŠ¡éœ€æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å›¢é˜Ÿå°±åº”è¯¥å»ºç«‹èµ·æˆ‘ä»¬è‡ªå·±çš„ç»„ä»¶åº“ï¼Œæ–¹ä¾¿äºæˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡å¼€å‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿™ç¯‡æ–‡ç« å°±æ¥äº†è§£ä¸€ä¸‹æˆ‘ä»¬å¼€å‘ç»„ä»¶åº“çš„å¤§ä½“æŠ€æœ¯æ¶æ„ä½“ç³»ã€‚</p>
<p>æ­å»ºç»„ä»¶åº“çš„æŠ€æœ¯è¦ç‚¹ï¼š</p>
<ul>
<li>å¦‚ä½•ä½¿ç”¨pnpmæ­å»ºå‡ºä¸€ä¸ªmenorepoç¯å¢ƒ</li>
<li>å¦‚ä½•ä½¿ç”¨viteæ­å»ºä¸€ä¸ªåŸºæœ¬çš„Vue3è„šæ‰‹æ¶é¡¹ç›®</li>
<li>å¦‚ä½•å¼€å‘è°ƒè¯•ä¸€ä¸ªè‡ªå·±çš„UIç»„ä»¶åº“</li>
<li>å¦‚ä½•ä½¿ç”¨viteæ‰“åŒ…å¹¶å‘å¸ƒè‡ªå·±çš„UIç»„ä»¶åº“</li>
</ul>
<h3 id="ä¸€ã€menorepoç¯å¢ƒçš„æ­å»º"><a href="#ä¸€ã€menorepoç¯å¢ƒçš„æ­å»º" class="headerlink" title="ä¸€ã€menorepoç¯å¢ƒçš„æ­å»º"></a>ä¸€ã€menorepoç¯å¢ƒçš„æ­å»º</h3><p>é¦–å…ˆæˆ‘ä»¬è¦äº†è§£ä»€ä¹ˆæ˜¯menorepoåŠå®ƒæ˜¯å¦‚ä½•æ­å»º (å•ä»“åº“ å¤šé¡¹ç›®)</p>
<p>å°±æ˜¯æŒ‡åœ¨ä¸€ä¸ªå¤§çš„é¡¹ç›®ä»“åº“ä¸­ï¼Œç®¡ç†å¤šä¸ªæ¨¡å—&#x2F;åŒ…ï¼ˆpackageï¼‰ï¼Œè¿™ç§ç±»å‹çš„é¡¹ç›®å¤§éƒ½åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ªpackagesæ–‡ä»¶å¤¹ï¼Œåˆ†å¤šä¸ªé¡¹ç›®ç®¡ç†ã€‚å¤§æ¦‚ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="ini">-- packages
  -- pkg1
    --package.json
  -- pkg2
    --package.json
--package.json
</code></pre>
<p>ç›®å‰å¾ˆå¤šæˆ‘ä»¬ç†ŸçŸ¥çš„é¡¹ç›®éƒ½æ˜¯é‡‡ç”¨è¿™ç§æ¨¡å¼ï¼Œå¦‚Vantï¼ŒElementUIï¼ŒVue3ç­‰ã€‚æ‰“é€ ä¸€ä¸ªmenorepoç¯å¢ƒçš„å·¥å…·æœ‰å¾ˆå¤šï¼Œå¦‚ï¼šlernaã€pnpmã€yarnç­‰ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨pnpmæ¥å¼€å‘æˆ‘ä»¬çš„UIç»„ä»¶åº“</p>
<h4 id="1-ä½¿ç”¨pnpm"><a href="#1-ä½¿ç”¨pnpm" class="headerlink" title="1.ä½¿ç”¨pnpm"></a>1.ä½¿ç”¨pnpm</h4><pre><code class="ini">npm install pnpm -g //å®‰è£…pnpm
pnpm init //åˆå§‹åŒ–package.json
</code></pre>
<p>æ–°å»ºé…ç½®æ–‡ä»¶ .npmrc</p>
<pre><code class="ini">shamefully-hoist = true
</code></pre>
<p>è¿™é‡Œç®€å•è¯´ä¸‹ä¸ºä»€ä¹ˆè¦é…ç½®shamefully-hoistã€‚</p>
<p>å¦‚æœæŸäº›å·¥å…·ä»…åœ¨æ ¹ç›®å½•çš„node_modulesæ—¶æ‰æœ‰æ•ˆï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºtrueæ¥æå‡é‚£äº›ä¸åœ¨æ ¹ç›®å½•çš„node_modulesï¼Œå°±æ˜¯å°†ä½ å®‰è£…çš„ä¾èµ–åŒ…çš„ä¾èµ–åŒ…çš„ä¾èµ–åŒ…çš„â€¦éƒ½æ”¾åˆ°åŒä¸€çº§åˆ«ï¼ˆæ‰å¹³åŒ–ï¼‰ã€‚è¯´ç™½äº†å°±æ˜¯ä¸è®¾ç½®ä¸ºtrueæœ‰äº›åŒ…å°±æœ‰å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚</p>
<p>å®‰è£…å¯¹åº”ä¾èµ–</p>
<pre><code class="ini">pnpm i vue@next typescript less -D -w //å¼€å‘ç¯å¢ƒä¸­çš„ä¾èµ–ä¸€èˆ¬å…¨éƒ¨å®‰è£…åœ¨æ•´ä¸ªé¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ–¹ä¾¿ä¸‹é¢æˆ‘ä»¬æ¯ä¸ªåŒ…éƒ½å¯ä»¥å¼•ç”¨,æ‰€ä»¥åœ¨å®‰è£…çš„æ—¶å€™éœ€è¦åŠ ä¸ª -w
</code></pre>
<p>å¦‚æœæˆ‘ä»¬æ˜¯åœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œå‘½ä»¤ï¼Œé‚£ä¹ˆå°±ä¸ç”¨åŠ  -w äº†ï¼Œè¦ä¸ç„¶ä¼šæç¤º</p>
<pre><code class="error">--workspace-root may only be used inside a workspace
</code></pre>
<p>é…ç½®tsconfit.json</p>
<pre><code class="ini">npx tsc --init //åˆå§‹åŒ–
</code></pre>
<pre><code class="javascript">//tsconfit.jsoné…ç½®
&#123;
  &quot;compilerOptions&quot;: &#123;
    &quot;baseUrl&quot;: &quot;.&quot;,
    &quot;jsx&quot;: &quot;preserve&quot;,
    &quot;strict&quot;: true,
    &quot;target&quot;: &quot;ES2015&quot;,
    &quot;module&quot;: &quot;ESNext&quot;,
    &quot;skipLibCheck&quot;: true,
    &quot;esModuleInterop&quot;: true,
    &quot;moduleResolution&quot;: &quot;Node&quot;,
    &quot;lib&quot;: [&quot;esnext&quot;, &quot;dom&quot;]
  &#125;
&#125;
</code></pre>
<h4 id="2-monorepoçš„å®ç°"><a href="#2-monorepoçš„å®ç°" class="headerlink" title="2.monorepoçš„å®ç°"></a>2.monorepoçš„å®ç°</h4><p>å„ä¸ªé¡¹ç›®ä¹‹é—´èƒ½å¤Ÿäº’ç›¸å¼•ç”¨æˆ‘ä»¬è¦æ–°å»ºä¸€ä¸ªpnpm-workspace.yamlæ–‡ä»¶å°†æˆ‘ä»¬çš„åŒ…å…³è”èµ·æ¥</p>
<pre><code class="ini">packages:
    - &#39;packages/**&#39;
    - &#39;examples&#39;
</code></pre>
<p>è¿™æ ·å°±èƒ½å°†æˆ‘ä»¬é¡¹ç›®ä¸‹çš„packagesç›®å½•å’Œexamplesç›®å½•å…³è”èµ·æ¥äº†ï¼Œå½“ç„¶å¦‚æœä½ æƒ³å…³è”æ›´å¤šç›®å½•ä½ åªéœ€è¦å¾€é‡Œé¢æ·»åŠ å³å¯ã€‚æ ¹æ®ä¸Šé¢çš„ç›®å½•ç»“æ„å¾ˆæ˜¾ç„¶ä½ åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºpackageså’Œexamplesæ–‡ä»¶å¤¹ï¼Œpackagesæ–‡ä»¶å¤¹å­˜æ”¾æˆ‘ä»¬å¼€å‘çš„åŒ…ï¼Œexamplesç”¨æ¥è°ƒè¯•æˆ‘ä»¬çš„ç»„ä»¶ã€‚</p>
<p>examplesæ–‡ä»¶å¤¹å°±æ˜¯æ¥ä¸‹æ¥æˆ‘ä»¬è¦ä½¿ç”¨viteæ­å»ºä¸€ä¸ªåŸºæœ¬çš„Vue3è„šæ‰‹æ¶é¡¹ç›®çš„åœ°æ–¹ã€‚</p>
<h4 id="3-æ‰‹åŠ¨æ­å»ºä¸€ä¸ªåŸºäºviteçš„vue3é¡¹ç›®"><a href="#3-æ‰‹åŠ¨æ­å»ºä¸€ä¸ªåŸºäºviteçš„vue3é¡¹ç›®" class="headerlink" title="3.æ‰‹åŠ¨æ­å»ºä¸€ä¸ªåŸºäºviteçš„vue3é¡¹ç›®"></a>3.æ‰‹åŠ¨æ­å»ºä¸€ä¸ªåŸºäºviteçš„vue3é¡¹ç›®</h4><p>è¿›å…¥examplesæ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œ</p>
<pre><code class="ini">pnpm init //åˆå§‹åŒ–ä»“åº“
pnpm install vite @vitejs/plugin-vue -D -w //å®‰è£…viteå’Œ@vitejs/plugin-vue
</code></pre>
<p>é…ç½®vite.config.ts</p>
<p>æ–°å»ºvite.config.tsæ–‡ä»¶</p>
<pre><code class="ini">import &#123; defineConfig &#125; from &#39;vite&#39;
import vue from &#39;@vitejs/plugin-vue&#39;

export default defineConfig(&#123;
    plugins:[vue()]
&#125;)
</code></pre>
<p>æ–°å»ºhtmlæ–‡ä»¶</p>
<p>@vitejs&#x2F;plugin-vue ä¼šé»˜è®¤åŠ è½½examplesä¸‹çš„index.html</p>
<p>æ–°å»ºindex.html</p>
<pre><code class="xml">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;
    &lt;script src=&quot;main.ts&quot; type=&quot;module&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>æ³¨æ„ï¼š<br>vite æ˜¯åŸºäºesmoduleçš„ æ‰€ä»¥type&#x3D;â€moduleâ€</p>
<p>æ–°å»ºapp.vueæ¨¡æ¿</p>
<pre><code class="xml">&lt;template&gt;
    &lt;div&gt;
        å¯åŠ¨æµ‹è¯•
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>æ–°å»ºmain.ts</p>
<pre><code class="javascript">import &#123;createApp&#125; from &#39;vue&#39;
import App from &#39;./app.vue&#39;

const app = createApp(App)

app.mount(&#39;#app&#39;)
</code></pre>
<p>æ­¤æ—¶ä¼šå‘ç°ç¼–è¯‘å™¨ä¼šæç¤ºä¸ªé”™è¯¯ï¼šæ‰¾ä¸åˆ°æ¨¡å—â€œ.&#x2F;app.vueâ€æˆ–å…¶ç›¸åº”çš„ç±»å‹å£°æ˜</p>
<p>å› ä¸ºç›´æ¥å¼•å…¥.vueæ–‡ä»¶ TSä¼šæ‰¾ä¸åˆ°å¯¹åº”çš„ç±»å‹å£°æ˜ï¼›æ‰€ä»¥éœ€è¦æ–°å»ºtypingsï¼ˆå‘½åæ²¡æœ‰æ˜ç¡®è§„å®šï¼ŒTSä¼šè‡ªåŠ¨å¯»æ‰¾.d.tsæ–‡ä»¶ï¼‰æ–‡ä»¶å¤¹æ¥ä¸“é—¨æ”¾è¿™äº›å£°æ˜æ–‡ä»¶ã€‚</p>
<p>typings&#x2F;vue-shim.d.ts</p>
<p>TypeScriptTSé»˜è®¤åªè®¤ES æ¨¡å—ã€‚å¦‚æœä½ è¦å¯¼å…¥.vueæ–‡ä»¶å°±è¦declare moduleæŠŠä»–ä»¬å£°æ˜å‡ºæ¥ã€‚</p>
<pre><code class="typescript">declare module &#39;*.vue&#39; &#123;
    import type &#123; DefineComponent &#125; from &quot;vue&quot;;
    const component:DefineComponent&lt;&#123;&#125;,&#123;&#125;,any&gt;
&#125;
</code></pre>
<p>é…ç½®è„šæœ¬å¯åŠ¨é¡¹ç›®</p>
<p>æœ€ååœ¨package.jsonæ–‡ä»¶ä¸­é…ç½®scriptsè„šæœ¬</p>
<pre><code class="erlang">...
&quot;scripts&quot;: &#123;
    &quot;dev&quot;: &quot;vite&quot;
  &#125;,
...
</code></pre>
<p>ç„¶åç»ˆç«¯è¾“å…¥æˆ‘ä»¬ç†Ÿæ‚‰çš„å‘½ä»¤ï¼špnpm run dev</p>
<p><img src="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/image-20221120114028908.png"></p>
<p>å¦‚æœå‡ºç°äº†cannot find module â€˜node:pathâ€™è¿™æ ·çš„é”™è¯¯æç¤ºï¼Œé‚£å¯èƒ½æ˜¯nodeç‰ˆæœ¬ä¸å…¼å®¹ï¼Œå‡çº§ä¸€ä¸‹nodeç‰ˆæœ¬å°±å¯ä»¥äº†</p>
<p>æˆ‘çš„node ç‰ˆæœ¬æ˜¯ v14.17.0 çš„ç‰ˆæœ¬ï¼Œå‡ºç°äº†ä¸å…¼å®¹çš„é—®é¢˜ï¼Œäºæ˜¯å‡çº§åˆ°äº†ç¨³å®šç‰ˆ v16.16.0 ã€‚</p>
<p>å†è¿è¡Œviteå°±æ²¡é—®é¢˜äº†</p>
<p><img src="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/image-20221120114403681.png"></p>
<h3 id="äºŒã€æœ¬åœ°è°ƒè¯•"><a href="#äºŒã€æœ¬åœ°è°ƒè¯•" class="headerlink" title="äºŒã€æœ¬åœ°è°ƒè¯•"></a>äºŒã€æœ¬åœ°è°ƒè¯•</h3><h4 id="1-æ–°å»ºåŒ…æ–‡ä»¶"><a href="#1-æ–°å»ºåŒ…æ–‡ä»¶" class="headerlink" title="1.æ–°å»ºåŒ…æ–‡ä»¶"></a>1.æ–°å»ºåŒ…æ–‡ä»¶</h4><p>å¾€packagesæ–‡ä»¶å¤¹å†²å¡«å……å†…å®¹</p>
<p>ä¸€èˆ¬packagesè¦æœ‰utilsåŒ…æ¥å­˜æ”¾æˆ‘ä»¬å…¬å…±æ–¹æ³•ï¼Œå·¥å…·å‡½æ•°ç­‰</p>
<p>æ—¢ç„¶å®ƒæ˜¯ä¸€ä¸ªåŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬æ–°å»ºutilsç›®å½•åå°±éœ€è¦åˆå§‹åŒ–å®ƒï¼Œè®©å®ƒå˜æˆä¸€ä¸ªåŒ…ï¼›ç»ˆç«¯è¿›å…¥utilsæ–‡ä»¶å¤¹æ‰§è¡Œï¼špnpm init ç„¶åä¼šç”Ÿæˆä¸€ä¸ªpackage.jsonæ–‡ä»¶ï¼›è¿™é‡Œéœ€è¦æ”¹ä¸€ä¸‹åŒ…åï¼Œæˆ‘è¿™é‡Œå°†nameæ”¹æˆ@alanmf&#x2F;utilsè¡¨ç¤ºè¿™ä¸ªutilsåŒ…æ˜¯å±äºalanmfè¿™ä¸ªç»„ç»‡ä¸‹çš„ã€‚æ‰€ä»¥è®°ä½å‘å¸ƒä¹‹å‰è¦ç™»å½•npmæ–°å»ºä¸€ä¸ªç»„ç»‡ï¼›ä¾‹å¦‚alanmf</p>
<p><img src="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/image-20221120152720676.png"></p>
<p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨tså†™çš„ï¼Œæ‰€ä»¥éœ€è¦å°†å…¥å£æ–‡ä»¶index.jsæ”¹ä¸ºindex.tsï¼Œå¹¶æ–°å»ºindex.tsæ–‡ä»¶:(å…ˆå¯¼å‡ºä¸€ä¸ªç®€å•çš„åŠ æ³•å‡½æ•°)</p>
<p>componentsæ˜¯æˆ‘ä»¬ç”¨æ¥å­˜æ”¾å„ç§UIç»„ä»¶çš„åŒ…</p>
<p>æ–°å»ºcomponentsæ–‡ä»¶å¤¹å¹¶æ‰§è¡Œ pnpm init ç”Ÿæˆpackage.json</p>
<ul>
<li>ç»„ä»¶åº“åŒ… è¿™é‡Œå‘½åä¸ºalanmf</li>
</ul>
<pre><code class="ini">&#123;
  &quot;name&quot;: &quot;@alanmf/utils&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.ts&quot;,
  &quot;scripts&quot;: &#123;
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  &#125;,
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;
&#125;
</code></pre>
<p>æ–°å»ºindex.tså…¥å£æ–‡ä»¶å¹¶å¼•å…¥utilsåŒ…</p>
<pre><code class="tsx">//@kitty-ui/utils
import &#123;testfun&#125; from &#39;@alanmf/utils&#39;

const result = testfun (1,1)

console.log(result)
</code></pre>
<p>ç”±äºç»„ä»¶åº“æ˜¯åŸºäºtsçš„ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…esnoæ¥æ‰§è¡Œtsæ–‡ä»¶ä¾¿äºæµ‹è¯•ç»„ä»¶ä¹‹é—´çš„å¼•å…¥æƒ…å†µ</p>
<p>æ§åˆ¶å°è¾“å…¥esno xxx.tså³å¯æ‰§è¡Œtsæ–‡ä»¶</p>
<pre><code class="ini">npm i esno -g //å®‰è£…esno
eson index.ts //æ‰§è¡Œindex.tsæ–‡ä»¶
</code></pre>
<p><img src="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/image-20221120151321307.png"></p>
<h4 id="2-åŒ…ä¹‹é—´æœ¬åœ°è°ƒè¯•"><a href="#2-åŒ…ä¹‹é—´æœ¬åœ°è°ƒè¯•" class="headerlink" title="2.åŒ…ä¹‹é—´æœ¬åœ°è°ƒè¯•"></a>2.åŒ…ä¹‹é—´æœ¬åœ°è°ƒè¯•</h4><p>è¿›å…¥componentsæ–‡ä»¶å¤¹æ‰§è¡Œ</p>
<pre><code class="bash">pnpm install @alanmf/utils
</code></pre>
<p>ä½ ä¼šå‘ç°pnpmä¼šè‡ªåŠ¨åˆ›å»ºä¸ªè½¯é“¾æ¥ç›´æ¥æŒ‡å‘æˆ‘ä»¬çš„utilsåŒ…ï¼›æ­¤æ—¶componentsä¸‹çš„packagesï¼š</p>
<pre><code class="swift">&#123;
  &quot;name&quot;: &quot;alanmf&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.ts&quot;,
  &quot;scripts&quot;: &#123;
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  &#125;,
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;dependencies&quot;: &#123;
    &quot;@alanmf/utils&quot;: &quot;workspace:^1.0.0&quot;
  &#125;
&#125;
</code></pre>
<p>ä½ ä¼šå‘ç°å®ƒçš„ä¾èµ–@alanmf&#x2F;utilså¯¹åº”çš„ç‰ˆæœ¬ä¸ºï¼šworkspace:^1.0.0ï¼›å› ä¸ºpnpmæ˜¯ç”±workspaceç®¡ç†çš„ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªå‰ç¼€workspaceå¯ä»¥æŒ‡å‘utilsä¸‹çš„å·¥ä½œç©ºé—´ä»è€Œæ–¹ä¾¿æœ¬åœ°è°ƒè¯•å„ä¸ªåŒ…ç›´æ¥çš„å…³è”å¼•ç”¨ã€‚</p>
<p>åˆ°è¿™é‡ŒåŸºæœ¬å¼€å‘æ–¹æ³•æˆ‘ä»¬å·²ç»çŸ¥é“å•¦ï¼›æ¥ä¸‹æ¥å°±è¦è¿›å…¥æ­£é¢˜äº†ï¼Œå¼€å‘ä¸€ä¸ªbuttonç»„ä»¶</p>
<h3 id="ä¸‰ã€å¼€å‘ä¸€ä¸ªbuttonç»„ä»¶"><a href="#ä¸‰ã€å¼€å‘ä¸€ä¸ªbuttonç»„ä»¶" class="headerlink" title="ä¸‰ã€å¼€å‘ä¸€ä¸ªbuttonç»„ä»¶"></a>ä¸‰ã€å¼€å‘ä¸€ä¸ªbuttonç»„ä»¶</h3><h4 id="1-åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç»„ä»¶"><a href="#1-åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç»„ä»¶" class="headerlink" title="1.åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç»„ä»¶"></a>1.åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç»„ä»¶</h4><p>åœ¨componentsæ–‡ä»¶å¤¹ä¸‹æ–°å»ºsrc,åŒæ—¶åœ¨srcä¸‹æ–°å»ºbuttonç»„ä»¶ç›®å½•å’Œiconç»„ä»¶ç›®å½•(æ–°å»ºiconä¸ºäº†ä¾¿äºè°ƒè¯•);æ­¤æ—¶componentsæ–‡ä»¶ç›®å½•å¦‚ä¸‹</p>
<pre><code class="lua">-- components
  -- src
    -- button
    -- icon
    -- index.ts
-- package.json
</code></pre>
<p>è®©æˆ‘ä»¬å…ˆæµ‹è¯•ä¸€ä¸‹æˆ‘ä»¬çš„buttonç»„ä»¶èƒ½å¦åœ¨æˆ‘ä»¬æ­å»ºçš„examplesä¸‹çš„vue3é¡¹ç›®æœ¬å¼•ç”¨~</p>
<p>é¦–å…ˆåœ¨buttonä¸‹æ–°å»ºä¸€ä¸ªç®€å•çš„button.vue</p>
<pre><code class="xml">&lt;template&gt;
    &lt;button&gt;æµ‹è¯•æŒ‰é’®&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<p>ç„¶ååœ¨button&#x2F;index.tså°†å…¶å¯¼å‡º</p>
<pre><code class="javascript">import Button from &#39;./button.vue&#39;

export default Button
</code></pre>
<p>å› ä¸ºæˆ‘ä»¬å¼€å‘ç»„ä»¶åº“çš„æ—¶å€™ä¸å¯èƒ½åªæœ‰buttonï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªcomponents&#x2F;index.tså°†æˆ‘ä»¬å¼€å‘çš„ç»„ä»¶ä¸€ä¸ªä¸ªçš„é›†ä¸­å¯¼å‡º</p>
<pre><code class="javascript">import Button from &#39;./button&#39;

export &#123;
    Button
&#125;
</code></pre>
<p>å¥½äº†ï¼Œä¸€ä¸ªç»„ä»¶çš„å¤§ä½“ç›®å½•å·®ä¸å¤šå°±æ˜¯è¿™æ ·äº†ï¼Œæ¥ä¸‹æ¥è¯·è¿›å…¥æˆ‘ä»¬çš„examplesæ¥çœ‹çœ‹èƒ½å¦å¼•å…¥æˆ‘ä»¬çš„buttonç»„ä»¶</p>
<h4 id="2-æµ‹è¯•é¡¹ç›®å¼•å…¥"><a href="#2-æµ‹è¯•é¡¹ç›®å¼•å…¥" class="headerlink" title="2.æµ‹è¯•é¡¹ç›®å¼•å…¥"></a>2.æµ‹è¯•é¡¹ç›®å¼•å…¥</h4><p>ä¸Šé¢å·²ç»è¯´è¿‡æ‰§è¡Œåœ¨workspaceæ‰§è¡Œ pnpm i xxxçš„æ—¶å€™pnpmä¼šè‡ªåŠ¨åˆ›å»ºä¸ªè½¯é“¾æ¥ç›´æ¥æŒ‡å‘æˆ‘ä»¬çš„xxxåŒ…ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç›´æ¥åœ¨examplesæ‰§è¡Œï¼špnpm i alanmf</p>
<p>æ­¤æ—¶ä½ å°±ä¼šå‘ç°packages.jsonçš„ä¾èµ–å¤šäº†ä¸ª</p>
<pre><code class="json">&quot;alanmf&quot;: &quot;workspace:^1.0.0&quot;
</code></pre>
<p>è¿™æ—¶å€™æˆ‘ä»¬å°±èƒ½ç›´æ¥åœ¨æˆ‘ä»¬çš„æµ‹è¯•é¡¹ç›®ä¸‹å¼•å…¥æˆ‘ä»¬æœ¬åœ°çš„componentsç»„ä»¶åº“äº†ï¼Œå¯åŠ¨æˆ‘ä»¬çš„æµ‹è¯•é¡¹ç›®ï¼Œæ¥åˆ°æˆ‘ä»¬çš„ examples&#x2F;app.vue ç›´æ¥å¼•å…¥Button</p>
<pre><code class="xml">&lt;template&gt;
    &lt;div&gt;
        &lt;Button /&gt;
    &lt;/div&gt;
&lt;/template&gt;
&lt;script lang=&quot;ts&quot; setup&gt;
import &#123; Button &#125; from &#39;alanmf/src&#39;
&lt;/script&gt;
</code></pre>
<p>ä¸å‡ºæ„å¤–çš„è¯ä½ çš„é¡µé¢å°±ä¼šå±•ç¤ºæˆ‘ä»¬åˆšåˆšå†™çš„buttonç»„ä»¶äº†</p>
<p>æ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯ä¸“æ³¨äºç»„ä»¶çš„å¼€å‘äº†ï¼›è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„buttonç»„ä»¶ç›®å½•ä¸‹ï¼ˆæµ‹è¯•é¡µé¢ä¸ç”¨å…³ï¼Œæ­¤æ—¶æˆ‘ä»¬å·²ç»å¯ä»¥è¾¹å¼€å‘è¾¹è°ƒè¯•è¾¹çœ‹æ•ˆæœäº†ï¼‰</p>
<h4 id="3-types-tsæ–‡ä»¶è§„èŒƒç»„ä»¶å±æ€§"><a href="#3-types-tsæ–‡ä»¶è§„èŒƒç»„ä»¶å±æ€§" class="headerlink" title="3.types.tsæ–‡ä»¶è§„èŒƒç»„ä»¶å±æ€§"></a>3.types.tsæ–‡ä»¶è§„èŒƒç»„ä»¶å±æ€§</h4><p>æˆ‘ä»¬çš„buttonç»„ä»¶æ˜¯éœ€è¦æ¥æ”¶å¾ˆå¤šå±æ€§çš„ï¼Œå¦‚typeã€sizeç­‰ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ–°å»ºä¸ªtypes.tsæ–‡ä»¶æ¥è§„èŒƒè¿™äº›å±æ€§</p>
<p>åœ¨buttonç›®å½•ä¸‹æ–°å»ºtypes.ts</p>
<pre><code class="tsx">
import &#123; ExtractPropTypes &#125; from &#39;vue&#39;


export const ButtonType = [&#39;default&#39;, &#39;primary&#39;, &#39;success&#39;, &#39;warning&#39;, &#39;danger&#39;]

export const ButtonSize = [&#39;large&#39;, &#39;normal&#39;, &#39;small&#39;, &#39;mini&#39;];


export const buttonProps = &#123;
  type: &#123;
    type: String,
    values: ButtonType
  &#125;,
  size: &#123;
    type: String,
    values: ButtonSize
  &#125;
&#125;

export type ButtonProps = ExtractPropTypes&lt;typeof buttonProps&gt;
</code></pre>
<p>import type è¡¨ç¤ºåªå¯¼å…¥ç±»å‹ï¼›ExtractPropTypesæ˜¯vue3ä¸­å†…ç½®çš„ç±»å‹å£°æ˜,å®ƒçš„ä½œç”¨æ˜¯æ¥æ”¶ä¸€ä¸ªç±»å‹ï¼Œç„¶åæŠŠå¯¹åº”çš„vue3æ‰€æ¥æ”¶çš„propsç±»å‹æä¾›å‡ºæ¥ï¼Œåé¢æœ‰éœ€è¦å¯ä»¥ç›´æ¥ä½¿ç”¨</p>
<p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åœ¨vueä¸­ä½¿ç”¨ä¸€ä¸ªç»„ä»¶ä¼šç”¨çš„app.use å°†ç»„ä»¶æŒ‚è½½åˆ°å…¨å±€ã€‚è¦ä½¿ç”¨app.useå‡½æ•°çš„è¯æˆ‘ä»¬éœ€è¦è®©æˆ‘ä»¬çš„æ¯ä¸ªç»„ä»¶éƒ½æä¾›ä¸€ä¸ªinstallæ–¹æ³•ï¼Œapp.use()çš„æ—¶å€™å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•;</p>
<p>æˆ‘ä»¬å°†button&#x2F;index.tsè°ƒæ•´ä¸º</p>
<pre><code class="typescript">import button from &#39;./button.vue&#39;
import type &#123;App,Plugin&#125; from &quot;vue&quot;
type SFCWithInstall&lt;T&gt; = T&amp;Plugin
const withInstall = &lt;T&gt;(comp:T) =&gt; &#123;
    (comp as SFCWithInstall&lt;T&gt;).install = (app:App)=&gt;&#123;
        //æ³¨å†Œç»„ä»¶
        app.component((comp as any).name,comp)
    &#125;
    return comp as SFCWithInstall&lt;T&gt;
&#125;
const Button = withInstall(button)
export default Button
</code></pre>
<p>æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨app.useæ¥æŒ‚è½½æˆ‘ä»¬çš„ç»„ä»¶å•¦</p>
<p>å…¶å®withInstallæ–¹æ³•å¯ä»¥åšä¸ªå…¬å…±æ–¹æ³•æ”¾åˆ°å·¥å…·åº“é‡Œï¼Œå› ä¸ºåç»­æ¯ä¸ªç»„ä»¶éƒ½ä¼šç”¨åˆ°ï¼Œè¿™é‡Œç­‰åé¢å¼€å‘ç»„ä»¶çš„æ—¶å€™å†è°ƒæ•´</p>
<p>åˆ°è¿™é‡Œç»„ä»¶å¼€å‘çš„åŸºæœ¬é…ç½®å·²ç»å®Œæˆï¼Œæœ€åæˆ‘ä»¬å¯¹æˆ‘ä»¬çš„ç»„ä»¶åº“ä»¥åŠå·¥å…·åº“è¿›è¡Œæ‰“åŒ…ï¼Œæ‰“åŒ…ä¹‹å‰å¦‚æœè¦å‘å…¬å…±åŒ…çš„è¯è®°å¾—å°†æˆ‘ä»¬çš„å„ä¸ªåŒ…çš„åè®®æ”¹ä¸ºMITå¼€æºåè®®</p>
<pre><code class="python-repl">...
&quot;license&quot;: &quot;MIT&quot;,
...
</code></pre>
<h3 id="å››ã€viteæ‰“åŒ…"><a href="#å››ã€viteæ‰“åŒ…" class="headerlink" title="å››ã€viteæ‰“åŒ…"></a>å››ã€viteæ‰“åŒ…</h3><h4 id="1-é…ç½®æ–‡ä»¶"><a href="#1-é…ç½®æ–‡ä»¶" class="headerlink" title="1.é…ç½®æ–‡ä»¶"></a>1.é…ç½®æ–‡ä»¶</h4><p>æ‰“åŒ…ä»¬è¿™é‡Œé€‰æ‹©viteï¼Œå®ƒæœ‰ä¸€ä¸ªåº“æ¨¡å¼ä¸“é—¨ä¸ºæˆ‘ä»¬æ¥æ‰“åŒ…è¿™ç§åº“ç»„ä»¶çš„ã€‚</p>
<p>å‰é¢å·²ç»å®‰è£…è¿‡viteäº†ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥åœ¨componentsä¸‹ç›´æ¥æ–°å»ºvite.config.ts(é…ç½®å‚æ•°æ–‡ä»¶ä¸­å·²ç»æ³¨é‡Š):</p>
<pre><code class="json">import &#123; defineConfig &#125; from &quot;vite&quot;;
import vue from &quot;@vitejs/plugin-vue&quot;
export default defineConfig(
    &#123;
        build: &#123;
            target: &#39;modules&#39;,
            //æ‰“åŒ…æ–‡ä»¶ç›®å½•
            outDir: &quot;es&quot;,
            //å‹ç¼©
            minify: false,
            //cssåˆ†ç¦»
            //cssCodeSplit: true,
            rollupOptions: &#123;
                //å¿½ç•¥æ‰“åŒ…vueæ–‡ä»¶
                external: [&#39;vue&#39;],
                input: [&#39;src/index.ts&#39;],
                output: [
                    &#123;
                        format: &#39;es&#39;,
                        //ä¸ç”¨æ‰“åŒ…æˆ.es.js,è¿™é‡Œæˆ‘ä»¬æƒ³æŠŠå®ƒæ‰“åŒ…æˆ.js
                        entryFileNames: &#39;[name].js&#39;,
                        //è®©æ‰“åŒ…ç›®å½•å’Œæˆ‘ä»¬ç›®å½•å¯¹åº”
                        preserveModules: true,
                        //é…ç½®æ‰“åŒ…æ ¹ç›®å½•
                        dir: &#39;es&#39;,
                        preserveModulesRoot: &#39;src&#39;
                    &#125;,
                    &#123;
                        format: &#39;cjs&#39;,
                        entryFileNames: &#39;[name].js&#39;,
                        //è®©æ‰“åŒ…ç›®å½•å’Œæˆ‘ä»¬ç›®å½•å¯¹åº”
                        preserveModules: true,
                        //é…ç½®æ‰“åŒ…æ ¹ç›®å½•
                        dir: &#39;lib&#39;,
                        preserveModulesRoot: &#39;src&#39;
                    &#125;
                ]
            &#125;,
            lib: &#123;
                entry: &#39;./index.ts&#39;,
                formats: [&#39;es&#39;, &#39;cjs&#39;]
            &#125;
        &#125;,
        plugins: [
            vue()
        ]
    &#125;
)
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©æ‰“åŒ…cjs(CommonJS)å’Œesm(ESModule)ä¸¤ç§å½¢å¼,cjsæ¨¡å¼ä¸»è¦ç”¨äºæœåŠ¡ç«¯å¼•ç”¨(ssr),è€Œesmå°±æ˜¯æˆ‘ä»¬ç°åœ¨ç»å¸¸ä½¿ç”¨çš„æ–¹å¼ï¼Œå®ƒæœ¬èº«è‡ªå¸¦treeShakingè€Œä¸éœ€è¦é¢å¤–é…ç½®æŒ‰éœ€å¼•å…¥(å‰ææ˜¯ä½ å°†æ¨¡å—åˆ†åˆ«å¯¼å‡º)</p>
<h4 id="2-viteæ‰“åŒ…"><a href="#2-viteæ‰“åŒ…" class="headerlink" title="2.viteæ‰“åŒ…"></a>2.viteæ‰“åŒ…</h4><p>åˆ°è¿™é‡Œå°±å·²ç»å¯ä»¥ç›´æ¥æ‰“åŒ…äº†ï¼›componentsä¸‹æ‰§è¡Œï¼š pnpm run buildä½ å°±ä¼šå‘ç°æ‰“åŒ…äº†eså’Œlibä¸¤ä¸ªç›®å½•</p>
<p><img src="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/image-20221120165853742.png"></p>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[ç§æœ‰ä»“åº“æ­å»ºæºç ]: 	â€œ<a target="_blank" rel="noopener" href="https://github.com/mengfeng/alanmf_ui.git">https://github.com/mengfeng/alanmf_ui.git</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BB%84%E4%BB%B6%E5%BA%93/" rel="tag">ç»„ä»¶åº“</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">ä¸Šä¸€é¡µ</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/">ä¸‹ä¸€é¡µ</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2022
        <i class="ri-heart-fill heart_icon"></i> alan_mf
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzzç»Ÿè®¡ -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="è‰ºæœ¯ç ç•œ"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">ä¸»é¡µ</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">å½’æ¡£</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">åˆ†ç±»</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">æ ‡ç­¾</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/%E6%97%85%E8%A1%8C/">æ—…è¡Œ</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://www.zcool.com.cn/u/21686563">æ‘„å½±</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">å‹é“¾</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">å…³äºæˆ‘</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/player">æ’­æ”¾å™¨</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>è¯·æˆ‘å–æ¯å’–å•¡å§~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/zfb.jpeg">
      <span class="reward-type">æ”¯ä»˜å®</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wx.jpeg">
      <span class="reward-type">å¾®ä¿¡</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // sliderå±•å¼€çŠ¶æ€
                // todo: è¿™æ ·ä¸å¥½ï¼Œåé¢æ”¹æˆçŠ¶æ€
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // è·å¾—åŸå›¾å°ºå¯¸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=22707008&auto=1&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    

  </div>
</body>

</html>