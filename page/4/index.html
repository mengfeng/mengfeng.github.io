<!DOCTYPE html>


<html lang="en">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> è‰ºæœ¯ç ç•œ</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-G16F14RTRN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-G16F14RTRN');
</script>

 
<script>
var _hmt = _hmt || [];
(function() {
	var hm = document.createElement("script");
	hm.src = "https://hm.baidu.com/hm.js?f5e6c5b5d28b6bff1c9eb1fcf7f6862b";
	var s = document.getElementsByTagName("script")[0]; 
	s.parentNode.insertBefore(hm, s);
})();
</script>


      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="è‰ºæœ¯ç ç•œ" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      <canvas class="fireworks"></canvas>
      <style>
        .fireworks {
          position: fixed;
          left: 0;
          top: 0;
          z-index: 99999;
          pointer-events: none;
        }
      </style>
      
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://github.com/mengfeng/mengfeng.github.io.git"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover1.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">è‰ºæœ¯ç ç•œ</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['é¢æœå¤§æµ·ï¼Œæ˜¥æš–èŠ±å¼€', 'æ„¿ä½ ä¸€ç”ŸåŠªåŠ›ï¼Œä¸€ç”Ÿè¢«çˆ±', 'æƒ³è¦çš„éƒ½æ‹¥æœ‰ï¼Œå¾—ä¸åˆ°çš„éƒ½é‡Šæ€€'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  
<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content">è‰ºæœ¯ç ç•œçš„ç”Ÿæ´»ç¬é—´</div>
</div>


<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-Electron-d-3-0"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/26/Electron-d-3-0/"
    >Electron-d-3.0</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/26/Electron-d-3-0/" class="article-date">
  <time datetime="2022-11-26T02:26:43.000Z" itemprop="datePublished">2022-11-26</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Electron/">Electron</a> / <a class="article-category-link" href="/categories/Electron/Electron-d-3-0/">Electron-d-3.0</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Electron-d-3-0"><a href="#Electron-d-3-0" class="headerlink" title="Electron-d-3.0"></a>Electron-d-3.0</h1><h3 id="æ¸²æŸ“è¿›ç¨‹"><a href="#æ¸²æŸ“è¿›ç¨‹" class="headerlink" title="æ¸²æŸ“è¿›ç¨‹"></a>æ¸²æŸ“è¿›ç¨‹</h3><p>ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²è§£äº†ä¸»è¿›ç¨‹çš„ä¸€äº›å¸¸ç”¨APIï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬æ¥ç€æ¥è®²è§£æ¸²æŸ“è¿›ç¨‹çš„API</p>
<h3 id="1-å‰ªåˆ‡æ¿ï¼ˆclipboardï¼‰"><a href="#1-å‰ªåˆ‡æ¿ï¼ˆclipboardï¼‰" class="headerlink" title="1.å‰ªåˆ‡æ¿ï¼ˆclipboardï¼‰"></a>1.å‰ªåˆ‡æ¿ï¼ˆclipboardï¼‰</h3><blockquote>
<p>åœ¨ç³»ç»Ÿå‰ªè´´æ¿ä¸Šæ‰§è¡Œå¤åˆ¶å’Œç²˜è´´æ“ä½œã€‚</p>
<p>ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹éƒ½å¯ä»¥ç”¨ã€‚</p>
</blockquote>
<p>ï¼ˆ1ï¼‰<code>clipboard.readText([type])</code></p>
<ul>
<li><code>type</code> string (optional) -å¯ä»¥æ˜¯ <code>selection</code> æˆ– <code>clipboard</code>; é»˜è®¤ä¸º â€˜clipboardâ€™. <code>selection</code> ä»…åœ¨ Linux ä¸­å¯ç”¨ã€‚</li>
</ul>
<p>è¿”å› <code>string</code> - å‰ªè´´æ¿ä¸­çš„å†…å®¹ä¸ºçº¯æ–‡æœ¬ã€‚</p>
<pre><code class="javascript">const &#123; clipboard &#125; = require(&#39;electron&#39;)

clipboard.writeText(&#39;hello i am a bit of text!&#39;)

const text = clipboard.readText()
console.log(text)
// hello i am a bit of text!&#39;
</code></pre>
<p>ï¼ˆ2ï¼‰<code>clipboard.writeText(text[, type])</code></p>
<ul>
<li><code>text</code> string</li>
<li><code>type</code> string (optional) -å¯ä»¥æ˜¯ <code>selection</code> æˆ– <code>clipboard</code>; é»˜è®¤ä¸º â€˜clipboardâ€™. <code>selection</code> ä»…åœ¨ Linux ä¸­å¯ç”¨ã€‚</li>
</ul>
<p>å°† <code>text</code> ä½œä¸ºçº¯æ–‡æœ¬å†™å…¥å‰ªè´´æ¿ã€‚</p>
<pre><code class="javascript">const &#123; clipboard &#125; = require(&#39;electron&#39;)

const text = &#39;hello i am a bit of text!&#39;
clipboard.writeText(text)
</code></pre>
<p>æˆ‘ä»¬å‰ªåˆ‡æ¿çš„APIå°±è¯´è¿™ä¸¤ä¸ªè¯»ä¸å†™ã€‚ä½†æ˜¯æˆ‘åœ¨æ¸²æŸ“è¿›ç¨‹é‡Œè¯»ä¸åˆ°clipboardã€‚</p>
<p>[clipboardæ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/clipboard">https://www.electronjs.org/zh/docs/latest/api/clipboard</a> â€œ</p>
<h3 id="2-contextBridge"><a href="#2-contextBridge" class="headerlink" title="2.contextBridge"></a>2.contextBridge</h3><p>åœ¨éš”ç¦»çš„ä¸Šä¸‹æ–‡ä¸­åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„ã€åŒå‘çš„ã€åŒæ­¥çš„æ¡¥æ¢ã€‚</p>
<p>å¦‚ä¸‹ï¼Œæ˜¯ä¸€ä¸ªä»éš”ç¦»çš„é¢„åŠ è½½è„šæœ¬å°† API æš´éœ²ç»™æ¸²æŸ“å™¨çš„ç¤ºä¾‹ï¼šï¼ˆé€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²APIï¼Œæ¸²æŸ“è¿›ç¨‹å¯ä»¥è¯»å–ï¼‰</p>
<pre><code class="javascript">// Preload (Isolated World)
const &#123; contextBridge, ipcRenderer &#125; = require(&#39;electron&#39;)

contextBridge.exposeInMainWorld(
  &#39;electron&#39;,
  &#123;
    doThing: () =&gt; ipcRenderer.send(&#39;do-a-thing&#39;)
  &#125;
)
</code></pre>
<pre><code class="javascript">// Renderer (Main World)

window.electron.doThing()
</code></pre>
<p>[contextBridgeæ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/context-bridge">https://www.electronjs.org/zh/docs/latest/api/context-bridge</a> â€œ</p>
<h3 id="3-desktopCapturer"><a href="#3-desktopCapturer" class="headerlink" title="3.desktopCapturer"></a>3.desktopCapturer</h3><p>å®˜æ–¹æ–‡æ¡£ç»™çš„æ¡ˆä¾‹ä¸æ˜¯ç‰¹åˆ«å®¹æ˜“ç†è§£ï¼Œä»£ç æœ‰ç‚¹é•¿ã€‚</p>
<blockquote>
<p>è™½ç„¶å®˜æ–¹æ–‡æ¡£çš„ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹éƒ½æœ‰desktopCapturerï¼Œä½†æ˜¯æ¸²æŸ“è¿›ç¨‹æ˜¯è®¿é—®ä¸åˆ°çš„</p>
</blockquote>
<p>æˆ‘ä»¬ä¸¾ä¸€ä¸ªæŠ“å–é¡µé¢å†…å®¹çš„è”æå§ï¼</p>
<p><img src="/2022/11/26/Electron-d-3-0/image-20221126093410069.png"></p>
<pre><code class="javascript">//main.js+
 ipcMain.handle(&#39;capture-event&#39;,async (event,args)=&gt;&#123;
      return  desktopCapturer.getSources(&#123; types: [&#39;window&#39;, &#39;screen&#39;] &#125;).then( sources =&gt; &#123;
        return sources
      &#125;)
 &#125;)
//è§£é‡Šä¸€ä¸‹ï¼ŒdesktopCapturer.getSourcesè¿”å›çš„æ˜¯ä¸€ä¸ªPromiseçš„å¯¹è±¡
</code></pre>
<pre><code class="javascript">//preload.js+

  const capture = async ()=&gt;&#123;
    let res = await ipcRenderer.invoke(&#39;capture-event&#39;)
    console.log(res)
  &#125;
  
  contextBridge.exposeInMainWorld(&#39;electronAPI&#39;, &#123;
    capture
&#125;)
</code></pre>
<pre><code class="javascript">//app.js+
const btn = document.getElementById(&#39;btn&#39;)
btn.addEventListener(&#39;click&#39;,()=&gt;&#123;
    window.electronAPI.capture()
&#125;)
</code></pre>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP --&gt;
    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;&gt;
    &lt;title&gt;capture&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;button id=&quot;btn&quot;&gt;capture&lt;/button&gt;
    &lt;script src=&#39;./renderer/app.js&#39;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>å½“æˆ‘ä»¬ç‚¹å‡»é¡µé¢ä¸Šçš„æŒ‰é’®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šæ‰“å°å‡ºçª—å£ä¿¡æ¯ï¼Œç”±ä¸‹å›¾å¯ä»¥çœ‹å‡ºsourcesæ˜¯ä¸€ä¸ªæ•°ç»„</p>
<p><img src="/2022/11/26/Electron-d-3-0/image-20221126093927866.png"></p>
<p>æˆ‘ä»¬ç°åœ¨å°±å¯ä»¥æ ¹æ®æˆ‘ä»¬è·å–åˆ°çš„ä¿¡æ¯å»å¹²ä¸€äº›äº‹æƒ…äº†ã€‚</p>
<pre><code class="javascript">//preload.js+
  const capture = async ()=&gt;&#123;
    let sources = await ipcRenderer.invoke(&#39;capture-event&#39;)
    for (const source of sources) &#123;
      if (source.name === &#39;electron&#39;) &#123;
        let str = source.thumbnail.crop(&#123;x:0,y:0,width:300,height:300&#125;)
        let imgUrl = str.toDataURL()
        return imgUrl //è¿”å›çš„æ˜¯ä¸€ä¸ªPromise
      &#125;
    &#125;
  &#125;

  contextBridge.exposeInMainWorld(&#39;electronAPI&#39;, &#123;
    handleCounter: (callback) =&gt; ipcRenderer.on(&#39;update-counter&#39;, callback),
    capture,
&#125;)
</code></pre>
<pre><code class="javascript">//app.js+
const btn = document.getElementById(&#39;btn&#39;)
btn.addEventListener(&#39;click&#39;,async ()=&gt;&#123;
   let imgUrl = await window.electronAPI.capture()
   console.log(imgUrl)
&#125;)
</code></pre>
<p><img src="/2022/11/26/Electron-d-3-0/image-20221126100006800.png"></p>
<p>æˆ‘ä»¬åœ¨æ¸²æŸ“è¿›ç¨‹è¿™å°±å·²ç»æ‹¿åˆ°äº†æˆ‘ä»¬çš„æ•°æ®</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å°†æˆ‘ä»¬çš„æ•°æ®å¡«å……åˆ°æˆ‘ä»¬çš„é¡µé¢ä¹‹ä¸­</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP --&gt;
    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;;img-src * data:&quot;&gt;
    &lt;title&gt;Menu Counter&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;!-- Current value: &lt;strong id=&quot;counter&quot;&gt;0&lt;/strong&gt; --&gt;
    &lt;button id=&quot;btn&quot;&gt;capture&lt;/button&gt;
    &lt;img src=&quot;&quot; alt=&quot;æ•è·æ•°æ®&quot; id=&quot;img&quot;&gt;
    &lt;script src=&#39;./renderer/app.js&#39;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<pre><code class="javascript">//app.js+
const btn = document.getElementById(&#39;btn&#39;)

btn.addEventListener(&#39;click&#39;,async ()=&gt;&#123;
   let imgUrl = await window.electronAPI.capture()
   document.getElementById(&#39;img&#39;).src = imgUrl
&#125;)
</code></pre>
<p><img src="/2022/11/26/Electron-d-3-0/image-20221126101223120.png"></p>
<p>æ­å–œä½ ï¼ï¼ï¼æˆåŠŸäº†ğŸ¥³ğŸ¥³ğŸ¥³</p>
<p>[desktopCaptureræ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/desktop-capturer&quot;">https://www.electronjs.org/zh/docs/latest/api/desktop-capturer&quot;</a></p>
<h3 id="4-nativeImage"><a href="#4-nativeImage" class="headerlink" title="4.nativeImage"></a>4.nativeImage</h3><blockquote>
<p>ä½¿ç”¨ PNG æˆ– JPG æ–‡ä»¶åˆ›å»ºæ‰˜ç›˜ã€dockå’Œåº”ç”¨ç¨‹åºå›¾æ ‡ã€‚</p>
<p>ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹éƒ½å¯ä»¥ç”¨ã€‚</p>
</blockquote>
<p>åœ¨ Electron å†…, é‚£äº›éœ€è¦å›¾ç‰‡çš„ API å¯ä»¥ä¼ é€’ä¸¤ç§å‚æ•°, ä¸€ç§æ˜¯æ–‡ä»¶è·¯å¾„, ä¸€ç§æ˜¯ <code>NativeImage</code> å®ä¾‹å¯¹è±¡ã€‚ ç©ºçš„å›¾ç‰‡å¯¹è±¡å°†è¢« <code>null</code> å‚æ•°æ›¿ä»£</p>
<p>ä¾‹å¦‚, åˆ›å»ºæ‰˜ç›˜æˆ–è®¾ç½®çª—å£å›¾æ ‡æ—¶, ä½ å¯ä»¥ä¼ é€’ <code>string</code> æ ¼å¼çš„å›¾ç‰‡è·¯å¾„</p>
<pre><code class="javascript">const &#123; BrowserWindow, Tray &#125; = require(&#39;electron&#39;)

const appIcon = new Tray(&#39;/Users/somebody/images/icon.png&#39;)
const win = new BrowserWindow(&#123; icon: &#39;/Users/somebody/images/window.png&#39; &#125;)
console.log(appIcon, win)
</code></pre>
<p>æˆ–è€…ä»ç²˜è´´æ¿è¯»å–å›¾ç‰‡ï¼Œå°†è¿”å› <code>NativeImage</code> å¯¹è±¡ï¼š</p>
<pre><code class="javascript">const &#123; clipboard, Tray &#125; = require(&#39;electron&#39;)
const image = clipboard.readImage()
const appIcon = new Tray(image)
console.log(appIcon)
</code></pre>
<p>æˆ‘ä»¬æ–‡æ¡£é‡Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›å…³äºNativeImageå¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼Œæˆ‘ä»¬å°±å“ªé‡Œéœ€è¦å“ªé‡Œæ¬ã€‚</p>
<p>[nativeImageæ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/native-image">https://www.electronjs.org/zh/docs/latest/api/native-image</a> â€œ</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å¯¹äºelectronçš„å­¦ä¹ å…ˆåˆ°è¿™ï¼Œå¦‚æœæˆ‘çš„è¿™å‡ ç¯‡æ–‡ç« éƒ½è®¤è®¤çœŸçœŸçš„çœ‹å®Œäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯¹electronæœ‰äº†è¿›ä¸€æ­¥è®¤è¯†ã€‚</p>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[Electronå®˜ç½‘]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/">https://www.electronjs.org/</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/electron/" rel="tag">electron</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Electron-d-2-0"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/25/Electron-d-2-0/"
    >Electron-d-2.0</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/25/Electron-d-2-0/" class="article-date">
  <time datetime="2022-11-25T09:31:05.000Z" itemprop="datePublished">2022-11-25</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Electron/">Electron</a> / <a class="article-category-link" href="/categories/Electron/Electron-d-2-0/">Electron-d-2.0</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Electron"><a href="#Electron" class="headerlink" title="Electron"></a>Electron</h1><p>æœ¬ç¯‡æ–‡ç« æ¥ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œè¯¦ç»†è®²è§£ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¸€äº›å¸¸ç”¨çš„API</p>
<h3 id="ä¸»è¿›ç¨‹API"><a href="#ä¸»è¿›ç¨‹API" class="headerlink" title="ä¸»è¿›ç¨‹API"></a>ä¸»è¿›ç¨‹API</h3><h4 id="1-App-BrowserWindow"><a href="#1-App-BrowserWindow" class="headerlink" title="1.App+BrowserWindow"></a>1.App+BrowserWindow</h4><h5 id="Appäº‹ä»¶ï¼š"><a href="#Appäº‹ä»¶ï¼š" class="headerlink" title="Appäº‹ä»¶ï¼š"></a>Appäº‹ä»¶ï¼š</h5><h6 id="ï¼ˆ1ï¼‰Before-quit"><a href="#ï¼ˆ1ï¼‰Before-quit" class="headerlink" title="ï¼ˆ1ï¼‰Before-quit"></a>ï¼ˆ1ï¼‰Before-quit</h6><ul>
<li><code>event</code> Event #è¿”å›</li>
</ul>
<p> åœ¨ç¨‹åºå…³é—­çª—å£å‰è§¦å‘ï¼ˆmacOSä¸æ˜¯å…³é—­çª—å£è§¦å‘ï¼Œè€Œæ˜¯å…³é—­ç¨‹åºï¼‰</p>
<p>**æ³¨:**åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå› ç³»ç»Ÿå…³æœº&#x2F;é‡å¯æˆ–ç”¨æˆ·æ³¨é”€è€Œå…³é—­ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹ä»¶ä¸ä¼šè¢«è§¦å‘ã€‚</p>
<p>ä»£ç ä»¥åŠç¨‹åºæ¼”ç¤ºï¼š</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125085755781.png"></p>
<h6 id="ï¼ˆ2ï¼‰browser-window-blur"><a href="#ï¼ˆ2ï¼‰browser-window-blur" class="headerlink" title="ï¼ˆ2ï¼‰browser-window-blur"></a>ï¼ˆ2ï¼‰browser-window-blur</h6><ul>
<li><code>event</code> Event #è¿”å›</li>
<li><code>window</code> BrowserWindow #è¿”å›</li>
</ul>
<p>å½“ä¸€ä¸ª browserWindow ï¼ˆçª—å£ï¼‰å¤±å»ç„¦ç‚¹æ—¶è§¦å‘ã€‚å½“æˆ‘ä»¬é¼ æ ‡ç‚¹å‡»çª—å£ä»¥å¤–çš„åœ°æ–¹å°±ä¼šå¤±ç„¦ã€‚</p>
<p>ä»£ç ä»¥åŠç¨‹åºæ¼”ç¤ºï¼š</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125090204480.png"></p>
<h6 id="ï¼ˆ3ï¼‰browser-window-focus"><a href="#ï¼ˆ3ï¼‰browser-window-focus" class="headerlink" title="ï¼ˆ3ï¼‰browser-window-focus"></a>ï¼ˆ3ï¼‰browser-window-focus</h6><ul>
<li><code>event</code> Event #è¿”å›</li>
<li><code>window</code> BrowserWindow #è¿”å›</li>
</ul>
<p>å½“ä¸€ä¸ª browserWindow è·å¾—ç„¦ç‚¹æ—¶è§¦å‘ã€‚</p>
<p>ä»£ç ä»¥åŠç¨‹åºæ¼”ç¤ºï¼š</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125090450485.png"></p>
<h6 id="ï¼ˆ4ï¼‰quit"><a href="#ï¼ˆ4ï¼‰quit" class="headerlink" title="ï¼ˆ4ï¼‰quit"></a>ï¼ˆ4ï¼‰quit</h6><ul>
<li><code>event</code> Event #è¿”å›</li>
<li><code>exitCode</code> Integer #è¿”å›</li>
</ul>
<p>åœ¨åº”ç”¨ç¨‹åºé€€å‡ºæ—¶å‘å‡ºã€‚</p>
<p>**æ³¨:**åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå› ç³»ç»Ÿå…³æœº&#x2F;é‡å¯æˆ–ç”¨æˆ·æ³¨é”€è€Œå…³é—­ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹ä»¶ä¸ä¼šè¢«è§¦å‘ã€‚</p>
<p>ä»£ç ä»¥åŠç¨‹åºæ¼”ç¤ºï¼š</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125090654139.png"></p>
<h6 id="ï¼ˆ5ï¼‰window-all-closed"><a href="#ï¼ˆ5ï¼‰window-all-closed" class="headerlink" title="ï¼ˆ5ï¼‰window-all-closed"></a>ï¼ˆ5ï¼‰window-all-closed</h6><p>å½“æ‰€æœ‰çš„çª—å£éƒ½è¢«å…³é—­æ—¶è§¦å‘ã€‚</p>
<p>å¦‚æœä½ æ²¡æœ‰ç›‘å¬æ­¤äº‹ä»¶å¹¶ä¸”æ‰€æœ‰çª—å£éƒ½å…³é—­äº†ï¼Œé»˜è®¤çš„è¡Œä¸ºæ˜¯æ§åˆ¶é€€å‡ºç¨‹åºï¼›ä½†å¦‚æœä½ ç›‘å¬äº†æ­¤äº‹ä»¶ï¼Œä½ å¯ä»¥æ§åˆ¶æ˜¯å¦é€€å‡ºç¨‹åºã€‚ å¦‚æœç”¨æˆ·æŒ‰ä¸‹äº† <code>Cmd + Q</code>ï¼Œæˆ–è€…å¼€å‘è€…è°ƒç”¨äº† <code>app.quit()</code>ï¼ŒElectron ä¼šé¦–å…ˆå…³é—­æ‰€æœ‰çš„çª—å£ç„¶åè§¦å‘ <code>will-quit</code> äº‹ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ <code>window-all-closed</code>äº‹ä»¶ä¸ä¼šè¢«è§¦å‘ã€‚</p>
<p>ä»£ç ä»¥åŠç¨‹åºæ¼”ç¤ºï¼š</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125090909458.png"></p>
<h5 id="æ–¹æ³•ï¼š"><a href="#æ–¹æ³•ï¼š" class="headerlink" title="æ–¹æ³•ï¼š"></a>æ–¹æ³•ï¼š</h5><p>ç”±äºå„ç§app.æ–¹æ³•ä½¿ç”¨é¢‘ç‡éƒ½å·®ä¸å¤šï¼Œé‚£ä¹ˆæˆ‘ä»¬æ ¹æ®éœ€è¦çœ‹å®˜æ–¹æ–‡æ¡£å§ï¼ˆä¹Ÿæ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚ï¼‰</p>
<p>[App.æ–¹æ³• æ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/app#%E6%96%B9%E6%B3%95">https://www.electronjs.org/zh/docs/latest/api/app#æ–¹æ³•</a> â€œ</p>
<h5 id="BrowserWindowï¼š"><a href="#BrowserWindowï¼š" class="headerlink" title="BrowserWindowï¼š"></a>BrowserWindowï¼š</h5><p><code>BrowserWindow</code> ç±»æš´éœ²äº†å„ç§æ–¹æ³•æ¥ä¿®æ”¹åº”ç”¨çª—å£çš„å¤–è§‚å’Œè¡Œä¸º</p>
<h6 id="ï¼ˆ1ï¼‰ä¼˜é›…çš„æ‰“å¼€çª—å£"><a href="#ï¼ˆ1ï¼‰ä¼˜é›…çš„æ‰“å¼€çª—å£" class="headerlink" title="ï¼ˆ1ï¼‰ä¼˜é›…çš„æ‰“å¼€çª—å£"></a>ï¼ˆ1ï¼‰ä¼˜é›…çš„æ‰“å¼€çª—å£</h6><p><code>ready-to-show</code> äº‹ä»¶</p>
<p>åœ¨åŠ è½½é¡µé¢æ—¶ï¼Œæ¸²æŸ“è¿›ç¨‹ç¬¬ä¸€æ¬¡å®Œæˆç»˜åˆ¶æ—¶ï¼Œå¦‚æœçª—å£è¿˜æ²¡æœ‰è¢«æ˜¾ç¤ºï¼Œæ¸²æŸ“è¿›ç¨‹ä¼šå‘å‡º <code>ready-to-show</code> äº‹ä»¶ ã€‚ åœ¨æ­¤äº‹ä»¶åæ˜¾ç¤ºçª—å£å°†æ²¡æœ‰è§†è§‰é—ªçƒï¼šï¼ˆä¸ä¼šæœ‰ç™½å±å‡ºç°ï¼Œä½†å¦‚æœç»˜åˆ¶æ²¡æœ‰å®Œæˆï¼Œçª—å£å‡ºç°çš„æ—¶é—´ä¹Ÿä¼šå»¶é•¿ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚æ¥é€‰æ‹©æ˜¯å¦è¦é€‰æ‹©è¿™ç§ä¼˜é›…çš„æ‰“å¼€çª—å£æ–¹å¼ï¼‰</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125093133167.png"></p>
<p>è¿™ä¸ªäº‹ä»¶é€šå¸¸åœ¨ <code>did-finish-load</code> äº‹ä»¶ä¹‹åå‘å‡ºï¼Œä½†æ˜¯é¡µé¢æœ‰è®¸å¤šè¿œç¨‹èµ„æºæ—¶ï¼Œå®ƒå¯èƒ½ä¼šåœ¨ <code>did-finish-load</code>ä¹‹å‰å‘å‡ºäº‹ä»¶ã€‚</p>
<p><code>backgroundColor</code>å±æ€§</p>
<p>å¯¹äºä¸€ä¸ªå¤æ‚çš„åº”ç”¨ï¼Œ<code>ready-to-show</code> å¯èƒ½å‘å‡ºçš„å¤ªæ™šï¼Œä¼šè®©åº”ç”¨æ„Ÿè§‰ç¼“æ…¢ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå»ºè®®ç«‹åˆ»æ˜¾ç¤ºçª—å£ï¼Œå¹¶ä½¿ç”¨æ¥è¿‘åº”ç”¨ç¨‹åºèƒŒæ™¯çš„ <code>backgroundColor</code></p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125093813389.png"></p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125093827541.png"></p>
<p>å»ºè®® è®¾ç½® <code>backgroundColor</code>å’Œ <code>ready-to-show</code> äº‹ä»¶ä¸€èµ·ç”¨ï¼Œä»¥ä½¿åº”ç”¨æ„Ÿè§‰æ›´æ¥è¿‘åŸç”Ÿã€‚</p>
<pre><code class="javascript">//backgroundColoræœ‰æ•ˆå€¼
const win = new BrowserWindow()
win.setBackgroundColor(&#39;hsl(230, 100%, 50%)&#39;)
win.setBackgroundColor(&#39;rgb(255, 145, 145)&#39;)
win.setBackgroundColor(&#39;#ff00a3&#39;)
win.setBackgroundColor(&#39;blueviolet&#39;)
</code></pre>
<h6 id="ï¼ˆ2ï¼‰çˆ¶å­çª—å£-amp-amp-æ¨¡æ€çª—å£"><a href="#ï¼ˆ2ï¼‰çˆ¶å­çª—å£-amp-amp-æ¨¡æ€çª—å£" class="headerlink" title="ï¼ˆ2ï¼‰çˆ¶å­çª—å£&amp;&amp;æ¨¡æ€çª—å£"></a>ï¼ˆ2ï¼‰çˆ¶å­çª—å£&amp;&amp;æ¨¡æ€çª—å£</h6><p>çˆ¶å­çª—å£ï¼š</p>
<p>é€šè¿‡ä½¿ç”¨ <code>parent</code> é€‰é¡¹ï¼Œä½ å¯ä»¥åˆ›å»ºå­çª—å£ï¼š</p>
<pre><code class="javascript">const &#123; BrowserWindow &#125; = require(&#39;electron&#39;)

const top = new BrowserWindow()
const child = new BrowserWindow(&#123; parent: top &#125;)
child.show()
top.show()
</code></pre>
<p><code>child</code> çª—å£å°†æ€»æ˜¯æ˜¾ç¤ºåœ¨ <code>top</code> çª—å£çš„é¡¶éƒ¨.</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125094829288.png"></p>
<p>æ¨¡æ€çª—å£</p>
<p>æ¨¡æ€çª—å£æ˜¯ç¦ç”¨çˆ¶çª—å£çš„å­çª—å£ï¼Œåˆ›å»ºæ¨¡æ€çª—å£å¿…é¡»è®¾ç½® <code>parent</code> å’Œ <code>modal</code> é€‰é¡¹ï¼š</p>
<pre><code class="javascript">const &#123; BrowserWindow &#125; = require(&#39;electron&#39;)

const child = new BrowserWindow(&#123; parent: top, modal: true, show: false &#125;)
child.loadURL(&#39;https://github.com&#39;)
child.once(&#39;ready-to-show&#39;, () =&gt; &#123;
  child.show()
&#125;)
</code></pre>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125095057232.png"></p>
<h6 id="ï¼ˆ3ï¼‰BrowserWindowå±æ€§"><a href="#ï¼ˆ3ï¼‰BrowserWindowå±æ€§" class="headerlink" title="ï¼ˆ3ï¼‰BrowserWindowå±æ€§"></a>ï¼ˆ3ï¼‰BrowserWindowå±æ€§</h6><p>è¿™ä¸ªBrowserWindowå±æ€§ æ¯”è¾ƒå¤šï¼Œè€Œä¸”éƒ½æ˜¯è®¾ç½®çª—å£çš„ä¸€äº›å±æ€§ï¼Œä¹Ÿæ˜¯ä¸éš¾ç†è§£ï¼Œæˆ‘ä»¬å°±å¯¹ç…§æˆ‘ä»¬çš„å®˜æ–¹æ–‡æ¡£æ¥å­¦ä¹ å§ï¼</p>
<p>[BrowserWindowå±æ€§]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/browser-window#new-browserwindowoptions">https://www.electronjs.org/zh/docs/latest/api/browser-window#new-browserwindowoptions</a> â€œ</p>
<h6 id="ï¼ˆ4ï¼‰webContents"><a href="#ï¼ˆ4ï¼‰webContents" class="headerlink" title="ï¼ˆ4ï¼‰webContents"></a>ï¼ˆ4ï¼‰webContents</h6><p><code>did-finish-load</code> äº‹ä»¶</p>
<p>å¯¼èˆªå®Œæˆæ—¶è§¦å‘ï¼Œå³é€‰é¡¹å¡çš„æ—‹è½¬å™¨å°†åœæ­¢æ—‹è½¬ï¼Œå¹¶æŒ‡æ´¾<code>onload</code>äº‹ä»¶åã€‚</p>
<p>[webContentsç±»å®ä¾‹äº‹ä»¶]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/web-contents#%E7%B1%BB-webcontents">https://www.electronjs.org/zh/docs/latest/api/web-contents#ç±»-webcontents</a> â€œ</p>
<h6 id="ï¼ˆ5ï¼‰ä¿å­˜çª—å£çŠ¶æ€"><a href="#ï¼ˆ5ï¼‰ä¿å­˜çª—å£çŠ¶æ€" class="headerlink" title="ï¼ˆ5ï¼‰ä¿å­˜çª—å£çŠ¶æ€"></a>ï¼ˆ5ï¼‰ä¿å­˜çª—å£çŠ¶æ€</h6><p>å½“æˆ‘ä»¬ä½¿ç”¨æ¡Œé¢ç¨‹åºçš„æ—¶å€™ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰æ—¶å€™å¸Œæœ›æˆ‘ä»¬å…³é—­ç¨‹åºå†æ¬¡æ‰“å¼€ç¨‹åºçš„æ—¶å€™ï¼Œç¨‹åºçš„ç•Œé¢å’ŒçŠ¶æ€èƒ½å¤Ÿæ˜¯æˆ‘ä»¬å…³é—­å‰çš„æ ·å­ï¼Œä¸å¸Œæœ›å†å»é‡æ–°è®¾ç½®ã€‚é‚£æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªåŒ…<code>electron-win-state</code> </p>
<p>å®‰è£…è¿™ä¸ªåŒ…</p>
<pre><code class="ini">npm i electron-win-state -S
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥åœ¨npmjså®˜ç½‘ä¸Šæ‰¾åˆ°è¿™ä¸ªåŒ…ï¼Œå»çœ‹å®ƒçš„è¯´æ˜æ–‡æ¡£</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125101014250.png"></p>
<p>æ ¹æ®ä½¿ç”¨è¯´æ˜ï¼Œæˆ‘ä»¬ä»£ç å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125101245297.png"></p>
<p>æˆ‘ä»¬å‘ç°æŠ¥é”™äº†ï¼ŒWinState is not a constructor</p>
<p>å½“æˆ‘ä»¬æ‰“å°ä¸€ä¸‹WinStateçœ‹çœ‹ä»€ä¹ˆæƒ…å†µ</p>
<pre><code class="javascript">const WinState = require(&#39;electron-win-state&#39;)
console.log(WinState)
</code></pre>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125101446532.png"></p>
<p>å‘ç°æ²¡æœ‰ç›´æ¥å¼•å…¥WinStateï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹</p>
<pre><code class="javascript">const WinState = require(&#39;electron-win-state&#39;).default 
</code></pre>
<p>ç°åœ¨å°±æ²¡æŠ¥é”™äº†ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬å‘ç°ï¼Œè™½ç„¶å®‰è£…äº†è¿™ä¸ªåŒ…ï¼Œä½†æ˜¯æˆ‘ä»¬ç¨‹åºçš„çŠ¶æ€è¿˜æ˜¯æ²¡æœ‰æ”¹å˜ï¼Œè¿™å°±å¾ˆå¥‡æ€ªäº†ï¼Œå…¶å®ï¼Œæ˜¯æˆ‘ä»¬è‡ªå·±å·²ç»ç»™çª—å£è®¾ç½®äº†è‡ªå®šä¹‰å®½é«˜ï¼Œè¦†ç›–äº†ã€‚æˆ‘ä»¬ä¹Ÿç¼ºäº†ä¸€å¥ä»£ç ï¼›</p>
<pre><code class="javascript"> winState.manage(win)
</code></pre>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125102737449.png"></p>
<p>ç°åœ¨æˆ‘ä»¬çš„çŠ¶æ€ä¿å­˜å°±æ²¡é—®é¢˜äº†ã€‚å½“æˆ‘ä»¬å…³é—­çª—å£å†æ¬¡æ‰“å¼€çš„æ—¶å€™å°±æ˜¯å…³é—­ä¹‹å‰çš„æ ·å­äº†ã€‚</p>
<h4 id="2-dialog"><a href="#2-dialog" class="headerlink" title="2.dialog"></a>2.dialog</h4><p>è¿™äº›å…·ä½“å‚æ•°è¯·çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œä¸‹é¢å‡ ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªpromiseå¯¹è±¡</p>
<h6 id="ï¼ˆ1ï¼‰dialog-showOpenDialog-browserWindow-options"><a href="#ï¼ˆ1ï¼‰dialog-showOpenDialog-browserWindow-options" class="headerlink" title="ï¼ˆ1ï¼‰dialog.showOpenDialog([browserWindow, ]options)"></a>ï¼ˆ1ï¼‰<code>dialog.showOpenDialog([browserWindow, ]options)</code></h6><h6 id="ï¼ˆ2ï¼‰dialog-showSaveDialog-browserWindow-options"><a href="#ï¼ˆ2ï¼‰dialog-showSaveDialog-browserWindow-options" class="headerlink" title="ï¼ˆ2ï¼‰dialog.showSaveDialog([browserWindow, ]options)"></a>ï¼ˆ2ï¼‰<code>dialog.showSaveDialog([browserWindow, ]options)</code></h6><h6 id="ï¼ˆ3ï¼‰dialog-showMessageBox-browserWindow-options"><a href="#ï¼ˆ3ï¼‰dialog-showMessageBox-browserWindow-options" class="headerlink" title="ï¼ˆ3ï¼‰dialog.showMessageBox([browserWindow, ]options)"></a>ï¼ˆ3ï¼‰<code>dialog.showMessageBox([browserWindow, ]options)</code></h6><p>[dialogæ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/dialog#dialogshowopendialogsyncbrowserwindow-options">https://www.electronjs.org/zh/docs/latest/api/dialog#dialogshowopendialogsyncbrowserwindow-options</a> â€œ</p>
<h4 id="3-å¿«æ·é”®ï¼ˆglobalShortcutï¼‰"><a href="#3-å¿«æ·é”®ï¼ˆglobalShortcutï¼‰" class="headerlink" title="3.å¿«æ·é”®ï¼ˆglobalShortcutï¼‰"></a>3.å¿«æ·é”®ï¼ˆglobalShortcutï¼‰</h4><blockquote>
<p>åœ¨åº”ç”¨ç¨‹åºæ²¡æœ‰é”®ç›˜ç„¦ç‚¹æ—¶ï¼Œç›‘å¬é”®ç›˜äº‹ä»¶ã€‚</p>
</blockquote>
<p><code>globalShortcut</code> æ¨¡å—å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿä¸­æ³¨å†Œ&#x2F;æ³¨é”€å…¨å±€å¿«æ·é”®, ä»¥ä¾¿å¯ä»¥ä¸ºæ“ä½œå®šåˆ¶å„ç§å¿«æ·é”®ã€‚</p>
<p><strong>æ³¨æ„:</strong> å¿«æ·æ–¹å¼æ˜¯å…¨å±€çš„; å³ä½¿åº”ç”¨ç¨‹åºæ²¡æœ‰é”®ç›˜ç„¦ç‚¹, å®ƒä¹Ÿä»ç„¶åœ¨æŒç»­ç›‘å¬é”®ç›˜äº‹ä»¶ã€‚ åœ¨ app æ¨¡å—çš„ <code>ready</code> äº‹ä»¶å°±ç»ªä¹‹å‰ï¼Œè¿™ä¸ªæ¨¡å—ä¸èƒ½ä½¿ç”¨ã€‚</p>
<pre><code class="javascript">const &#123; app, globalShortcut &#125; = require(&#39;electron&#39;)

app.whenReady().then(() =&gt; &#123;
  // æ³¨å†Œä¸€ä¸ª&#39;CommandOrControl+X&#39; å¿«æ·é”®ç›‘å¬å™¨
  const ret = globalShortcut.register(&#39;CommandOrControl+X&#39;, () =&gt; &#123;
    console.log(&#39;CommandOrControl+X is pressed&#39;)
  &#125;)

  if (!ret) &#123;
    console.log(&#39;registration failed&#39;)
  &#125;

  // æ£€æŸ¥å¿«æ·é”®æ˜¯å¦æ³¨å†ŒæˆåŠŸ
  console.log(globalShortcut.isRegistered(&#39;CommandOrControl+X&#39;))
&#125;)

app.on(&#39;will-quit&#39;, () =&gt; &#123;
  // æ³¨é”€å¿«æ·é”®
  globalShortcut.unregister(&#39;CommandOrControl+X&#39;)

  // æ³¨é”€æ‰€æœ‰å¿«æ·é”®
  globalShortcut.unregisterAll()
&#125;)
</code></pre>
<p>æ–¹æ³•</p>
<p><code>globalShortcut</code> æ¨¡å—å…·æœ‰ä»¥ä¸‹æ–¹æ³•:</p>
<h6 id="ï¼ˆ1ï¼‰globalShortcut-register-accelerator-callback"><a href="#ï¼ˆ1ï¼‰globalShortcut-register-accelerator-callback" class="headerlink" title="ï¼ˆ1ï¼‰globalShortcut.register(accelerator, callback)"></a>ï¼ˆ1ï¼‰<code>globalShortcut.register(accelerator, callback)</code></h6><ul>
<li><code>accelerator</code> Accelerator</li>
<li><code>callback</code> Function</li>
</ul>
<p>è¿”å›<code>boolean</code> - å¿«æ·é”®æ³¨å†Œæ˜¯å¦æˆåŠŸ</p>
<p>æ³¨å†Œ <code>accelerator</code> çš„å…¨å±€å¿«æ·é”®ã€‚ å½“ç”¨æˆ·æŒ‰ä¸‹æ³¨å†Œå¿«æ·é”®æ—¶ï¼Œ <code>callback</code> ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>å¦‚æœæŒ‡å®šçš„å¿«æ·é”®å·²ç»è¢«å…¶ä»–åº”ç”¨ç¨‹åºæ³¨å†Œæ‰, è°ƒç”¨ä¼šé»˜é»˜å¤±è´¥ã€‚ è¯¥ç‰¹æ€§ç”±æ“ä½œç³»ç»Ÿå®šä¹‰ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¸å¸Œæœ›å¤šä¸ªç¨‹åºçš„å…¨å±€å¿«æ·é”®äº’ç›¸å†²çªã€‚</p>
<p>åœ¨ macOS 10.14 Mojave ä¸‹é¢ï¼Œå¦‚æœ app æ²¡æœ‰è¢«æˆæƒä¸ºå¯ä¿¡ä»»ä½¿ç”¨çš„å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆä¸‹åˆ—å¿«æ·é”®ä¼šæ³¨å†Œå¤±è´¥ï¼š</p>
<ul>
<li>â€œMedia Play&#x2F;Pauseâ€</li>
<li>â€œMedia Next Trackâ€</li>
<li>â€œMedia Previous Trackâ€</li>
<li>â€œMedia Stopâ€</li>
</ul>
<h6 id="ï¼ˆ2ï¼‰globalShortcut-registerAll-accelerators-callback"><a href="#ï¼ˆ2ï¼‰globalShortcut-registerAll-accelerators-callback" class="headerlink" title="ï¼ˆ2ï¼‰globalShortcut.registerAll(accelerators, callback)"></a>ï¼ˆ2ï¼‰<code>globalShortcut.registerAll(accelerators, callback)</code></h6><ul>
<li><code>accelerators</code> string[] - an array of Accelerators.</li>
<li><code>callback</code> Function</li>
</ul>
<p>æ³¨å†Œå¤šä¸ªå…¨å±€å¿«æ·é”®ã€‚ å½“ç”¨æˆ·æŒ‰ä¸‹æ³¨å†Œå¿«æ·é”®æ—¶ï¼Œ <code>callback</code> ä¼šè¢«è°ƒç”¨ã€‚</p>
<p>å¦‚æœå®šä¹‰çš„å¿«æ·é”®å·²ç»è¢«å…¶ä»–åº”ç”¨å ç”¨ï¼Œè¿™ä¸ªè°ƒç”¨ä¼šå¤±æ•ˆã€‚ è¯¥ç‰¹æ€§ç”±æ“ä½œç³»ç»Ÿå®šä¹‰ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¸å¸Œæœ›å¤šä¸ªç¨‹åºçš„å…¨å±€å¿«æ·é”®äº’ç›¸å†²çªã€‚</p>
<p>åœ¨ macOS 10.14 Mojave ä¸‹é¢ï¼Œå¦‚æœ app æ²¡æœ‰è¢«æˆæƒä¸ºå¯ä¿¡ä»»ä½¿ç”¨çš„å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆä¸‹åˆ—å¿«æ·é”®ä¼šæ³¨å†Œå¤±è´¥ï¼š</p>
<ul>
<li>â€œMedia Play&#x2F;Pauseâ€</li>
<li>â€œMedia Next Trackâ€</li>
<li>â€œMedia Previous Trackâ€</li>
<li>â€œMedia Stopâ€</li>
</ul>
<h6 id="ï¼ˆ3ï¼‰globalShortcut-isRegistered-accelerator"><a href="#ï¼ˆ3ï¼‰globalShortcut-isRegistered-accelerator" class="headerlink" title="ï¼ˆ3ï¼‰globalShortcut.isRegistered(accelerator)"></a>ï¼ˆ3ï¼‰<code>globalShortcut.isRegistered(accelerator)</code></h6><ul>
<li><code>accelerator</code> Accelerator</li>
</ul>
<p>Returns <code>boolean</code> - è¡¨ç¤º <code>accelerator</code> å…¨å±€å¿«æ·é”®æ˜¯å¦æ³¨å†ŒæˆåŠŸ</p>
<p>å½“å¿«æ·é”®å·²ç»è¢«å…¶ä»–åº”ç”¨ç¨‹åºæ³¨å†Œæ—¶, æ­¤è°ƒç”¨ä¾ç„¶å°†è¿”å› <code>false</code>ã€‚ è¯¥ç‰¹æ€§ç”±æ“ä½œç³»ç»Ÿå®šä¹‰ï¼Œå› ä¸ºæ“ä½œç³»ç»Ÿä¸å¸Œæœ›å¤šä¸ªç¨‹åºçš„å…¨å±€å¿«æ·é”®äº’ç›¸å†²çªã€‚</p>
<h6 id="ï¼ˆ4ï¼‰globalShortcut-unregister-accelerator"><a href="#ï¼ˆ4ï¼‰globalShortcut-unregister-accelerator" class="headerlink" title="ï¼ˆ4ï¼‰globalShortcut.unregister(accelerator)"></a>ï¼ˆ4ï¼‰<code>globalShortcut.unregister(accelerator)</code></h6><ul>
<li><code>accelerator</code> Accelerator</li>
</ul>
<p>æ³¨é”€ <code>accelerator</code> çš„å…¨å±€å¿«æ·é”®ã€‚</p>
<h6 id="ï¼ˆ5ï¼‰globalShortcut-unregisterAll"><a href="#ï¼ˆ5ï¼‰globalShortcut-unregisterAll" class="headerlink" title="ï¼ˆ5ï¼‰globalShortcut.unregisterAll()"></a>ï¼ˆ5ï¼‰<code>globalShortcut.unregisterAll()</code></h6><p>æ³¨é”€æ‰€æœ‰çš„å…¨å±€å¿«æ·é”®ï¼ˆæ¸…ç©ºè¯¥åº”ç”¨ç¨‹åºçš„æ‰€æœ‰å…¨å±€å¿«æ·é”®ï¼‰ã€‚</p>
<h4 id="4-èœå•ï¼ˆMenuï¼‰"><a href="#4-èœå•ï¼ˆMenuï¼‰" class="headerlink" title="4.èœå•ï¼ˆMenuï¼‰"></a>4.èœå•ï¼ˆMenuï¼‰</h4><p>æˆ‘ä»¬è¿™ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="javascript">//ä¸€ä¸ªç®€å•çš„èœå•æ¨¡æ¿
const &#123; app, Menu &#125; = require(&#39;electron&#39;)

const isMac = process.platform === &#39;darwin&#39;//åˆ¤æ–­æ˜¯ä¸æ˜¯macOS
//roleï¼šèœå•é€‰é¡¹
const template = [
  // &#123; role: &#39;appMenu&#39; &#125;
  ...(isMac ? [&#123;
    label: app.name,//æˆ‘ä»¬ç¨‹åºåç§°
    submenu: [
      &#123; role: &#39;about&#39; &#125;,
      &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
      &#123; role: &#39;services&#39; &#125;,
      &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
      &#123; role: &#39;hide&#39; &#125;,
      &#123; role: &#39;hideOthers&#39; &#125;,
      &#123; role: &#39;unhide&#39; &#125;,
      &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
      &#123; role: &#39;quit&#39; &#125;
    ]
  &#125;] : []),
  // &#123; role: &#39;fileMenu&#39; &#125;
  &#123;
    label: &#39;File&#39;,
    submenu: [
      isMac ? &#123; role: &#39;close&#39; &#125; : &#123; role: &#39;quit&#39; &#125;
    ]
  &#125;,
  // &#123; role: &#39;editMenu&#39; &#125;
  &#123;
    label: &#39;Edit&#39;,
    submenu: [
      &#123; role: &#39;undo&#39; &#125;,
      &#123; role: &#39;redo&#39; &#125;,
      &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
      &#123; role: &#39;cut&#39; &#125;,
      &#123; role: &#39;copy&#39; &#125;,
      &#123; role: &#39;paste&#39; &#125;,
      ...(isMac ? [
        &#123; role: &#39;pasteAndMatchStyle&#39; &#125;,
        &#123; role: &#39;delete&#39; &#125;,
        &#123; role: &#39;selectAll&#39; &#125;,
        &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
        &#123;
          label: &#39;Speech&#39;,
          submenu: [
            &#123; role: &#39;startSpeaking&#39; &#125;,
            &#123; role: &#39;stopSpeaking&#39; &#125;
          ]
        &#125;
      ] : [
        &#123; role: &#39;delete&#39; &#125;,
        &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
        &#123; role: &#39;selectAll&#39; &#125;
      ])
    ]
  &#125;,
  // &#123; role: &#39;viewMenu&#39; &#125;
  &#123;
    label: &#39;View&#39;,
    submenu: [
      &#123; role: &#39;reload&#39; &#125;,
      &#123; role: &#39;forceReload&#39; &#125;,
      &#123; role: &#39;toggleDevTools&#39; &#125;,
      &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
      &#123; role: &#39;resetZoom&#39; &#125;,
      &#123; role: &#39;zoomIn&#39; &#125;,
      &#123; role: &#39;zoomOut&#39; &#125;,
      &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
      &#123; role: &#39;togglefullscreen&#39; &#125;
    ]
  &#125;,
  // &#123; role: &#39;windowMenu&#39; &#125;
  &#123;
    label: &#39;Window&#39;,
    submenu: [
      &#123; role: &#39;minimize&#39; &#125;,
      &#123; role: &#39;zoom&#39; &#125;,
      ...(isMac ? [
        &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
        &#123; role: &#39;front&#39; &#125;,
        &#123; type: &#39;separator&#39; &#125;,//åˆ†å‰²çº¿
        &#123; role: &#39;window&#39; &#125;
      ] : [
        &#123; role: &#39;close&#39; &#125;
      ])
    ]
  &#125;,
  &#123;
    role: &#39;help&#39;,
    submenu: [
      &#123;
        label: &#39;Learn More&#39;,
        click: async () =&gt; &#123;
          //å®šä¹‰è‡ªå·±çš„èœå•æ–¹æ³•
          const &#123; shell &#125; = require(&#39;electron&#39;)
          await shell.openExternal(&#39;https://electronjs.org&#39;)
        &#125;
      &#125;,
      &#123;
        label:&#39;alanmf&#39;,
          click:()=&gt;&#123;console.log(&#39;shift+G&#39;)&#125;,
          accelerator:&#39;shift+G&#39;//å®šä¹‰å¿«æ·é”®
      &#125;
    ]
  &#125;
]

const menu = Menu.buildFromTemplate(template)//ä¸€èˆ¬æ¥è¯´ï¼Œ templateæ˜¯ä¸€ä¸ªoptionsç±»å‹çš„æ•°ç»„ï¼Œç”¨äºæ„å»ºMenuItemã€‚ ä½¿ç”¨æ–¹æ³•å¯å‚è€ƒå‰æ–‡ã€‚è¿˜å¯ä»¥å°†å…¶ä»–å­—æ®µé™„åŠ åˆ°templateï¼Œå®ƒä»¬å°†æˆä¸ºèœå•é¡¹çš„å±æ€§ã€‚
Menu.setApplicationMenu(menu)//åœ¨macOSä¸Šå°† menuè®¾ç½®æˆåº”ç”¨å†…èœå• åœ¨windowså’ŒLinuxä¸Šï¼Œmenu å°†ä¼šè¢«è®¾ç½®æˆçª—å£é¡¶éƒ¨èœå•åœ¨Windowså’ŒLinuxä¸­
</code></pre>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125155603331.png"></p>
<p>[Menuèœå•æ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/menu">https://www.electronjs.org/zh/docs/latest/api/menu</a> â€œ<br>[roleçš„å±æ€§å€¼]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/menu-item#%E8%A7%92%E8%89%B2">https://www.electronjs.org/zh/docs/latest/api/menu-item#è§’è‰²</a> â€œ</p>
<h4 id="5-ç³»ç»Ÿæ‰˜ç›˜ï¼ˆTrayï¼‰"><a href="#5-ç³»ç»Ÿæ‰˜ç›˜ï¼ˆTrayï¼‰" class="headerlink" title="5.ç³»ç»Ÿæ‰˜ç›˜ï¼ˆTrayï¼‰"></a>5.ç³»ç»Ÿæ‰˜ç›˜ï¼ˆTrayï¼‰</h4><blockquote>
<p>æ·»åŠ å›¾æ ‡å’Œä¸Šä¸‹æ–‡èœå•åˆ°ç³»ç»Ÿé€šçŸ¥åŒº</p>
</blockquote>
<pre><code class="javascript">const &#123; app, Menu, Tray &#125; = require(&#39;electron&#39;)

let tray = null
app.whenReady().then(() =&gt; &#123;
  tray = new Tray(&#39;/path/to/my/icon&#39;) //å®šä¹‰iconçš„è·¯å¾„
  const contextMenu = Menu.buildFromTemplate([
    &#123; label: &#39;Item1&#39;, type: &#39;radio&#39; &#125;,
    &#123; label: &#39;Item2&#39;, type: &#39;radio&#39; &#125;,
    &#123; label: &#39;Item3&#39;, type: &#39;radio&#39;, checked: true &#125;,
    &#123; label: &#39;Item4&#39;, type: &#39;radio&#39; &#125;
  ])
  tray.setToolTip(&#39;This is my application.&#39;)//è®¾ç½®é¼ æ ‡æŒ‡é’ˆåœ¨æ‰˜ç›˜å›¾æ ‡ä¸Šæ‚¬åœæ—¶æ˜¾ç¤ºçš„æ–‡æœ¬
  tray.setContextMenu(contextMenu)//è®¾ç½®ä¸Šä¸‹æ–‡èœå•åˆ°æ‰˜ç›˜
&#125;)
</code></pre>
<p>å…¶å®è¿™ä¸ªTrayè·ŸMenuæ˜¯å¸ƒå±€å·®ä¸å¤ªå¤šçš„ï¼Œæ‰€ä»¥å­¦ä¹ èµ·æ¥ä¹Ÿä¸æ˜¯å¾ˆéš¾ç†è§£äº†ã€‚å…·ä½“äº‹ä»¶å’Œæ–¹æ³•ä¹Ÿä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæˆ‘ä»¬å°±ç›´æ¥çœ‹å®˜æ–¹APIæ–‡æ¡£å§ï¼</p>
<p>[Trayæ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/tray">https://www.electronjs.org/zh/docs/latest/api/tray</a> â€œ</p>
<h4 id="6-è§¦æ§æ¿ï¼ˆTouchBarï¼‰"><a href="#6-è§¦æ§æ¿ï¼ˆTouchBarï¼‰" class="headerlink" title="6.è§¦æ§æ¿ï¼ˆTouchBarï¼‰"></a>6.è§¦æ§æ¿ï¼ˆTouchBarï¼‰</h4><p><strong>æ³¨æ„:</strong> TouchBar APIç›®å‰ä¸ºå®éªŒæ€§è´¨ï¼Œå¯èƒ½ä¼šæ›´æ”¹æˆ–åˆ é™¤ã€‚</p>
<p>å¦‚æœå®˜ç½‘æ¨èçš„TouchBaræ¨¡æ‹Ÿå™¨ä¸‹è½½å¤±è´¥ï¼Œè‡ªå·±æœç´¢ä¸€ä¸‹å³å¯ã€‚ï¼ˆå¦‚æœä¸‹è½½çš„æ‰“ä¸å¼€ï¼Œé‚£å°±åœ¨åº”ç”¨ç¨‹åº-&gt;å³é”®æ˜¾ç¤ºåŒ…å†…å®¹-&gt;å¦‚ä¸‹ï¼‰æ‰§è¡Œå°±å¯ä»¥äº†</p>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125172856290.png"></p>
<pre><code class="javascript">//touchbar.js
const &#123; app, BrowserWindow, TouchBar &#125; = require(&#39;electron&#39;)

const &#123; TouchBarLabel, TouchBarButton, TouchBarSpacer &#125; = TouchBar

let spinning = false

// ç±»ä¼¼è€è™æœºçš„æ»šè½´æ ‡ç­¾
const reel1 = new TouchBarLabel()
const reel2 = new TouchBarLabel()
const reel3 = new TouchBarLabel()

// æ—‹è½¬ç»“æœæ ‡ç­¾
const result = new TouchBarLabel()

// æ—‹è½¬æŒ‰é’®
const spin = new TouchBarButton(&#123;
  label: &#39;ğŸ° Spin&#39;,
  backgroundColor: &#39;#7851A9&#39;,
  click: () =&gt; &#123;
    // Ignore clicks if already spinning
    if (spinning) &#123;
      return
    &#125;

    spinning = true
    result.label = &#39;&#39;

    let timeout = 10
    const spinLength = 4 * 1000 // 4 seconds
    const startTime = Date.now()

    const spinReels = () =&gt; &#123;
      updateReels()

      if ((Date.now() - startTime) &gt;= spinLength) &#123;
        finishSpin()
      &#125; else &#123;
        // Slow down a bit on each spin
        timeout *= 1.1
        setTimeout(spinReels, timeout)
      &#125;
    &#125;

    spinReels()
  &#125;
&#125;)

const getRandomValue = () =&gt; &#123;
  const values = [&#39;ğŸ’&#39;, &#39;ğŸ’&#39;, &#39;7ï¸âƒ£&#39;, &#39;ğŸŠ&#39;, &#39;ğŸ””&#39;, &#39;â­&#39;, &#39;ğŸ‡&#39;, &#39;ğŸ€&#39;]
  return values[Math.floor(Math.random() * values.length)]
&#125;

const updateReels = () =&gt; &#123;
  reel1.label = getRandomValue()
  reel2.label = getRandomValue()
  reel3.label = getRandomValue()
&#125;

const finishSpin = () =&gt; &#123;
  const uniqueValues = new Set([reel1.label, reel2.label, reel3.label]).size
  if (uniqueValues === 1) &#123;
    // All 3 values are the same
    result.label = &#39;ğŸ’° Jackpot!&#39;
    result.textColor = &#39;#FDFF00&#39;
  &#125; else if (uniqueValues === 2) &#123;
    // 2ä¸ªå€¼ç›¸åŒ
    result.label = &#39;ğŸ˜ Winner!&#39;
    result.textColor = &#39;#FDFF00&#39;
  &#125; else &#123;
    // æ²¡æœ‰å€¼ç›¸åŒ
    result.label = &#39;ğŸ™ Spin Again&#39;
    result.textColor = null
  &#125;
  spinning = false
&#125;

const touchBar = new TouchBar(&#123;
  items: [
    spin,
    new TouchBarSpacer(&#123; size: &#39;large&#39; &#125;),
    reel1,
    new TouchBarSpacer(&#123; size: &#39;small&#39; &#125;),
    reel2,
    new TouchBarSpacer(&#123; size: &#39;small&#39; &#125;),
    reel3,
    new TouchBarSpacer(&#123; size: &#39;large&#39; &#125;),
    result
  ]
&#125;)

let window

app.whenReady().then(() =&gt; &#123;
  window = new BrowserWindow(&#123;
    frame: false,
    titleBarStyle: &#39;hiddenInset&#39;,
    width: 200,
    height: 200,
    backgroundColor: &#39;#000&#39;
  &#125;)
  window.loadURL(&#39;about:blank&#39;)
  window.setTouchBar(touchBar)
&#125;)
</code></pre>
<p>è¿è¡Œå‘½ä»¤ï¼š</p>
<pre><code class="ini">./node_modules/.bin/electron touchbar.js
</code></pre>
<p><img src="/2022/11/25/Electron-d-2-0/image-20221125172447369.png"></p>
<p>[TouchBaræ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/touch-bar&quot;">https://www.electronjs.org/zh/docs/latest/api/touch-bar&quot;</a></p>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[Electronå®˜æ–¹æ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/api/app">https://www.electronjs.org/zh/docs/latest/api/app</a> â€œ<br>[npmjs]: 	â€œ<a target="_blank" rel="noopener" href="https://www.npmjs.com/">https://www.npmjs.com/</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/electron/" rel="tag">electron</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Electron-d-1-0"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/24/Electron-d-1-0/"
    >Electron-d-1.0</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/24/Electron-d-1-0/" class="article-date">
  <time datetime="2022-11-24T08:27:34.000Z" itemprop="datePublished">2022-11-24</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Electron/">Electron</a> / <a class="article-category-link" href="/categories/Electron/Electron-d-1-0/">Electron-d-1.0</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Electron"><a href="#Electron" class="headerlink" title="Electron"></a>Electron</h1><h3 id="ä¸€ã€æ„å»ºç¬¬ä¸€ä¸ªelectronåº”ç”¨"><a href="#ä¸€ã€æ„å»ºç¬¬ä¸€ä¸ªelectronåº”ç”¨" class="headerlink" title="ä¸€ã€æ„å»ºç¬¬ä¸€ä¸ªelectronåº”ç”¨"></a>ä¸€ã€æ„å»ºç¬¬ä¸€ä¸ªelectronåº”ç”¨</h3><h4 id="1-åˆå§‹åŒ–"><a href="#1-åˆå§‹åŒ–" class="headerlink" title="1.åˆå§‹åŒ–"></a>1.åˆå§‹åŒ–</h4><pre><code class="ini">npm init -y //åˆå§‹åŒ–é¡¹ç›®
npm install --save-dev electron //ä¸‹è½½electronåˆ°å¼€å‘ä¾èµ–
</code></pre>
<h4 id="2-åˆ›å»ºå…¥å£index-html"><a href="#2-åˆ›å»ºå…¥å£index-html" class="headerlink" title="2.åˆ›å»ºå…¥å£index.html"></a>2.åˆ›å»ºå…¥å£index.html</h4><pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP --&gt;
    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;&gt;
    &lt;title&gt;Hello World!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello World!&lt;/h1&gt;
    We are using Node.js &lt;span id=&quot;node-version&quot;&gt;&lt;/span&gt;,
    Chromium &lt;span id=&quot;chrome-version&quot;&gt;&lt;/span&gt;,
    and Electron &lt;span id=&quot;electron-version&quot;&gt;&lt;/span&gt;.
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h4 id="3-åˆ›å»ºå…¥å£æ–‡ä»¶"><a href="#3-åˆ›å»ºå…¥å£æ–‡ä»¶" class="headerlink" title="3.åˆ›å»ºå…¥å£æ–‡ä»¶"></a>3.åˆ›å»ºå…¥å£æ–‡ä»¶</h4><pre><code class="javascript">//main.js
const &#123; app,BrowserWindow &#125; = require(&#39;electron&#39;)

const createWindow = () =&gt; &#123;
    const win = new BrowserWindow(&#123;
      width: 800,
      height: 600
    &#125;)
  
    win.loadFile(&#39;index.html&#39;)
  &#125;

app.whenReady().then(() =&gt; &#123;
    createWindow()
  &#125;)
</code></pre>
<h4 id="4-åˆ›å»ºçª—å£åº”ç”¨"><a href="#4-åˆ›å»ºçª—å£åº”ç”¨" class="headerlink" title="4.åˆ›å»ºçª—å£åº”ç”¨"></a>4.åˆ›å»ºçª—å£åº”ç”¨</h4><p>Package.jsoné…ç½®</p>
<pre><code class="javascript">//Package.json
&#123;
  &quot;name&quot;: &quot;electron-app&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;ä¸€ä¸ªå¤„äºå®éªŒé˜¶æ®µçš„app&quot;,
  &quot;main&quot;: &quot;main.js&quot;,
  &quot;scripts&quot;: &#123;
    &quot;start&quot;: &quot;electron .&quot;
  &#125;,
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;alanmf&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;devDependencies&quot;: &#123;
    &quot;electron&quot;: &quot;^21.3.0&quot;
  &#125;
&#125;
</code></pre>
<pre><code class="ini">npm start //æ‰§è¡Œ electron .
</code></pre>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221123155226283.png"></p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221123155133707.png"></p>
<p>ä¸ºäº†æ›´æ–¹ä¾¿é¡µé¢æ›´æ–°æˆ‘ä»¬ä½¿ç”¨nodemon</p>
<p>nodemonæ˜¯ä¸€ä¸ªè‡ªåŠ¨é‡å¯nodeåº”ç”¨çš„å·¥å…·ï¼Œå½“ç›‘å¬çš„æ–‡ä»¶æˆ–ç›‘å¬ç›®å½•ä¸‹çš„æ–‡ä»¶å‘ç”Ÿä¿®æ”¹æ—¶ï¼Œè‡ªåŠ¨é‡å¯åº”ç”¨</p>
<pre><code class="ini">npm i nodemon -D
</code></pre>
<p>æ›´æ”¹package.json</p>
<pre><code class="javascript">//Package.json
&#123;
  &quot;name&quot;: &quot;electron-app&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;ä¸€ä¸ªå¤„äºå®éªŒé˜¶æ®µçš„app&quot;,
  &quot;main&quot;: &quot;main.js&quot;,
  &quot;scripts&quot;: &#123;
    &quot;start&quot;: &quot;nodemon --exec electron .&quot;
  &#125;,
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;alanmf&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;devDependencies&quot;: &#123;
    &quot;electron&quot;: &quot;^21.3.0&quot;
  &#125;
&#125;
</code></pre>
<h3 id="äºŒã€electronæ ¸å¿ƒ"><a href="#äºŒã€electronæ ¸å¿ƒ" class="headerlink" title="äºŒã€electronæ ¸å¿ƒ"></a>äºŒã€electronæ ¸å¿ƒ</h3><h4 id="1-electronæ ¸å¿ƒæ¦‚å¿µ"><a href="#1-electronæ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="1.electronæ ¸å¿ƒæ¦‚å¿µ"></a>1.electronæ ¸å¿ƒæ¦‚å¿µ</h4><p><strong>ä¸»è¿›ç¨‹</strong>ï¼›å¯åŠ¨é¡¹ç›®æ—¶è¿è¡Œçš„main.jsè„šæœ¬å°±æ˜¯æˆ‘ä»¬è¯´çš„ä¸»è¿›ç¨‹ï¼Œåœ¨ä¸»è¿›ç¨‹è¿è¡Œçš„è„šæ­¥å¯ä»¥åˆ›å»ºwebé¡µé¢çš„å½¢å¼å±•ç¤ºGUIï¼Œä¸»è¿›ç¨‹åªæœ‰ä¸€ä¸ªã€‚</p>
<p><strong>æ¸²æŸ“è¿›ç¨‹</strong>ï¼šæ¯ä¸ªElectronçš„é¡µé¢éƒ½åœ¨è¿è¡Œç€è‡ªå·±çš„è¿›ç¨‹ï¼Œè¿™æ ·çš„è¿›ç¨‹ç§°ä¹‹ä¸ºæ¸²æŸ“è¿›ç¨‹ï¼ˆåŸºäºChromiumçš„å¤šè¿›ç¨‹ç»“æ„ï¼‰ã€‚</p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221123160858462.png"></p>
<p>ä¸»è¿›ç¨‹ä½¿ç”¨BrowserWindowåˆ›å»ºå®ä¾‹ï¼Œä¸»è¿›ç¨‹é”€æ¯åï¼Œå¯¹åº”çš„æ¸²æŸ“è¿›ç¨‹ä¼šè¢«ç»ˆæ­¢ã€‚ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹é€šè¿‡ IPC çš„æ–¹å¼ï¼ˆäº‹ä»¶é©±åŠ¨ï¼‰è¿›è¡Œé€šä¿¡ã€‚</p>
<h4 id="2-electronçª—å£æ§åˆ¶å°"><a href="#2-electronçª—å£æ§åˆ¶å°" class="headerlink" title="2.electronçª—å£æ§åˆ¶å°"></a>2.electronçª—å£æ§åˆ¶å°</h4><pre><code class="javascript">//æ‰“å¼€å¼€å‘è€…å·¥å…·
win.webContents.openDevTools();
//æš‚æ—¶å…³é—­å®‰å…¨è­¦å‘Šï¼ˆä¸æ¨èï¼‰
process.env[&#39;ELECTRON_DISABLE_SECURITY_WARNINGS&#39;] = &#39;true&#39;
</code></pre>
<pre><code class="javascript">//é…ç½®CSPï¼ˆé˜»æŒ¡ä¸€éƒ¨åˆ†å®‰å…¨è­¦å‘Šï¼‰
&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;&gt;
</code></pre>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221123162757926.png"></p>
<h4 id="3-ä¸»è¿›ç¨‹äº‹ä»¶ç”Ÿå‘½å‘¨æœŸ"><a href="#3-ä¸»è¿›ç¨‹äº‹ä»¶ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="3.ä¸»è¿›ç¨‹äº‹ä»¶ç”Ÿå‘½å‘¨æœŸ"></a>3.ä¸»è¿›ç¨‹äº‹ä»¶ç”Ÿå‘½å‘¨æœŸ</h4><p>å…³é—­æ‰€æœ‰çª—å£æ—¶é€€å‡ºåº”ç”¨ <strong>Windows &amp; Linux</strong></p>
<p>åœ¨Windowså’ŒLinuxä¸Šï¼Œå…³é—­æ‰€æœ‰çª—å£é€šå¸¸ä¼šå®Œå…¨é€€å‡ºä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œä½ éœ€è¦ç›‘å¬ <code>app</code> æ¨¡å—çš„ <code>&#39;window-all-closed&#39;äº‹ä»¶ã€‚å¦‚æœç”¨æˆ·ä¸æ˜¯åœ¨ macOS(</code>darwin<code>) ä¸Šè¿è¡Œç¨‹åºï¼Œåˆ™è°ƒç”¨ </code>app.quit()&#96;ã€‚</p>
<pre><code class="javascript">app.on(&#39;window-all-closed&#39;, () =&gt; &#123;
  //macOSç”¨æˆ·åœ¨å…³é—­çª—å£æ—¶ä¸ä¼šå…³é—­åº”ç”¨
  if (process.platform !== &#39;darwin&#39;) app.quit()
&#125;)
</code></pre>
<p>å½“ Linux å’Œ Windows åº”ç”¨åœ¨æ²¡æœ‰çª—å£æ‰“å¼€æ—¶é€€å‡ºäº†ï¼ŒmacOS åº”ç”¨é€šå¸¸å³ä½¿åœ¨æ²¡æœ‰æ‰“å¼€ä»»ä½•çª—å£çš„æƒ…å†µä¸‹ä¹Ÿç»§ç»­è¿è¡Œï¼Œå¹¶ä¸”åœ¨æ²¡æœ‰çª—å£å¯ç”¨çš„æƒ…å†µä¸‹æ¿€æ´»åº”ç”¨æ—¶ä¼šæ‰“å¼€æ–°çš„çª—å£ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸€ç‰¹æ€§ï¼Œç›‘å¬ <code>app</code> æ¨¡å—çš„ <code>activate</code> äº‹ä»¶ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•æµè§ˆå™¨çª—å£æ˜¯æ‰“å¼€çš„ï¼Œåˆ™è°ƒç”¨ <code>createWindow()</code> æ–¹æ³•ã€‚</p>
<p>å› ä¸ºçª—å£æ— æ³•åœ¨ <code>ready</code> äº‹ä»¶å‰åˆ›å»ºï¼Œä½ åº”å½“åœ¨ä½ çš„åº”ç”¨åˆå§‹åŒ–åä»…ç›‘å¬ <code>activate</code> äº‹ä»¶ã€‚ é€šè¿‡åœ¨æ‚¨ç°æœ‰çš„ <code>whenReady()</code> å›è°ƒä¸­é™„ä¸Šæ‚¨çš„äº‹ä»¶ç›‘å¬å™¨æ¥å®Œæˆè¿™ä¸ªæ“ä½œã€‚</p>
<pre><code class="javascript">app.whenReady().then(() =&gt; &#123;
  createWindow()
  app.on(&#39;activate&#39;, () =&gt; &#123;
    if (BrowserWindow.getAllWindows().length === 0) createWindow()
  &#125;)
&#125;)
</code></pre>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„çª—å£çš„æ§ä»¶å°±å®Œæ•´äº†ï¼ˆå®ç°macOSç”¨æˆ·-æ²¡æœ‰çª—å£æ‰“å¼€æ—¶åˆ›å»ºæ–°çª—å£-å…³é—­çª—å£ä¸å…³é—­åº”ç”¨ï¼Œç‚¹å‡»ç¨‹åºååº”ç”¨æ‰“å¼€æ–°çª—å£ï¼‰</p>
<h4 id="4-é€šè¿‡é¢„åŠ è½½è„šæœ¬ä»æ¸²æŸ“å™¨è®¿é—®Node-js"><a href="#4-é€šè¿‡é¢„åŠ è½½è„šæœ¬ä»æ¸²æŸ“å™¨è®¿é—®Node-js" class="headerlink" title="4.é€šè¿‡é¢„åŠ è½½è„šæœ¬ä»æ¸²æŸ“å™¨è®¿é—®Node.js"></a>4.é€šè¿‡é¢„åŠ è½½è„šæœ¬ä»æ¸²æŸ“å™¨è®¿é—®Node.js</h4><p>ç°åœ¨ï¼Œæœ€åè¦åšçš„æ˜¯è¾“å‡ºElectronçš„ç‰ˆæœ¬å·å’Œå®ƒçš„ä¾èµ–é¡¹åˆ°ä½ çš„webé¡µé¢ä¸Šã€‚</p>
<p>åœ¨ä¸»è¿›ç¨‹é€šè¿‡Nodeçš„å…¨å±€ <code>process</code> å¯¹è±¡è®¿é—®è¿™ä¸ªä¿¡æ¯æ˜¯å¾®ä¸è¶³é“çš„ã€‚ ç„¶è€Œï¼Œä½ ä¸èƒ½ç›´æ¥åœ¨ä¸»è¿›ç¨‹ä¸­ç¼–è¾‘DOMï¼Œå› ä¸ºå®ƒæ— æ³•è®¿é—®æ¸²æŸ“å™¨ <code>æ–‡æ¡£</code> ä¸Šä¸‹æ–‡ã€‚ å®ƒä»¬å­˜åœ¨äºå®Œå…¨ä¸åŒçš„è¿›ç¨‹ï¼</p>
<p>è¿™æ˜¯å°† <strong>é¢„åŠ è½½</strong> è„šæœ¬è¿æ¥åˆ°æ¸²æŸ“å™¨æ—¶æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚ é¢„åŠ è½½è„šæœ¬åœ¨æ¸²æŸ“å™¨è¿›ç¨‹åŠ è½½ä¹‹å‰åŠ è½½ï¼Œå¹¶æœ‰æƒè®¿é—®ä¸¤ä¸ª æ¸²æŸ“å™¨å…¨å±€ (ä¾‹å¦‚ <code>window</code> å’Œ <code>document</code>) å’Œ Node.js ç¯å¢ƒã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªåä¸º <code>preload.js</code> çš„æ–°è„šæœ¬:</p>
<pre><code class="javascript">//preload.js
window.addEventListener(&#39;DOMContentLoaded&#39;, () =&gt; &#123;
  const replaceText = (selector, text) =&gt; &#123;
    const element = document.getElementById(selector)
    if (element) element.innerText = text
  &#125;

  for (const dependency of [&#39;chrome&#39;, &#39;node&#39;, &#39;electron&#39;]) &#123;
    replaceText(`$&#123;dependency&#125;-version`, process.versions[dependency])
  &#125;
&#125;)
</code></pre>
<p>ä¸Šé¢çš„ä»£ç è®¿é—® Node.js <code>process.versions</code> å¯¹è±¡ï¼Œå¹¶è¿è¡Œä¸€ä¸ªåŸºæœ¬çš„ <code>replaceText</code> è¾…åŠ©å‡½æ•°å°†ç‰ˆæœ¬å·æ’å…¥åˆ° HTML æ–‡æ¡£ä¸­ã€‚</p>
<p>è¦å°†æ­¤è„šæœ¬é™„åŠ åˆ°æ¸²æŸ“å™¨æµç¨‹ï¼Œè¯·åœ¨ä½ ç°æœ‰çš„ <code>BrowserWindow</code> æ„é€ å™¨ä¸­å°†è·¯å¾„ä¸­çš„é¢„åŠ è½½è„šæœ¬ä¼ å…¥ <code>webPreferences.preload</code> é€‰é¡¹ã€‚</p>
<pre><code class="javascript">// include the Node.js &#39;path&#39; module at the top of your file
const path = require(&#39;path&#39;)

// modify your existing createWindow() function
const createWindow = () =&gt; &#123;
  const win = new BrowserWindow(&#123;
    width: 800,
    height: 600,
    webPreferences: &#123;
      preload: path.join(__dirname, &#39;preload.js&#39;)
    &#125;
  &#125;)

  win.loadFile(&#39;index.html&#39;)
&#125;
// ...
</code></pre>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124081539904.png"></p>
<p>è¿™é‡Œä½¿ç”¨äº†ä¸¤ä¸ªNode.jsæ¦‚å¿µï¼š</p>
<ul>
<li><code>__dirname</code>å­—ç¬¦ä¸²æŒ‡å‘å½“å‰æ­£åœ¨æ‰§è¡Œè„šæœ¬çš„è·¯å¾„ (åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒæŒ‡å‘ä½ çš„é¡¹ç›®çš„æ ¹æ–‡ä»¶å¤¹)ã€‚</li>
<li><code>path.join</code> API å°†å¤šä¸ªè·¯å¾„è”ç»“åœ¨ä¸€èµ·ï¼Œåˆ›å»ºä¸€ä¸ªè·¨å¹³å°çš„è·¯å¾„å­—ç¬¦ä¸²ã€‚</li>
</ul>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç›¸å¯¹å½“å‰æ­£åœ¨æ‰§è¡ŒJavaScriptæ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™æ ·ç›¸å¯¹è·¯å¾„å°†åœ¨å¼€å‘æ¨¡å¼å’Œæ‰“åŒ…æ¨¡å¼ä¸­éƒ½å°†æœ‰æ•ˆã€‚</p>
<h4 id="5-contextBridge"><a href="#5-contextBridge" class="headerlink" title="5.contextBridge"></a>5.contextBridge</h4><p><code>contextBridge</code>æ¨¡å—æœ‰ä»¥ä¸‹æ–¹æ³•:</p>
<p><code>contextBridge.exposeInMainWorld(apiKey, api)</code></p>
<ul>
<li><code>apiKey</code> string - å°† API æ³¨å…¥åˆ° <code>çª—å£</code> çš„é”®ã€‚ API å°†å¯é€šè¿‡ <code>window[apiKey]</code> è®¿é—®ã€‚</li>
<li><code>api</code> any - ä½ çš„ APIå¯ä»¥æ˜¯ä»€ä¹ˆæ ·çš„ä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ç›¸å…³ä¿¡æ¯å¦‚ä¸‹ã€‚</li>
</ul>
<p>åº”ç”¨å¼€å‘æ¥å£ï¼ˆAPIï¼‰</p>
<p>æä¾›ç»™ <code>exposeInMainWorld</code> çš„ <code>api</code> å¿…é¡»æ˜¯ä¸€ä¸ª <code>Function</code>ï¼Œ <code>string</code>ï¼Œ <code>number</code>ï¼Œ <code>Array</code>ï¼Œ <code>boolean</code>ï¼›æˆ–ä¸€ä¸ªé”®ä¸ºå­—ç¬¦ä¸²ï¼Œå€¼ä¸ºä¸€ä¸ª <code>Function</code>ï¼Œ <code>string</code>ï¼Œ <code>number</code>ï¼Œ <code>Array</code>ï¼Œ <code>boolean</code>çš„å¯¹è±¡ï¼›æˆ–å…¶ä»–ç¬¦åˆç›¸åŒæ¡ä»¶çš„åµŒå¥—å¯¹è±¡ã€‚</p>
<p><code>Function</code> ç±»å‹çš„å€¼è¢«ä»£ç†åˆ°å…¶ä»–ä¸Šä¸‹æ–‡ä¸­ï¼Œæ‰€æœ‰å…¶ä»–ç±»å‹çš„å€¼éƒ½ä¼šè¢« <strong>å¤åˆ¶</strong> å¹¶ <strong>å†»ç»“</strong>ã€‚ åœ¨ API ä¸­å‘é€çš„ä»»ä½•æ•°æ® &#x2F;åŸå§‹æ•°æ®å°†ä¸å¯æ”¹å˜ï¼Œåœ¨æ¡¥æ¥å™¨å…¶ä¸­ä¸€ä¾§çš„æ›´æ–°ä¸ä¼šå¯¼è‡´å¦ä¸€ä¾§çš„æ›´æ–°ã€‚</p>
<p>ä»£ç åº”ç”¨ï¼š</p>
<pre><code class="javascript">//preload.js+
const &#123; contextBridge &#125; = require(&#39;electron&#39;)

contextBridge.exposeInMainWorld(&#39;myApi&#39;,&#123;
    platform:process.platform
  &#125;)
</code></pre>
<p>é‚£æˆ‘ä»¬å°±å¯ä»¥åœ¨é¡µé¢ä¸Šå»è®¿é—®windowä¸Šçš„æ–¹æ³•äº†</p>
<pre><code class="javascript">//app.js
console.log(window.myApi.platform) //darwin
</code></pre>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124093018081.png"></p>
<h3 id="ä¸‰ã€ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹é€šä¿¡"><a href="#ä¸‰ã€ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹é€šä¿¡" class="headerlink" title="ä¸‰ã€ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹é€šä¿¡"></a>ä¸‰ã€ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹é€šä¿¡</h3><p>è¿›ç¨‹é—´é€šä¿¡ (IPC) æ˜¯åœ¨ Electron ä¸­æ„å»ºåŠŸèƒ½ä¸°å¯Œçš„æ¡Œé¢åº”ç”¨ç¨‹åºçš„å…³é”®éƒ¨åˆ†ä¹‹ä¸€ã€‚ ç”±äºä¸»è¿›ç¨‹å’Œæ¸²æŸ“å™¨è¿›ç¨‹åœ¨ Electron çš„è¿›ç¨‹æ¨¡å‹å…·æœ‰ä¸åŒçš„èŒè´£ï¼Œå› æ­¤ IPC æ˜¯æ‰§è¡Œè®¸å¤šå¸¸è§ä»»åŠ¡çš„å”¯ä¸€æ–¹æ³•ï¼Œä¾‹å¦‚ä» UI è°ƒç”¨åŸç”Ÿ API æˆ–ä»åŸç”Ÿèœå•è§¦å‘ Web å†…å®¹çš„æ›´æ”¹ã€‚</p>
<p>åœ¨ Electron ä¸­ï¼Œè¿›ç¨‹ä½¿ç”¨ <code>ipcMain</code> å’Œ <code>ipcRenderer</code>æ¨¡å—ï¼Œé€šè¿‡å¼€å‘äººå‘˜å®šä¹‰çš„â€œé€šé“â€ä¼ é€’æ¶ˆæ¯æ¥è¿›è¡Œé€šä¿¡ã€‚ è¿™äº›é€šé“æ˜¯ <strong>ä»»æ„</strong> ï¼ˆæ‚¨å¯ä»¥éšæ„å‘½åå®ƒä»¬ï¼‰å’Œ <strong>åŒå‘</strong> ï¼ˆæ‚¨å¯ä»¥åœ¨ä¸¤ä¸ªæ¨¡å—ä¸­ä½¿ç”¨ç›¸åŒçš„é€šé“åç§°ï¼‰çš„ã€‚</p>
<h4 id="1-æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆå•å‘"><a href="#1-æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆå•å‘" class="headerlink" title="1.æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆå•å‘ )"></a>1.æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆå•å‘ )</h4><p>è¦å°†å•å‘ IPC æ¶ˆæ¯ä»æ¸²æŸ“å™¨è¿›ç¨‹å‘é€åˆ°ä¸»è¿›ç¨‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>ipcRenderer.send</code>API å‘é€æ¶ˆæ¯ï¼Œç„¶åä½¿ç”¨ <code>ipcMain.on</code>API æ¥æ”¶ã€‚</p>
<p>æˆ‘ä»¬ä¸‹è¾¹å°±æŒ‰ç…§å®˜ç½‘çš„ä¾‹å­æ¥è¯´å§ï¼</p>
<h5 id="1-ä½¿ç”¨-ipcMain-on-ç›‘å¬äº‹ä»¶"><a href="#1-ä½¿ç”¨-ipcMain-on-ç›‘å¬äº‹ä»¶" class="headerlink" title="(1) ä½¿ç”¨ ipcMain.on ç›‘å¬äº‹ä»¶"></a>(1) ä½¿ç”¨ <code>ipcMain.on</code> ç›‘å¬äº‹ä»¶</h5><p>åœ¨ä¸»è¿›ç¨‹ï¼ˆmain.jsï¼‰ä¸­ï¼Œä½¿ç”¨ <code>ipcMain.on</code> API åœ¨ <code>set-title</code> é€šé“ä¸Šè®¾ç½®ä¸€ä¸ª IPC ç›‘å¬å™¨:</p>
<pre><code class="javascript">//main.js+
const &#123; ipcMain &#125; = require(&#39;electron&#39;)
 ipcMain.on(&#39;set-title&#39;, (event, title) =&gt; &#123;
      const webContents = event.sender
      const win = BrowserWindow.fromWebContents(webContents)
      win.setTitle(title)
    &#125;)
</code></pre>
<h5 id="2-é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²-ipcRenderer-send"><a href="#2-é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²-ipcRenderer-send" class="headerlink" title="(2) é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ² ipcRenderer.send"></a>(2) é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ² <code>ipcRenderer.send</code></h5><p>è¦å°†æ¶ˆæ¯å‘é€åˆ°ä¸Šé¢åˆ›å»ºçš„ IPC ç›‘å¬å™¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>ipcRenderer.send</code> APIã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¸²æŸ“å™¨è¿›ç¨‹æ²¡æœ‰æƒé™è®¿é—® Node.js å’Œ Electron æ¨¡å—ã€‚ ä½œä¸ºåº”ç”¨å¼€å‘è€…ï¼Œéœ€è¦ä½¿ç”¨ <code>contextBridge</code> API æ¥é€‰æ‹©è¦ä»é¢„åŠ è½½è„šæœ¬ä¸­æš´éœ²å“ªäº› APIã€‚</p>
<p>åœ¨æ‚¨çš„é¢„åŠ è½½è„šæœ¬ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œå‘æ¸²æŸ“å™¨è¿›ç¨‹æš´éœ²ä¸€ä¸ªå…¨å±€çš„ <code>window.electronAPI</code> å˜é‡ã€‚</p>
<pre><code class="javascript">//preload.js+
const &#123; contextBridge,ipcRenderer &#125; = require(&#39;electron&#39;)
contextBridge.exposeInMainWorld(&#39;electronAPI&#39;, &#123;
    setTitle: (title) =&gt; ipcRenderer.send(&#39;set-title&#39;, title)
&#125;)
</code></pre>
<p>æ­¤æ—¶ï¼Œå°†èƒ½å¤Ÿåœ¨æ¸²æŸ“å™¨è¿›ç¨‹ä¸­ä½¿ç”¨ <code>window.electronAPI.setTitle()</code> å‡½æ•°ã€‚</p>
<h5 id="3-æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹-UI"><a href="#3-æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹-UI" class="headerlink" title="(3) æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹ UI"></a>(3) æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹ UI</h5><p>åœ¨ BrowserWindow åŠ è½½çš„æˆ‘ä»¬çš„ HTML æ–‡ä»¶ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªç”±æ–‡æœ¬è¾“å…¥æ¡†å’ŒæŒ‰é’®ç»„æˆçš„åŸºæœ¬ç”¨æˆ·ç•Œé¢ï¼š</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP --&gt;
    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;&gt;
    &lt;title&gt;Hello World!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    Title: &lt;input id=&quot;title&quot;/&gt;
    &lt;button id=&quot;btn&quot; type=&quot;button&quot;&gt;Set&lt;/button&gt;
    &lt;script src=&quot;./renderer/app.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>å°†åœ¨å¯¼å…¥çš„ <code>renderer.js</code> æ–‡ä»¶ä¸­æ·»åŠ å‡ è¡Œä»£ç ï¼Œä»¥åˆ©ç”¨ä»é¢„åŠ è½½è„šæœ¬ä¸­æš´éœ²çš„ <code>window.electronAPI</code> åŠŸèƒ½ï¼š</p>
<pre><code class="javascript">//app.js
const setButton = document.getElementById(&#39;btn&#39;)
const titleInput = document.getElementById(&#39;title&#39;)
setButton.addEventListener(&#39;click&#39;, () =&gt; &#123;
    const title = titleInput.value
    window.electronAPI.setTitle(title)
&#125;);
</code></pre>
<p>åˆ°ç›®å‰çš„ä»£ç ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹çš„è¿›ç¨‹é€šä¿¡å°±å·²ç»å®ç°äº†ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ä¸€è¯•æˆ‘ä»¬çš„UIç•Œé¢åŠŸèƒ½</p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124100800847.png"></p>
<h5 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h5><p>ï¼ï¼ï¼æˆ‘ä»¬ä¸Šé¢æœ‰ä¸€äº›åœ°æ–¹ä¸ç†è§£çš„æ–¹æ³•å’ŒAPIï¼Œæˆ‘ä»¬ç°åœ¨è®²ä¸€ä¸‹</p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124101054114.png"></p>
<p>ä¸Šé¢çš„ å›è°ƒå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ª IpcMainEvent ç»“æ„å’Œä¸€ä¸ª <code>title</code> å­—ç¬¦ä¸²ã€‚ æ¯å½“æ¶ˆæ¯é€šè¿‡ <code>set-title</code> é€šé“ä¼ å…¥æ—¶ï¼Œæ­¤å‡½æ•°æ‰¾åˆ°é™„åŠ åˆ°æ¶ˆæ¯å‘é€æ–¹çš„ BrowserWindow å®ä¾‹ï¼Œå¹¶åœ¨è¯¥å®ä¾‹ä¸Šä½¿ç”¨ <code>win.setTitle</code> APIã€‚</p>
<p>æˆ‘ä»¬åªæ˜¯ä¸ºäº†æ›´ç®€å•çš„ç†è§£è¿›ç¨‹é€šä¿¡ï¼Œå…·ä½“ API è§å®˜æ–¹æ–‡æ¡£å§ï¼</p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124101339509.png"></p>
<h4 id="2-æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆåŒå‘ï¼‰"><a href="#2-æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆåŒå‘ï¼‰" class="headerlink" title="2.æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆåŒå‘ï¼‰"></a>2.æ¸²æŸ“å™¨è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹ï¼ˆåŒå‘ï¼‰</h4><p>åŒå‘ IPC çš„ä¸€ä¸ªå¸¸è§åº”ç”¨æ˜¯ä»æ¸²æŸ“å™¨è¿›ç¨‹ä»£ç è°ƒç”¨ä¸»è¿›ç¨‹æ¨¡å—å¹¶ç­‰å¾…ç»“æœã€‚ è¿™å¯ä»¥é€šè¿‡å°† <code>ipcRenderer.invoke</code> ä¸ <code>ipcMain.handle</code> æ­é…ä½¿ç”¨æ¥å®Œæˆã€‚</p>
<h5 id="1-ä½¿ç”¨-ipcMain-handle-ç›‘å¬äº‹ä»¶"><a href="#1-ä½¿ç”¨-ipcMain-handle-ç›‘å¬äº‹ä»¶" class="headerlink" title="(1)ä½¿ç”¨ ipcMain.handle ç›‘å¬äº‹ä»¶"></a>(1)ä½¿ç”¨ <code>ipcMain.handle</code> ç›‘å¬äº‹ä»¶</h5><p>åœ¨ä¸»è¿›ç¨‹(main.js)ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª <code>handleFileOpen()</code> å‡½æ•°ï¼Œå®ƒè°ƒç”¨ <code>dialog.showOpenDialog</code> å¹¶è¿”å›ç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶è·¯å¾„å€¼ã€‚ æ¯å½“æ¸²æŸ“å™¨è¿›ç¨‹é€šè¿‡ <code>dialog:openFile</code> é€šé“å‘é€ <code>ipcRender.invoke</code> æ¶ˆæ¯æ—¶ï¼Œæ­¤å‡½æ•°è¢«ç”¨ä½œä¸€ä¸ªå›è°ƒã€‚ ç„¶åï¼Œè¿”å›å€¼å°†ä½œä¸ºä¸€ä¸ª Promise è¿”å›åˆ°æœ€åˆçš„ <code>invoke</code> è°ƒç”¨ã€‚</p>
<pre><code class="javascript">//main.js
const &#123; app,BrowserWindow,ipcMain,dialog &#125; = require(&#39;electron&#39;)
const path = require(&#39;path&#39;)

//å›è°ƒå‡½æ•°
async function handleFileOpen() &#123;
  const &#123; canceled, filePaths &#125; = await dialog.showOpenDialog()
  if (canceled) &#123;
    return
  &#125; else &#123;
    return filePaths[0]
  &#125;
&#125;

const createWindow = () =&gt; &#123;
    const win = new BrowserWindow(&#123;
      width: 800,
      height: 600,
      webPreferences: &#123;
        preload: path.join(__dirname, &#39;preload.js&#39;)
      &#125;
    &#125;)
    win.loadFile(&#39;index.html&#39;) 
    win.webContents.openDevTools()
    
  &#125;

  app.whenReady().then(() =&gt; &#123;
    //ç›‘å¬ï¼Œæ‰§è¡Œå›è°ƒ
    ipcMain.handle(&#39;dialog:openFile&#39;, handleFileOpen)
    createWindow()
    app.on(&#39;activate&#39;, () =&gt; &#123;
      if (BrowserWindow.getAllWindows().length === 0) createWindow()
    &#125;)
  &#125;)
  app.on(&#39;window-all-closed&#39;, () =&gt; &#123;
    if (process.platform !== &#39;darwin&#39;) app.quit()
  &#125;)
</code></pre>
<h5 id="2-é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²-ipcRenderer-invoke"><a href="#2-é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²-ipcRenderer-invoke" class="headerlink" title="(2)é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ² ipcRenderer.invoke"></a>(2)é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ² <code>ipcRenderer.invoke</code></h5><p>åœ¨é¢„åŠ è½½è„šæœ¬ä¸­ï¼Œæˆ‘ä»¬æš´éœ²äº†ä¸€ä¸ªå•è¡Œçš„ <code>openFile</code> å‡½æ•°ï¼Œå®ƒè°ƒç”¨å¹¶è¿”å› <code>ipcRenderer.invoke(&#39;dialog:openFile&#39;)</code> çš„å€¼ã€‚ æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€æ­¥ä¸­ä½¿ç”¨æ­¤ API ä»æ¸²æŸ“å™¨çš„ç”¨æˆ·ç•Œé¢è°ƒç”¨åŸç”Ÿå¯¹è¯æ¡†ã€‚</p>
<pre><code class="javascript">//preload.js
const &#123; contextBridge,ipcRenderer &#125; = require(&#39;electron&#39;)
 contextBridge.exposeInMainWorld(&#39;electronAPI&#39;, &#123;
    openFile: () =&gt; ipcRenderer.invoke(&#39;dialog:openFile&#39;)
&#125;)
</code></pre>
<h5 id="3-æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹-UI-1"><a href="#3-æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹-UI-1" class="headerlink" title="(3)æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹ UI"></a>(3)æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹ UI</h5><p>æœ€åï¼Œè®©æˆ‘ä»¬æ„å»ºåŠ è½½åˆ° BrowserWindow ä¸­çš„ HTML æ–‡ä»¶ã€‚</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP --&gt;
    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;&gt;
    &lt;title&gt;Dialog&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;button type=&quot;button&quot; id=&quot;btn&quot;&gt;Open a File&lt;/button&gt;
    File path: &lt;strong id=&quot;filePath&quot;&gt;&lt;/strong&gt;
    &lt;script src=&#39;./renderer/app.js&#39;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>ç”¨æˆ·ç•Œé¢åŒ…å«ä¸€ä¸ª <code>#btn</code> æŒ‰é’®å…ƒç´ ï¼Œå°†ç”¨äºè§¦å‘æˆ‘ä»¬çš„é¢„åŠ è½½ APIï¼Œä»¥åŠä¸€ä¸ª <code>#filePath</code> å…ƒç´ ï¼Œå°†ç”¨äºæ˜¾ç¤ºæ‰€é€‰æ–‡ä»¶çš„è·¯å¾„ã€‚éœ€è¦åœ¨æ¸²æŸ“å™¨è¿›ç¨‹è„šæœ¬ä¸­ç¼–å†™å‡ è¡Œä»£ç </p>
<pre><code class="javascript">//app.js
const btn = document.getElementById(&#39;btn&#39;)
const filePathElement = document.getElementById(&#39;filePath&#39;)

btn.addEventListener(&#39;click&#39;, async () =&gt; &#123;
  const filePath = await window.electronAPI.openFile()
  filePathElement.innerText = filePath
&#125;)
</code></pre>
<p>åˆ°ç›®å‰çš„ä»£ç ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªæ¸²æŸ“è¿›ç¨‹åˆ°ä¸»è¿›ç¨‹çš„åŒå‘è¿›ç¨‹é€šä¿¡å°±å·²ç»å®ç°äº†ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ä¸€è¯•æˆ‘ä»¬çš„UIç•Œé¢åŠŸèƒ½</p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124103530122.png"></p>
<h5 id="æ€»ç»“ï¼š-1"><a href="#æ€»ç»“ï¼š-1" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h5><p><code>ipcRenderer.invoke</code> API ï¼ˆè€æ–¹æ³•äº†ï¼Œä½†ä¾ç„¶å¥½ç”¨ï¼‰æ˜¯åœ¨ Electron 7 ä¸­æ·»åŠ çš„ï¼Œä½œä¸ºå¤„ç†æ¸²æŸ“å™¨è¿›ç¨‹ä¸­åŒå‘ IPC çš„ä¸€ç§å¼€å‘äººå‘˜å‹å¥½çš„æ–¹å¼ã€‚ ä½†è¿™ç§ IPC æ¨¡å¼å­˜åœ¨å‡ ç§æ›¿ä»£æ–¹æ³•ã€‚</p>
<p>ä½¿ç”¨ <code>ipcRenderer.send</code>æˆ‘ä»¬ç”¨äºå•å‘é€šä¿¡çš„ <code>ipcRenderer.send</code> API ä¹Ÿå¯ç”¨äºåŒå‘é€šä¿¡ã€‚ è¿™æ˜¯åœ¨ Electron 7 ä¹‹å‰é€šè¿‡ IPC è¿›è¡Œå¼‚æ­¥åŒå‘é€šä¿¡çš„æ¨èæ–¹å¼ã€‚</p>
<pre><code class="javascript">//preload.js
// æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ `contextBridge` API
// å°†è¿™æ®µä»£ç æš´éœ²ç»™æ¸²æŸ“å™¨è¿›ç¨‹
const &#123; ipcRenderer &#125; = require(&#39;electron&#39;)

ipcRenderer.on(&#39;asynchronous-reply&#39;, (_event, arg) =&gt; &#123;
  console.log(arg) // åœ¨ DevTools æ§åˆ¶å°ä¸­æ‰“å°â€œpongâ€
&#125;)
ipcRenderer.send(&#39;asynchronous-message&#39;, &#39;ping&#39;)
</code></pre>
<pre><code class="javascript">//main.js
ipcMain.on(&#39;asynchronous-message&#39;, (event, arg) =&gt; &#123;
  console.log(arg) // åœ¨ Node æ§åˆ¶å°ä¸­æ‰“å°â€œpingâ€
  // ä½œç”¨å¦‚åŒ `send`ï¼Œä½†è¿”å›ä¸€ä¸ªæ¶ˆæ¯
  // åˆ°å‘é€åŸå§‹æ¶ˆæ¯çš„æ¸²æŸ“å™¨
  event.reply(&#39;asynchronous-reply&#39;, &#39;pong&#39;)
&#125;)
</code></pre>
<p>è¿™ç§æ–¹æ³•æœ‰å‡ ä¸ªç¼ºç‚¹ï¼š</p>
<ul>
<li>æ‚¨éœ€è¦è®¾ç½®ç¬¬äºŒä¸ª <code>ipcRenderer.on</code> ç›‘å¬å™¨æ¥å¤„ç†æ¸²æŸ“å™¨è¿›ç¨‹ä¸­çš„å“åº”ã€‚ ä½¿ç”¨ <code>invoke</code>ï¼Œæ‚¨å°†è·å¾—ä½œä¸º Promise è¿”å›åˆ°åŸå§‹ API è°ƒç”¨çš„å“åº”å€¼ã€‚</li>
<li>æ²¡æœ‰æ˜¾è€Œæ˜“è§çš„æ–¹æ³•å¯ä»¥å°† <code>asynchronous-reply</code> æ¶ˆæ¯ä¸åŸå§‹çš„ <code>asynchronous-message</code>æ¶ˆæ¯é…å¯¹ã€‚ å¦‚æœæ‚¨é€šè¿‡è¿™äº›é€šé“éå¸¸é¢‘ç¹åœ°æ¥å›ä¼ é€’æ¶ˆæ¯ï¼Œåˆ™éœ€è¦æ·»åŠ å…¶ä»–åº”ç”¨ä»£ç æ¥å•ç‹¬è·Ÿè¸ªæ¯ä¸ªè°ƒç”¨å’Œå“åº”ã€‚</li>
</ul>
<p>ä½¿ç”¨ <code>ipcRenderer.sendSync</code>APIä¹Ÿæ˜¯å¯ä»¥æ›¿ä»£çš„ï¼Œä½†ä¸æ¨è</p>
<p><code>ipcRenderer.sendSync</code> API å‘ä¸»è¿›ç¨‹å‘é€æ¶ˆæ¯ï¼Œå¹¶ <em>åŒæ­¥</em> ç­‰å¾…å“åº”ã€‚</p>
<pre><code class="javascript">//main.js
const &#123; ipcMain &#125; = require(&#39;electron&#39;)
ipcMain.on(&#39;synchronous-message&#39;, (event, arg) =&gt; &#123;
  console.log(arg) // åœ¨ Node æ§åˆ¶å°ä¸­æ‰“å°â€œpingâ€
  event.returnValue = &#39;pong&#39;
&#125;)
</code></pre>
<pre><code class="javascript">//perload.js
// æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ `contextBridge` API
// å°†è¿™æ®µä»£ç æš´éœ²ç»™æ¸²æŸ“å™¨è¿›ç¨‹
const &#123; ipcRenderer &#125; = require(&#39;electron&#39;)

const result = ipcRenderer.sendSync(&#39;synchronous-message&#39;, &#39;ping&#39;)
console.log(result) // åœ¨ DevTools æ§åˆ¶å°ä¸­æ‰“å°â€œpongâ€
</code></pre>
<p>è¿™ä»½ä»£ç çš„ç»“æ„ä¸ <code>invoke</code> æ¨¡å‹éå¸¸ç›¸ä¼¼ï¼Œä½†å‡ºäºæ€§èƒ½åŸå› ï¼Œæˆ‘ä»¬å»ºè®®<strong>é¿å…ä½¿ç”¨æ­¤ API</strong>ã€‚ å®ƒçš„åŒæ­¥ç‰¹æ€§æ„å‘³ç€å®ƒå°†é˜»å¡æ¸²æŸ“å™¨è¿›ç¨‹ï¼Œç›´åˆ°æ”¶åˆ°å›å¤ä¸ºæ­¢ã€‚(å®¹æ˜“é˜»å¡æ¸²æŸ“å™¨è¿›ç¨‹)</p>
<h4 id="3-ä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹"><a href="#3-ä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹" class="headerlink" title="3.ä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹"></a>3.ä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹</h4><p>å°†æ¶ˆæ¯ä»ä¸»è¿›ç¨‹å‘é€åˆ°æ¸²æŸ“å™¨è¿›ç¨‹æ—¶ï¼Œéœ€è¦æŒ‡å®šæ˜¯å“ªä¸€ä¸ªæ¸²æŸ“å™¨æ¥æ”¶æ¶ˆæ¯ã€‚ æ¶ˆæ¯éœ€è¦é€šè¿‡å…¶ <code>WebContents</code>å®ä¾‹å‘é€åˆ°æ¸²æŸ“å™¨è¿›ç¨‹ã€‚ æ­¤ WebContents å®ä¾‹åŒ…å«ä¸€ä¸ª <code>send</code> æ–¹æ³•ï¼Œå…¶ä½¿ç”¨æ–¹å¼ä¸ <code>ipcRenderer.send</code> ç›¸åŒã€‚</p>
<h5 id="1-ä½¿ç”¨-webContents-æ¨¡å—å‘é€æ¶ˆæ¯"><a href="#1-ä½¿ç”¨-webContents-æ¨¡å—å‘é€æ¶ˆæ¯" class="headerlink" title="(1)ä½¿ç”¨ webContents æ¨¡å—å‘é€æ¶ˆæ¯"></a>(1)ä½¿ç”¨ <code>webContents</code> æ¨¡å—å‘é€æ¶ˆæ¯</h5><p>æˆ‘ä»¬éœ€è¦é¦–å…ˆä½¿ç”¨ Electron çš„ <code>Menu</code> æ¨¡å—åœ¨ä¸»è¿›ç¨‹ä¸­æ„å»ºä¸€ä¸ªè‡ªå®šä¹‰èœå•ï¼Œè¯¥æ¨¡å—ä½¿ç”¨ <code>webContents.send</code> API å°† IPC æ¶ˆæ¯ä»ä¸»è¿›ç¨‹å‘é€åˆ°ç›®æ ‡æ¸²æŸ“å™¨ã€‚</p>
<pre><code class="javascript">//main.js
const &#123; app,BrowserWindow,ipcMain,Menu &#125; = require(&#39;electron&#39;)
const path = require(&#39;path&#39;)

const createWindow = () =&gt; &#123;
    const win = new BrowserWindow(&#123;
      width: 800,
      height: 600,
      webPreferences: &#123;
        preload: path.join(__dirname, &#39;preload.js&#39;)
      &#125;
    &#125;)

    const menu = Menu.buildFromTemplate([
      &#123;
        label: app.name,
        submenu: [
        &#123;
          click: () =&gt; win.webContents.send(&#39;update-counter&#39;, 1),
          label: &#39;Increment&#39;,
        &#125;,
        &#123;
          click: () =&gt; win.webContents.send(&#39;update-counter&#39;, -1),
          label: &#39;Decrement&#39;,
        &#125;
        ]
      &#125;
  
    ])

    Menu.setApplicationMenu(menu)
    win.loadFile(&#39;index.html&#39;) 
    win.webContents.openDevTools()
    
  &#125;

  app.whenReady().then(() =&gt; &#123;
    ipcMain.on(&#39;counter-value&#39;, (_event, value) =&gt; &#123;
      console.log(value) // will print value to Node console
    &#125;)
    createWindow()
    app.on(&#39;activate&#39;, () =&gt; &#123;
      if (BrowserWindow.getAllWindows().length === 0) createWindow()
    &#125;)
  &#125;)

  app.on(&#39;window-all-closed&#39;, () =&gt; &#123;
    if (process.platform !== &#39;darwin&#39;) app.quit()
  &#125;)
</code></pre>
<h5 id="2-é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²-ipcRenderer-on"><a href="#2-é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²-ipcRenderer-on" class="headerlink" title="(2)é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ² ipcRenderer.on"></a>(2)é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ² <code>ipcRenderer.on</code></h5><p>ä¸å‰é¢çš„æ¸²æŸ“å™¨åˆ°ä¸»è¿›ç¨‹çš„ç¤ºä¾‹ä¸€æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨é¢„åŠ è½½è„šæœ¬ä¸­çš„ <code>contextBridge</code> å’Œ <code>ipcRenderer</code> æ¨¡å—å‘æ¸²æŸ“å™¨è¿›ç¨‹æš´éœ² IPC åŠŸèƒ½ï¼š</p>
<pre><code class="javascript">//preload.js
const &#123; contextBridge,ipcRenderer &#125; = require(&#39;electron&#39;)
contextBridge.exposeInMainWorld(&#39;electronAPI&#39;, &#123;
    handleCounter: (callback) =&gt; ipcRenderer.on(&#39;update-counter&#39;, callback)
&#125;)
</code></pre>
<p>åŠ è½½é¢„åŠ è½½è„šæœ¬åï¼Œæ¸²æŸ“å™¨è¿›ç¨‹åº”æœ‰æƒè®¿é—® <code>window.electronAPI.handleCounter()</code> ç›‘å¬å™¨å‡½æ•°ã€‚</p>
<h5 id="3-æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹-UI-2"><a href="#3-æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹-UI-2" class="headerlink" title="(3)æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹ UI"></a>(3)æ„å»ºæ¸²æŸ“å™¨è¿›ç¨‹ UI</h5><p>æˆ‘ä»¬å°†åœ¨åŠ è½½çš„ HTML æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªæ¥å£ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª <code>#counter</code>å…ƒç´ ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥å…ƒç´ æ¥æ˜¾ç¤ºå€¼ï¼š</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP --&gt;
    &lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;self&#39;&quot;&gt;
    &lt;title&gt;Menu Counter&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    Current value: &lt;strong id=&quot;counter&quot;&gt;0&lt;/strong&gt;
    &lt;script src=&#39;./renderer/app.js&#39;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>ä¸ºäº†æ›´æ–° HTML æ–‡æ¡£ä¸­çš„å€¼ï¼Œæˆ‘ä»¬å°†æ·»åŠ å‡ è¡Œ DOM æ“ä½œçš„ä»£ç ï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡è§¦å‘ <code>update-counter</code> äº‹ä»¶æ—¶æ›´æ–° <code>#counter</code> å…ƒç´ çš„å€¼ã€‚</p>
<pre><code class="javascript">//app.js
const counter = document.getElementById(&#39;counter&#39;)
window.electronAPI.handleCounter((event, value) =&gt; &#123;
    const oldValue = Number(counter.innerText)
    const newValue = oldValue + value
    counter.innerText = newValue
    event.sender.send(&#39;counter-value&#39;, newValue)
&#125;)
</code></pre>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†å›è°ƒä¼ é€’ç»™ä»é¢„åŠ è½½è„šæœ¬ä¸­æš´éœ²çš„ <code>window.electronAPI.onUpdateCounter</code> å‡½æ•°ã€‚ ç¬¬äºŒä¸ª <code>value</code> å‚æ•°å¯¹åº”äºæˆ‘ä»¬ä¼ å…¥ <code>webContents.send</code> å‡½æ•°çš„ <code>1</code> æˆ– <code>-1</code>ï¼Œè¯¥å‡½æ•°æ˜¯ä»åŸç”Ÿèœå•è°ƒç”¨çš„ã€‚</p>
<p>åˆ°ç›®å‰çš„ä»£ç ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹çš„è¿›ç¨‹é€šä¿¡å°±å·²ç»å®ç°äº†ï¼Œæˆ‘ä»¬å¯ä»¥è¯•ä¸€è¯•æˆ‘ä»¬çš„UIç•Œé¢åŠŸèƒ½</p>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124161644112.png"></p>
<h5 id="æ€»ç»“ï¼š-2"><a href="#æ€»ç»“ï¼š-2" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h5><p>å¯¹äºä»ä¸»è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹çš„ IPCï¼Œæ²¡æœ‰ä¸ <code>ipcRenderer.invoke</code> ç­‰æ•ˆçš„ APIã€‚ ä¸è¿‡ï¼Œå¯ä»¥ä» <code>ipcRenderer.on</code> å›è°ƒä¸­å°†å›å¤å‘é€å›ä¸»è¿›ç¨‹ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å¯¹å‰é¢ä¾‹å­çš„ä»£ç è¿›è¡Œç•¥å¾®ä¿®æ”¹æ¥æ¼”ç¤ºè¿™ä¸€ç‚¹ã€‚ åœ¨æ¸²æŸ“å™¨è¿›ç¨‹ä¸­ï¼Œä½¿ç”¨ <code>event</code> å‚æ•°ï¼Œé€šè¿‡ <code>counter-value</code> é€šé“å°†å›å¤å‘é€å›ä¸»è¿›ç¨‹ã€‚</p>
<pre><code class="javascript">//app.js
const counter = document.getElementById(&#39;counter&#39;)
window.electronAPI.handleCounter((event, value) =&gt; &#123;
    const oldValue = Number(counter.innerText)
    const newValue = oldValue + value
    counter.innerText = newValue
    event.sender.send(&#39;counter-value&#39;, newValue)
&#125;)
</code></pre>
<p>åœ¨ä¸»è¿›ç¨‹ä¸­ï¼Œç›‘å¬ <code>counter-value</code> äº‹ä»¶å¹¶é€‚å½“åœ°å¤„ç†å®ƒä»¬ã€‚</p>
<pre><code class="javascript">//main.js
ipcMain.on(&#39;counter-value&#39;, (_event, value) =&gt; &#123;
      console.log(value) // will print value to Node console
  &#125;)
</code></pre>
<p><img src="/2022/11/24/Electron-d-1-0/image-20221124162116311.png"></p>
<h4 id="4-æ¸²æŸ“å™¨è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹"><a href="#4-æ¸²æŸ“å™¨è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹" class="headerlink" title="4.æ¸²æŸ“å™¨è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹"></a>4.æ¸²æŸ“å™¨è¿›ç¨‹åˆ°æ¸²æŸ“å™¨è¿›ç¨‹</h4><p>æ²¡æœ‰ç›´æ¥çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨ <code>ipcMain</code> å’Œ <code>ipcRenderer</code> æ¨¡å—åœ¨ Electron ä¸­çš„æ¸²æŸ“å™¨è¿›ç¨‹ä¹‹é—´å‘é€æ¶ˆæ¯ã€‚ ä¸ºæ­¤ï¼Œæœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<ul>
<li>å°†ä¸»è¿›ç¨‹ä½œä¸ºæ¸²æŸ“å™¨ä¹‹é—´çš„æ¶ˆæ¯ä»£ç†ã€‚ è¿™éœ€è¦å°†æ¶ˆæ¯ä»ä¸€ä¸ªæ¸²æŸ“å™¨å‘é€åˆ°ä¸»è¿›ç¨‹ï¼Œç„¶åä¸»è¿›ç¨‹å°†æ¶ˆæ¯è½¬å‘åˆ°å¦ä¸€ä¸ªæ¸²æŸ“å™¨ã€‚</li>
<li>ä»ä¸»è¿›ç¨‹å°†ä¸€ä¸ª MessagePort ä¼ é€’åˆ°ä¸¤ä¸ªæ¸²æŸ“å™¨ã€‚ è¿™å°†å…è®¸åœ¨åˆå§‹è®¾ç½®åæ¸²æŸ“å™¨ä¹‹é—´ç›´æ¥è¿›è¡Œé€šä¿¡ã€‚</li>
</ul>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[Electronå®˜ç½‘]: 	â€œ<a target="_blank" rel="noopener" href="https://www.electronjs.org/zh/docs/latest/tutorial/quick-start">https://www.electronjs.org/zh/docs/latest/tutorial/quick-start</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/electron/" rel="tag">electron</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-pinia"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/23/pinia/"
    >pinia</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/23/pinia/" class="article-date">
  <time datetime="2022-11-23T02:21:26.000Z" itemprop="datePublished">2022-11-23</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Electron/">Electron</a> / <a class="article-category-link" href="/categories/Electron/Pinia/">Pinia</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="pinia"><a href="#pinia" class="headerlink" title="pinia"></a>pinia</h1><h3 id="ä¸€ã€Vuex-ä¸-Pinia-æ ¸å¿ƒæ€æƒ³ä¸ç”¨æ³•"><a href="#ä¸€ã€Vuex-ä¸-Pinia-æ ¸å¿ƒæ€æƒ³ä¸ç”¨æ³•" class="headerlink" title="ä¸€ã€Vuex ä¸ Pinia æ ¸å¿ƒæ€æƒ³ä¸ç”¨æ³•"></a>ä¸€ã€Vuex ä¸ Pinia æ ¸å¿ƒæ€æƒ³ä¸ç”¨æ³•</h3><h4 id="Flux-æ¶æ„"><a href="#Flux-æ¶æ„" class="headerlink" title="Flux æ¶æ„"></a>Flux æ¶æ„</h4><p>Flux æ˜¯ Facebook åœ¨æ„å»ºå¤§å‹ Web åº”ç”¨ç¨‹åºæ—¶ä¸ºäº†è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜è€Œè®¾è®¡å‡ºçš„ä¸€ç§æ¶æ„ï¼Œå®ƒæ˜¯ä¸€ç§æè¿°çŠ¶æ€ç®¡ç†çš„è®¾è®¡æ¨¡å¼ã€‚ç»å¤§å¤šæ•°å‰ç«¯é¢†åŸŸçš„çŠ¶æ€ç®¡ç†å·¥å…·éƒ½éµå¾ªè¿™ç§æ¶æ„ï¼Œæˆ–è€…ä»¥å®ƒä¸ºå‚è€ƒåŸå‹ã€‚</p>
<p>Flux æ¶æ„ä¸»è¦æœ‰å››ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p>
<ul>
<li>ğŸ“¦ <strong>store</strong>ï¼šçŠ¶æ€æ•°æ®çš„å­˜å‚¨ç®¡ç†ä¸­å¿ƒï¼Œå¯ä»¥æœ‰å¤šä¸ªï¼Œå¯ä»¥æ¥å— action åšå‡ºå“åº”ã€‚</li>
<li>ğŸ–¼ <strong>view</strong>ï¼šè§†å›¾ï¼Œæ ¹æ® store ä¸­çš„æ•°æ®æ¸²æŸ“ç”Ÿæˆé¡µé¢ï¼Œä¸ store ä¹‹é—´å­˜åœ¨å‘å¸ƒè®¢é˜…å…³ç³»ã€‚</li>
<li>ğŸ›  <strong>action</strong>ï¼šä¸€ç§æè¿°åŠ¨ä½œè¡Œä¸ºçš„æ•°æ®å¯¹è±¡ï¼Œé€šå¸¸ä¼šåŒ…å«åŠ¨ä½œç±»å‹ type å’Œéœ€è¦ä¼ é€’çš„å‚æ•° payload ç­‰å±æ€§ã€‚</li>
<li>ğŸ“® <strong>dispatcher</strong>ï¼šè°ƒåº¦å™¨ï¼Œæ¥æ”¶ action å¹¶åˆ†å‘è‡³ storeã€‚</li>
</ul>
<p><img src="/2022/11/23/pinia/b55512a3f1be47b2.png"></p>
<p>æ•´ä¸ªæ•°æ®æµåŠ¨å…³ç³»ä¸ºï¼š</p>
<p>1ã€view è§†å›¾ä¸­çš„äº¤äº’è¡Œä¸ºä¼šåˆ›å»º actionï¼Œäº¤ç”± dispatcher è°ƒåº¦å™¨ã€‚</p>
<p>2ã€dispatcher æ¥æ”¶åˆ° action åä¼šåˆ†å‘è‡³å¯¹åº”çš„ storeã€‚</p>
<p>3ã€store æ¥æ”¶åˆ° action ååšå‡ºå“åº”åŠ¨ä½œï¼Œå¹¶è§¦å‘ change äº‹ä»¶ï¼Œé€šçŸ¥ä¸å…¶å…³è”çš„ view é‡æ–°æ¸²æŸ“å†…å®¹ã€‚</p>
<p>è¿™å°±æ˜¯ Flux æ¶æ„æœ€æ ¸å¿ƒçš„ç‰¹ç‚¹ï¼šå•å‘æ•°æ®æµã€‚</p>
<p>ä¸ä¼ ç»Ÿçš„ MVC æ¶æ„ç›¸æ¯”ï¼Œå•å‘æ•°æ®æµä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªå¥½å¤„ï¼šå¯é¢„æµ‹æ€§ã€‚</p>
<p>æ‰€æœ‰å¯¹äºçŠ¶æ€çš„ä¿®æ”¹éƒ½éœ€è¦ç»è¿‡ dispatcher æ´¾å‘çš„ action æ¥è§¦å‘çš„ï¼Œæ¯ä¸€ä¸ª action éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ•°æ®å¯¹è±¡å®ä½“ï¼Œå¯åºåˆ—åŒ–ï¼Œæ“ä½œè®°å½•å¯è¿½è¸ªï¼Œæ›´æ˜“äºè°ƒè¯•ã€‚</p>
<p>Vuex ä¸ Pinia å¤§ä½“ä¸Šæ²¿ç”¨ Flux çš„æ€æƒ³ï¼Œå¹¶é’ˆå¯¹ Vue æ¡†æ¶å•ç‹¬è¿›è¡Œäº†ä¸€äº›è®¾è®¡ä¸Šçš„ä¼˜åŒ–ã€‚</p>
<h4 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h4><p><img src="/2022/11/23/pinia/f9ae36a64955b220.png"></p>
<ul>
<li>ğŸ“¦ <strong>state</strong>ï¼šæ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ç®¡ç†å•ä¾‹ï¼Œç­‰æ•ˆäº Vue ç»„ä»¶ä¸­çš„ dataï¼Œå¯¹åº”äº† Flux æ¶æ„ä¸­çš„ storeã€‚</li>
<li>ğŸ§® <strong>getter</strong>ï¼šå¯ä»¥ç”± state ä¸­çš„æ•°æ®æ´¾ç”Ÿè€Œæˆï¼Œç­‰æ•ˆäº Vue ç»„ä»¶ä¸­çš„è®¡ç®—å±æ€§ã€‚å®ƒä¼šè‡ªåŠ¨æ”¶é›†ä¾èµ–ï¼Œä»¥å®ç°è®¡ç®—å±æ€§çš„ç¼“å­˜ã€‚</li>
<li>ğŸ›  <strong>mutation</strong>ï¼šç±»ä¼¼äºäº‹ä»¶ï¼ŒåŒ…å«ä¸€ä¸ªç±»å‹åå’Œå¯¹åº”çš„å›è°ƒå‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­å¯ä»¥å¯¹ state ä¸­çš„æ•°æ®è¿›è¡ŒåŒæ­¥ä¿®æ”¹ã€‚<ul>
<li>Vuex ä¸å…è®¸ç›´æ¥è°ƒç”¨è¯¥å‡½æ•°ï¼Œè€Œæ˜¯éœ€è¦é€šè¿‡ <code>store.commit</code> æ–¹æ³•æäº¤ä¸€ä¸ªæ“ä½œï¼Œå¹¶å°†å‚æ•°ä¼ å…¥å›è°ƒå‡½æ•°ã€‚</li>
<li>commit çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œæ­£å¦‚ Flux æ¶æ„ä¸­çš„ action å¯¹è±¡ä¸€æ ·ï¼Œå®ƒåŒ…å«äº†ç±»å‹å <code>type</code> å’Œè´Ÿè½½ <code>payload</code>ã€‚</li>
<li>è¿™é‡Œè¦æ±‚ mutation ä¸­å›è°ƒå‡½æ•°çš„æ“ä½œä¸€å®šæ˜¯åŒæ­¥çš„ï¼Œè¿™æ˜¯å› ä¸ºåŒæ­¥çš„ã€å¯åºåˆ—åŒ–çš„æ“ä½œæ­¥éª¤èƒ½ä¿è¯ç”Ÿæˆå”¯ä¸€çš„æ—¥å¿—è®°å½•ï¼Œæ‰èƒ½ä½¿å¾— devtools èƒ½å¤Ÿå®ç°å¯¹çŠ¶æ€çš„è¿½è¸ªï¼Œå®ç° time-travelã€‚</li>
</ul>
</li>
<li>ğŸ”¨ <strong>action</strong>ï¼šaction å†…éƒ¨çš„æ“ä½œä¸å—é™åˆ¶ï¼Œå¯ä»¥è¿›è¡Œä»»æ„çš„å¼‚æ­¥æ“ä½œã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡ <code>dispatch</code> æ–¹æ³•æ¥è§¦å‘ action æ“ä½œï¼ŒåŒæ ·çš„ï¼Œå‚æ•°åŒ…å«äº†ç±»å‹å <code>type</code> å’Œè´Ÿè½½ <code>payload</code>ã€‚<ul>
<li>action çš„æ“ä½œæœ¬è´¨ä¸Šå·²ç»è„±ç¦»äº† Vuex æœ¬èº«ï¼Œå‡å¦‚å°†å®ƒå‰¥ç¦»å‡ºæ¥ï¼Œä»…ä»…åœ¨ç”¨æˆ·ï¼ˆå¼€å‘è€…ï¼‰ä»£ç ä¸­è°ƒç”¨ <code>commit</code> æ¥æäº¤ mutation ä¹Ÿèƒ½è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœã€‚</li>
</ul>
</li>
<li>ğŸ“ <strong>module</strong>ï¼šstore çš„åˆ†å‰²ï¼Œæ¯ä¸ª module éƒ½å…·æœ‰ç‹¬ç«‹çš„ stateã€getterã€mutation å’Œ actionã€‚<ul>
<li>å¯ä»¥ä½¿ç”¨ <code>module.registerModule</code> åŠ¨æ€æ³¨å†Œæ¨¡å—ã€‚</li>
<li>æ”¯æŒæ¨¡å—ç›¸äº’åµŒå¥—ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®å‘½åç©ºé—´æ¥è¿›è¡Œæ•°æ®å’Œæ“ä½œéš”ç¦»ã€‚</li>
</ul>
</li>
</ul>
<h4 id="Pinia"><a href="#Pinia" class="headerlink" title="Pinia"></a>Pinia</h4><p><img src="/2022/11/23/pinia/image-20221123084525884.png"></p>
<p>ä¿ç•™ï¼š</p>
<ul>
<li>ğŸ“¦ <strong>state</strong>ï¼šstore çš„æ ¸å¿ƒï¼Œä¸ Vue ä¸­çš„ data ä¸€è‡´ï¼Œå¯ä»¥ç›´æ¥å¯¹å…¶ä¸­çš„æ•°æ®è¿›è¡Œè¯»å†™ã€‚</li>
<li>ğŸ§® <strong>getters</strong>ï¼šä¸ Vue ä¸­çš„è®¡ç®—å±æ€§ç›¸åŒï¼Œæ”¯æŒç¼“å­˜ã€‚</li>
<li>ğŸ”¨ <strong>actions</strong>ï¼šæ“ä½œä¸å—é™åˆ¶ï¼Œå¯ä»¥åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ï¼Œå¯ä»¥ç›´æ¥è¢«è°ƒç”¨ï¼Œä¸å†éœ€è¦ commitã€dispatch ç­‰æ–¹æ³•ã€‚</li>
</ul>
<p>èˆå¼ƒï¼š</p>
<ul>
<li>ğŸ›  <strong>mutation</strong>ï¼šPinia å¹¶éå®Œå…¨æŠ›å¼ƒäº† mutationï¼Œè€Œæ˜¯å°†å¯¹ state ä¸­å•ä¸ªæ•°æ®è¿›è¡Œä¿®æ”¹çš„æ“ä½œå°è£…ä¸ºä¸€ä¸ª mutationï¼Œä½†ä¸å¯¹å¤–å¼€æ”¾æ¥å£ã€‚å¯ä»¥åœ¨ devtools ä¸­è§‚å¯Ÿåˆ° mutationã€‚</li>
<li>ğŸ“ <strong>module</strong>ï¼šPinia é€šè¿‡åœ¨åˆ›å»º store æ—¶æŒ‡å®š name æ¥åŒºåˆ†ä¸åŒçš„ storeï¼Œä¸å†éœ€è¦ moduleã€‚</li>
</ul>
<h3 id="äºŒã€ä½¿ç”¨Pinia"><a href="#äºŒã€ä½¿ç”¨Pinia" class="headerlink" title="äºŒã€ä½¿ç”¨Pinia"></a>äºŒã€ä½¿ç”¨Pinia</h3><h4 id="1-å®‰è£…pinia"><a href="#1-å®‰è£…pinia" class="headerlink" title="1.å®‰è£…pinia"></a>1.å®‰è£…pinia</h4><pre><code class="ini">npm i pinia -S //å®‰è£…piniaä¾èµ–
</code></pre>
<h4 id="2-main-jsç»„å†Œ"><a href="#2-main-jsç»„å†Œ" class="headerlink" title="2.main.jsç»„å†Œ"></a>2.main.jsç»„å†Œ</h4><pre><code class="javascript">//main.js
import &#123; createApp &#125; from &#39;vue&#39;
import &#39;./style.css&#39;
import App from &#39;./App.vue&#39;
import &#123; createPinia &#125; from &#39;pinia&#39;

createApp(App)
.use(createPinia())
.mount(&#39;#app&#39;)
</code></pre>
<h4 id="3-åˆ›å»ºstore"><a href="#3-åˆ›å»ºstore" class="headerlink" title="3.åˆ›å»ºstore"></a>3.åˆ›å»ºstore</h4><p><img src="/2022/11/23/pinia/image-20221123090656211.png"></p>
<pre><code class="javascript">//countStore.js
import &#123; defineStore &#125; from &#39;pinia&#39;
const useCountStore = defineStore(&#39;countStore&#39;,&#123;
    state()&#123;
        return &#123;
            count:0
        &#125;
    &#125;
&#125; )
export default useCountStore; //å¯¼å‡º
</code></pre>
<h4 id="4-æ–°å»ºç»„ä»¶ä½¿ç”¨state"><a href="#4-æ–°å»ºç»„ä»¶ä½¿ç”¨state" class="headerlink" title="4.æ–°å»ºç»„ä»¶ä½¿ç”¨state"></a>4.æ–°å»ºç»„ä»¶ä½¿ç”¨state</h4><pre><code class="vue">//components/Count.vue
&lt;script setup&gt;
import useCountStore from &#39;../store/countStore&#39;
const countStore = useCountStore();
console.log(countStore)
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
    &#123;&#123;countStore.count&#125;&#125;
  &lt;/div&gt;
&lt;/template&gt;
&lt;style lang=&quot;css&quot;&gt;
div&#123;
    width: 100px;
    height: 30px;
    border:1px solid black;
    border-radius: 5px;
&#125;
&lt;/style&gt;
</code></pre>
<pre><code class="vue">//App.vue
&lt;script setup&gt;
// This starter template is using Vue 3 &lt;script setup&gt; SFCs
// Check out https://vuejs.org/api/sfc-script-setup.html#script-setup
import Count from &#39;./components/Count.vue&#39;
&lt;/script&gt;

&lt;template&gt;
  &lt;div&gt;
    &lt;Count/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style scoped&gt;
.logo &#123;
  height: 6em;
  padding: 1.5em;
  will-change: filter;
&#125;
.logo:hover &#123;
  filter: drop-shadow(0 0 2em #646cffaa);
&#125;
.logo.vue:hover &#123;
  filter: drop-shadow(0 0 2em #42b883aa);
&#125;
&lt;/style&gt;
</code></pre>
<p><img src="/2022/11/23/pinia/image-20221123091224524.png" alt="countStore"></p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å°±å¯ä»¥äº†ï¼Œæ ¹æ®ä¸Šé¢æ§åˆ¶å°è¾“å‡ºå¯ä»¥çœ‹æ¸…æ¥šcountStore</p>
<p>åˆ°ç°åœ¨å·²ç»å®ç°äº†åˆ›å»ºstoreåŠä½¿ç”¨</p>
<h4 id="5-æ›´æ–°store"><a href="#5-æ›´æ–°store" class="headerlink" title="5.æ›´æ–°store"></a>5.æ›´æ–°store</h4><p>1.æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªactionæ–¹æ³•</p>
<pre><code class="javascript">//countStore.js
import &#123; defineStore &#125; from &#39;pinia&#39;

const useCountStore = defineStore(&#39;countStore&#39;,&#123;
    //å®šä¹‰state
    state()&#123;
        return &#123;
            count:0
        &#125;
    &#125;,
    //å®šä¹‰actionæ–¹æ³•
    actions:&#123;
        add()&#123;
            this.count++
        &#125;
    &#125;
&#125; )

export default useCountStore;
</code></pre>
<p>2.è§£æ„æ–¹æ³•å’Œstate</p>
<pre><code class="vue">//Count.vue
&lt;script setup&gt;
import &#123; storeToRefs &#125; from &#39;pinia&#39;
import useCountStore from &#39;../store/countStore&#39;
const &#123;count,add&#125; = storeToRefs(useCountStore());
&lt;/script&gt;
&lt;template&gt;
  &lt;div&gt;
    &#123;&#123;count&#125;&#125;
  &lt;/div&gt;
  &lt;button @click=&quot;add()&quot;&gt;Add&lt;/button&gt;
&lt;/template&gt;
&lt;style lang=&quot;css&quot;&gt;
div&#123;
    width: 100px;
    height: 30px;
    border:1px solid black;
    border-radius: 5px;
    text-align: center;
&#125;
button&#123;
    position: relative;
    bottom: -30px;
&#125;
&lt;/style&gt; 
</code></pre>
<p>å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ storeToRefs æ¥è½¬å‘ï¼Œé‚£ä¹ˆé¡µé¢å°†ä¸ä¼šæœ‰ä»»ä½•å“åº”</p>
<p>ä½†æ˜¯æˆ‘ä»¬åŒ…è£¹äº†useCountStore()å¹¶ä¸”è§£æ„äº†ï¼Œå‘ç°æ§åˆ¶å°è¾“å‡ºé”™è¯¯error</p>
<p><img src="/2022/11/23/pinia/image-20221123094109387.png"></p>
<p>ç»è¿‡ä¿®æ”¹å‘ç°ï¼Œactionsæ–¹æ³•ä¸å¯ä»¥é€šè¿‡è§£æ„æ¥ä½¿ç”¨ï¼Œåªèƒ½é€šè¿‡å¦ä¸€ç§æ–¹æ³•</p>
<p><img src="/2022/11/23/pinia/image-20221123094416363.png"> </p>
<h3 id="å‚è€ƒæ–‡æ¡£ï¼š"><a href="#å‚è€ƒæ–‡æ¡£ï¼š" class="headerlink" title="å‚è€ƒæ–‡æ¡£ï¼š"></a>å‚è€ƒæ–‡æ¡£ï¼š</h3><p>[Piniaä¸­æ–‡æ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://pinia.web3doc.top/">https://pinia.web3doc.top/</a> â€œ<br>[Viteä¸­æ–‡æ–‡æ¡£]: 	â€œ<a target="_blank" rel="noopener" href="https://vitejs.cn/">https://vitejs.cn/</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pinia/" rel="tag">Pinia</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-viteé…ç½®"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/22/vite%E9%85%8D%E7%BD%AE/"
    >viteé…ç½®</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/22/vite%E9%85%8D%E7%BD%AE/" class="article-date">
  <time datetime="2022-11-22T01:50:43.000Z" itemprop="datePublished">2022-11-22</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/">å·¥ç¨‹æŠ€æœ¯</a> / <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/vite%E9%85%8D%E7%BD%AE/">viteé…ç½®</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="viteé…ç½®"><a href="#viteé…ç½®" class="headerlink" title="viteé…ç½®"></a>viteé…ç½®</h1><p>æœ€ç›´è§‚çš„ä½“éªŒæ˜¯â€œå¿«é€Ÿâ€ã€â€œæ¸…çˆ½â€ï¼Œå¼€å‘æ•ˆç‡ä¹Ÿå¾—åˆ°æ˜æ˜¾æå‡ï¼ˆè§£å†³æ‰äº†webpackå¼€å‘æœåŠ¡å™¨å­˜åœ¨çš„ç—›ç‚¹ï¼‰ã€‚</p>
<p>åˆå§‹åŒ–å®Œæˆåï¼Œå·¥ç¨‹ç›®å½•å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/11/22/vite%E9%85%8D%E7%BD%AE/image-20221122094453903.png"></p>
<p>VS Codeæ’ä»¶ï¼šVite</p>
<p>é…ç½®è¯¦æƒ…ï¼š</p>
<p>vite.config.ts</p>
<pre><code class="javascript">import &#123; defineConfig, loadEnv &#125; from &#39;vite&#39;;
import vue from &#39;@vitejs/plugin-vue&#39;;
import vueJSX from &#39;@vitejs/plugin-vue-jsx&#39;;
import Components from &#39;unplugin-vue-components/vite&#39;;
import &#123; AntDesignVueResolver &#125; from &#39;unplugin-vue-components/resolvers&#39;;
import &#123; resolve &#125; from &#39;path&#39;;
import &#123; initDevProxy &#125; from &#39;./http-proxy&#39;;

// https://vitejs.dev/config/
export default defineConfig((&#123; mode &#125;) =&gt; &#123;
  const env = loadEnv(mode, process.cwd(), &#39;&#39;);
  return &#123;
    // è‡ªå®šä¹‰å…¬å…±åŸºç¡€è·¯å¾„ï¼ˆå–è‡ª .env(.*) æ–‡ä»¶ï¼‰
    base: env.VITE_BASE_PATH,
    // å®šä¹‰å…¨å±€å¸¸é‡æ›¿æ¢æ–¹å¼
    define: &#123;
      // å–æ¶ˆå¯ç”¨Vue.2xä¸­é€‰é¡¹å¼apiï¼ˆè¿™éƒ¨åˆ†ä¸ä¼šè¢«æ‰“åŒ…ï¼‰
      &#39;__VUE_OPTIONS_API__&#39;: false,
    &#125;,
    // é…ç½®viteæ’ä»¶
    plugins: [
      vue(),
      vueJSX(),
      // è‡ªåŠ¨åŒ–çš„ç»„ä»¶æŒ‰éœ€å¼•å…¥é…ç½®
      Components(&#123;
        extensions: [&#39;vue&#39;, &#39;tsx&#39;],
        resolvers: [
          AntDesignVueResolver(&#123; resolveIcons: true &#125;),
        ],
        include: [/\.vue$/, /\.vue\?vue/, /\.tsx$/],
      &#125;),
    ],
    // é…ç½®è§£æé¡¹
    resolve: &#123;
      // è·¯å¾„åˆ«å
      alias: &#123;
        &#39;@/&#39;: resolve(__dirname, &#39;src&#39;) + &#39;/&#39;,
      &#125;,
    &#125;,
    // æ ·å¼å¤„ç†é…ç½®é¡¹
    css: &#123;
      // CSS module
      modules: &#123;
        generateScopedName: `_[name]_[local]_[hash:base64:6]_`,
      &#125;,
      // ä¼ é€’ç»™ç‰¹å®šcssæ ·å¼é¢„å¤„ç†å™¨çš„é…ç½®
      preprocessorOptions: &#123;
        less: &#123;
          javascriptEnabled: true,
        &#125;,
      &#125;,
    &#125;,
    // é…ç½®å¼€å‘æœåŠ¡å™¨
    server: &#123;
      open: true,
      proxy: initDevProxy(),
    &#125;,
    // è‡ªå®šä¹‰æ‰“åŒ…é¡¹é…ç½®
    build: &#123;
      // å¤§æ–‡ä»¶å‘Šè­¦é˜ˆå€¼(kb)
      chunkSizeWarningLimit: 400,
    &#125;,
  &#125;;
&#125;);
</code></pre>
<p>http-proxy.ts</p>
<pre><code class="javascript">import type &#123; ProxyOptions &#125; from &#39;vite&#39;;

/**
 * åˆå§‹åŒ–å¼€å‘æœåŠ¡å™¨ä»£ç†
 */
export const initDevProxy = (): Record&lt;string, string | ProxyOptions&gt; =&gt; &#123;
  return &#123;
    // ä¸´æ—¶ç¤ºä¾‹
    &#39;/api&#39;: &#123;
      target: &#39;&#39;,
      changeOrigin: true,
    &#125;,
  &#125;;
&#125;;
</code></pre>
<p>ä»¥ä¸Šçš„é…ç½®æ˜¯é¡¹ç›®é…ç½®çš„ä¸€éƒ¨åˆ†ï¼Œå…¶ä»–æ‰€éœ€è¦çš„é…ç½®æŒ‰ç…§è‡ªå·±çš„éœ€è¦å»å®˜ç½‘æŸ¥è¯¢å°±å¯ä»¥ï¼Œå®˜ç½‘åŸºäºæ²¡ä¸ªé…ç½®éƒ½æœ‰è¯¦ç»†è®²è§£ã€‚</p>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[Viteä¸­æ–‡å®˜ç½‘]: 	â€œ<a target="_blank" rel="noopener" href="https://cn.vitejs.dev/guide/">https://cn.vitejs.dev/guide/</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vite/" rel="tag">vite</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Vite-Vue3-Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/21/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%932/"
    >Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/21/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%932/" class="article-date">
  <time datetime="2022-11-21T06:40:38.000Z" itemprop="datePublished">2022-11-21</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/">å·¥ç¨‹æŠ€æœ¯</a> / <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%932/">Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Vite-Vue3-Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2"><a href="#Vite-Vue3-Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2" class="headerlink" title="Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2"></a>Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“2</h1><p>æœ¬æ–‡ç« åªä¾›å‚è€ƒï¼Œå…·ä½“å®ç°å¯èƒ½ä¼šæœ‰å‡ºå…¥ï¼ˆä¼šå°½å¿«å®Œå–„ï¼‰</p>
<h3 id="ä¸€ã€viteæ‰“åŒ…"><a href="#ä¸€ã€viteæ‰“åŒ…" class="headerlink" title="ä¸€ã€viteæ‰“åŒ…"></a>ä¸€ã€viteæ‰“åŒ…</h3><p>ä¸Šä¸€ç¯‡æœ«å°¾çš„æ‰“åŒ…è¿˜æ˜¯æœ‰ç¼ºé™·çš„ï¼Œæ‰“åŒ…çš„ç»„ä»¶åº“åªèƒ½ç»™jsé¡¹ç›®ä½¿ç”¨,åœ¨tsé¡¹ç›®ä¸‹è¿è¡Œä¼šå‡ºç°ä¸€äº›é”™è¯¯ï¼Œè€Œä¸”ä½¿ç”¨çš„æ—¶å€™è¿˜ä¼šå¤±å»ä»£ç æç¤ºåŠŸèƒ½ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±å¤±å»äº†ç”¨tså¼€å‘ç»„ä»¶åº“çš„æ„ä¹‰äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ‰“åŒ…çš„åº“é‡ŒåŠ å…¥å£°æ˜æ–‡ä»¶(.d.ts)ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•å‘æ‰“åŒ…åçš„åº“é‡ŒåŠ å…¥å£°æ˜æ–‡ä»¶å‘¢ï¼Ÿ å…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦å¼•å…¥ vite-plugin-dts</p>
<pre><code class="css">pnpm i vite-plugin-dts -D -w
</code></pre>
<p>å¦‚æœpnpmå‘½ä»¤ä¸€ç›´errorï¼Œç”¨å…¶ä»–å‘½ä»¤ä¸‹è½½å®‰è£…ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼ˆä¸‹è½½åˆ°æ ¹ç›®å½•ï¼‰</p>
<p>ç„¶åä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„vite.config.tså¼•å…¥è¿™ä¸ªæ’ä»¶</p>
<pre><code class="javascript">//components/vite.config.ts
import &#123; defineConfig &#125; from &quot;vite&quot;;
import vue from &quot;@vitejs/plugin-vue&quot;
import dts from &#39;vite-plugin-dts&#39;

export default defineConfig(
    &#123;
        build: &#123;...&#125;,
        plugins: [
            vue(),
            dts(&#123;
                //æŒ‡å®šä½¿ç”¨çš„tsconfig.jsonä¸ºæˆ‘ä»¬æ•´ä¸ªé¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰,å¦‚æœä¸é…ç½®,ä½ ä¹Ÿå¯ä»¥åœ¨componentsä¸‹æ–°å»ºtsconfig.json
                tsConfigFilePath: &#39;../../tsconfig.json&#39;
            &#125;),
            //å› ä¸ºè¿™ä¸ªæ’ä»¶é»˜è®¤æ‰“åŒ…åˆ°esä¸‹ï¼Œæˆ‘ä»¬æƒ³è®©libç›®å½•ä¸‹ä¹Ÿç”Ÿæˆå£°æ˜æ–‡ä»¶éœ€è¦å†é…ç½®ä¸€ä¸ª
            dts(&#123;
                outputDir:&#39;lib&#39;,
                tsConfigFilePath: &#39;../../tsconfig.json&#39;
            &#125;)

        ]
    &#125;
)
</code></pre>
<p>æ‰§è¡Œpnpm run buildä½ å°±ä¼šå‘ç°ä½ çš„eså’Œlibä¸‹å°±æœ‰äº†å£°æ˜æ–‡ä»¶</p>
<h3 id="äºŒã€ç»„ä»¶æ ·å¼"><a href="#äºŒã€ç»„ä»¶æ ·å¼" class="headerlink" title="äºŒã€ç»„ä»¶æ ·å¼"></a>äºŒã€ç»„ä»¶æ ·å¼</h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åšçš„æ˜¯å°†lessæ‰“åŒ…æˆcssç„¶åæ”¾åˆ°æ‰“åŒ…åå¯¹åº”çš„æ–‡ä»¶ç›®å½•ä¸‹,æˆ‘ä»¬åœ¨componentsä¸‹æ–°å»ºbuildæ–‡ä»¶å¤¹æ¥å­˜æ”¾æˆ‘ä»¬çš„ä¸€äº›æ‰“åŒ…å·¥å…·,ç„¶åæ–°å»ºbuildLess.ts,é¦–å…ˆæˆ‘ä»¬éœ€è¦å…ˆå®‰è£…ä¸€äº›å·¥å…·cpyå’Œfast-glob</p>
<pre><code class="css">pnpm i cpy fast-glob -D -w
</code></pre>
<p>å®ƒå¯ä»¥ç›´æ¥å¤åˆ¶æˆ‘ä»¬è§„å®šçš„æ–‡ä»¶å¹¶å°†æˆ‘ä»¬çš„æ–‡ä»¶copyåˆ°æŒ‡å®šç›®å½•,æ¯”å¦‚buildLess.ts:</p>
<pre><code class="javascript">//build/buildLess.ts
import cpy from &#39;cpy&#39;
import &#123; resolve &#125; from &#39;path&#39;

const sourceDir = resolve(__dirname, &#39;../src&#39;)
//libæ–‡ä»¶
const targetLib = resolve(__dirname, &#39;../lib&#39;)
//esæ–‡ä»¶
const targetEs = resolve(__dirname, &#39;../es&#39;)
console.log(sourceDir);
const buildLess = async () =&gt; &#123;
    await cpy(`$&#123;sourceDir&#125;/**/*.less`, targetLib)
    await cpy(`$&#123;sourceDir&#125;/**/*.less`, targetEs)
&#125;
buildLess()
</code></pre>
<p>ç„¶ååœ¨package.jsonä¸­æ–°å¢å‘½ä»¤</p>
<pre><code class="erlang">...
&quot;scripts&quot;: &#123;
    &quot;build&quot;: &quot;vite build&quot;,
    &quot;build:less&quot;: &quot;esno build/buildLess&quot;
  &#125;,
...
</code></pre>
<p>ç»ˆç«¯æ‰§è¡Œ pnpm run build:less ä½ å°±ä¼šå‘ç°libå’Œesæ–‡ä»¶å¯¹åº”ç›®å½•ä¸‹å°±å‡ºç°äº†lessæ–‡ä»¶.(å¦‚æœerrorï¼Œåˆ‡æ¢nodeç‰ˆæœ¬)</p>
<p>ä½†æ˜¯æˆ‘ä»¬æœ€ç»ˆè¦çš„å¹¶ä¸æ˜¯lessæ–‡ä»¶è€Œæ˜¯cssæ–‡ä»¶,æ‰€ä»¥æˆ‘ä»¬è¦å°†lessæ‰“åŒ…æˆcss,æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨çš„lessæ¨¡å—.åœ¨tsä¸­å¼•å…¥lesså› ä¸ºå®ƒæœ¬èº«æ²¡æœ‰å£°æ˜æ–‡ä»¶æ‰€ä»¥ä¼šå‡ºç°ç±»å‹é”™è¯¯,æ‰€ä»¥æˆ‘ä»¬è¦å…ˆå®‰è£…å®ƒçš„ @types&#x2F;less</p>
<pre><code class="css">pnpm i --save-dev @types/less -D -w
</code></pre>
<p>buildLess.tså¦‚ä¸‹(è¯¦ç»†æ³¨é‡Šéƒ½åœ¨ä»£ç ä¸­)</p>
<pre><code class="javascript">import cpy from &#39;cpy&#39;
import &#123; resolve &#125; from &#39;path&#39;
import &#123; promises as fs &#125; from &quot;fs&quot;
import less from &quot;less&quot;
import glob from &quot;fast-glob&quot;
const sourceDir = resolve(__dirname, &#39;../src&#39;)
//libæ–‡ä»¶ç›®å½•
const targetLib = resolve(__dirname, &#39;../lib&#39;)
//esæ–‡ä»¶ç›®å½•
const targetEs = resolve(__dirname, &#39;../es&#39;)



const buildLess = async () =&gt; &#123;
    //ç›´æ¥å°†lessæ–‡ä»¶å¤åˆ¶åˆ°æ‰“åŒ…åç›®å½•
    await cpy(`$&#123;sourceDir&#125;/**/*.less`, targetLib)
    await cpy(`$&#123;sourceDir&#125;/**/*.less`, targetEs)

    //è·å–æ‰“åŒ…å.lessæ–‡ä»¶ç›®å½•(libå’Œesä¸€æ ·)
    const lessFils = await glob(&quot;**/*.less&quot;, &#123; cwd: targetLib, onlyFiles: true &#125;)

    //éå†å«æœ‰lessçš„ç›®å½•
    for (let path in lessFils) &#123;
        const lessPathLib = `$&#123;targetLib&#125;/$&#123;lessFils[path]&#125;`
        const lessPathEs = `$&#123;targetEs&#125;/$&#123;lessFils[path]&#125;`

        //è·å–lessæ–‡ä»¶å­—ç¬¦ä¸²
        const lessCode = await fs.readFile(lessPathLib, &#39;utf-8&#39;)
        //å°†lessè§£ææˆcss
        const code = await less.render(lessCode)

        //æ‹¿åˆ°.cssåç¼€path
        const cssPathLib = lessPathLib.replace(&#39;.less&#39;, &#39;.css&#39;)
        const cssPathEs = lessPathEs.replace(&#39;.less&#39;, &#39;.css&#39;)

        //å°†csså†™å…¥å¯¹åº”ç›®å½•
        await fs.writeFile(cssPathLib, code.css)
        await fs.writeFile(cssPathEs, code.css)
    &#125;



&#125;
buildLess()
</code></pre>
<p>æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ä¹‹åä½ ä¼šå‘ç°å¯¹åº”æ–‡ä»¶å¤¹ä¸‹å¤šäº†.cssæ–‡ä»¶</p>
<p><img src="/2022/11/21/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%932/image-20221121092003205.png"></p>
<p>ç°åœ¨æˆ‘å·²ç»å°†cssæ–‡ä»¶æ”¾å…¥å¯¹åº”çš„ç›®å½•ä¸‹äº†,ä½†æ˜¯æˆ‘ä»¬çš„ç›¸å…³ç»„ä»¶å¹¶æ²¡æœ‰å¼•å…¥è¿™ä¸ªcssæ–‡ä»¶;æ‰€ä»¥æˆ‘ä»¬éœ€è¦çš„æ˜¯æ¯ä¸ªæ‰“åŒ…åç»„ä»¶çš„index.jsä¸­å‡ºç°å¦‚:</p>
<pre><code class="cpp">import &quot;xxx/xxx.css&quot;
</code></pre>
<p>ä¹‹ç±»çš„ä»£ç æˆ‘ä»¬çš„cssæ‰ä¼šç”Ÿæ•ˆ;æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹vite.config.tsè¿›è¡Œç›¸å…³é…ç½®</p>
<p>é¦–å…ˆæˆ‘ä»¬å…ˆå°†.lessæ–‡ä»¶å¿½ç•¥external: [â€˜vueâ€™, &#x2F;.less&#x2F;],è¿™æ—¶å€™æ‰“åŒ…åçš„æ–‡ä»¶ä¸­å¦‚button&#x2F;index.jså°±ä¼šå‡ºç°</p>
<pre><code class="cpp">import &quot;./style/index.less&quot;;
</code></pre>
<p>ç„¶åæˆ‘ä»¬å†å°†æ‰“åŒ…åä»£ç çš„.lessæ¢æˆ.csså°±å¤§åŠŸå‘Šæˆäº†</p>
<pre><code class="typescript">...
plugins: [
            ...

            &#123;
                name: &#39;style&#39;,
                generateBundle(config, bundle) &#123;
                    //è¿™é‡Œå¯ä»¥è·å–æ‰“åŒ…åçš„æ–‡ä»¶ç›®å½•ä»¥åŠä»£ç code
                    const keys = Object.keys(bundle)

                    for (const key of keys) &#123;
                        const bundler: any = bundle[key as any]
                        //rollupå†…ç½®æ–¹æ³•,å°†æ‰€æœ‰è¾“å‡ºæ–‡ä»¶codeä¸­çš„.lessæ¢æˆ.css,å› ä¸ºæˆ‘ä»¬å½“æ—¶æ²¡æœ‰æ‰“åŒ…lessæ–‡ä»¶

                        this.emitFile(&#123;
                            type: &#39;asset&#39;,
                            fileName: key,//æ–‡ä»¶ååä¸å˜
                            source: bundler.code.replace(/\.less/g, &#39;.css&#39;)
                        &#125;)
                    &#125;
                &#125;
            &#125;
        ...
        ]
...
</code></pre>
<p>æˆ‘ä»¬æœ€ç»ˆçš„vite.config.tså¦‚ä¸‹</p>
<pre><code class="typescript">import &#123; defineConfig &#125; from &quot;vite&quot;;
import vue from &quot;@vitejs/plugin-vue&quot;
import dts from &#39;vite-plugin-dts&#39;

export default defineConfig(
    &#123;
        build: &#123;
            target: &#39;modules&#39;,
            //æ‰“åŒ…æ–‡ä»¶ç›®å½•
            outDir: &quot;es&quot;,
            //å‹ç¼©
            minify: false,
            //cssåˆ†ç¦»
            //cssCodeSplit: true,
            rollupOptions: &#123;
                //å¿½ç•¥æ‰“åŒ…vueå’Œ.lessæ–‡ä»¶
                external: [&#39;vue&#39;, /\.less/],
                input: [&#39;src/index.ts&#39;],
                output: [
                    &#123;
                        format: &#39;es&#39;,
                        //ä¸ç”¨æ‰“åŒ…æˆ.es.js,è¿™é‡Œæˆ‘ä»¬æƒ³æŠŠå®ƒæ‰“åŒ…æˆ.js
                        entryFileNames: &#39;[name].js&#39;,
                        //è®©æ‰“åŒ…ç›®å½•å’Œæˆ‘ä»¬ç›®å½•å¯¹åº”
                        preserveModules: true,
                        //é…ç½®æ‰“åŒ…æ ¹ç›®å½•
                        dir: &#39;es&#39;,
                        preserveModulesRoot: &#39;src&#39;
                    &#125;,
                    &#123;
                        format: &#39;cjs&#39;,
                        //ä¸ç”¨æ‰“åŒ…æˆ.mjs
                        entryFileNames: &#39;[name].js&#39;,
                        //è®©æ‰“åŒ…ç›®å½•å’Œæˆ‘ä»¬ç›®å½•å¯¹åº”
                        preserveModules: true,
                        //é…ç½®æ‰“åŒ…æ ¹ç›®å½•
                        dir: &#39;lib&#39;,
                        preserveModulesRoot: &#39;src&#39;
                    &#125;
                ]
            &#125;,
            lib: &#123;
                entry: &#39;./index.ts&#39;,
                formats: [&#39;es&#39;, &#39;cjs&#39;]
            &#125;
        &#125;,




        plugins: [
            vue(),
            dts(&#123;
                //æŒ‡å®šä½¿ç”¨çš„tsconfig.jsonä¸ºæˆ‘ä»¬æ•´ä¸ªé¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰,å¦‚æœä¸é…ç½®,ä½ ä¹Ÿå¯ä»¥åœ¨componentsä¸‹æ–°å»ºtsconfig.json
                tsConfigFilePath: &#39;../../tsconfig.json&#39;
            &#125;),
            //å› ä¸ºè¿™ä¸ªæ’ä»¶é»˜è®¤æ‰“åŒ…åˆ°esä¸‹ï¼Œæˆ‘ä»¬æƒ³è®©libç›®å½•ä¸‹ä¹Ÿç”Ÿæˆå£°æ˜æ–‡ä»¶éœ€è¦å†é…ç½®ä¸€ä¸ª
            dts(&#123;
                outputDir: &#39;lib&#39;,
                tsConfigFilePath: &#39;../../tsconfig.json&#39;
            &#125;),

            &#123;
                name: &#39;style&#39;,
                generateBundle(config, bundle) &#123;
                    //è¿™é‡Œå¯ä»¥è·å–æ‰“åŒ…åçš„æ–‡ä»¶ç›®å½•ä»¥åŠä»£ç code
                    const keys = Object.keys(bundle)

                    for (const key of keys) &#123;
                        const bundler: any = bundle[key as any]
                        //rollupå†…ç½®æ–¹æ³•,å°†æ‰€æœ‰è¾“å‡ºæ–‡ä»¶codeä¸­çš„.lessæ¢æˆ.css,å› ä¸ºæˆ‘ä»¬å½“æ—¶æ²¡æœ‰æ‰“åŒ…lessæ–‡ä»¶

                        this.emitFile(&#123;
                            type: &#39;asset&#39;,
                            fileName: key,//æ–‡ä»¶ååä¸å˜
                            source: bundler.code.replace(/\.less/g, &#39;.css&#39;)
                        &#125;)
                    &#125;
                &#125;
            &#125;

        ]
    &#125;
)
</code></pre>
<p>æœ€åæˆ‘ä»¬å°†æ‰“åŒ…lessä¸æ‰“åŒ…ç»„ä»¶åˆæˆä¸€ä¸ªå‘½ä»¤(package.json):</p>
<pre><code class="erlang">...
&quot;scripts&quot;: &#123;
     &quot;build&quot;:&quot;vite build&quot;,
    &quot;build:less&quot;: &quot;esno build/buildLess&quot;
  &#125;,
...
</code></pre>
<p>åç»­ç›´æ¥æ‰§è¡Œpnpm run build å³å¯å®Œæˆæ‰€æœ‰æ‰“åŒ…å•¦</p>
<h3 id="ä¸‰ã€å¼•ç”¨uiåŒ…"><a href="#ä¸‰ã€å¼•ç”¨uiåŒ…" class="headerlink" title="ä¸‰ã€å¼•ç”¨uiåŒ…"></a>ä¸‰ã€å¼•ç”¨uiåŒ…</h3><p>åšäº†é‚£ä¹ˆå¤šç»ˆäºåˆ°å‘å¸ƒçš„é˜¶æ®µäº†ï¼›å…¶å®npmå‘åŒ…æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œå°±æ‹¿æˆ‘ä»¬çš„ç»„ä»¶alanmfä¸¾ä¾‹å§</p>
<p>å‘å¸ƒä¹‹å‰è®°å¾—åˆ°<a target="_blank" rel="noopener" href="https://www.npmjs.com/">npm</a>å®˜ç½‘æ³¨å†Œä¸ªè´¦æˆ·,å¦‚æœä½ è¦å‘å¸ƒ@xx&#x2F;xxè¿™ç§åŒ…çš„è¯éœ€è¦åœ¨npmæ–°å»ºä¸ªç»„ç»‡ç»„ç»‡ç»„ç»‡åå°±æ˜¯@åé¢çš„ï¼Œæ¯”å¦‚æˆ‘å»ºçš„ç»„ç»‡å°±æ˜¯kitty-ui,æ³¨å†Œå®Œä¹‹åä½ å°±å¯ä»¥å‘å¸ƒäº†</p>
<p>é¦–å…ˆè¦å°†æˆ‘ä»¬ä»£ç æäº¤åˆ°gitä»“åº“ï¼Œä¸ç„¶pnpmå‘å¸ƒæ— æ³•é€šè¿‡ï¼Œåé¢æ¯æ¬¡å‘ç‰ˆè®°å¾—åœ¨å¯¹åº”åŒ…ä¸‹æ‰§è¡Œ <strong>pnpm version patch</strong>ä½ å°±ä¼šå‘ç°è¿™ä¸ªåŒ…çš„ç‰ˆæœ¬å·patch(ç‰ˆæœ¬å·ç¬¬ä¸‰ä¸ªæ•°) +1 äº†</p>
<p>å¦‚æœä½ å‘å¸ƒçš„æ˜¯å…¬å…±åŒ…çš„è¯ï¼Œåœ¨å¯¹åº”åŒ…ä¸‹æ‰§è¡Œ</p>
<pre><code class="cpp">pnpm publish --access public
</code></pre>
<p>è¾“å…¥ä½ çš„è´¦æˆ·å’Œå¯†ç ï¼ˆè®°å¾—è¾“å…¥å¯†ç çš„æ—¶å€™æ˜¯ä¸æ˜¾ç¤ºçš„ï¼Œä¸è¦ä»¥ä¸ºå¡äº†ï¼‰æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¯å‘å¸ƒæˆåŠŸäº†</p>
<p><strong>æ³¨æ„</strong></p>
<p>å‘å¸ƒçš„æ—¶å€™è¦å°†npmçš„æºåˆ‡æ¢åˆ°npmçš„å®˜æ–¹åœ°å€(<a target="_blank" rel="noopener" href="https://registry.npmjs.org/">https://registry.npmjs.org/</a>); å¦‚æœä½ ä½¿ç”¨äº†å…¶å®ƒé•œåƒæºçš„è¯</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/" rel="tag">ç§æœ‰ç»„ä»¶åº“</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Vite-Vue3-Tsæ­å»ºç§æœ‰ç»„ä»¶åº“"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/"
    >Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/" class="article-date">
  <time datetime="2022-11-20T09:04:55.000Z" itemprop="datePublished">2022-11-20</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/">å·¥ç¨‹æŠ€æœ¯</a> / <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/">Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Vite-Vue3-Tsæ­å»ºç§æœ‰ç»„ä»¶åº“"><a href="#Vite-Vue3-Tsæ­å»ºç§æœ‰ç»„ä»¶åº“" class="headerlink" title="Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“"></a>Vite+Vue3+Tsæ­å»ºç§æœ‰ç»„ä»¶åº“</h1><p>ç›®å‰å‰ç«¯æŠ€æœ¯çš„æŒç»­å‘å±•ï¼Œç¤¾åŒºç”Ÿæ€å‡ºç°äº†ä¸€æ‰¹æ¯”è¾ƒé€‚ç”¨çš„ç»„ä»¶åº“ï¼Œä¾‹å¦‚ï¼šElementUI,Vantï¼ŒAntDesignç­‰ï¼Œä½†è¿™äº›ç»„ä»¶åº“çš„ç»„ä»¶ä¸ä¸€å®šèƒ½æ»¡è¶³æˆ‘ä»¬ä¸€äº›é¡¹ç›®çš„ç‰¹å®šä¸šåŠ¡éœ€æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å›¢é˜Ÿå°±åº”è¯¥å»ºç«‹èµ·æˆ‘ä»¬è‡ªå·±çš„ç»„ä»¶åº“ï¼Œæ–¹ä¾¿äºæˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡å¼€å‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿™ç¯‡æ–‡ç« å°±æ¥äº†è§£ä¸€ä¸‹æˆ‘ä»¬å¼€å‘ç»„ä»¶åº“çš„å¤§ä½“æŠ€æœ¯æ¶æ„ä½“ç³»ã€‚</p>
<p>æ­å»ºç»„ä»¶åº“çš„æŠ€æœ¯è¦ç‚¹ï¼š</p>
<ul>
<li>å¦‚ä½•ä½¿ç”¨pnpmæ­å»ºå‡ºä¸€ä¸ªmenorepoç¯å¢ƒ</li>
<li>å¦‚ä½•ä½¿ç”¨viteæ­å»ºä¸€ä¸ªåŸºæœ¬çš„Vue3è„šæ‰‹æ¶é¡¹ç›®</li>
<li>å¦‚ä½•å¼€å‘è°ƒè¯•ä¸€ä¸ªè‡ªå·±çš„UIç»„ä»¶åº“</li>
<li>å¦‚ä½•ä½¿ç”¨viteæ‰“åŒ…å¹¶å‘å¸ƒè‡ªå·±çš„UIç»„ä»¶åº“</li>
</ul>
<h3 id="ä¸€ã€menorepoç¯å¢ƒçš„æ­å»º"><a href="#ä¸€ã€menorepoç¯å¢ƒçš„æ­å»º" class="headerlink" title="ä¸€ã€menorepoç¯å¢ƒçš„æ­å»º"></a>ä¸€ã€menorepoç¯å¢ƒçš„æ­å»º</h3><p>é¦–å…ˆæˆ‘ä»¬è¦äº†è§£ä»€ä¹ˆæ˜¯menorepoåŠå®ƒæ˜¯å¦‚ä½•æ­å»º (å•ä»“åº“ å¤šé¡¹ç›®)</p>
<p>å°±æ˜¯æŒ‡åœ¨ä¸€ä¸ªå¤§çš„é¡¹ç›®ä»“åº“ä¸­ï¼Œç®¡ç†å¤šä¸ªæ¨¡å—&#x2F;åŒ…ï¼ˆpackageï¼‰ï¼Œè¿™ç§ç±»å‹çš„é¡¹ç›®å¤§éƒ½åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ªpackagesæ–‡ä»¶å¤¹ï¼Œåˆ†å¤šä¸ªé¡¹ç›®ç®¡ç†ã€‚å¤§æ¦‚ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code class="ini">-- packages
  -- pkg1
    --package.json
  -- pkg2
    --package.json
--package.json
</code></pre>
<p>ç›®å‰å¾ˆå¤šæˆ‘ä»¬ç†ŸçŸ¥çš„é¡¹ç›®éƒ½æ˜¯é‡‡ç”¨è¿™ç§æ¨¡å¼ï¼Œå¦‚Vantï¼ŒElementUIï¼ŒVue3ç­‰ã€‚æ‰“é€ ä¸€ä¸ªmenorepoç¯å¢ƒçš„å·¥å…·æœ‰å¾ˆå¤šï¼Œå¦‚ï¼šlernaã€pnpmã€yarnç­‰ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨pnpmæ¥å¼€å‘æˆ‘ä»¬çš„UIç»„ä»¶åº“</p>
<h4 id="1-ä½¿ç”¨pnpm"><a href="#1-ä½¿ç”¨pnpm" class="headerlink" title="1.ä½¿ç”¨pnpm"></a>1.ä½¿ç”¨pnpm</h4><pre><code class="ini">npm install pnpm -g //å®‰è£…pnpm
pnpm init //åˆå§‹åŒ–package.json
</code></pre>
<p>æ–°å»ºé…ç½®æ–‡ä»¶ .npmrc</p>
<pre><code class="ini">shamefully-hoist = true
</code></pre>
<p>è¿™é‡Œç®€å•è¯´ä¸‹ä¸ºä»€ä¹ˆè¦é…ç½®shamefully-hoistã€‚</p>
<p>å¦‚æœæŸäº›å·¥å…·ä»…åœ¨æ ¹ç›®å½•çš„node_modulesæ—¶æ‰æœ‰æ•ˆï¼Œå¯ä»¥å°†å…¶è®¾ç½®ä¸ºtrueæ¥æå‡é‚£äº›ä¸åœ¨æ ¹ç›®å½•çš„node_modulesï¼Œå°±æ˜¯å°†ä½ å®‰è£…çš„ä¾èµ–åŒ…çš„ä¾èµ–åŒ…çš„ä¾èµ–åŒ…çš„â€¦éƒ½æ”¾åˆ°åŒä¸€çº§åˆ«ï¼ˆæ‰å¹³åŒ–ï¼‰ã€‚è¯´ç™½äº†å°±æ˜¯ä¸è®¾ç½®ä¸ºtrueæœ‰äº›åŒ…å°±æœ‰å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚</p>
<p>å®‰è£…å¯¹åº”ä¾èµ–</p>
<pre><code class="ini">pnpm i vue@next typescript less -D -w //å¼€å‘ç¯å¢ƒä¸­çš„ä¾èµ–ä¸€èˆ¬å…¨éƒ¨å®‰è£…åœ¨æ•´ä¸ªé¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œæ–¹ä¾¿ä¸‹é¢æˆ‘ä»¬æ¯ä¸ªåŒ…éƒ½å¯ä»¥å¼•ç”¨,æ‰€ä»¥åœ¨å®‰è£…çš„æ—¶å€™éœ€è¦åŠ ä¸ª -w
</code></pre>
<p>å¦‚æœæˆ‘ä»¬æ˜¯åœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œå‘½ä»¤ï¼Œé‚£ä¹ˆå°±ä¸ç”¨åŠ  -w äº†ï¼Œè¦ä¸ç„¶ä¼šæç¤º</p>
<pre><code class="error">--workspace-root may only be used inside a workspace
</code></pre>
<p>é…ç½®tsconfit.json</p>
<pre><code class="ini">npx tsc --init //åˆå§‹åŒ–
</code></pre>
<pre><code class="javascript">//tsconfit.jsoné…ç½®
&#123;
  &quot;compilerOptions&quot;: &#123;
    &quot;baseUrl&quot;: &quot;.&quot;,
    &quot;jsx&quot;: &quot;preserve&quot;,
    &quot;strict&quot;: true,
    &quot;target&quot;: &quot;ES2015&quot;,
    &quot;module&quot;: &quot;ESNext&quot;,
    &quot;skipLibCheck&quot;: true,
    &quot;esModuleInterop&quot;: true,
    &quot;moduleResolution&quot;: &quot;Node&quot;,
    &quot;lib&quot;: [&quot;esnext&quot;, &quot;dom&quot;]
  &#125;
&#125;
</code></pre>
<h4 id="2-monorepoçš„å®ç°"><a href="#2-monorepoçš„å®ç°" class="headerlink" title="2.monorepoçš„å®ç°"></a>2.monorepoçš„å®ç°</h4><p>å„ä¸ªé¡¹ç›®ä¹‹é—´èƒ½å¤Ÿäº’ç›¸å¼•ç”¨æˆ‘ä»¬è¦æ–°å»ºä¸€ä¸ªpnpm-workspace.yamlæ–‡ä»¶å°†æˆ‘ä»¬çš„åŒ…å…³è”èµ·æ¥</p>
<pre><code class="ini">packages:
    - &#39;packages/**&#39;
    - &#39;examples&#39;
</code></pre>
<p>è¿™æ ·å°±èƒ½å°†æˆ‘ä»¬é¡¹ç›®ä¸‹çš„packagesç›®å½•å’Œexamplesç›®å½•å…³è”èµ·æ¥äº†ï¼Œå½“ç„¶å¦‚æœä½ æƒ³å…³è”æ›´å¤šç›®å½•ä½ åªéœ€è¦å¾€é‡Œé¢æ·»åŠ å³å¯ã€‚æ ¹æ®ä¸Šé¢çš„ç›®å½•ç»“æ„å¾ˆæ˜¾ç„¶ä½ åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºpackageså’Œexamplesæ–‡ä»¶å¤¹ï¼Œpackagesæ–‡ä»¶å¤¹å­˜æ”¾æˆ‘ä»¬å¼€å‘çš„åŒ…ï¼Œexamplesç”¨æ¥è°ƒè¯•æˆ‘ä»¬çš„ç»„ä»¶ã€‚</p>
<p>examplesæ–‡ä»¶å¤¹å°±æ˜¯æ¥ä¸‹æ¥æˆ‘ä»¬è¦ä½¿ç”¨viteæ­å»ºä¸€ä¸ªåŸºæœ¬çš„Vue3è„šæ‰‹æ¶é¡¹ç›®çš„åœ°æ–¹ã€‚</p>
<h4 id="3-æ‰‹åŠ¨æ­å»ºä¸€ä¸ªåŸºäºviteçš„vue3é¡¹ç›®"><a href="#3-æ‰‹åŠ¨æ­å»ºä¸€ä¸ªåŸºäºviteçš„vue3é¡¹ç›®" class="headerlink" title="3.æ‰‹åŠ¨æ­å»ºä¸€ä¸ªåŸºäºviteçš„vue3é¡¹ç›®"></a>3.æ‰‹åŠ¨æ­å»ºä¸€ä¸ªåŸºäºviteçš„vue3é¡¹ç›®</h4><p>è¿›å…¥examplesæ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œ</p>
<pre><code class="ini">pnpm init //åˆå§‹åŒ–ä»“åº“
pnpm install vite @vitejs/plugin-vue -D -w //å®‰è£…viteå’Œ@vitejs/plugin-vue
</code></pre>
<p>é…ç½®vite.config.ts</p>
<p>æ–°å»ºvite.config.tsæ–‡ä»¶</p>
<pre><code class="ini">import &#123; defineConfig &#125; from &#39;vite&#39;
import vue from &#39;@vitejs/plugin-vue&#39;

export default defineConfig(&#123;
    plugins:[vue()]
&#125;)
</code></pre>
<p>æ–°å»ºhtmlæ–‡ä»¶</p>
<p>@vitejs&#x2F;plugin-vue ä¼šé»˜è®¤åŠ è½½examplesä¸‹çš„index.html</p>
<p>æ–°å»ºindex.html</p>
<pre><code class="xml">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;&lt;/div&gt;
    &lt;script src=&quot;main.ts&quot; type=&quot;module&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>æ³¨æ„ï¼š<br>vite æ˜¯åŸºäºesmoduleçš„ æ‰€ä»¥type&#x3D;â€moduleâ€</p>
<p>æ–°å»ºapp.vueæ¨¡æ¿</p>
<pre><code class="xml">&lt;template&gt;
    &lt;div&gt;
        å¯åŠ¨æµ‹è¯•
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>æ–°å»ºmain.ts</p>
<pre><code class="javascript">import &#123;createApp&#125; from &#39;vue&#39;
import App from &#39;./app.vue&#39;

const app = createApp(App)

app.mount(&#39;#app&#39;)
</code></pre>
<p>æ­¤æ—¶ä¼šå‘ç°ç¼–è¯‘å™¨ä¼šæç¤ºä¸ªé”™è¯¯ï¼šæ‰¾ä¸åˆ°æ¨¡å—â€œ.&#x2F;app.vueâ€æˆ–å…¶ç›¸åº”çš„ç±»å‹å£°æ˜</p>
<p>å› ä¸ºç›´æ¥å¼•å…¥.vueæ–‡ä»¶ TSä¼šæ‰¾ä¸åˆ°å¯¹åº”çš„ç±»å‹å£°æ˜ï¼›æ‰€ä»¥éœ€è¦æ–°å»ºtypingsï¼ˆå‘½åæ²¡æœ‰æ˜ç¡®è§„å®šï¼ŒTSä¼šè‡ªåŠ¨å¯»æ‰¾.d.tsæ–‡ä»¶ï¼‰æ–‡ä»¶å¤¹æ¥ä¸“é—¨æ”¾è¿™äº›å£°æ˜æ–‡ä»¶ã€‚</p>
<p>typings&#x2F;vue-shim.d.ts</p>
<p>TypeScriptTSé»˜è®¤åªè®¤ES æ¨¡å—ã€‚å¦‚æœä½ è¦å¯¼å…¥.vueæ–‡ä»¶å°±è¦declare moduleæŠŠä»–ä»¬å£°æ˜å‡ºæ¥ã€‚</p>
<pre><code class="typescript">declare module &#39;*.vue&#39; &#123;
    import type &#123; DefineComponent &#125; from &quot;vue&quot;;
    const component:DefineComponent&lt;&#123;&#125;,&#123;&#125;,any&gt;
&#125;
</code></pre>
<p>é…ç½®è„šæœ¬å¯åŠ¨é¡¹ç›®</p>
<p>æœ€ååœ¨package.jsonæ–‡ä»¶ä¸­é…ç½®scriptsè„šæœ¬</p>
<pre><code class="erlang">...
&quot;scripts&quot;: &#123;
    &quot;dev&quot;: &quot;vite&quot;
  &#125;,
...
</code></pre>
<p>ç„¶åç»ˆç«¯è¾“å…¥æˆ‘ä»¬ç†Ÿæ‚‰çš„å‘½ä»¤ï¼špnpm run dev</p>
<p><img src="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/image-20221120114028908.png"></p>
<p>å¦‚æœå‡ºç°äº†cannot find module â€˜node:pathâ€™è¿™æ ·çš„é”™è¯¯æç¤ºï¼Œé‚£å¯èƒ½æ˜¯nodeç‰ˆæœ¬ä¸å…¼å®¹ï¼Œå‡çº§ä¸€ä¸‹nodeç‰ˆæœ¬å°±å¯ä»¥äº†</p>
<p>æˆ‘çš„node ç‰ˆæœ¬æ˜¯ v14.17.0 çš„ç‰ˆæœ¬ï¼Œå‡ºç°äº†ä¸å…¼å®¹çš„é—®é¢˜ï¼Œäºæ˜¯å‡çº§åˆ°äº†ç¨³å®šç‰ˆ v16.16.0 ã€‚</p>
<p>å†è¿è¡Œviteå°±æ²¡é—®é¢˜äº†</p>
<p><img src="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/image-20221120114403681.png"></p>
<h3 id="äºŒã€æœ¬åœ°è°ƒè¯•"><a href="#äºŒã€æœ¬åœ°è°ƒè¯•" class="headerlink" title="äºŒã€æœ¬åœ°è°ƒè¯•"></a>äºŒã€æœ¬åœ°è°ƒè¯•</h3><h4 id="1-æ–°å»ºåŒ…æ–‡ä»¶"><a href="#1-æ–°å»ºåŒ…æ–‡ä»¶" class="headerlink" title="1.æ–°å»ºåŒ…æ–‡ä»¶"></a>1.æ–°å»ºåŒ…æ–‡ä»¶</h4><p>å¾€packagesæ–‡ä»¶å¤¹å†²å¡«å……å†…å®¹</p>
<p>ä¸€èˆ¬packagesè¦æœ‰utilsåŒ…æ¥å­˜æ”¾æˆ‘ä»¬å…¬å…±æ–¹æ³•ï¼Œå·¥å…·å‡½æ•°ç­‰</p>
<p>æ—¢ç„¶å®ƒæ˜¯ä¸€ä¸ªåŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬æ–°å»ºutilsç›®å½•åå°±éœ€è¦åˆå§‹åŒ–å®ƒï¼Œè®©å®ƒå˜æˆä¸€ä¸ªåŒ…ï¼›ç»ˆç«¯è¿›å…¥utilsæ–‡ä»¶å¤¹æ‰§è¡Œï¼špnpm init ç„¶åä¼šç”Ÿæˆä¸€ä¸ªpackage.jsonæ–‡ä»¶ï¼›è¿™é‡Œéœ€è¦æ”¹ä¸€ä¸‹åŒ…åï¼Œæˆ‘è¿™é‡Œå°†nameæ”¹æˆ@alanmf&#x2F;utilsè¡¨ç¤ºè¿™ä¸ªutilsåŒ…æ˜¯å±äºalanmfè¿™ä¸ªç»„ç»‡ä¸‹çš„ã€‚æ‰€ä»¥è®°ä½å‘å¸ƒä¹‹å‰è¦ç™»å½•npmæ–°å»ºä¸€ä¸ªç»„ç»‡ï¼›ä¾‹å¦‚alanmf</p>
<p><img src="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/image-20221120152720676.png"></p>
<p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨tså†™çš„ï¼Œæ‰€ä»¥éœ€è¦å°†å…¥å£æ–‡ä»¶index.jsæ”¹ä¸ºindex.tsï¼Œå¹¶æ–°å»ºindex.tsæ–‡ä»¶:(å…ˆå¯¼å‡ºä¸€ä¸ªç®€å•çš„åŠ æ³•å‡½æ•°)</p>
<p>componentsæ˜¯æˆ‘ä»¬ç”¨æ¥å­˜æ”¾å„ç§UIç»„ä»¶çš„åŒ…</p>
<p>æ–°å»ºcomponentsæ–‡ä»¶å¤¹å¹¶æ‰§è¡Œ pnpm init ç”Ÿæˆpackage.json</p>
<ul>
<li>ç»„ä»¶åº“åŒ… è¿™é‡Œå‘½åä¸ºalanmf</li>
</ul>
<pre><code class="ini">&#123;
  &quot;name&quot;: &quot;@alanmf/utils&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.ts&quot;,
  &quot;scripts&quot;: &#123;
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  &#125;,
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;
&#125;
</code></pre>
<p>æ–°å»ºindex.tså…¥å£æ–‡ä»¶å¹¶å¼•å…¥utilsåŒ…</p>
<pre><code class="tsx">//@kitty-ui/utils
import &#123;testfun&#125; from &#39;@alanmf/utils&#39;

const result = testfun (1,1)

console.log(result)
</code></pre>
<p>ç”±äºç»„ä»¶åº“æ˜¯åŸºäºtsçš„ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…esnoæ¥æ‰§è¡Œtsæ–‡ä»¶ä¾¿äºæµ‹è¯•ç»„ä»¶ä¹‹é—´çš„å¼•å…¥æƒ…å†µ</p>
<p>æ§åˆ¶å°è¾“å…¥esno xxx.tså³å¯æ‰§è¡Œtsæ–‡ä»¶</p>
<pre><code class="ini">npm i esno -g //å®‰è£…esno
eson index.ts //æ‰§è¡Œindex.tsæ–‡ä»¶
</code></pre>
<p><img src="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/image-20221120151321307.png"></p>
<h4 id="2-åŒ…ä¹‹é—´æœ¬åœ°è°ƒè¯•"><a href="#2-åŒ…ä¹‹é—´æœ¬åœ°è°ƒè¯•" class="headerlink" title="2.åŒ…ä¹‹é—´æœ¬åœ°è°ƒè¯•"></a>2.åŒ…ä¹‹é—´æœ¬åœ°è°ƒè¯•</h4><p>è¿›å…¥componentsæ–‡ä»¶å¤¹æ‰§è¡Œ</p>
<pre><code class="bash">pnpm install @alanmf/utils
</code></pre>
<p>ä½ ä¼šå‘ç°pnpmä¼šè‡ªåŠ¨åˆ›å»ºä¸ªè½¯é“¾æ¥ç›´æ¥æŒ‡å‘æˆ‘ä»¬çš„utilsåŒ…ï¼›æ­¤æ—¶componentsä¸‹çš„packagesï¼š</p>
<pre><code class="swift">&#123;
  &quot;name&quot;: &quot;alanmf&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;main&quot;: &quot;index.ts&quot;,
  &quot;scripts&quot;: &#123;
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  &#125;,
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;dependencies&quot;: &#123;
    &quot;@alanmf/utils&quot;: &quot;workspace:^1.0.0&quot;
  &#125;
&#125;
</code></pre>
<p>ä½ ä¼šå‘ç°å®ƒçš„ä¾èµ–@alanmf&#x2F;utilså¯¹åº”çš„ç‰ˆæœ¬ä¸ºï¼šworkspace:^1.0.0ï¼›å› ä¸ºpnpmæ˜¯ç”±workspaceç®¡ç†çš„ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªå‰ç¼€workspaceå¯ä»¥æŒ‡å‘utilsä¸‹çš„å·¥ä½œç©ºé—´ä»è€Œæ–¹ä¾¿æœ¬åœ°è°ƒè¯•å„ä¸ªåŒ…ç›´æ¥çš„å…³è”å¼•ç”¨ã€‚</p>
<p>åˆ°è¿™é‡ŒåŸºæœ¬å¼€å‘æ–¹æ³•æˆ‘ä»¬å·²ç»çŸ¥é“å•¦ï¼›æ¥ä¸‹æ¥å°±è¦è¿›å…¥æ­£é¢˜äº†ï¼Œå¼€å‘ä¸€ä¸ªbuttonç»„ä»¶</p>
<h3 id="ä¸‰ã€å¼€å‘ä¸€ä¸ªbuttonç»„ä»¶"><a href="#ä¸‰ã€å¼€å‘ä¸€ä¸ªbuttonç»„ä»¶" class="headerlink" title="ä¸‰ã€å¼€å‘ä¸€ä¸ªbuttonç»„ä»¶"></a>ä¸‰ã€å¼€å‘ä¸€ä¸ªbuttonç»„ä»¶</h3><h4 id="1-åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç»„ä»¶"><a href="#1-åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç»„ä»¶" class="headerlink" title="1.åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç»„ä»¶"></a>1.åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç»„ä»¶</h4><p>åœ¨componentsæ–‡ä»¶å¤¹ä¸‹æ–°å»ºsrc,åŒæ—¶åœ¨srcä¸‹æ–°å»ºbuttonç»„ä»¶ç›®å½•å’Œiconç»„ä»¶ç›®å½•(æ–°å»ºiconä¸ºäº†ä¾¿äºè°ƒè¯•);æ­¤æ—¶componentsæ–‡ä»¶ç›®å½•å¦‚ä¸‹</p>
<pre><code class="lua">-- components
  -- src
    -- button
    -- icon
    -- index.ts
-- package.json
</code></pre>
<p>è®©æˆ‘ä»¬å…ˆæµ‹è¯•ä¸€ä¸‹æˆ‘ä»¬çš„buttonç»„ä»¶èƒ½å¦åœ¨æˆ‘ä»¬æ­å»ºçš„examplesä¸‹çš„vue3é¡¹ç›®æœ¬å¼•ç”¨~</p>
<p>é¦–å…ˆåœ¨buttonä¸‹æ–°å»ºä¸€ä¸ªç®€å•çš„button.vue</p>
<pre><code class="xml">&lt;template&gt;
    &lt;button&gt;æµ‹è¯•æŒ‰é’®&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<p>ç„¶ååœ¨button&#x2F;index.tså°†å…¶å¯¼å‡º</p>
<pre><code class="javascript">import Button from &#39;./button.vue&#39;

export default Button
</code></pre>
<p>å› ä¸ºæˆ‘ä»¬å¼€å‘ç»„ä»¶åº“çš„æ—¶å€™ä¸å¯èƒ½åªæœ‰buttonï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªcomponents&#x2F;index.tså°†æˆ‘ä»¬å¼€å‘çš„ç»„ä»¶ä¸€ä¸ªä¸ªçš„é›†ä¸­å¯¼å‡º</p>
<pre><code class="javascript">import Button from &#39;./button&#39;

export &#123;
    Button
&#125;
</code></pre>
<p>å¥½äº†ï¼Œä¸€ä¸ªç»„ä»¶çš„å¤§ä½“ç›®å½•å·®ä¸å¤šå°±æ˜¯è¿™æ ·äº†ï¼Œæ¥ä¸‹æ¥è¯·è¿›å…¥æˆ‘ä»¬çš„examplesæ¥çœ‹çœ‹èƒ½å¦å¼•å…¥æˆ‘ä»¬çš„buttonç»„ä»¶</p>
<h4 id="2-æµ‹è¯•é¡¹ç›®å¼•å…¥"><a href="#2-æµ‹è¯•é¡¹ç›®å¼•å…¥" class="headerlink" title="2.æµ‹è¯•é¡¹ç›®å¼•å…¥"></a>2.æµ‹è¯•é¡¹ç›®å¼•å…¥</h4><p>ä¸Šé¢å·²ç»è¯´è¿‡æ‰§è¡Œåœ¨workspaceæ‰§è¡Œ pnpm i xxxçš„æ—¶å€™pnpmä¼šè‡ªåŠ¨åˆ›å»ºä¸ªè½¯é“¾æ¥ç›´æ¥æŒ‡å‘æˆ‘ä»¬çš„xxxåŒ…ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç›´æ¥åœ¨examplesæ‰§è¡Œï¼špnpm i alanmf</p>
<p>æ­¤æ—¶ä½ å°±ä¼šå‘ç°packages.jsonçš„ä¾èµ–å¤šäº†ä¸ª</p>
<pre><code class="json">&quot;alanmf&quot;: &quot;workspace:^1.0.0&quot;
</code></pre>
<p>è¿™æ—¶å€™æˆ‘ä»¬å°±èƒ½ç›´æ¥åœ¨æˆ‘ä»¬çš„æµ‹è¯•é¡¹ç›®ä¸‹å¼•å…¥æˆ‘ä»¬æœ¬åœ°çš„componentsç»„ä»¶åº“äº†ï¼Œå¯åŠ¨æˆ‘ä»¬çš„æµ‹è¯•é¡¹ç›®ï¼Œæ¥åˆ°æˆ‘ä»¬çš„ examples&#x2F;app.vue ç›´æ¥å¼•å…¥Button</p>
<pre><code class="xml">&lt;template&gt;
    &lt;div&gt;
        &lt;Button /&gt;
    &lt;/div&gt;
&lt;/template&gt;
&lt;script lang=&quot;ts&quot; setup&gt;
import &#123; Button &#125; from &#39;alanmf/src&#39;
&lt;/script&gt;
</code></pre>
<p>ä¸å‡ºæ„å¤–çš„è¯ä½ çš„é¡µé¢å°±ä¼šå±•ç¤ºæˆ‘ä»¬åˆšåˆšå†™çš„buttonç»„ä»¶äº†</p>
<p>æ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯ä¸“æ³¨äºç»„ä»¶çš„å¼€å‘äº†ï¼›è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„buttonç»„ä»¶ç›®å½•ä¸‹ï¼ˆæµ‹è¯•é¡µé¢ä¸ç”¨å…³ï¼Œæ­¤æ—¶æˆ‘ä»¬å·²ç»å¯ä»¥è¾¹å¼€å‘è¾¹è°ƒè¯•è¾¹çœ‹æ•ˆæœäº†ï¼‰</p>
<h4 id="3-types-tsæ–‡ä»¶è§„èŒƒç»„ä»¶å±æ€§"><a href="#3-types-tsæ–‡ä»¶è§„èŒƒç»„ä»¶å±æ€§" class="headerlink" title="3.types.tsæ–‡ä»¶è§„èŒƒç»„ä»¶å±æ€§"></a>3.types.tsæ–‡ä»¶è§„èŒƒç»„ä»¶å±æ€§</h4><p>æˆ‘ä»¬çš„buttonç»„ä»¶æ˜¯éœ€è¦æ¥æ”¶å¾ˆå¤šå±æ€§çš„ï¼Œå¦‚typeã€sizeç­‰ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ–°å»ºä¸ªtypes.tsæ–‡ä»¶æ¥è§„èŒƒè¿™äº›å±æ€§</p>
<p>åœ¨buttonç›®å½•ä¸‹æ–°å»ºtypes.ts</p>
<pre><code class="tsx">
import &#123; ExtractPropTypes &#125; from &#39;vue&#39;


export const ButtonType = [&#39;default&#39;, &#39;primary&#39;, &#39;success&#39;, &#39;warning&#39;, &#39;danger&#39;]

export const ButtonSize = [&#39;large&#39;, &#39;normal&#39;, &#39;small&#39;, &#39;mini&#39;];


export const buttonProps = &#123;
  type: &#123;
    type: String,
    values: ButtonType
  &#125;,
  size: &#123;
    type: String,
    values: ButtonSize
  &#125;
&#125;

export type ButtonProps = ExtractPropTypes&lt;typeof buttonProps&gt;
</code></pre>
<p>import type è¡¨ç¤ºåªå¯¼å…¥ç±»å‹ï¼›ExtractPropTypesæ˜¯vue3ä¸­å†…ç½®çš„ç±»å‹å£°æ˜,å®ƒçš„ä½œç”¨æ˜¯æ¥æ”¶ä¸€ä¸ªç±»å‹ï¼Œç„¶åæŠŠå¯¹åº”çš„vue3æ‰€æ¥æ”¶çš„propsç±»å‹æä¾›å‡ºæ¥ï¼Œåé¢æœ‰éœ€è¦å¯ä»¥ç›´æ¥ä½¿ç”¨</p>
<p>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åœ¨vueä¸­ä½¿ç”¨ä¸€ä¸ªç»„ä»¶ä¼šç”¨çš„app.use å°†ç»„ä»¶æŒ‚è½½åˆ°å…¨å±€ã€‚è¦ä½¿ç”¨app.useå‡½æ•°çš„è¯æˆ‘ä»¬éœ€è¦è®©æˆ‘ä»¬çš„æ¯ä¸ªç»„ä»¶éƒ½æä¾›ä¸€ä¸ªinstallæ–¹æ³•ï¼Œapp.use()çš„æ—¶å€™å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•;</p>
<p>æˆ‘ä»¬å°†button&#x2F;index.tsè°ƒæ•´ä¸º</p>
<pre><code class="typescript">import button from &#39;./button.vue&#39;
import type &#123;App,Plugin&#125; from &quot;vue&quot;
type SFCWithInstall&lt;T&gt; = T&amp;Plugin
const withInstall = &lt;T&gt;(comp:T) =&gt; &#123;
    (comp as SFCWithInstall&lt;T&gt;).install = (app:App)=&gt;&#123;
        //æ³¨å†Œç»„ä»¶
        app.component((comp as any).name,comp)
    &#125;
    return comp as SFCWithInstall&lt;T&gt;
&#125;
const Button = withInstall(button)
export default Button
</code></pre>
<p>æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨app.useæ¥æŒ‚è½½æˆ‘ä»¬çš„ç»„ä»¶å•¦</p>
<p>å…¶å®withInstallæ–¹æ³•å¯ä»¥åšä¸ªå…¬å…±æ–¹æ³•æ”¾åˆ°å·¥å…·åº“é‡Œï¼Œå› ä¸ºåç»­æ¯ä¸ªç»„ä»¶éƒ½ä¼šç”¨åˆ°ï¼Œè¿™é‡Œç­‰åé¢å¼€å‘ç»„ä»¶çš„æ—¶å€™å†è°ƒæ•´</p>
<p>åˆ°è¿™é‡Œç»„ä»¶å¼€å‘çš„åŸºæœ¬é…ç½®å·²ç»å®Œæˆï¼Œæœ€åæˆ‘ä»¬å¯¹æˆ‘ä»¬çš„ç»„ä»¶åº“ä»¥åŠå·¥å…·åº“è¿›è¡Œæ‰“åŒ…ï¼Œæ‰“åŒ…ä¹‹å‰å¦‚æœè¦å‘å…¬å…±åŒ…çš„è¯è®°å¾—å°†æˆ‘ä»¬çš„å„ä¸ªåŒ…çš„åè®®æ”¹ä¸ºMITå¼€æºåè®®</p>
<pre><code class="python-repl">...
&quot;license&quot;: &quot;MIT&quot;,
...
</code></pre>
<h3 id="å››ã€viteæ‰“åŒ…"><a href="#å››ã€viteæ‰“åŒ…" class="headerlink" title="å››ã€viteæ‰“åŒ…"></a>å››ã€viteæ‰“åŒ…</h3><h4 id="1-é…ç½®æ–‡ä»¶"><a href="#1-é…ç½®æ–‡ä»¶" class="headerlink" title="1.é…ç½®æ–‡ä»¶"></a>1.é…ç½®æ–‡ä»¶</h4><p>æ‰“åŒ…ä»¬è¿™é‡Œé€‰æ‹©viteï¼Œå®ƒæœ‰ä¸€ä¸ªåº“æ¨¡å¼ä¸“é—¨ä¸ºæˆ‘ä»¬æ¥æ‰“åŒ…è¿™ç§åº“ç»„ä»¶çš„ã€‚</p>
<p>å‰é¢å·²ç»å®‰è£…è¿‡viteäº†ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥åœ¨componentsä¸‹ç›´æ¥æ–°å»ºvite.config.ts(é…ç½®å‚æ•°æ–‡ä»¶ä¸­å·²ç»æ³¨é‡Š):</p>
<pre><code class="json">import &#123; defineConfig &#125; from &quot;vite&quot;;
import vue from &quot;@vitejs/plugin-vue&quot;
export default defineConfig(
    &#123;
        build: &#123;
            target: &#39;modules&#39;,
            //æ‰“åŒ…æ–‡ä»¶ç›®å½•
            outDir: &quot;es&quot;,
            //å‹ç¼©
            minify: false,
            //cssåˆ†ç¦»
            //cssCodeSplit: true,
            rollupOptions: &#123;
                //å¿½ç•¥æ‰“åŒ…vueæ–‡ä»¶
                external: [&#39;vue&#39;],
                input: [&#39;src/index.ts&#39;],
                output: [
                    &#123;
                        format: &#39;es&#39;,
                        //ä¸ç”¨æ‰“åŒ…æˆ.es.js,è¿™é‡Œæˆ‘ä»¬æƒ³æŠŠå®ƒæ‰“åŒ…æˆ.js
                        entryFileNames: &#39;[name].js&#39;,
                        //è®©æ‰“åŒ…ç›®å½•å’Œæˆ‘ä»¬ç›®å½•å¯¹åº”
                        preserveModules: true,
                        //é…ç½®æ‰“åŒ…æ ¹ç›®å½•
                        dir: &#39;es&#39;,
                        preserveModulesRoot: &#39;src&#39;
                    &#125;,
                    &#123;
                        format: &#39;cjs&#39;,
                        entryFileNames: &#39;[name].js&#39;,
                        //è®©æ‰“åŒ…ç›®å½•å’Œæˆ‘ä»¬ç›®å½•å¯¹åº”
                        preserveModules: true,
                        //é…ç½®æ‰“åŒ…æ ¹ç›®å½•
                        dir: &#39;lib&#39;,
                        preserveModulesRoot: &#39;src&#39;
                    &#125;
                ]
            &#125;,
            lib: &#123;
                entry: &#39;./index.ts&#39;,
                formats: [&#39;es&#39;, &#39;cjs&#39;]
            &#125;
        &#125;,
        plugins: [
            vue()
        ]
    &#125;
)
</code></pre>
<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©æ‰“åŒ…cjs(CommonJS)å’Œesm(ESModule)ä¸¤ç§å½¢å¼,cjsæ¨¡å¼ä¸»è¦ç”¨äºæœåŠ¡ç«¯å¼•ç”¨(ssr),è€Œesmå°±æ˜¯æˆ‘ä»¬ç°åœ¨ç»å¸¸ä½¿ç”¨çš„æ–¹å¼ï¼Œå®ƒæœ¬èº«è‡ªå¸¦treeShakingè€Œä¸éœ€è¦é¢å¤–é…ç½®æŒ‰éœ€å¼•å…¥(å‰ææ˜¯ä½ å°†æ¨¡å—åˆ†åˆ«å¯¼å‡º)</p>
<h4 id="2-viteæ‰“åŒ…"><a href="#2-viteæ‰“åŒ…" class="headerlink" title="2.viteæ‰“åŒ…"></a>2.viteæ‰“åŒ…</h4><p>åˆ°è¿™é‡Œå°±å·²ç»å¯ä»¥ç›´æ¥æ‰“åŒ…äº†ï¼›componentsä¸‹æ‰§è¡Œï¼š pnpm run buildä½ å°±ä¼šå‘ç°æ‰“åŒ…äº†eså’Œlibä¸¤ä¸ªç›®å½•</p>
<p><img src="/2022/11/20/Vite-Vue3-Ts%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E7%BB%84%E4%BB%B6%E5%BA%93/image-20221120165853742.png"></p>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[ç§æœ‰ä»“åº“æ­å»ºæºç ]: 	â€œ<a target="_blank" rel="noopener" href="https://github.com/mengfeng/alanmf_ui.git">https://github.com/mengfeng/alanmf_ui.git</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BB%84%E4%BB%B6%E5%BA%93/" rel="tag">ç»„ä»¶åº“</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-Vue3-Ts-Vite-Piniaç»„åˆçš„é«˜æ•ˆå¼€å‘å¥—ä»¶"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/19/Vue3-Ts-Vite-Pinia%E7%BB%84%E5%90%88%E7%9A%84%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E5%A5%97%E4%BB%B6/"
    >Vue3+Ts+Vite+Piniaç»„åˆçš„é«˜æ•ˆå¼€å‘å¥—ä»¶</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/19/Vue3-Ts-Vite-Pinia%E7%BB%84%E5%90%88%E7%9A%84%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E5%A5%97%E4%BB%B6/" class="article-date">
  <time datetime="2022-11-19T07:34:30.000Z" itemprop="datePublished">2022-11-19</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/">å·¥ç¨‹æŠ€æœ¯</a> / <a class="article-category-link" href="/categories/%E5%B7%A5%E7%A8%8B%E6%8A%80%E6%9C%AF/Vue3-Ts-Vite-Pinia%E7%BB%84%E5%90%88%E7%9A%84%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E5%A5%97%E4%BB%B6/">Vue3+Ts+Vite+Piniaç»„åˆçš„é«˜æ•ˆå¼€å‘å¥—ä»¶</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Vue3-Ts-Vite-Piniaç»„åˆçš„é«˜æ•ˆå¼€å‘å¥—ä»¶"><a href="#Vue3-Ts-Vite-Piniaç»„åˆçš„é«˜æ•ˆå¼€å‘å¥—ä»¶" class="headerlink" title="Vue3+Ts+Vite+Piniaç»„åˆçš„é«˜æ•ˆå¼€å‘å¥—ä»¶"></a>Vue3+Ts+Vite+Piniaç»„åˆçš„é«˜æ•ˆå¼€å‘å¥—ä»¶</h1><p>2022å¹´æœ€å—æ¬¢è¿çš„ç»„åˆ</p>
<h3 id="ä¸€ã€Viteå’ŒWebpackåŒºåˆ«"><a href="#ä¸€ã€Viteå’ŒWebpackåŒºåˆ«" class="headerlink" title="ä¸€ã€Viteå’ŒWebpackåŒºåˆ«"></a>ä¸€ã€Viteå’ŒWebpackåŒºåˆ«</h3><ul>
<li>webpackæ˜¯ä¸€ä¸ªJavaScriptåº”ç”¨ç¨‹åºçš„é™æ€æ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œå®ƒä¼šå¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºè¿›è¡Œä¾èµ–å…³ç³»å›¾æ„å»ºã€‚</li>
<li>viteæ˜¯æ„å»ºå·¥å…·çš„é«˜é˜¶å°è£…ï¼Œä½¿ç”¨ç®€å•ï¼Œå¿«ï¼ˆå¼€å‘çš„æ—¶å€™æ„Ÿè§‰æ²¡æœ‰ç¼–è¯‘è¿‡ç¨‹ï¼‰ï¼Œä¾¿äºæ‰©å±•ã€‚è€Œä»–é›†æˆçš„esbuild(Go ç¼–å†™) é¢„æ„å»ºä¾èµ–ï¼Œæ¯”nodeå¿« 10-100 å€ã€‚</li>
</ul>
<p>åŒºåˆ«ï¼š</p>
<h4 id="1-å…³æ³¨å±‚çº§ä¸åŒ"><a href="#1-å…³æ³¨å±‚çº§ä¸åŒ" class="headerlink" title="1.å…³æ³¨å±‚çº§ä¸åŒ"></a>1.å…³æ³¨å±‚çº§ä¸åŒ</h4><p>viteå…³æ³¨çš„å±‚çº§æ›´é«˜ï¼šviteæ˜¯ high level apiï¼Œå…³æ³¨çš„æ˜¯å¦‚ä½•å¿«é€Ÿæ–¹ä¾¿çš„æ­å»ºé¡¹ç›®ï¼Œç›¸æ¯”webpackï¼Œå‡å°‘äº†å¾ˆå¤šé…ç½®é‡ã€‚</p>
<p>webpackå…³æ³¨çš„å±‚çº§æ›´ä½ï¼šwebpackæ˜¯low level apiï¼Œå› ä¸ºwebpackæ›´å…³æ³¨çš„æ˜¯å„ç§åŠŸèƒ½çš„å®ç°ï¼Œé‡ç‚¹æ”¾åœ¨æ„å»ºä¸Šã€‚</p>
<h4 id="2-viteè‡ªå·±ä¸åŒ…å«ç¼–è¯‘èƒ½åŠ›ã€‚"><a href="#2-viteè‡ªå·±ä¸åŒ…å«ç¼–è¯‘èƒ½åŠ›ã€‚" class="headerlink" title="2.viteè‡ªå·±ä¸åŒ…å«ç¼–è¯‘èƒ½åŠ›ã€‚"></a>2.viteè‡ªå·±ä¸åŒ…å«ç¼–è¯‘èƒ½åŠ›ã€‚</h4><p>å®ƒæœ¬èº«å¹¶ä¸å‚ä¸ç¼–è¯‘ï¼Œå®ƒçš„ç¼–è¯‘èƒ½åŠ›åªæ˜¯é›†æˆäº†rollupå’ŒESbuildçš„åŠŸèƒ½.</p>
<h4 id="3-å¯åŠ¨é¡¹ç›®viteæ›´å¿«ï¼Œå¯ä»¥è¯´æ˜¯è¶…çº§å¿«ã€‚"><a href="#3-å¯åŠ¨é¡¹ç›®viteæ›´å¿«ï¼Œå¯ä»¥è¯´æ˜¯è¶…çº§å¿«ã€‚" class="headerlink" title="3.å¯åŠ¨é¡¹ç›®viteæ›´å¿«ï¼Œå¯ä»¥è¯´æ˜¯è¶…çº§å¿«ã€‚"></a>3.å¯åŠ¨é¡¹ç›®viteæ›´å¿«ï¼Œå¯ä»¥è¯´æ˜¯è¶…çº§å¿«ã€‚</h4><p>å¯¹æ¯”webpackåœ¨dev-serveçš„æ—¶å€™ï¼Œä¼šæäº¤æ‰€æœ‰ç¼–è¯‘çš„æ–‡ä»¶ï¼Œè€Œviteåœ¨dev-serveçš„æ—¶å€™åˆ©ç”¨äº†æµè§ˆå™¨çš„native ES moduleåŠŸèƒ½ï¼Œåœ¨æµè§ˆå™¨è¯·æ±‚å¯¹åº”çš„urlæ—¶æ‰æä¾›æ–‡ä»¶ï¼Œå®ç°äº†æ ¹æ®è·¯ç”±çš„æ‡’åŠ è½½ï¼Œæ‰€ä»¥å¯åŠ¨çš„æ—¶å€™æ˜¯è¶…å¿«çš„ã€‚</p>
<h4 id="4-viteçš„çƒ­æ›´æ–°æ›´å¿«ã€‚"><a href="#4-viteçš„çƒ­æ›´æ–°æ›´å¿«ã€‚" class="headerlink" title="4.viteçš„çƒ­æ›´æ–°æ›´å¿«ã€‚"></a>4.viteçš„çƒ­æ›´æ–°æ›´å¿«ã€‚</h4><p>å¯¹æ¯”webpackçš„çƒ­æ›´æ–°ï¼Œçƒ­æ›´æ–°æ—¶ï¼ŒæŠŠæ”¹åŠ¨è¿‡æ¨¡å—çš„ç›¸å…³ä¾èµ–æ¨¡å—å…¨éƒ¨ç¼–è¯‘ä¸€æ¬¡ã€‚è€Œviteçƒ­æ›´æ–°æ—¶ï¼Œä»…è®©æµè§ˆå™¨é‡æ–°è¯·æ±‚æ”¹åŠ¨è¿‡çš„æ¨¡å—ã€‚</p>
<p>ç°åœ¨å…¬å¸é¡¹ç›®ä»webpackè¿‡æ¸¡åˆ°vite,è¿˜åœ¨ä¸æ–­æ‘¸ç´¢çˆ¬å‘ä¸­ï¼Œè™½ç„¶ç›®å‰viteçš„ç”Ÿæ€ä¸å¦‚webpackä¸°å¯Œï¼Œä¸”å®ç”¨çš„å¼€å‘è€…ä¹Ÿä¸åŠwebpackã€‚<br>ä½†æ˜¯ä¸å¯å¦è®¤çš„æ˜¯ï¼Œç›¸æ¯”äºwebpack, viteéå¸¸é€‚åˆé¡¹ç›®çš„å¼€å‘ï¼Œwebpacké€‚åˆå·¥å…·çš„å¼€å‘ã€‚</p>
<ul>
<li><p>viteä¸ºæ„å»ºé¡¹ç›®è€Œç”Ÿ</p>
</li>
<li><p>webpackä¸ºæ„å»ºå·¥å…·è€Œç”Ÿ</p>
</li>
</ul>
<h3 id="äºŒã€Piniaå’ŒVuex"><a href="#äºŒã€Piniaå’ŒVuex" class="headerlink" title="äºŒã€Piniaå’ŒVuex"></a>äºŒã€Piniaå’ŒVuex</h3><p>Piniaæ˜¯Vueç”Ÿæ€é‡ŒVuexçš„ä»£æ›¿è€…ï¼Œä¸€ä¸ªå…¨æ–°Vueçš„çŠ¶æ€ç®¡ç†åº“ã€‚åœ¨Vue3æˆä¸ºæ­£å¼ç‰ˆä»¥åï¼Œå°¤é›¨æºªå¼ºåŠ¿æ¨èçš„é¡¹ç›®å°±æ˜¯Piniaã€‚</p>
<p>Pinia æ˜¯ Vue.js çš„è½»é‡çº§çŠ¶æ€ç®¡ç†åº“ï¼Œå®ƒä½¿ç”¨ Vue 3 ä¸­çš„æ–°ååº”ç³»ç»Ÿæ¥æ„å»ºä¸€ä¸ªç›´è§‚ä¸”å®Œå…¨ç±»å‹åŒ–çš„çŠ¶æ€ç®¡ç†åº“ã€‚<br>Vuexä¹Ÿæ˜¯ä¸ºVueæ¡†æ¶å»ºç«‹çš„ä¸€ä¸ªæµè¡Œçš„çŠ¶æ€ç®¡ç†åº“ï¼Œå®ƒä¹Ÿæ˜¯Vueæ ¸å¿ƒå›¢é˜Ÿæ¨èçš„çŠ¶æ€ç®¡ç†åº“ã€‚ Vuexé«˜åº¦å…³æ³¨åº”ç”¨ç¨‹åºçš„å¯æ‰©å±•æ€§ã€å¼€å‘äººå‘˜çš„å·¥æ•ˆå’Œä¿¡å¿ƒã€‚å®ƒåŸºäºä¸reduxç›¸åŒçš„æµé‡æ¶æ„ã€‚Pinia å®Œæ•´çš„ç¬¦åˆäº†å½“æ—¶ Vuex5 ææ¡ˆæ‰€æåˆ°çš„åŠŸèƒ½ç‚¹ã€‚</p>
<h4 id="Pinia-å’Œ-Vuex"><a href="#Pinia-å’Œ-Vuex" class="headerlink" title="Pinia å’Œ Vuex"></a>Pinia å’Œ Vuex</h4><p>Vuexï¼š <code>State</code>ã€<code>Gettes</code>ã€<code>Mutations</code>(åŒæ­¥)ã€<code>Actions</code>(å¼‚æ­¥)</p>
<p>Piniaï¼š <code>State</code>ã€<code>Gettes</code>ã€<code>Actions</code>(åŒæ­¥å¼‚æ­¥éƒ½æ”¯æŒ)</p>
<h4 id="Pinia-æ ¸å¿ƒç‰¹æ€§"><a href="#Pinia-æ ¸å¿ƒç‰¹æ€§" class="headerlink" title="Pinia æ ¸å¿ƒç‰¹æ€§"></a>Pinia æ ¸å¿ƒç‰¹æ€§</h4><ul>
<li><p>Pinia æ²¡æœ‰ <code>Mutations</code></p>
</li>
<li><p><code>Actions</code> æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥</p>
</li>
<li><p>æ²¡æœ‰æ¨¡å—çš„åµŒå¥—ç»“æ„</p>
</li>
<li><ul>
<li>Pinia é€šè¿‡è®¾è®¡æä¾›æ‰å¹³ç»“æ„ï¼Œå°±æ˜¯è¯´æ¯ä¸ª store éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œè°ä¹Ÿä¸å±äºè°ï¼Œä¹Ÿå°±æ˜¯æ‰å¹³åŒ–äº†ï¼Œæ›´å¥½çš„ä»£ç åˆ†å‰²ä¸”æ²¡æœ‰å‘½åç©ºé—´ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å¯¼å…¥å¦ä¸€ä¸ªæ¨¡å—æ¥éšå¼åµŒå¥— storeï¼Œç”šè‡³å¯ä»¥æ‹¥æœ‰ store çš„å¾ªç¯ä¾èµ–å…³ç³»</li>
</ul>
</li>
<li><p>æ›´å¥½çš„ <code>TypeScript</code> æ”¯æŒ </p>
</li>
<li><ul>
<li>ä¸éœ€è¦å†åˆ›å»ºè‡ªå®šä¹‰çš„å¤æ‚åŒ…è£…å™¨æ¥æ”¯æŒ TypeScript æ‰€æœ‰å†…å®¹éƒ½ç±»å‹åŒ–ï¼Œå¹¶ä¸” API çš„è®¾è®¡æ–¹å¼ä¹Ÿå°½å¯èƒ½çš„ä½¿ç”¨ TS ç±»å‹æ¨æ–­</li>
</ul>
</li>
<li><p>ä¸éœ€è¦æ³¨å…¥ã€å¯¼å…¥å‡½æ•°ã€è°ƒç”¨å®ƒä»¬ï¼Œäº«å—è‡ªåŠ¨è¡¥å…¨ï¼Œè®©æˆ‘ä»¬å¼€å‘æ›´åŠ æ–¹ä¾¿</p>
</li>
<li><p>æ— éœ€æ‰‹åŠ¨æ·»åŠ  storeï¼Œå®ƒçš„æ¨¡å—é»˜è®¤æƒ…å†µä¸‹åˆ›å»ºå°±è‡ªåŠ¨æ³¨å†Œçš„</p>
</li>
<li><p>Vue2 å’Œ Vue3 éƒ½æ”¯æŒ </p>
</li>
<li><ul>
<li>é™¤äº†åˆå§‹åŒ–å®‰è£…å’ŒSSRé…ç½®ä¹‹å¤–ï¼Œä¸¤è€…ä½¿ç”¨ä¸Šçš„APIéƒ½æ˜¯ç›¸åŒçš„</li>
</ul>
</li>
<li><p>æ”¯æŒ <code>Vue DevTools</code></p>
</li>
<li><ul>
<li>è·Ÿè¸ª actions, mutations çš„æ—¶é—´çº¿</li>
<li>åœ¨ä½¿ç”¨äº†æ¨¡å—çš„ç»„ä»¶ä¸­å°±å¯ä»¥è§‚å¯Ÿåˆ°æ¨¡å—æœ¬èº«</li>
<li>æ”¯æŒ time-travel æ›´å®¹æ˜“è°ƒè¯•</li>
<li>åœ¨ Vue2 ä¸­ Pinia ä¼šä½¿ç”¨ Vuex çš„æ‰€æœ‰æ¥å£ï¼Œæ‰€ä»¥å®ƒä¿©ä¸èƒ½ä¸€èµ·ä½¿ç”¨</li>
<li>ä½†æ˜¯é’ˆå¯¹ Vue3 çš„è°ƒè¯•å·¥å…·æ”¯æŒè¿˜ä¸å¤Ÿå®Œç¾ï¼Œæ¯”å¦‚è¿˜æ²¡æœ‰ time-travel åŠŸèƒ½</li>
</ul>
</li>
<li><p>æ¨¡å—çƒ­æ›´æ–° </p>
</li>
<li><ul>
<li>æ— éœ€é‡æ–°åŠ è½½é¡µé¢å°±å¯ä»¥ä¿®æ”¹æ¨¡å—</li>
<li>çƒ­æ›´æ–°çš„æ—¶å€™ä¼šä¿æŒä»»ä½•ç°æœ‰çŠ¶æ€</li>
</ul>
</li>
<li><p>æ”¯æŒä½¿ç”¨æ’ä»¶æ‰©å±• Pinia åŠŸèƒ½</p>
</li>
<li><p>æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“</p>
</li>
</ul>
<h3 id="ä¸‰ã€Viteç”ŸæˆVue3è„šæ‰‹æ¶"><a href="#ä¸‰ã€Viteç”ŸæˆVue3è„šæ‰‹æ¶" class="headerlink" title="ä¸‰ã€Viteç”ŸæˆVue3è„šæ‰‹æ¶"></a>ä¸‰ã€Viteç”ŸæˆVue3è„šæ‰‹æ¶</h3><pre><code class="ini">npm create vite@latest //æ„å»ºvite+vue
npm i //ä¸‹è½½ä¾èµ–
npm run dev //å¯åŠ¨é¡¹ç›®
</code></pre>
<p><img src="/2022/11/19/Vue3-Ts-Vite-Pinia%E7%BB%84%E5%90%88%E7%9A%84%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E5%A5%97%E4%BB%B6/image-20221119091852577.png"></p>
<p><img src="/2022/11/19/Vue3-Ts-Vite-Pinia%E7%BB%84%E5%90%88%E7%9A%84%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E5%A5%97%E4%BB%B6/image-20221119101610847.png"></p>
<h3 id="å››ã€é›†æˆpinia"><a href="#å››ã€é›†æˆpinia" class="headerlink" title="å››ã€é›†æˆpinia"></a>å››ã€é›†æˆpinia</h3><pre><code class="ini">npm install pinia //å®‰è£…pinia
</code></pre>
<p>piniaç®€å•ä½¿ç”¨</p>
<p><img src="/2022/11/19/Vue3-Ts-Vite-Pinia%E7%BB%84%E5%90%88%E7%9A%84%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E5%A5%97%E4%BB%B6/image-20221119150910678.png"></p>
<p>1.åœ¨main.tsä¸­æ³¨å†Œpinia</p>
<pre><code class="tsx">//main.ts
import &#123; createApp &#125; from &#39;vue&#39;
import &#39;./style.css&#39;
import App from &#39;./App.vue&#39;
import &#123;createPinia&#125; from &#39;pinia&#39; 

createApp(App).use(createPinia()).mount(&#39;#app&#39;)
</code></pre>
<p>2.åˆ›å»ºsrc&#x2F;type&#x2F;user.d.ts</p>
<pre><code class="tsx">// ç”¨æˆ·çš„ç±»å‹å£°æ˜æ–‡ä»¶
interface IUser &#123;
    name: string;
    age: number;
&#125;  
</code></pre>
<p>3.åˆ›å»ºsrc&#x2F;store&#x2F;user.ts</p>
<pre><code class="tsx">//user.ts
import &#123; defineStore &#125; from &quot;pinia&quot;;
 
export default defineStore(&quot;user&quot;, &#123;
  state() &#123;
    return &#123;
      userList: [] as IUser[],
    &#125;;
  &#125;,
  actions: &#123;
    getList() &#123;
      // æ¨¡æ‹Ÿä»åç«¯è·å–æ•°æ®
      let resList: IUser[] = [
        &#123; name: &quot;å­Ÿå³°&quot;, age: 24 &#125;,
        &#123; name: &quot;å­Ÿä¸€&quot;, age: 19 &#125;
      ];
      this.userList = resList;
    &#125;,
  &#125;,
&#125;);
</code></pre>
<p>4.åˆ›å»ºsrc&#x2F;store&#x2F;index.ts</p>
<pre><code class="tsx">//index.ts
import useUserStore from &quot;./user&quot;;
 
export default function useStore() &#123;
  return &#123;
    user: useUserStore(),
  &#125;;
&#125;
</code></pre>
<p>5.App.vueä½¿ç”¨</p>
<pre><code class="vue">&lt;script setup lang=&quot;ts&quot;&gt;
// ä»çŠ¶æ€å±‚å¯¼å‡ºæŒ‡å®šæ¨¡å—
import useStore from &quot;./store&quot;;
const &#123; user &#125; = useStore();
// è·å–ç”¨æˆ·åˆ—è¡¨
user.getList();
&lt;/script&gt;
 
&lt;template&gt;
  &lt;div&gt;
    &lt;ul&gt;
      &lt;li v-for=&quot;item in user.userList&quot;&gt;
        å§“åï¼š&#123;&#123; item.name &#125;&#125; ---- å¹´é¾„ï¼š&#123;&#123; item.age &#125;&#125;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p><img src="/2022/11/19/Vue3-Ts-Vite-Pinia%E7%BB%84%E5%90%88%E7%9A%84%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E5%A5%97%E4%BB%B6/image-20221119151532682.png"></p>
<h3 id="äº”ã€é›†æˆpretterå’Œeslint"><a href="#äº”ã€é›†æˆpretterå’Œeslint" class="headerlink" title="äº”ã€é›†æˆpretterå’Œeslint"></a>äº”ã€é›†æˆpretterå’Œeslint</h3><pre><code class="ini">npm i prettier -D //å®‰è£…prettier
npm i eslint -D //å®‰è£…eslint
npx eslint --init //åˆå§‹åŒ–eslint
</code></pre>
<p>æ ¹ç›®å½•åˆ›å»º<code>.prettierrc.js</code>æ–‡ä»¶</p>
<pre><code class="javascript">//.prettierrc.js
module.exports = &#123;
    printWidth: 140,// è¶…è¿‡æœ€å¤§å€¼æ¢è¡Œ
    tabWidth: 4, // tabé”®å®½åº¦ï¼Œé»˜è®¤ä¸º4
    useTabs: true,// ä½¿ç”¨tabï¼ˆåˆ¶è¡¨ç¬¦ï¼‰ç¼©è¿›è€Œéç©ºæ ¼
    singleQuote: true,// ç”¨å•å¼•å·ä»£æ›¿åŒå¼•å·
    semi: true,// è¡Œæœ«æ˜¯å¦åŠ åˆ†å·
    trailingComma: &#39;none&#39;,// æœ€åä¸€ä¸ªå¯¹è±¡å…ƒç´ åŠ é€—å·
    bracketSpacing: true,// å¯¹è±¡ï¼Œæ•°ç»„åŠ ç©ºæ ¼
    jsxBracketSameLine: true, // jsx &gt; æ˜¯å¦å¦èµ·ä¸€è¡Œ
  
  &#125;;
</code></pre>
<pre><code class="js">//.eslintrc.cjs
module.exports = &#123;
  root: true,
  env: &#123;
    browser: true,
    node: true,
    es6: true,
    commonjs: true,
    amd: true
  &#125;,
  // ts eslint é…ç½®
  parserOptions: &#123;
    parser:&#39;@typescript-eslint/parser&#39;,
  &#125;,
  plugins: [&#39;@typescript-eslint&#39;],
  extends: [&#39;plugin:vue/vue3-recommended&#39;,&#39;plugin:prettier/recommended&#39;,&#39;prettier/@typescript-eslint&#39;,&#39;plugin:@typescript-eslint/recommended&#39;],
  // js eslint é…ç½®
  // parserOptions: &#123;
  //   parser: &#39;babel-eslint&#39;,
  //   sourceType: &#39;module&#39;
  // &#125;,
  // plugins: [&#39;html&#39;, &#39;vue&#39;],
  // extends: [&#39;plugin:vue/recommended&#39;, &#39;eslint:recommended&#39;],
 
  rules: &#123;
    &#39;max-len&#39;: &#39;off&#39;,
     // ç»Ÿä¸€è±å…è§„åˆ™ï¼ŒåŸå› ï¼šç›´æ¥ä¿®æ”¹å¯èƒ½å¯¹ç°æœ‰åŠŸèƒ½äº§ç”Ÿå½±å“
     &#39;eqeqeq&#39;: 1,
    //  &#39;vue/no-v-html&#39;: 1,
     // å…¶ä¸­ä»£ç æœ¬èº«æœ‰é—®é¢˜çš„è§„åˆ™é”™è¯¯æœ‰
     &#39;no-undef&#39;: 0,
     &#39;import/no-duplicates&#39;: 0,
 
     // å¯èƒ½å¼•èµ·æ ¼å¼åŒ–é—®é¢˜ä½†å»ºè®®æ‰‹åŠ¨ä¿®æ”¹ä»£ç çš„æœ‰
     &#39;no-plusplus&#39;: 0,
     &#39;no-eval&#39;: 0,
     &#39;no-prototype-builtins&#39;: 0,
     &#39;no-multi-assign&#39;: 0,
     &#39;no-unused-vars&#39;: 0,
     &#39;no-useless-escape&#39;: 0,
     &#39;camelcase&#39;: 0,
     &#39;vue/no-unused-components&#39;: 0,
     &#39;vue/return-in-computed-property&#39;: 0,
     &#39;no-param-reassign&#39;: 0,
     &#39;prefer-const&#39;: 0,
     &#39;prefer-destructuring&#39;: 0,
     &#39;no-underscore-dangle&#39;: 0,
     &#39;no-restricted-syntax&#39;: 0,
     &#39;no-nested-ternary&#39;: 0,
     &#39;radix&#39;: 0,
     &#39;vue/no-side-effects-in-computed-properties&#39;: 0,
     &#39;vue/order-in-components&#39;: 0,
     &#39;function-paren-newline&#39;: 0,
  &#125;,
&#125;;
</code></pre>
<h3 id="å‚è€ƒé“¾æ¥ï¼š"><a href="#å‚è€ƒé“¾æ¥ï¼š" class="headerlink" title="å‚è€ƒé“¾æ¥ï¼š"></a>å‚è€ƒé“¾æ¥ï¼š</h3><p>[gitä»“åº“é¡¹ç›®æºç ]: 	â€œ<a target="_blank" rel="noopener" href="https://github.com/mengfeng/vite-vue3-pinia-ts">https://github.com/mengfeng/vite-vue3-pinia-ts</a> â€œ<br>[Viteä¸­æ–‡å®˜ç½‘]: 		â€œ<a target="_blank" rel="noopener" href="https://cn.vitejs.dev/">https://cn.vitejs.dev</a> â€œ<br>[piniaä¸­æ–‡å®˜ç½‘]: 	â€œ<a target="_blank" rel="noopener" href="https://pinia.web3doc.top/getting-started.html#%E5%AE%89%E8%A3%85">https://pinia.web3doc.top/getting-started.html#å®‰è£…</a> â€œ</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%8A%80%E6%9C%AF/" rel="tag">æŠ€æœ¯</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-webgl"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/18/webgl/"
    >webgl</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/18/webgl/" class="article-date">
  <time datetime="2022-11-18T06:22:29.000Z" itemprop="datePublished">2022-11-18</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/WebGl/">WebGl</a> / <a class="article-category-link" href="/categories/WebGl/webgl/">webgl</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="webgl"><a href="#webgl" class="headerlink" title="webgl"></a>webgl</h1><h2 id="ç¬¬ä¸€ç« -webglç»˜å›¾æµç¨‹"><a href="#ç¬¬ä¸€ç« -webglç»˜å›¾æµç¨‹" class="headerlink" title="ç¬¬ä¸€ç«   webglç»˜å›¾æµç¨‹"></a>ç¬¬ä¸€ç«   webglç»˜å›¾æµç¨‹</h2><hr>
<h3 id="ä¸€ã€åˆ›å»ºcanvasç”»å¸ƒ"><a href="#ä¸€ã€åˆ›å»ºcanvasç”»å¸ƒ" class="headerlink" title="ä¸€ã€åˆ›å»ºcanvasç”»å¸ƒ"></a>ä¸€ã€åˆ›å»ºcanvasç”»å¸ƒ</h3><pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;style&gt;
        body&#123;
            margin: 0;
            overflow: hidden;
        &#125;
        #canvas&#123;
            background-color: pink;
        &#125;
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;canvas id=&quot;canvas&quot;&gt;&lt;/canvas&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="äºŒã€jsè·å–canvasç”»å¸ƒ"><a href="#äºŒã€jsè·å–canvasç”»å¸ƒ" class="headerlink" title="äºŒã€jsè·å–canvasç”»å¸ƒ"></a>äºŒã€jsè·å–canvasç”»å¸ƒ</h3><pre><code class="javascript">const canvas = document.querySelector(&#39;#canvas&#39;)
        canvas.width = window.innerWidth
        canvas.height = window.innerHeight
</code></pre>
<h3 id="ä¸‰ã€ä½¿ç”¨canvasè·å–webglç»˜å›¾ä¸Šä¸‹æ–‡"><a href="#ä¸‰ã€ä½¿ç”¨canvasè·å–webglç»˜å›¾ä¸Šä¸‹æ–‡" class="headerlink" title="ä¸‰ã€ä½¿ç”¨canvasè·å–webglç»˜å›¾ä¸Šä¸‹æ–‡"></a>ä¸‰ã€ä½¿ç”¨canvasè·å–webglç»˜å›¾ä¸Šä¸‹æ–‡</h3><pre><code class="javascript"> const gl = canvas.getContext(&quot;webgl&quot;)
        gl.clearColor(1,0,0,1)
        gl.clear(gl.COLOR_BUFFER_BIT)
</code></pre>
<h3 id="å››ã€åœ¨scriptä¸­å»ºç«‹é¡¶ç‚¹ç€è‰²å™¨å’Œé¡¶ç‚¹ç€è‰²å™¨-glsl-esè¯­è¨€"><a href="#å››ã€åœ¨scriptä¸­å»ºç«‹é¡¶ç‚¹ç€è‰²å™¨å’Œé¡¶ç‚¹ç€è‰²å™¨-glsl-esè¯­è¨€" class="headerlink" title="å››ã€åœ¨scriptä¸­å»ºç«‹é¡¶ç‚¹ç€è‰²å™¨å’Œé¡¶ç‚¹ç€è‰²å™¨(glsl esè¯­è¨€)"></a>å››ã€åœ¨scriptä¸­å»ºç«‹é¡¶ç‚¹ç€è‰²å™¨å’Œé¡¶ç‚¹ç€è‰²å™¨(glsl esè¯­è¨€)</h3><pre><code class="javascript">&lt;!-- é¡¶ç‚¹ç€è‰²å™¨ --&gt;
&lt;script id=&quot;vertexShader&quot; type=&quot;x-shader/x-vertex&quot;&gt;
        void main()&#123;
            gl_Position = vec4(0,0,0,1);
            gl_PointSize = 50.0;
        &#125;
&lt;/script&gt;
    &lt;!-- ç‰‡å…ƒç€è‰²å™¨ --&gt;
&lt;script id=&quot;fragmentShader&quot; type=&quot;x-shader/x-fragment&quot;&gt;
        void main()&#123;
            gl_FragColor = vec4(1,1,1,1);
        &#125;
&lt;/script&gt;
</code></pre>
<h3 id="äº”ã€åœ¨jsä¸­è·å–é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡å…ƒç€è‰²å™¨"><a href="#äº”ã€åœ¨jsä¸­è·å–é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡å…ƒç€è‰²å™¨" class="headerlink" title="äº”ã€åœ¨jsä¸­è·å–é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡å…ƒç€è‰²å™¨"></a>äº”ã€åœ¨jsä¸­è·å–é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡å…ƒç€è‰²å™¨</h3><pre><code class="javascript">//é¡¶ç‚¹ç€è‰²å™¨æ–‡æœ¬
const vsSource = document.getElementById(&#39;vertexShader&#39;).innerText;
//ç‰‡å…ƒèˆè‰²å™¨æ–‡æœ¬
const fsSourse = document.getElementById(&#39;fragmentShader&#39;).innerText;
</code></pre>
<h3 id="å…­ã€åˆå§‹åŒ–èŠ‚ç‚¹"><a href="#å…­ã€åˆå§‹åŒ–èŠ‚ç‚¹" class="headerlink" title="å…­ã€åˆå§‹åŒ–èŠ‚ç‚¹"></a>å…­ã€åˆå§‹åŒ–èŠ‚ç‚¹</h3><pre><code class="javascript"> //åˆå§‹åŒ–ç€è‰²å™¨
 initShaders(gl,vsSource,fsSourse);
</code></pre>
<h3 id="ä¸ƒã€æŒ‡å®šå°†æ¥ç”¨æ¥æ¸…ç©ºç»˜å›¾åŒºçš„é¢œè‰²"><a href="#ä¸ƒã€æŒ‡å®šå°†æ¥ç”¨æ¥æ¸…ç©ºç»˜å›¾åŒºçš„é¢œè‰²" class="headerlink" title="ä¸ƒã€æŒ‡å®šå°†æ¥ç”¨æ¥æ¸…ç©ºç»˜å›¾åŒºçš„é¢œè‰²"></a>ä¸ƒã€æŒ‡å®šå°†æ¥ç”¨æ¥æ¸…ç©ºç»˜å›¾åŒºçš„é¢œè‰²</h3><pre><code class="javascript">//æŒ‡å®šå°†è¦ç”¨æ¥æ¸…ç†ç»˜å›¾åŒºçš„é¢œè‰²
gl.clearColor(0,0,0,1);
</code></pre>
<h3 id="å…«ã€ä½¿ç”¨æŒ‡å®šé¢œè‰²æ¸…ç©ºç»˜å›¾åŒº"><a href="#å…«ã€ä½¿ç”¨æŒ‡å®šé¢œè‰²æ¸…ç©ºç»˜å›¾åŒº" class="headerlink" title="å…«ã€ä½¿ç”¨æŒ‡å®šé¢œè‰²æ¸…ç©ºç»˜å›¾åŒº"></a>å…«ã€ä½¿ç”¨æŒ‡å®šé¢œè‰²æ¸…ç©ºç»˜å›¾åŒº</h3><pre><code class="javascript">//æ¸…ç†ç»˜å›¾åŒº
gl.clear(gl.COLOR_BUFFER_BIT);
</code></pre>
<h3 id="ä¹ã€ç»˜åˆ¶é¡¶ç‚¹"><a href="#ä¹ã€ç»˜åˆ¶é¡¶ç‚¹" class="headerlink" title="ä¹ã€ç»˜åˆ¶é¡¶ç‚¹"></a>ä¹ã€ç»˜åˆ¶é¡¶ç‚¹</h3><pre><code class="javascript">//ç»˜åˆ¶é¡¶ç‚¹(ç‚¹æ¨¡å¼)
gl.drawArrays(gl.POINTS,0,1);
</code></pre>
<h3 id="åã€åˆå§‹åŒ–èŠ‚ç‚¹å…·ä½“ä»£ç å®ç°"><a href="#åã€åˆå§‹åŒ–èŠ‚ç‚¹å…·ä½“ä»£ç å®ç°" class="headerlink" title="åã€åˆå§‹åŒ–èŠ‚ç‚¹å…·ä½“ä»£ç å®ç°"></a>åã€åˆå§‹åŒ–èŠ‚ç‚¹å…·ä½“ä»£ç å®ç°</h3><pre><code class="javascript">function initShaders(gl,vsSource,fsSourse)&#123;
//åˆ›å»ºç¨‹åºå¯¹è±¡
const program = gl.createProgram();
//å»ºç«‹ç€è‰²å¯¹è±¡
const vertexShader = loadShader(gl,gl.VERTEX_SHADER,vsSource);
const fragmentShader = loadShader(gl,gl.FRAGMENT_SHADER,fsSourse);
//å°†é¡¶ç‚¹ç€è‰²å¯¹è±¡è£…è¿›ç¨‹åºå¯¹è±¡ä¸­
gl.attachShader(program, vertexShader);
//å°†ç‰‡å…ƒç€è‰²å¯¹è±¡è£…è¿›ç¨‹åºå¯¹è±¡ä¸­
         gl.attachShader(program,fragmentShader);
//è¿æ¥webglä¸Šä¸‹æ–‡å¯¹è±¡å’Œç¨‹åºå¯¹è±¡
gl.linkProgram(program);
//å¯åŠ¨ç¨‹åºå¯¹è±¡
gl.useProgram(program);
//å°†ç¨‹åºå¯¹è±¡æŒ‚åˆ°ä¸Šä¸‹æ–‡å¯¹è±¡
gl.program = program;
return true;
&#125;

function loadShader(gl,type,source)&#123;
//æ ¹æ®ç€è‰²å™¨çš„ç±»å‹ï¼Œå»ºç«‹ç€è‰²å™¨å¯¹è±¡
const shader = gl.createShader(type);
//å°†ç€è‰²å™¨æºæ–‡ä»¶ä¼ å…¥ç€è‰²å™¨å¯¹è±¡ä¸­
gl.shaderSource(shader, source);
//ç¼–è¯‘ç€è‰²å™¨å¯¹è±¡
gl.compileShader(shader);
//è¿”å›ç€è‰²å™¨å¯¹è±¡
return shader;
&#125;
</code></pre>
<h2 id="ç¬¬äºŒç« -ç”¨jsæ§åˆ¶ç‚¹ä½"><a href="#ç¬¬äºŒç« -ç”¨jsæ§åˆ¶ç‚¹ä½" class="headerlink" title="ç¬¬äºŒç«   ç”¨jsæ§åˆ¶ç‚¹ä½"></a>ç¬¬äºŒç«   ç”¨jsæ§åˆ¶ç‚¹ä½</h2><h3 id="ä¸€ã€jsä¸­å£°æ˜attributeå˜é‡"><a href="#ä¸€ã€jsä¸­å£°æ˜attributeå˜é‡" class="headerlink" title="ä¸€ã€jsä¸­å£°æ˜attributeå˜é‡"></a>ä¸€ã€jsä¸­å£°æ˜attributeå˜é‡</h3><pre><code class="javascript">&lt;script id=&quot;vertexShader&quot; type=&quot;x-shader/x-vertex&quot;&gt;
//å£°æ˜å˜é‡ç±»å‹vec4ï¼Œå¯¼å‡ºå˜é‡a_Position
        attribute vec4 a_Position;
//ä¿®æ”¹é¡¶ç‚¹å°ºå¯¸å’Œä¿®æ”¹é¡¶ç‚¹ä½ç½®æ˜¯ä¸€æ ·çš„åŸç†ï¼Œåªæ˜¯ç±»å‹ä¸ºfloat
        void main()&#123;
            gl_Position = a_Position;
            gl_PointSize = 50.0;
        &#125;
    &lt;/script&gt;
</code></pre>
<h3 id="äºŒã€jsè·å–attributeå˜é‡"><a href="#äºŒã€jsè·å–attributeå˜é‡" class="headerlink" title="äºŒã€jsè·å–attributeå˜é‡"></a>äºŒã€jsè·å–attributeå˜é‡</h3><pre><code class="javascript">//è®¾ç½®attributeå˜é‡
const a_Position = gl.getAttribLocation(gl.program, &#39;a_Position&#39;);
</code></pre>
<h3 id="ä¸‰ã€åœ¨jsä¸­ä¿®æ”¹attributeå˜é‡"><a href="#ä¸‰ã€åœ¨jsä¸­ä¿®æ”¹attributeå˜é‡" class="headerlink" title="ä¸‰ã€åœ¨jsä¸­ä¿®æ”¹attributeå˜é‡"></a>ä¸‰ã€åœ¨jsä¸­ä¿®æ”¹attributeå˜é‡</h3><pre><code class="javascript">//ä¿®æ”¹attributeå˜é‡å€¼
gl.vertexAttrib3f(a_Position,0,0,0)
//å‚æ•°ï¼ˆå˜é‡å,x,y,zï¼‰
//ä¹Ÿæœ‰è®¸å¤šåŒæ—å‡½æ•°
gl.vertexAttrib1f(a_Position,0)
gl.vertexAttrib2f(a_Position,0,0)
gl.vertexAttrib3f(a_Position,0,0,0)
gl.vertexAttrib4f(a_Position,0,0,0,0)
</code></pre>
<h3 id="æ¡ˆä¾‹å°èŠ‚ï¼ˆé¼ æ ‡æ§åˆ¶ç‚¹ä½ï¼‰"><a href="#æ¡ˆä¾‹å°èŠ‚ï¼ˆé¼ æ ‡æ§åˆ¶ç‚¹ä½ï¼‰" class="headerlink" title="æ¡ˆä¾‹å°èŠ‚ï¼ˆé¼ æ ‡æ§åˆ¶ç‚¹ä½ï¼‰"></a>æ¡ˆä¾‹å°èŠ‚ï¼ˆé¼ æ ‡æ§åˆ¶ç‚¹ä½ï¼‰</h3><h4 id="1-è·å–é¼ æ ‡åœ¨canvasä¸­çš„ä½ç½®"><a href="#1-è·å–é¼ æ ‡åœ¨canvasä¸­çš„ä½ç½®" class="headerlink" title="1.è·å–é¼ æ ‡åœ¨canvasä¸­çš„ä½ç½®"></a>1.è·å–é¼ æ ‡åœ¨canvasä¸­çš„ä½ç½®</h4><pre><code class="javascript">//è·å–é¼ æ ‡ç‚¹åœ¨canvasä¸­çš„ä½ç½®
canvas.addEventListener(&#39;click&#39;,(event)=&gt;&#123;
const &#123;clientX,clientY&#125; = event;
const &#123;left,top&#125; = canvas.getBoundingClientRect();
const [cssX,cssY]=[clientX - left,clientY - top];
        &#125;)
</code></pre>
<p><img src="/2022/11/18/webgl/image-20220922115516857.png"></p>
<pre><code class="javascript">//è§£å†³canvaså’Œwebglå·®å¼‚
//1.è§£å†³åŸç‚¹å·®å¼‚
const [halfWidth,halfHeight] = [width/2,height/2];
const [xBaseCenter,yBaseCenter] = [cssX - halfWidth,cssY - halfHeight];
//2.è§£å†³yè½´è½´å‘å·®å¼‚
const yBaseCenterTop = -yBaseCenter;
//3.è§£å†³åŸºåº•å·®å¼‚
const [x,y] = [xBaseCenter/halfWidth,yBaseCenterTop/halfHeight];
</code></pre>
<h4 id="2-ç»˜åˆ¶å›¾å±‚"><a href="#2-ç»˜åˆ¶å›¾å±‚" class="headerlink" title="2.ç»˜åˆ¶å›¾å±‚"></a>2.ç»˜åˆ¶å›¾å±‚</h4><pre><code class="javascript">gl.vertexAttrib2f(a_Position,x,y);
gl.clear(gl.COLOR_BUFFER_BIT);
gl.drawArrays(gl.POINTS,0,1);
</code></pre>
<h3 id="å››ã€webglåŒæ­¥ç»˜å›¾åŸç†"><a href="#å››ã€webglåŒæ­¥ç»˜å›¾åŸç†" class="headerlink" title="å››ã€webglåŒæ­¥ç»˜å›¾åŸç†"></a>å››ã€webglåŒæ­¥ç»˜å›¾åŸç†</h3><p>â€‹       webgl çš„åŒæ­¥ç»˜å›¾çš„ç°è±¡,å…¶å®æ˜¯ç”±äº webgl åº•å±‚å†…ç½®é¢œè‰²ç¼“å†²åŒºå¯¼è‡´çš„.å®ƒåœ¨ç”µè„‘ä¸­ä¼šå ç”¨ä¸€å—å†…å­˜,åœ¨æˆ‘ä»¬ä½¿ç”¨ webgl ç»˜å›¾çš„æ—¶å€™,æ˜¯åœ¨é¢œè‰²ç¼“å†²åŒºä¸­ç”»å‡ºæ¥,ä½†æ˜¯å›¾ç‰‡æš‚æ—¶è¿˜æœªæ¸²æŸ“å‡ºæ¥.åªæœ‰ webgl è‡ªå·±çŸ¥é“.å¦‚æœæˆ‘ä»¬æƒ³è¦å°†å›¾åƒçš„æ—¶å€™,é‚£å°±ç…§ç€ç¼“å†²åŒºçš„å›¾åƒå»ç”»,è¿™ä¸ªæ­¥éª¤æ˜¯ webgl å†…éƒ¨è‡ªå·±å®Œæˆçš„,æˆ‘ä»¬åªéœ€è¦æ‰§è¡Œç»˜å›¾å‘½ä»¤å°±è¡Œäº†,é¢œè‰²ç¼“å†²åŒºå­˜å‚¨çš„å›¾åƒ,åªæœ‰å½“å‰çº¿ç¨‹æœ‰æ•ˆ,æ¯”å¦‚æˆ‘ä»¬å…ˆåœ¨ js ä¸»çº¿ç¨‹ç»˜å›¾çš„æ—¶å€™,ä¸»çº¿ç¨‹ç»“æŸå,ä¼šåœ¨æ‰§è¡Œä¿¡æ¯é˜Ÿåˆ—çš„å¼‚æ­¥çº¿ç¨‹,å­å•Šæ‰§è¡Œå¼‚æ­¥çº¿ç¨‹æ—¶,é¢œè‰²ç¼“å†²åŒºä¼šè¢« webgl é‡ç½®,å¯¼è‡´é¢œè‰²ç¼“å†²å™¨ç»˜åˆ¶çš„å›¾å½¢è¢«æ¸…é™¤,å¯¼è‡´ä»¥å‰ç»˜åˆ¶çš„å›¾åƒä¹Ÿä¼šæ¶ˆå¤±.</p>
<h2 id="ç¬¬ä¸‰ç« -ç”¨jsæ§åˆ¶é¡¶ç‚¹é¢œè‰²"><a href="#ç¬¬ä¸‰ç« -ç”¨jsæ§åˆ¶é¡¶ç‚¹é¢œè‰²" class="headerlink" title="ç¬¬ä¸‰ç«   ç”¨jsæ§åˆ¶é¡¶ç‚¹é¢œè‰²"></a>ç¬¬ä¸‰ç«   ç”¨jsæ§åˆ¶é¡¶ç‚¹é¢œè‰²</h2><h3 id="ä¸€ã€jsä¸­å£°æ˜uniformå˜é‡"><a href="#ä¸€ã€jsä¸­å£°æ˜uniformå˜é‡" class="headerlink" title="ä¸€ã€jsä¸­å£°æ˜uniformå˜é‡"></a>ä¸€ã€jsä¸­å£°æ˜uniformå˜é‡</h3><pre><code class="javascript">&lt;script id=&quot;fragmentShader&quot; type=&quot;x-shader/x-fragment&quot;&gt;
 //å°†floatç²¾åº¦è®¾ç½®ä¸ºä¸­ç­‰
 precision mediump float;
 uniform vec4 u_FragColor;
 void main()&#123;
    gl_FragColor = u_FragColor;
 &#125;
&lt;/script&gt;
</code></pre>
<h3 id="äºŒã€jsè·å–uniformå˜é‡"><a href="#äºŒã€jsè·å–uniformå˜é‡" class="headerlink" title="äºŒã€jsè·å–uniformå˜é‡"></a>äºŒã€jsè·å–uniformå˜é‡</h3><pre><code class="javascript">const u_FragColor = gl.getUniformLocation(gl.program, &#39;u_FragColor&#39;);
</code></pre>
<h3 id="ä¸‰ã€åœ¨jsä¸­ä¿®æ”¹uniformå˜é‡å€¼"><a href="#ä¸‰ã€åœ¨jsä¸­ä¿®æ”¹uniformå˜é‡å€¼" class="headerlink" title="ä¸‰ã€åœ¨jsä¸­ä¿®æ”¹uniformå˜é‡å€¼"></a>ä¸‰ã€åœ¨jsä¸­ä¿®æ”¹uniformå˜é‡å€¼</h3><pre><code class="javascript">//ä¸€ä¸ªä¸€ä¸ªä¼ é€’å‚æ•°
gl.uniform4f(u_FragColor, 0.0, 1.0, 0.0, 1.0);
//å¯ä»¥ä»¥æ•°ç»„çš„å½¢å¼ä¼ é€’å‚æ•°
//Float32Arrayä¸ºä¸€ç§32ä½æµ®ç‚¹å‹æ•°ç»„ï¼Œåœ¨æµè§ˆå™¨ä¸­çš„è¿è¡Œæ•ˆç‡æ¯”Arrayè¦é«˜çš„å¤š
const color = new Float32Array([1.0,1.0,0.0,1.0]);
gl.uniform4v(u_FragColor,color);
</code></pre>
<h3 id="å››ã€ç‰‡å…ƒç€è‰²å™¨çš„ç»˜å›¾åŸç†"><a href="#å››ã€ç‰‡å…ƒç€è‰²å™¨çš„ç»˜å›¾åŸç†" class="headerlink" title="å››ã€ç‰‡å…ƒç€è‰²å™¨çš„ç»˜å›¾åŸç†"></a>å››ã€ç‰‡å…ƒç€è‰²å™¨çš„ç»˜å›¾åŸç†</h3><p>â€‹     æˆ‘ä»¬æ‰€çœ‹åˆ°çš„å›¾å½¢éƒ½æ˜¯ç”±å¤šä¸ªç‰‡å…ƒç»„æˆçš„ï¼Œé‚£ä¹ˆæƒ³è¦ç»˜åˆ¶ç›¸åº”å›¾å½¢ï¼Œåªéœ€è¦æ¸²æŸ“èŒƒå›´å†…çš„ç‰‡å…ƒå°±å¯ä»¥äº†</p>
<p><img src="/2022/11/18/webgl/image-20220922162314987.png"></p>
<p>å…·ä½“ä»£ç å®ç°ï¼š</p>
<pre><code class="javascript">&lt;script id=&quot;fragmentShader&quot; type=&quot;x-shader/x-fragment&quot;&gt;
precision mediump float;
uniform vec4 u_FragColor;
void main()&#123;
  //distanceä¸ºè®¡ç®—ä¸¤ä¸ªç‚¹çš„è·ç¦» distance(p1,p2)
  //gl_PointCoordç‰‡å…ƒåœ¨ä¸€ä¸ªç‚¹ä¸­çš„ä½ç½®æ˜¯ç»Ÿä¸€åŒ–çš„
  //discardä¸¢å¼ƒï¼Œä¸ä¼šè¿›è¡Œæ¸²æŸ“
float dist = distance(gl_PointCoord,vec2(0.5,0.5));
if(dist &lt; 0.5)&#123;
  //è¿›å…¥èŒƒå›´å°±æ¸²æŸ“
    gl_FragColor = u_FragColor;
&#125;else&#123;
    discard;
&#125;
&#125;
&lt;/script&gt;
</code></pre>
<h3 id="äº”ã€ç‰‡å…ƒç€è‰²å™¨åˆæˆåŠŸèƒ½"><a href="#äº”ã€ç‰‡å…ƒç€è‰²å™¨åˆæˆåŠŸèƒ½" class="headerlink" title="äº”ã€ç‰‡å…ƒç€è‰²å™¨åˆæˆåŠŸèƒ½"></a>äº”ã€ç‰‡å…ƒç€è‰²å™¨åˆæˆåŠŸèƒ½</h3><p>å¼€å¯ç€è‰²å™¨åˆæˆåŠŸèƒ½å’Œå£°æ˜åˆæˆæ–¹å¼æ‰å¯ä»¥ç”Ÿæ•ˆ</p>
<pre><code class="javascript">//å¼€å¯ç‰‡å…ƒç€è‰²å™¨åˆæˆåŠŸèƒ½
gl.enable(gl.BLEND);
//è®¾ç½®ç‰‡å…ƒç€è‰²å™¨åˆæˆæ–¹å¼
gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);
</code></pre>
<h2 id="ç¬¬å››ç« -æ¶æ„è¡¥é—´åŠ¨ç”»"><a href="#ç¬¬å››ç« -æ¶æ„è¡¥é—´åŠ¨ç”»" class="headerlink" title="ç¬¬å››ç«  æ¶æ„è¡¥é—´åŠ¨ç”»"></a>ç¬¬å››ç«  æ¶æ„è¡¥é—´åŠ¨ç”»</h2><p>å®Œæˆé€æ˜åº¦åŠ¨ç”»</p>
<h3 id="ä¸€ã€å»ºç«‹åˆæˆå¯¹è±¡"><a href="#ä¸€ã€å»ºç«‹åˆæˆå¯¹è±¡" class="headerlink" title="ä¸€ã€å»ºç«‹åˆæˆå¯¹è±¡"></a>ä¸€ã€å»ºç«‹åˆæˆå¯¹è±¡</h3><pre><code class="javascript">export default class Compose &#123;
    constructor()&#123;
//parent çˆ¶å¯¹è±¡ï¼Œåˆæˆå¯¹è±¡å¯ä»¥åµŒå¥—
        this.parent = null;
//children å­å¯¹è±¡é›†åˆï¼Œå…¶é›†åˆå¯ä»¥æ˜¯æ—¶é—´è½¨ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆæˆå¯¹è±¡
        this.children = [];
    &#125;
//æ·»åŠ å­å¯¹è±¡æ–¹æ³•
    add(obj)&#123;
        obj.parent = this;
        this.children.push(obj);
    &#125;
//åŸºäºå½“å‰æ—¶é—´æ›´æ–°å­å¯¹è±¡çŠ¶æ€çš„æ–¹æ³•
    update(t) &#123;
        this.children.forEach((ele)=&gt;&#123;
            ele.update(t);
        &#125;)
    &#125;
&#125;
</code></pre>
<h3 id="äºŒã€å»ºç«‹æ—¶é—´è½¨"><a href="#äºŒã€å»ºç«‹æ—¶é—´è½¨" class="headerlink" title="äºŒã€å»ºç«‹æ—¶é—´è½¨"></a>äºŒã€å»ºç«‹æ—¶é—´è½¨</h3><pre><code class="javascript">export default class Track&#123;
    constructor(target)&#123;
        this.target = target;
        this.parent = null;
        this.start = 0;
        this.timeLen = 5;
        this.loop = false;
        this.keyMap = new Map();
    &#125;
    update(t) &#123;
        const &#123;target,start,timeLen,loop,keyMap&#125; = this;
        //æœ¬åœ°æ—¶é—´
        let time = t - start;
        if(loop)&#123;
            time = time % timeLen;
        &#125;
        //éå†å…³é”®å¸§é›†åˆï¼Œåˆ¤æ–­åœ¨ä¸¤ä¸ªå…³é”®å¸§ä¹‹å‰è¿˜æ˜¯ä¹‹å
        for(const [key,fms] of keyMap)&#123;
            const last = fms.length - 1;
            if(time &lt; fms[0][0])&#123;
                target[key] = fms[0][1]; 
            &#125;else if(time &gt; fms[0][1])&#123;
                target[key] = fms[last][0];
            &#125;else&#123;
                target[key] = getValBetweenFms(time,fms,last);
            &#125;
        &#125;
    &#125;
&#125;

//è·å–ä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´çš„è¡¥é—´çŠ¶æ€çš„æ–¹æ³•
function getValBetweenFms(time,fms,last)&#123;
    for(let i = 0;i &lt; last;i++)&#123;
        //ä¸¤ä¸ªå…³é”®å¸§fm1å’Œfm2
        const fm1 = fms[i];
        const fm2 = fms[i + 1];
        //å¦‚æœåœ¨ä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´ï¼ŒåŸºäºä¸¤ä¸ªå…³é”®å¸§çš„æ—¶é—´å’ŒçŠ¶æ€æ±‚ç‚¹æ–œå¼
        if(time &gt;= fm1[0] &amp;&amp; time &lt;= fm2[0])&#123;
            const delta = &#123;
                x: fm2[0] - fm1[0],
                y: fm2[1] - fm1[1],
            &#125;;
            //è·å–æ–œç‡kå’Œæˆªè·b
            const k = delta.y / delta.x;
            const b = fm1[1] - fm1[0] * k;
            //æ ¹æ®ç‚¹æ–œå¼æ±‚å½“å‰æ—¶é—´å¯¹åº”çš„çŠ¶æ€
            return k * time + b;
        &#125;
    &#125;
&#125;
</code></pre>
<p><img src="/2022/11/18/webgl/image-20220922181506452.png"></p>
<h3 id="ä¸‰ã€ä½¿ç”¨åˆæˆå¯¹è±¡å’Œè½¨é“å¯¹è±¡åˆ¶ä½œè¡¥é—´åŠ¨ç”»"><a href="#ä¸‰ã€ä½¿ç”¨åˆæˆå¯¹è±¡å’Œè½¨é“å¯¹è±¡åˆ¶ä½œè¡¥é—´åŠ¨ç”»" class="headerlink" title="ä¸‰ã€ä½¿ç”¨åˆæˆå¯¹è±¡å’Œè½¨é“å¯¹è±¡åˆ¶ä½œè¡¥é—´åŠ¨ç”»"></a>ä¸‰ã€ä½¿ç”¨åˆæˆå¯¹è±¡å’Œè½¨é“å¯¹è±¡åˆ¶ä½œè¡¥é—´åŠ¨ç”»</h3><pre><code class="javascript">//å¼•å…¥åˆæˆå¯¹è±¡Composeå’Œè½¨é“å¯¹è±¡Track
import Compose from &#39;./utils/Compose.js&#39;
import Track from &#39;./utils/ComposeOne.js&#39;
</code></pre>
<pre><code class="javascript">const compose = new Compose();
</code></pre>
<pre><code class="javascript">const obj = &#123;x,y,size&#125;;
starts.push(obj);
//å»ºç«‹è½¨é“å¯¹è±¡
const track = new Track(obj);
track.start = new Date();
track.timeLen = 2000;
track.loop = true;
track.keyMap = new Map([
            [
                &#39;size&#39;,
                [
                    [500,size],
                    [1000,0],
                    [1500,size]
                ]
            ]
           ])
compose.add(track);
</code></pre>
<pre><code class="javascript">//è¿ç»­æ¸²æŸ“
!(function ani()&#123;
            compose.update(new Date());
            render();
            requestAnimationFrame(ani);
 &#125;)()
 //æ¸²æŸ“æ–¹æ³•
 function render()&#123;
gl.clear(gl.COLOR_BUFFER_BIT);
starts.forEach((&#123;x,y,size&#125;)=&gt;&#123;
   gl.vertexAttrib2f(a_Position,x,y);
   gl.vertexAttrib1f(a_PointSize,size);
   gl.uniform4f(u_FragColor, 1.0, 1.0,1.0, Math.random()*1);
   
  gl.drawArrays(gl.POINTS,0,1);
            &#125;)
        &#125;
</code></pre>
<h2 id="ç¬¬äº”ç« -ç»˜åˆ¶å¤šç‚¹å›¾å½¢"><a href="#ç¬¬äº”ç« -ç»˜åˆ¶å¤šç‚¹å›¾å½¢" class="headerlink" title="ç¬¬äº”ç«  ç»˜åˆ¶å¤šç‚¹å›¾å½¢"></a>ç¬¬äº”ç«  ç»˜åˆ¶å¤šç‚¹å›¾å½¢</h2><h3 id="ä¸€ã€ç»˜åˆ¶å¤šç‚¹æ­¥éª¤"><a href="#ä¸€ã€ç»˜åˆ¶å¤šç‚¹æ­¥éª¤" class="headerlink" title="ä¸€ã€ç»˜åˆ¶å¤šç‚¹æ­¥éª¤"></a>ä¸€ã€ç»˜åˆ¶å¤šç‚¹æ­¥éª¤</h3><p>å’Œä¹‹å‰çš„webglç»˜å›¾æµç¨‹æ˜¯ä¸€æ ·çš„åªæ˜¯èµ‹å€¼attributeä¸ä¸€æ ·</p>
<pre><code class="html">&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;webglå¤šç‚¹ç»˜åˆ¶&lt;/title&gt;
    &lt;style&gt;
        body&#123;
            margin: 0;
            overflow: hidden;
        &#125;
        #canvas&#123;
            background-color: antiquewhite;
        &#125;
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;canvas id=&quot;canvas&quot;&gt;&lt;/canvas&gt;
    &lt;!-- é¡¶ç‚¹ç€è‰²å™¨ --&gt;
    &lt;script id=&quot;vertexShader&quot; type=&quot;x-shader/x-vertex&quot;&gt;
        attribute vec4 a_Position;
        void main()&#123;
            gl_Position = a_Position;
            gl_PointSize = 50.0;
        &#125;
    &lt;/script&gt;
    &lt;!-- ç‰‡å…ƒç€è‰²å™¨ --&gt;
    &lt;script id=&quot;fragmentShader&quot; type=&quot;x-shader/x-fragment&quot;&gt;
        void main()&#123;
            gl_FragColor = vec4(1,1,1,1);
        &#125;
    &lt;/script&gt;
    &lt;script type=&quot;module&quot;&gt;
        import &#123;initShaders&#125; from &#39;./utils/index.js&#39;
        //canvasç”»å¸ƒï¼Œè·å–ä¸Šä¸‹æ–‡å¯¹è±¡
        const canvas = document.querySelector(&#39;#canvas&#39;);
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        //webglç”»ç¬”
        const gl = canvas.getContext(&quot;webgl&quot;);
        //é¡¶ç‚¹ç€è‰²å™¨æ–‡æœ¬
        const vsSource = document.getElementById(&#39;vertexShader&#39;).innerText;
        //ç‰‡å…ƒèˆè‰²å™¨æ–‡æœ¬
        const fsSourse = document.getElementById(&#39;fragmentShader&#39;).innerText;
        //åˆå§‹åŒ–ç€è‰²å™¨
        initShaders(gl,vsSource,fsSourse);
      //è®¾ç½®attributeå˜é‡
        const a_Position =                        gl.getAttribLocation(gl.program, &#39;a_Position&#39;);
        //åœ¨è¿™å¼€å§‹ä¿®æ”¹

        //æŒ‡å®šå°†è¦ç”¨æ¥æ¸…ç†ç»˜å›¾åŒºçš„é¢œè‰²
        gl.clearColor(0,0,0,1);
        //æ¸…ç†ç»˜å›¾åŒº
        gl.clear(gl.COLOR_BUFFER_BIT);
        //ç»˜åˆ¶é¡¶ç‚¹
        gl.drawArrays(gl.POINTS,0,1);
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="äºŒã€ç»˜åˆ¶å¤šç‚¹"><a href="#äºŒã€ç»˜åˆ¶å¤šç‚¹" class="headerlink" title="äºŒã€ç»˜åˆ¶å¤šç‚¹"></a>äºŒã€ç»˜åˆ¶å¤šç‚¹</h3><p><img src="/2022/11/18/webgl/image-20220923105127932.png"></p>
<pre><code class="javascript">//å¦‚ä½•å‘attributeå˜é‡ä¸­å†™å…¥å¤šç‚¹ï¼Œå¹¶ç»˜åˆ¶å¤šç‚¹
//åˆ›å»ºé¡¶ç‚¹æ•°æ®
const vertices =new Float32Array([0.0,0.1,-0.1,-0.1,0.1,-0.1])
//å»ºç«‹ç¼“å­˜å¯¹è±¡ï¼Œç‹¬ç«‹ç¼“å­˜åŒº
const vertexBuffer = gl.createBuffer();
//ç»‘å®šç¼“å­˜å¯¹è±¡
gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
//å†™å…¥æ•°æ®
gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);
//è·å–attributeå˜é‡
gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0);
//å¼€å¯æ‰¹å¤„ç†åŠŸèƒ½
gl.enableVertexAttribArray(a_Position);
</code></pre>
<pre><code class="javascript">//æ·»åŠ é¡¶ç‚¹çš„æ—¶å€™ï¼Œä¹Ÿè¦ä¿®æ”¹ç»˜åˆ¶é¡¶ç‚¹çš„æ•°é‡ 
//ç»˜åˆ¶é¡¶ç‚¹
 gl.drawArrays(gl.POINTS,0,3);
</code></pre>
<h3 id="ä¸‰ã€ç»˜åˆ¶ä¸‰è§’é¢"><a href="#ä¸‰ã€ç»˜åˆ¶ä¸‰è§’é¢" class="headerlink" title="ä¸‰ã€ç»˜åˆ¶ä¸‰è§’é¢"></a>ä¸‰ã€ç»˜åˆ¶ä¸‰è§’é¢</h3><pre><code class="javascript">//ä¸éœ€è¦é¡¶ç‚¹å¤§å°äº†
//ä¿®æ”¹ç»˜å›¾æ–¹å¼å°±å¯ä»¥äº†
gl.drawArrays(gl.TRIANGLES,0,3);
</code></pre>
<h3 id="å››ã€ç»˜åˆ¶çº¿"><a href="#å››ã€ç»˜åˆ¶çº¿" class="headerlink" title="å››ã€ç»˜åˆ¶çº¿"></a>å››ã€ç»˜åˆ¶çº¿</h3><p>ç»˜åˆ¶çº¿çš„æ–¹å¼ä¸»è¦æ˜¯ä¿®æ”¹é¡¶ç‚¹ä¸ªæ•°å’Œç»˜å›¾æ–¹å¼gl.drawArrays(mode,first,count);</p>
<ul>
<li>POINTS å¯è§†çš„ç‚¹</li>
<li>LINES å•ç‹¬çº¿æ®µ</li>
<li>LINE_STRIP çº¿æ¡</li>
<li>LINE_LOOPé—­åˆçº¿æ¡</li>
<li>TRIANGLES å•ç‹¬ä¸‰è§’å½¢</li>
<li>TRIANGLE_STRIP ä¸‰è§’å¸¦</li>
<li>TRIANGLE_FAN ä¸‰è§’æ‰‡</li>
</ul>
<h3 id="äº”ã€ä¸‰è§’å¸¦å’Œä¸‰è§’æ‰‡çš„è§„åˆ™"><a href="#äº”ã€ä¸‰è§’å¸¦å’Œä¸‰è§’æ‰‡çš„è§„åˆ™" class="headerlink" title="äº”ã€ä¸‰è§’å¸¦å’Œä¸‰è§’æ‰‡çš„è§„åˆ™"></a>äº”ã€ä¸‰è§’å¸¦å’Œä¸‰è§’æ‰‡çš„è§„åˆ™</h3><p><img src="/2022/11/18/webgl/image-20220923120827422.png"></p>
<p><img src="/2022/11/18/webgl/image-20220923122032402.png"></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webgl/" rel="tag">webgl</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
    <article
  id="post-å‰ç«¯é¢è¯•å¤§å…¨ä¹‹æ‰‹å†™ä»£ç ä¸€"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2022/11/17/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8%E4%B9%8B%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81%E4%B8%80/"
    >å‰ç«¯é¢è¯•å¤§å…¨ä¹‹æ‰‹å†™ä»£ç ä¸€</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2022/11/17/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8%E4%B9%8B%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81%E4%B8%80/" class="article-date">
  <time datetime="2022-11-17T06:51:50.000Z" itemprop="datePublished">2022-11-17</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E9%9D%A2%E8%AF%95/">æŠ€æœ¯é¢è¯•</a> / <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E9%9D%A2%E8%AF%95/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95%E5%A4%A7%E5%85%A8%E4%B9%8B%E6%89%8B%E5%86%99%E4%BB%A3%E7%A0%81%E4%B8%80/">å‰ç«¯é¢è¯•å¤§å…¨ä¹‹æ‰‹å†™ä»£ç ä¸€</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="å‰ç«¯é¢è¯•å¤§å…¨ä¹‹æ‰‹å†™ä»£ç ï¼ˆä¸€ï¼‰"><a href="#å‰ç«¯é¢è¯•å¤§å…¨ä¹‹æ‰‹å†™ä»£ç ï¼ˆä¸€ï¼‰" class="headerlink" title="å‰ç«¯é¢è¯•å¤§å…¨ä¹‹æ‰‹å†™ä»£ç ï¼ˆä¸€ï¼‰"></a>å‰ç«¯é¢è¯•å¤§å…¨ä¹‹æ‰‹å†™ä»£ç ï¼ˆä¸€ï¼‰</h1><p>æ¯æ—¥12é¢˜ï¼ˆé«˜é¢‘åŸºç¡€ï¼‰</p>
<h3 id="1-æ„é€ å‡½æ•°ç»§æ‰¿"><a href="#1-æ„é€ å‡½æ•°ç»§æ‰¿" class="headerlink" title="1.æ„é€ å‡½æ•°ç»§æ‰¿"></a>1.æ„é€ å‡½æ•°ç»§æ‰¿</h3><pre><code class="javascript">function Super(name,age)&#123;
    this.name = name;
    this.age = age;
    this.color = [&#39;red&#39;,&#39;yellow&#39;,&#39;blue&#39;];
    this.sayHi = function()&#123;
        console.log(&#39;hi&#39;)
    &#125;
    console.log(this)
&#125;
function Sub()&#123;
    Super.apply(this,arguments)
    this.height = 180;
&#125;

var instance1 = new Sub(&#39;mengfeng&#39;,25);
var instance2 = new Sub(&#39;mengfeng123&#39;,24);
instance1.sayHi();
</code></pre>
<h3 id="2-è®¡æ—¶å™¨"><a href="#2-è®¡æ—¶å™¨" class="headerlink" title="2.è®¡æ—¶å™¨"></a>2.è®¡æ—¶å™¨</h3><pre><code class="javascript">var i = 10;
let fn = () =&gt; &#123;
    console.log(i--);
&#125;
function mySetInterval(fn, delay, times) &#123;
    let timer = setTimeout(function a() &#123;
        fn()
        times--
        timer = setTimeout(a, delay)
        if (times &lt;= 0) &#123;
            clearTimeout(timer)
        &#125;
    &#125;, delay)
&#125;
mySetInterval(fn, 1000, 10)
</code></pre>
<h3 id="3-å¯„ç”Ÿç»„åˆç»§æ‰¿"><a href="#3-å¯„ç”Ÿç»„åˆç»§æ‰¿" class="headerlink" title="3.å¯„ç”Ÿç»„åˆç»§æ‰¿"></a>3.å¯„ç”Ÿç»„åˆç»§æ‰¿</h3><pre><code class="javascript"> function inheritPrototype(Sub,Super)&#123;
    var subPrototype=Object.create(Super.prototype)
    subPrototype.constructor=Sub
    Sub.prototype=subPrototype
    
  &#125;
  function Super(name)&#123;
    this.name=name
  &#125;
  Super.prototype.sayHi=function()&#123;
    console.log(this.name)//ccdida
  &#125;
  function Sub(name)&#123;
    Super.call(this,name)
  &#125;
  inheritPrototype(Sub,Super)

  Sub.prototype.sayHello=function()&#123;
    console.log(&#39;sayHello&#39;)
  &#125;

  var instance1=new Sub(&#39;ccdida&#39;)
  console.log(instance1.__proto__)
  console.log(instance1.__proto__.__proto__)
</code></pre>
<h3 id="4-æŸ¯é‡ŒåŒ–å‡½æ•°"><a href="#4-æŸ¯é‡ŒåŒ–å‡½æ•°" class="headerlink" title="4.æŸ¯é‡ŒåŒ–å‡½æ•°"></a>4.æŸ¯é‡ŒåŒ–å‡½æ•°</h3><pre><code class="javascript">function add() &#123;
    const _args = [...arguments];
    function fn() &#123;
      _args.push(...arguments);
      return fn; //ä¸€ç›´é‡å¤æ”¶é›†å‚æ•°
    &#125;
    fn.toString = function() &#123;
      return _args.reduce((sum, cur) =&gt; sum + cur);
    &#125;
    return fn;
  &#125;
console.log(add(1)(2)(3)(4).toString())
console.log(add(1,2)(1, 2, 3)(2).toString())
</code></pre>
<h3 id="5-åƒä½ç¬¦"><a href="#5-åƒä½ç¬¦" class="headerlink" title="5.åƒä½ç¬¦"></a>5.åƒä½ç¬¦</h3><pre><code class="javascript">// å°†é‡‘é¢ç±»å‹è½¬ä¸ºæ•°å­—ç±»å‹
function toNum(str) &#123;
    return str.replace(/\,|\ï¿¥/g, &quot;&quot;);
&#125;

// ä¿ç•™ä¸¤ä½å°æ•°ï¼ˆå››èˆäº”å…¥ï¼‰
function toPrice(num) &#123;
    num = parseFloat(toNum(num)).toFixed(2).toString().split(&quot;.&quot;);
    num[0] = num[0].replace(new RegExp(&#39;(\\d)(?=(\\d&#123;3&#125;)+$)&#39;,&#39;ig&#39;),&quot;$1,&quot;);
    return &quot;ï¿¥&quot; + num.join(&quot;.&quot;);
&#125;

// ä¿ç•™ä¸¤ä½å°æ•°ï¼ˆä¸å››èˆäº”å…¥ï¼‰
function toPrice1(num) &#123;
    num = parseFloat(toNum(num).replace(/(\.\d&#123;2&#125;)\d+$/,&quot;$1&quot;)).toFixed(2).toString().split(&quot;.&quot;);
    num[0] = num[0].replace(new RegExp(&#39;(\\d)(?=(\\d&#123;3&#125;)+$)&#39;,&#39;ig&#39;),&quot;$1,&quot;);
    return &quot;ï¿¥&quot; + num.join(&quot;.&quot;);;
&#125;

// ä¸å¤„ç†å°æ•°éƒ¨åˆ†
function toPrice2(num) &#123;
    var source = toNum(num).split(&quot;.&quot;);
    source[0] = source[0].replace(new RegExp(&#39;(\\d)(?=(\\d&#123;3&#125;)+$)&#39;,&#39;ig&#39;),&quot;$1,&quot;);
    return &quot;ï¿¥&quot; + source.join(&quot;.&quot;)
&#125;

console.log(toPrice(&#39;12312.236&#39;)) //ï¿¥12,312.24
console.log(toPrice1(&#39;12312.234&#39;)) //ï¿¥12,312.23
console.log(toPrice2(&#39;1232342312.234&#39;)) //ï¿¥1,232,342,312.234
</code></pre>
<h3 id="6-æ·±æ‹·è´"><a href="#6-æ·±æ‹·è´" class="headerlink" title="6.æ·±æ‹·è´"></a>6.æ·±æ‹·è´</h3><pre><code class="javascript">function deepClone(obj,hash = new WeakMap())&#123;
    if(obj == null) return obj;
    if(obj instanceof Date) return new Date(obj);
    if(obj instanceof RegExp) return new RegExp(obj);
    if(typeof obj !== &#39;object&#39;) return obj;
    if(hash.get(obj)) return hash.get(obj);
    let cloneObj = new obj.constructor;
    hash.set(obj,cloneObj);
    for(let key in obj)&#123;
        if(obj.hasOwnProperty(key))&#123;
            cloneObj[key] = deepClone(obj[key],hash);
        &#125;
    &#125;
    return cloneObj;
&#125;

let obj = &#123;name:1,address:&#123;x:1000&#125;&#125;;
let d = deepClone(obj);
obj.address.x = 200;
console.log(d); //&#123;name:1,address:&#123;x:1000&#125;&#125;
</code></pre>
<h3 id="7-æ•°ç»„æ‰å¹³åŒ–"><a href="#7-æ•°ç»„æ‰å¹³åŒ–" class="headerlink" title="7.æ•°ç»„æ‰å¹³åŒ–"></a>7.æ•°ç»„æ‰å¹³åŒ–</h3><pre><code class="javascript">//é€’å½’å®ç°
var arr = [1,2,[3,4,[5,6]]]
function flatten(arr)&#123;
    let result = []
    arr.forEach(item =&gt; &#123;
        if(Array.isArray(item))&#123;
            result = result.concat(flatten(item))
        &#125;else&#123;
            result.push(item)
        &#125;
    &#125;);
    return result
&#125;
console.log(flatten(arr)) //[ 1, 2, 3, 4, 5, 6 ]

//åˆ©ç”¨reduceå‡½æ•°è¿­ä»£
var arr1 = [1,2,[3,4,[5,6]]]
function flatten1(arr)&#123;
    return arr.reduce((res,next) =&gt; &#123;
        return res.concat(Array.isArray(next) ? flatten1(next) : next)
    &#125;,[])
&#125;
console.log(flatten1(arr1)) //[ 1, 2, 3, 4, 5, 6 ]
</code></pre>
<h3 id="8-åŸå‹é“¾ç»§æ‰¿"><a href="#8-åŸå‹é“¾ç»§æ‰¿" class="headerlink" title="8.åŸå‹é“¾ç»§æ‰¿"></a>8.åŸå‹é“¾ç»§æ‰¿</h3><pre><code class="javascript">//1.åŸå‹é“¾ç»§æ‰¿
function Super()&#123;
    this.color = [&#39;red&#39;,&#39;yellow&#39;,&#39;black&#39;]
&#125;
function Sub()&#123;
&#125;

Sub.prototype = new Super();
const instance1 = new Sub();
const instance2 = new Sub();
console.log(instance1.__proto__.color === instance2.__proto__.color)//true
</code></pre>
<h3 id="9-ç»„åˆç»§æ‰¿"><a href="#9-ç»„åˆç»§æ‰¿" class="headerlink" title="9.ç»„åˆç»§æ‰¿"></a>9.ç»„åˆç»§æ‰¿</h3><pre><code class="javascript">function Super(name,age)&#123;
    this.name = name;
    this.age = age;
    this.color = [&#39;red&#39;,&#39;yellow&#39;,&#39;blue&#39;]
&#125;

Super.prototype.sayHi = function()&#123;
    console.log(&#39;hi&#39;)
&#125;

function Sub(name,age,height)&#123;
    Super.apply(this,arguments)
    this.height = height;
&#125;

Sub.prototype = new Super(&#39;w&#39;,22);
Sub.prototype.constructor = Sub;
console.log(Sub.prototype)
Sub.prototype.sayHello = function()&#123;
    console.log(&#39;hello&#39;)
&#125;

var instance1 = new Sub(&#39;mengfeng&#39;,23,180);
var instance2 = new Sub(&#39;mengfeng123&#39;,24,181);
console.log(instance1)
</code></pre>
<h3 id="10-instanceof"><a href="#10-instanceof" class="headerlink" title="10.instanceof"></a>10.instanceof</h3><pre><code class="javascript">function new_instance_of(leftValue,rightValue)&#123;
    let rightProto = rightValue.prototype;//å–å³è¾¹è¡¨è¾¾å¼çš„ prototype å€¼
    leftValue = leftValue.__proto__;//å–å·¦è¡¨è¾¾å¼çš„ __proto__ å€¼
    while(true)&#123;
        if(leftValue == null)&#123;
            return false;
        &#125;
        if(leftValue === rightProto)&#123;
            return true;
        &#125;
        leftValue = leftValue.__proto__;
    &#125;
&#125;
function Foo()&#123;&#125;
console.log(new_instance_of(Foo,Object))//true
</code></pre>
<h3 id="11-promise-all"><a href="#11-promise-all" class="headerlink" title="11.promise.all"></a>11.promise.all</h3><pre><code class="javascript">Promise.prototype.all = function(promises)&#123;
    let results = [];
    let promiseCount = 0;
    let promisesLength = promises.length;
    return new Promise(function(resolve,reject)&#123;
        for(let val of promises)&#123;
            Promise.resolve(val).then(function(res)&#123;
                promiseCount++;
                results[i] = res;
                if(promiseCount === promisesLength)&#123;
                    return resolve(results);
                &#125;
            &#125;,function(err)&#123;
                return reject(err);
            &#125;)
        &#125;
    &#125;)
&#125;

let promise1 = new Promise(function(resolve) &#123;
    resolve(1);
  &#125;);
  let promise2 = new Promise(function(resolve) &#123;
    resolve(2);
  &#125;);
  let promise3 = new Promise(function(resolve) &#123;
    resolve(3);
  &#125;);
  
  let promiseAll = Promise.all([promise1, promise2, promise3]);
  promiseAll.then(function(res) &#123;
    console.log(res);
  &#125;);
</code></pre>
<h3 id="12-promise-race"><a href="#12-promise-race" class="headerlink" title="12.promise.race"></a>12.promise.race</h3><pre><code class="javascript">Promise.race = function(promises)&#123;
    //å°†å¯è¿­ä»£å¯¹è±¡è½¬æ¢ä¸ºæ•°ç»„
    promises = Array.from(promises);
    return new Promise((resolve,reject)=&gt;&#123;
        if(promises.length === 0)&#123;
            //ç©ºçš„å¯è¿­ä»£å¯¹è±¡ï¼Œç”¨äºpendingçŠ¶æ€
        &#125;else&#123;
            for(let i = 0;i &lt; promises.length;i++)&#123;
                Promise.resolve(promises[i]).then((data)=&gt;&#123;
                    resolve(data);
                &#125;).catch((reason)=&gt;&#123;
                    reject(reason)
                &#125;)
            &#125;
        &#125;
    &#125;)
&#125;

let p1 = new Promise(function(resolve,reject)&#123;
    setTimeout(function()&#123;
     resolve(&#39;success&#39;)
    &#125;,1000)
&#125;)

let p2 = new Promise(function(resolve,reject)&#123;
    setTimeout(function()&#123;
     resolve(&#39;faild&#39;)
    &#125;,500)
&#125;)

Promise.race([p1,p2]).then(result=&gt;&#123;
console.log(result)             //  faild    faildè€—æ—¶çŸ­
&#125;)
</code></pre>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">é¢è¯•</a></li></ul>

    </footer>
  </div>

   
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">ä¸Šä¸€é¡µ</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/5/">ä¸‹ä¸€é¡µ</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2022-2023
        <i class="ri-heart-fill heart_icon"></i> alan_mf
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzzç»Ÿè®¡ -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="è‰ºæœ¯ç ç•œ"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">ä¸»é¡µ</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">å½’æ¡£</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">åˆ†ç±»</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">æ ‡ç­¾</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/%E6%97%85%E8%A1%8C/">æ—…è¡Œ</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://www.zcool.com.cn/u/21686563">æ‘„å½±</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">å‹é“¾</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">å…³äºæˆ‘</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/player">æ’­æ”¾å™¨</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>è¯·æˆ‘å–æ¯å’–å•¡å§~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/zfb.jpeg">
      <span class="reward-type">æ”¯ä»˜å®</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wx.jpeg">
      <span class="reward-type">å¾®ä¿¡</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // sliderå±•å¼€çŠ¶æ€
                // todo: è¿™æ ·ä¸å¥½ï¼Œåé¢æ”¹æˆçŠ¶æ€
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // è·å¾—åŸå›¾å°ºå¯¸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script>

<script src="/js/clickBoom1.js"></script>
 
<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // ç­‰å¾…ä¸¤ç§’é’Ÿåæ¢å¤
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=22707008&auto=1&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
    

  </div>
</body>

</html>